/*! For license information please see index.win32.bundle.LICENSE.txt */
!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="http://localhost:8081/",n(n.s=70)}([function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.SessionHealthSource=t.SessionHealthReason=t.SessionHealthImpact=t.SessionHealthEvent=t.SessionHealth=void 0,r(n(92),t),r(n(94),t),r(n(95),t),r(n(96),t),r(n(97),t);var i=n(99);Object.defineProperty(t,"SessionHealth",{enumerable:!0,get:function(){return i.SessionHealth}}),Object.defineProperty(t,"SessionHealthEvent",{enumerable:!0,get:function(){return i.SessionHealth}}),Object.defineProperty(t,"SessionHealthImpact",{enumerable:!0,get:function(){return i.SessionHealthImpact}}),Object.defineProperty(t,"SessionHealthReason",{enumerable:!0,get:function(){return i.SessionHealthReason}}),Object.defineProperty(t,"SessionHealthSource",{enumerable:!0,get:function(){return i.SessionHealthSource}})},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.runtimeALv1=void 0,r(n(41),t),r(n(101),t);var i=n(102);Object.defineProperty(t,"runtimeALv1",{enumerable:!0,get:function(){return i.runtimeALv1}})},function(e,t,n){"use strict";var o=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.isServerOp=t.getSafeNumber=t.buildArrayOfTypes=t.LogCountLimiter=t.Utils=void 0;var r=n(0),i=n(4),s=n(3),a=function(){function e(){}return e.createHealthCheckRequest=function(e){return{payload:{},payloadSchema:{category:i.TypeCategory.Schema,schema:{name:"HealthCheckRequest"}},requestedSchema:{category:i.TypeCategory.Schema,schema:{name:"HealthCheckResponse"}},clientMetadata:e}},e.isFeatureEnabled=function(e,t,n,o){return void 0===n&&(n=!1),void 0===o&&(o="None"),e&&e.isFeatureEnabled?e.isFeatureEnabled("Microsoft.Office.AugLoop."+t,o).catch((function(){return Promise.resolve(n)})):Promise.resolve(n)},e.convertWebSocketUrlToHttp=function(e){return this.convertUrl(e,!1)},e.convertServiceUrlToWebSocket=function(e){return this.convertUrl(e,!0)},e.convertUrl=function(e,t){if(!e)return e;var n=e.split(":"),o=n[0].toLowerCase();return 0==o.indexOf(t?"http":"ws")?(o=t?o.replace("http","ws"):o.replace("ws","http"),n[0]=o,n.join(":")):e},e.getCurrentTimeMs=function(){return Date.now?Date.now():(new Date).getTime()},e}();t.Utils=a;var u=function(){function e(e){this.maxNumberOfLogs=40,this.numberOfLogs=0,this.id=e}return e.prototype.log=function(e){if(this.numberOfLogs<this.maxNumberOfLogs&&(this.numberOfLogs++,e(),this.numberOfLogs===this.maxNumberOfLogs)){var t=new r.Operation({operationName:"OnLastLog",success:!0,resourceId:this.id,resultDescription:"Limit for number of logs for id: "+this.id+" reached - all next logs will be dropped"});r.Log.warn(572838107,r.LogCategory.CoreDefault,t)}},e}();t.LogCountLimiter=u;var c=[s.SchemaObject.getTypeName(),s.Annotation.getTypeName(),s.Signal.getTypeName()];t.buildArrayOfTypes=function(e){for(var t=new Set,n=0,r=e;n<r.length;n++){var i=r[n];if("string"==typeof i)-1===c.indexOf(i)&&t.add(i);else for(var s=0,a=o([i.getTypeName()],i.getBaseTypes(),!0);s<a.length;s++){var u=a[s];-1===c.indexOf(u)&&t.add(u)}}return Array.from(t)};t.getSafeNumber=function(e,t){return void 0===t&&(t=0),Number.isFinite(e)?e:t};t.isServerOp=function(e,t){if(!Array.isArray(t)||0===t.length)return!0;if(s.DeltaUpdateOperation.typeGuard(e)||s.UpdateAnnotationMetaDataOperation.typeGuard(e))return!0;for(var n=0,o=e.items;n<o.length;n++){var r=o[n];if(!r.body||s.SchemaObject.matchesTypesFor(r.body,t))return!0}return!1}},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(22),t),r(n(26),t),r(n(27),t),r(n(6),t),r(n(28),t),r(n(29),t),r(n(114),t),r(n(115),t),r(n(23),t),r(n(24),t),r(n(25),t)},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(17),t),r(n(33),t),r(n(34),t),r(n(18),t),r(n(19),t)},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(51),t),r(n(117),t),r(n(120),t)},function(e,t,n){"use strict";var o=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.SchemaObject=void 0;var r=function(){function e(t){e.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_SchemaObject"},e.getBaseTypes=function(){return[]},e.getTypeNameFor=function(e){return e&&e.H_?e.H_.T_:void 0},e.getBaseTypesFor=function(e){return e&&e.H_&&e.H_.B_?e.H_.B_:[]},e.getAllTypesFor=function(t){var n=e.getTypeNameFor(t);return n?o([n],e.getBaseTypesFor(t),!0):[]},e.matchesTypesFor=function(t,n){if(!Array.isArray(n)||0===n.length)return!0;for(var o=e.getTypeNameFor(t),r=e.getBaseTypesFor(t),i=0,s=n;i<s.length;i++){var a=s[i];if(a===o)return!0;if(r.indexOf(a)>=0)return!0}return!1},e.assign=function(e,t,n){if(n)for(var o=0,r=Object.keys(n);o<r.length;o++){var i=r[o];t[i]=n[i]}return t.H_=e.H_,t},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SchemaObject=r},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(21),t),r(n(30),t),r(n(31),t),r(n(32),t),r(n(35),t),r(n(36),t),r(n(38),t),r(n(37),t)},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.Net=t.WebSocketWorker=t.Utils=t.TokenCache=t.TelemetryLogger=t.JoinWorkflow=t.SingleItemWorkflow=t.getVersion=t.createRuntime=t.runtime=t.internalFetch=t.estimateSize=t.BatchManager=void 0;var i=n(45);Object.defineProperty(t,"BatchManager",{enumerable:!0,get:function(){return i.BatchManager}});var s=n(46);Object.defineProperty(t,"estimateSize",{enumerable:!0,get:function(){return s.estimateSize}});var a=n(47);Object.defineProperty(t,"internalFetch",{enumerable:!0,get:function(){return a.internalFetch}}),r(n(111),t);var u=n(112);Object.defineProperty(t,"runtime",{enumerable:!0,get:function(){return u.runtime}}),Object.defineProperty(t,"createRuntime",{enumerable:!0,get:function(){return u.createRuntime}}),Object.defineProperty(t,"getVersion",{enumerable:!0,get:function(){return u.getVersion}});var c=n(162);Object.defineProperty(t,"SingleItemWorkflow",{enumerable:!0,get:function(){return c.SingleItemWorkflow}});var l=n(163);Object.defineProperty(t,"JoinWorkflow",{enumerable:!0,get:function(){return l.JoinWorkflow}});var p=n(49);Object.defineProperty(t,"TelemetryLogger",{enumerable:!0,get:function(){return p.TelemetryLogger}});var f=n(164);Object.defineProperty(t,"TokenCache",{enumerable:!0,get:function(){return f.TokenCache}});var d=n(2);Object.defineProperty(t,"Utils",{enumerable:!0,get:function(){return d.Utils}});var h=n(50);Object.defineProperty(t,"WebSocketWorker",{enumerable:!0,get:function(){return h.WebSocketWorker}});var g=n(165);Object.defineProperty(t,"Net",{enumerable:!0,get:function(){return g.Net}})},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(22),t),r(n(87),t),r(n(23),t),r(n(24),t),r(n(25),t),r(n(26),t),r(n(88),t),r(n(27),t),r(n(6),t),r(n(28),t),r(n(29),t)},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(176),t),r(n(17),t),r(n(177),t),r(n(60),t),r(n(178),t),r(n(33),t),r(n(179),t),r(n(180),t),r(n(181),t),r(n(182),t),r(n(183),t),r(n(184),t),r(n(185),t),r(n(186),t),r(n(34),t),r(n(187),t),r(n(188),t),r(n(189),t),r(n(190),t),r(n(191),t),r(n(192),t),r(n(18),t),r(n(193),t),r(n(194),t),r(n(61),t),r(n(62),t),r(n(195),t),r(n(196),t),r(n(197),t),r(n(198),t),r(n(199),t),r(n(200),t),r(n(201),t),r(n(63),t),r(n(202),t),r(n(203),t),r(n(204),t),r(n(64),t),r(n(19),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultThrottlingIntervalSecondsPromise=t.defaultBatchSizeKBPromise=t.defaultBatchIntervalSecondsPromise=t.isWin32=t.setAuthTicketsOnSharedLambda=t.getAuthTickets=t.ClpGlobals=t.DocumentMetadata=t.fixKnownErrorsForTextTileEventAndIgnoreIfTrivial=t.getSensitiveItemsCount=t.clpTextTileGroupingKeyExtractor=t.getEditorUIResponse=t.getCritiques=t.getCritique=t.getDeleteCritiques=t.updatePreviousEditorUIResponse=t.isCacheModified=t.updatePreviousCache=t.getEmptyLabellingEditorUIResponse=t.getNewRequestSequence=t.addCritique=void 0;var o=n(11),r=n(15),i=n(14),s=n(208),a=n(13);t.addCritique=function(e,t){var n=null,o=a.clpGlobals.documents.get(e);(n=o.getCurrentCritiques()?o.getCurrentCritiques():new Set).add(t),o.setCurrentCritiques(n)};t.getNewRequestSequence=function(e){var t=a.clpGlobals.documents.get(e);return t.setLabellingRequestSequence(t.getLabellingRequestSequence()+1),t.getLabellingRequestSequence()};t.getEmptyLabellingEditorUIResponse=function(e){return{docSessionID:e,recommendedLabel:{responsiblePolicy:{},sensitivityLabel:{},locale:a.clpGlobals.officeUILanguage,critiques:[],deleteCritiques:[]},automaticApplyLabel:{responsiblePolicy:{},sensitivityLabel:{},locale:a.clpGlobals.officeUILanguage,critiques:[],deleteCritiques:[]}}};t.updatePreviousCache=function(e,t,n){var o=a.clpGlobals.documents.get(n);if(o.getPreviousCacheSensitiveItems())o.getPreviousCacheSensitiveItems().set(t,e);else{var r=new Map;r.set(t,e),o.setPreviousCacheSensitiveItems(r)}};t.isCacheModified=function(e){var n=new Map;e.values.forEach((function(e){e&&Array.isArray(e.sensitiveItems)&&e.sensitiveItems.forEach((function(e){void 0!==e.id&&void 0!==e.uniqueCount&&void 0!==e.matches&&(n.has(e.id)?n.set(e.id,n.get(e.id)+e.uniqueCount+e.matches.length):n.set(e.id,e.uniqueCount+e.matches.length))}))}));var o=a.clpGlobals.documents.get(e.id),r=o.getPreviousCacheSensitiveItems().size!==n.size;return r?(o.getPreviousCacheSensitiveItems().clear(),n.forEach((function(n,o){(0,t.updatePreviousCache)(n,o,e.id)})),r):(o.getPreviousCacheSensitiveItems().forEach((function(e,t){e!==n.get(t)&&(r=!0)})),r?(o.getPreviousCacheSensitiveItems().clear(),n.forEach((function(n,o){(0,t.updatePreviousCache)(n,o,e.id)})),r):r)};t.updatePreviousEditorUIResponse=function(e){var t=a.clpGlobals.documents.get(e.docSessionID);t.getCurrentCritiques()&&t.getCurrentCritiques().clear(),t.setPreviousEditorUIResponse(e)};t.getDeleteCritiques=function(e){var t=[],n=a.clpGlobals.documents.get(e),o=n.getPreviousEditorUIResponse(),r=n.getCurrentCritiques();return null!=o&&o.recommendedLabel.critiques.forEach((function(e){r.has(e.inputTileMetadata.classificationCritiqueID)||t.push(e.inputTileMetadata.classificationCritiqueID)})),t};t.getCritique=function(e,n,o){var r={};return r.categoryID=n.id,r.categoryTitle=n.name,r.explanationTitle=n.name,r.explanationDescription=n.description+" "+n.publisherName,r.inputTileMetadata=e.inputTileMetadata,r.length=e.length,r.offset=e.offset,r.text=e.idMatch,r.context="",r.scope=n.scope,(0,t.addCritique)(o,r.inputTileMetadata.classificationCritiqueID),r};t.getCritiques=function(e,n){var o=[];return e.forEach((function(e){e.matches.forEach((function(r){var i=(0,t.getCritique)(r,e,n);null!==i&&o.push(i)}))})),o};t.getEditorUIResponse=function(e){var n=(0,t.getEmptyLabellingEditorUIResponse)(e.documentMetadata.docSessionID);return void 0!==e.recommended.sensitivityLabel&&null!==e.recommended.sensitivityLabel&&(n.recommendedLabel.responsiblePolicy=e.recommended.responsiblePolicy,n.recommendedLabel.sensitivityLabel=e.recommended.sensitivityLabel),n.recommendedLabel.critiques=(0,t.getCritiques)(e.recommended.sensitiveItems,e.documentMetadata.docSessionID),n.recommendedLabel.deleteCritiques=(0,t.getDeleteCritiques)(e.documentMetadata.docSessionID),void 0!==e.automatic.sensitivityLabel&&(n.automaticApplyLabel.responsiblePolicy=e.automatic.responsiblePolicy,n.automaticApplyLabel.sensitivityLabel=e.automatic.sensitivityLabel),(0,t.updatePreviousEditorUIResponse)(n),n};t.clpTextTileGroupingKeyExtractor=function(e){if("string"==typeof e){var t=e;return a.clpGlobals.docIdToDocSessionIdMap.has(e)&&(t=a.clpGlobals.docIdToDocSessionIdMap.get(e)),{primary:t}}var n=(e=e).tile.metadata.docSessionId,o=e.tile.metadata.docId;return a.clpGlobals.docSessionIdToDocIdMap.set(n,o),a.clpGlobals.docIdToDocSessionIdMap.set(o,n),(0,i.textTileGroupingKeyExtractor)(e)};t.getSensitiveItemsCount=function(e){for(var t=0,n=0,o=e.values;n<o.length;n++){var r=o[n];r&&r.sensitiveItems&&r.sensitiveItems.length>=0&&(t+=r.sensitiveItems.length)}return t};t.fixKnownErrorsForTextTileEventAndIgnoreIfTrivial=function(e){var t=(0,r.fixKnownErrorsForTextTileEvent)(e);return t&&t.tile.elements[0].text.length<=4&&0===t.tile.elements[0].text.search(/^([\s\x00-\x1F\x7F]*)$/)&&(t=null),t};var u=function(){function e(e){this.previousEditorUIResponse=null,this.currentCritiques=null,this.labellingRequestSequence=e,this.previousCacheSensitiveItems=new Map}return e.prototype.setPreviousEditorUIResponse=function(e){this.previousEditorUIResponse=e},e.prototype.setCurrentCritiques=function(e){this.currentCritiques=e},e.prototype.setLabellingRequestSequence=function(e){this.labellingRequestSequence=e},e.prototype.setPreviousCacheSensitiveItems=function(e){this.previousCacheSensitiveItems=e},e.prototype.getPreviousEditorUIResponse=function(){return this.previousEditorUIResponse},e.prototype.getCurrentCritiques=function(){return this.currentCritiques},e.prototype.getLabellingRequestSequence=function(){return this.labellingRequestSequence},e.prototype.getPreviousCacheSensitiveItems=function(){return this.previousCacheSensitiveItems},e}();t.DocumentMetadata=u;var c=function(){};t.ClpGlobals=c;t.getAuthTickets=function(){var e=[];switch((0,s.getEnvironment)(a.clpGlobals.serviceUrl)){case s.Environment.dev:case s.Environment.int:case s.Environment.dogfood:case s.Environment.prod:e.push({Provider:o.IdentityProvider.ADAL,ResourceId:"https://graph.microsoft.com",AuthorityUrl:"https://login.microsoftonline.com/common/oauth2/authorize"});break;case s.Environment.gcc:e.push({Provider:o.IdentityProvider.ADAL,ResourceId:"https://graph.microsoft.com",AuthorityUrl:"https://login.windows.net/common/oauth2/authorize"});break;case s.Environment.gccHigh:e.push({Provider:o.IdentityProvider.ADAL,ResourceId:"https://graph.microsoft.us",AuthorityUrl:"https://login.microsoftonline.us/common/oauth2/authorize"});break;case s.Environment.dod:e.push({Provider:o.IdentityProvider.ADAL,ResourceId:"https://dod-graph.microsoft.us",AuthorityUrl:"https://login.microsoftonline.us/common/oauth2/authorize"})}return e};t.setAuthTicketsOnSharedLambda=function(e){e.authTickets=(0,t.getAuthTickets)()};t.isWin32=function(e){return"Win32"===e};t.defaultBatchIntervalSecondsPromise=function(){return new Promise((function(e,t){e(a.clpGlobals.defaultThrottlingIntervalSeconds)}))};t.defaultBatchSizeKBPromise=function(){return new Promise((function(e,t){e(a.clpGlobals.defaultBatchSizeKB)}))};t.defaultThrottlingIntervalSecondsPromise=function(){return new Promise((function(e,t){e(a.clpGlobals.defaultThrottlingIntervalSeconds)}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clpGlobals=void 0,t.clpGlobals={documents:new Map,officeUILanguage:"",serviceUrl:"",docSessionIdToDocIdMap:new Map,docIdToDocSessionIdMap:new Map,classificationResponse:"Classification.Response",classificationBatchedResponse:"Classification.BatchResponse",classificationReduce:"Classification.Reduce",classificationReduceResponse:"Labelling.Response",labellingEditorUIResponse:"Labelling.EditorUIResponse",autoClpLicenseFeatures:[76080228,31135922],defaultBatchIntervalSeconds:3,defaultBatchSizeKB:20,defaultThrottlingIntervalSeconds:3,maxReduceDelayUntilIdleSeconds:5}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.slideTileGroupingKeyExtractor=t.textTileGroupingKeyExtractor=void 0;t.textTileGroupingKeyExtractor=function(e){return{primary:e.tile.metadata.docSessionId,secondary:e.tile.metadata.tileId}};t.slideTileGroupingKeyExtractor=function(e){var t=JSON.parse(e.content.toString()).slides[0],n=JSON.stringify(t.mk);return{primary:e.docId,secondary:n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.expectDefinedAndNotNull=t.fixKnownErrorsForSlideTile=t.fixKnownErrorsForSlideTileContent=t.fixKnownErrorsForSlideTileContentSlides=t.fixKnownErrorsForSlideTileContentSlidesDrawingElems=t.fixKnownErrorsForSlideTileContentSlidesDrawingElemsMoniker=t.fixKnownErrorsForTextTileEvent=void 0;var o=n(11);t.fixKnownErrorsForTextTileEvent=function(e){return e.type===o.Tiling.TextTileEventType.Delete||void 0===e.tile.elements||null===e.tile.elements||0===e.tile.elements.length||void 0===e.tile.elements[0].text||null===e.tile.elements[0].text||0===e.tile.elements[0].text.length?null:e};t.fixKnownErrorsForSlideTileContentSlidesDrawingElemsMoniker=function(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];if("type"===i){var s=e[i].toString();"shape"===s?t[i]=o.Oart.DrawingElementType.shape:"groupShape"===s?t[i]=o.Oart.DrawingElementType.groupShape:"graphicFrame"===s?t[i]=o.Oart.DrawingElementType.graphicFrame:"connector"===s?t[i]=o.Oart.DrawingElementType.connector:"picture"===s?t[i]=o.Oart.DrawingElementType.picture:"ink"===s&&(t[i]=o.Oart.DrawingElementType.ink)}else t[i]=e[i]}return t};t.fixKnownErrorsForSlideTileContentSlidesDrawingElems=function(e){var n=[];return e.forEach((function(e){for(var o={},r=0,i=Object.keys(e);r<i.length;r++){var s=i[r];o[s]="mk"===s?(0,t.fixKnownErrorsForSlideTileContentSlidesDrawingElemsMoniker)(e[s]):e[s]}n.push(o)})),n};t.fixKnownErrorsForSlideTileContentSlides=function(e){for(var n=e,o=0;o<n.length;o++)for(var r=0,i=Object.keys(e[o]);r<i.length;r++){var s=i[r];"drawingElems"===s&&(n[o][s]=(0,t.fixKnownErrorsForSlideTileContentSlidesDrawingElems)(n[o][s]))}return n};t.fixKnownErrorsForSlideTileContent=function(e){for(var n={},o=JSON.parse(e.toString()),r=0,i=Object.keys(o);r<i.length;r++){var s=i[r];"slides"===s&&(n[s]=(0,t.fixKnownErrorsForSlideTileContentSlides)(o[s]))}return n};t.fixKnownErrorsForSlideTile=function(e){for(var n={},o=0,r=Object.keys(e);o<r.length;o++){var i=r[o];n[i]="content"===i?(0,t.fixKnownErrorsForSlideTileContent)(e[i]):e[i]}return n};t.expectDefinedAndNotNull=function(e,t){if(null===t)throw new Error("".concat(e," must be defined and non null"))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LogSeverity=t.IdentityProvider=t.nativeNamespace=void 0,t.nativeNamespace="AugLoopData",function(e){e[e.Unknown=0]="Unknown",e[e.LiveId=1]="LiveId",e[e.OrgId=2]="OrgId",e[e.ActiveDirectory=3]="ActiveDirectory",e[e.ADAL=4]="ADAL",e[e.SSPI=5]="SSPI",e[e.OAuth2=6]="OAuth2"}(t.IdentityProvider||(t.IdentityProvider={})),function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=3]="Info",e[e.Metric=4]="Metric",e[e.Verbose=5]="Verbose",e[e.Debug=6]="Debug"}(t.LogSeverity||(t.LogSeverity={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AuthTokenType=t.IdentityProvider=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.LiveId=1]="LiveId",e[e.OrgId=2]="OrgId",e[e.ActiveDirectory=3]="ActiveDirectory",e[e.ADAL=4]="ADAL",e[e.SSPI=5]="SSPI",e[e.OAuth2=6]="OAuth2",e[e.Badger=7]="Badger"}(t.IdentityProvider||(t.IdentityProvider={})),function(e){e[e.Augloop=0]="Augloop",e[e.Substrate=1]="Substrate"}(t.AuthTokenType||(t.AuthTokenType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExceptionType=t.MessageType=void 0,function(e){e[e.Input=0]="Input",e[e.Exception=1]="Exception",e[e.WaitOn=2]="WaitOn",e[e.StopAndFilterWorkflow=3]="StopAndFilterWorkflow"}(t.MessageType||(t.MessageType={})),function(e){e[e.Unknown=0]="Unknown",e[e.NoOutput=1]="NoOutput",e[e.Authentication=2]="Authentication",e[e.JoinTimedOut=3]="JoinTimedOut",e[e.LambdaThrow=4]="LambdaThrow",e[e.LambdaErrorCallback=5]="LambdaErrorCallback"}(t.ExceptionType||(t.ExceptionType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeCategory=void 0,function(e){e[e.Undefined=0]="Undefined",e[e.Schema=1]="Schema",e[e.Boolean=2]="Boolean",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Buffer=5]="Buffer",e[e.Function=6]="Function"}(t.TypeCategory||(t.TypeCategory={}))},function(e,t,n){"use strict";var o=Object.prototype.hasOwnProperty,r="~";function i(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,n,o,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new s(n,o||e,i),u=r?r+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],a]:e._events[u].push(a):(e._events[u]=a,e._eventsCount++),e}function u(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function c(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),c.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)o.call(e,t)&&n.push(r?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},c.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,s=new Array(i);o<i;o++)s[o]=n[o].fn;return s},c.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},c.prototype.emit=function(e,t,n,o,i,s){var a=r?r+e:e;if(!this._events[a])return!1;var u,c,l=this._events[a],p=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),p){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,o),!0;case 5:return l.fn.call(l.context,t,n,o,i),!0;case 6:return l.fn.call(l.context,t,n,o,i,s),!0}for(c=1,u=new Array(p-1);c<p;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var f,d=l.length;for(c=0;c<d;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),p){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,n);break;case 4:l[c].fn.call(l[c].context,t,n,o);break;default:if(!u)for(f=1,u=new Array(p-1);f<p;f++)u[f-1]=arguments[f];l[c].fn.apply(l[c].context,u)}}return!0},c.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},c.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},c.prototype.removeListener=function(e,t,n,o){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return u(this,i),this;var s=this._events[i];if(s.fn)s.fn!==t||o&&!s.once||n&&s.context!==n||u(this,i);else{for(var a=0,c=[],l=s.length;a<l;a++)(s[a].fn!==t||o&&!s[a].once||n&&s[a].context!==n)&&c.push(s[a]);c.length?this._events[i]=1===c.length?c[0]:c:u(this,i)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&u(this,t)):(this._events=new i,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=r,c.EventEmitter=c,e.exports=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserType=t.AuthTokenType=void 0,function(e){e[e.EditorLowPrivilege=0]="EditorLowPrivilege",e[e.AugLoopLowPrivilege=1]="AugLoopLowPrivilege",e[e.Anonymous=2]="Anonymous",e[e.ClientAssertion=3]="ClientAssertion",e[e.ClientAssertionV2=4]="ClientAssertionV2",e[e.AutoClpLowPrivilege=5]="AutoClpLowPrivilege",e[e.AutoClpAppOnlyLowPrivilege=6]="AutoClpAppOnlyLowPrivilege",e[e.Substrate=7]="Substrate",e[e.WacUserInfo=8]="WacUserInfo",e[e.OwaExchange=9]="OwaExchange",e[e.SmartCompose=10]="SmartCompose",e[e.WritingAnalyticsLowPrivilege=11]="WritingAnalyticsLowPrivilege",e[e.DWEngineLowPrivilege=12]="DWEngineLowPrivilege",e[e.SubstrateApp=13]="SubstrateApp",e[e.CortanaAppPop=14]="CortanaAppPop",e[e.OfficeAppsAppOnly=15]="OfficeAppsAppOnly",e[e.PPTFrontdoorAppPop=16]="PPTFrontdoorAppPop",e[e.EditorAppOnlyLowPrivilege=17]="EditorAppOnlyLowPrivilege",e[e.AugLoopApp=18]="AugLoopApp",e[e.MeetingIntelligenceApp=19]="MeetingIntelligenceApp",e[e.GraphApp=20]="GraphApp",e[e.IceServicesApp=21]="IceServicesApp",e[e.AzureMapsApp=22]="AzureMapsApp"}(t.AuthTokenType||(t.AuthTokenType={})),function(e){e[e.Unknown=0]="Unknown",e[e.Consumer=1]="Consumer",e[e.Enterprise=2]="Enterprise"}(t.UserType||(t.UserType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationState=void 0,function(e){e[e.Undefined=0]="Undefined",e[e.Created=10]="Created",e[e.Sent=20]="Sent",e[e.Duplicated=30]="Duplicated",e[e.Seen=40]="Seen",e[e.Tried=50]="Tried",e[e.Kept=60]="Kept",e[e.Rejected=70]="Rejected"}(t.AnnotationState||(t.AnnotationState={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GridConstants=void 0;var o=function(){function e(){}return e.lowerIndexBound=1,e.maxNumberOfRows=1048576,e.maxNumberOfColumns=16384,e.firstColumnName="A",e.lastColumnName="XFD",e}();t.GridConstants=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BinaryClassificationAnnotation=t.Annotation=void 0;var o=n(6),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return Object.defineProperty(e.prototype,"metadata",{get:function(){return this.M_},set:function(e){this.M_=e},enumerable:!1,configurable:!0}),e.getTypeName=function(){return"AugLoop_Core_Annotation"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Annotation=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return Object.defineProperty(e.prototype,"metadata",{get:function(){return this.M_},set:function(e){this.M_=e},enumerable:!1,configurable:!0}),e.getTypeName=function(){return"AugLoop_Core_BinaryClassificationAnnotation"},e.getBaseTypes=function(){return["AugLoop_Core_Annotation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.BinaryClassificationAnnotation=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SignalOperation=t.MicroSyncOperation=t.DeltaUpdateOperation=t.VisibilityOperation=t.FocusOperation=t.PurgeOperation=t.DeleteOperation=t.UpdateOperation=t.UpdateAnnotationMetaDataOperation=t.MoveOperation=t.AddOperation=t.OperationWithSiblingContext=t.Operation=t.ItemChangesDelta=t.ItemDelta=void 0;var o=n(6),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_ItemDelta"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.ItemDelta=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_ItemChangesDelta"},e.getBaseTypes=function(){return["AugLoop_Core_ItemDelta"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.ItemChangesDelta=i;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Operation"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Operation=s;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_OperationWithSiblingContext"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.OperationWithSiblingContext=a;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_AddOperation"},e.getBaseTypes=function(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AddOperation=u;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_MoveOperation"},e.getBaseTypes=function(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.MoveOperation=c;var l=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UpdateAnnotationMetaDataOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.UpdateAnnotationMetaDataOperation=l;var p=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UpdateOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.UpdateOperation=p;var f=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_DeleteOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.DeleteOperation=f;var d=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_PurgeOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.PurgeOperation=d;var h=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_FocusOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.FocusOperation=h;var g=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_VisibilityOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.VisibilityOperation=g;var m=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_DeltaUpdateOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.DeltaUpdateOperation=m;var y=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_MicroSyncOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.MicroSyncOperation=y;var v=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Signals_SignalOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SignalOperation=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Signal=void 0;var o=n(6),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Signals_Signal"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Signal=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserCommandsHolder=t.EventsHolder=t.TenantContextHolder=t.UserContextHolder=t.ContextHolder=t.DynamicContext=t.GridNeighborhoodContext=t.GridCell=t.SubDocument=t.Document=t.Session=t.TileGroup=t.Binary=t.Blob=void 0;var o=n(6),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Blob"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Blob=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Binary"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Binary=i;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_TileGroup"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.TileGroup=s;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Session"},e.getBaseTypes=function(){return["AugLoop_Core_TileGroup"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Session=a;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Document"},e.getBaseTypes=function(){return["AugLoop_Core_TileGroup"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Document=u;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_SubDocument"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SubDocument=c;var l=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_GridCell"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.GridCell=l;var p=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_GridNeighborhoodContext"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.GridNeighborhoodContext=p;var f=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_DynamicContext"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.DynamicContext=f;var d=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_ContextHolder"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.ContextHolder=d;var h=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UserContextHolder"},e.getBaseTypes=function(){return["AugLoop_Core_ContextHolder"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.UserContextHolder=h;var g=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_TenantContextHolder"},e.getBaseTypes=function(){return["AugLoop_Core_ContextHolder"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.TenantContextHolder=g;var m=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_EventsHolder"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.EventsHolder=m;var y=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UserCommandsHolder"},e.getBaseTypes=function(){return["AugLoop_Core_EventsHolder"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.UserCommandsHolder=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggingLevel=void 0,function(e){e[e.error=0]="error",e[e.warn=1]="warn",e[e.info=3]="info",e[e.metric=4]="metric",e[e.verbose=5]="verbose",e[e.debug=6]="debug"}(t.LoggingLevel||(t.LoggingLevel={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isExceptionMessage=void 0;var o=n(4);t.isExceptionMessage=function(e){return null==e||null==e.messageType||e.messageType==o.MessageType.Exception}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.ExpectedError=t.WorkflowKind=void 0,function(e){e[e.SingleItem=0]="SingleItem",e[e.Reduce=1]="Reduce",e[e.Grid=2]="Grid",e[e.DynamicText=3]="DynamicText",e[e.Join=4]="Join",e[e.Generic=5]="Generic"}(t.WorkflowKind||(t.WorkflowKind={}));var i=function(e){function t(n){void 0===n&&(n="ExpectedError");var o=e.call(this,n)||this;return o.__proto__=t.prototype,o}return r(t,e),t}(Error);t.ExpectedError=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.CoherencyError=void 0;var i=function(e){function t(n){void 0===n&&(n="CoherencyError");var o=e.call(this,n)||this;return o.__proto__=t.prototype,o}return r(t,e),t}(Error);t.CoherencyError=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t){var n,o,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(e){o=s}}();var u,c=[],l=!1,p=-1;function f(){l&&u&&(l=!1,u.length?c=u.concat(c):p=-1,c.length&&d())}function d(){if(!l){var e=a(f);l=!0;for(var t=c.length;t;){for(u=c,c=[];++p<t;)u&&u[p].run();p=-1,t=c.length}u=null,l=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function g(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new h(e,t)),1!==c.length||l||a(d)},h.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.now=void 0;t.now=void 0!==e&&e.hrtime?function(){var t=e.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return Date.now()}}).call(this,n(39))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LambdaSource=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.Local=1]="Local",e[e.Custom=2]="Custom",e[e.Remote=3]="Remote",e[e.BatchedRemote=4]="BatchedRemote"}(t.LambdaSource||(t.LambdaSource={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayOperators=void 0,function(e){e.some="some",e.every="every",e.none="none"}(t.arrayOperators||(t.arrayOperators={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.comparisonOperators=void 0,function(e){e.eq="eq",e.ne="ne",e.ge="ge",e.gt="gt",e.lt="lt",e.le="le"}(t.comparisonOperators||(t.comparisonOperators={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logicalOperators=void 0,function(e){e.All="All",e.Any="Any"}(t.logicalOperators||(t.logicalOperators={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BatchManager=void 0;var o=n(0),r=n(4),i=function(){function e(e,t){this.batchesByGroupingKey=new Map,this.submit=e,this.onSummary=t}return e.prototype.addBatchItem=function(e,t,n,r,i,s){var a=this,u=t.delayMs,c=t.maxInputSize,l=t.estimateSize,p=t.groupingKeyExtractor,f=l(e),d=p(e);if(t.split&&f>c){var h;try{h=t.split(e)}catch(e){var g=new Error("Split error: "+e.message);return void(s?s(g):o.Log.error(573366352,o.LogCategory.CoreDefault,g))}if(h&&Array.isArray(h.inputs)&&h.inputs.length>1){for(var m,y=[],v=s?function(e,t){if(m=m||e,y.push(t),y.length===h.inputs.length){var n;try{n=h.join(y)}catch(e){return void s(new Error("Join error: "+e.message))}s(m,n)}}:void 0,S=0;S<h.inputs.length;S++){var T=h.inputs[S];this.addBatchItem(T,t,n,r,i&&S===h.inputs.length-1,v)}return}}var b=this.batchesByGroupingKey.get(d);b&&b.size+f>c&&(clearTimeout(b.timeout),this.executeBatch(d,b,t),b=void 0),b||(b={items:[],size:0,hasItemsWithCallbacks:!1,context:n},this.batchesByGroupingKey.set(d,b)),b.items.push({input:e,size:f,callback:s}),b.size+=f,b.hasItemsWithCallbacks=b.hasItemsWithCallbacks||!!s,b.cv=r,b.groupComplete=i,clearTimeout(b.timeout),b.groupComplete?this.executeBatch(d,b,t):b.timeout=setTimeout((function(){a.executeBatch(d,b,t)}),u)},e.prototype.removeAllBatchedItems=function(){this.batchesByGroupingKey.forEach((function(e){e.timeout&&clearTimeout(e.timeout)})),this.batchesByGroupingKey.clear()},e.prototype.executeBatch=function(e,t,n){var i=this;this.batchesByGroupingKey.delete(e);var s,a=t.items,u=function(e){return e<0?"Negative":0===e?"0":1===e?"1":"Magnitude "+e.toString().length},c=new o.Operation({operationName:"ExecuteBatch",cv:t.cv,resourceId:t.context.name,dimension0:"Count "+u(a.length),dimension1:"Size "+u(t.size)}).start(),l=function(e,n,i){var s;if(n&&n.exceptionType===r.ExceptionType.NoOutput)c.success=!0,o.Log.info(573366353,o.LogCategory.CoreDefault,c.stop());else{var u=e+" error: "+(n?n.message||n:"Unknown error");s=n||new Error(u),c.success=!1,c.resultDescription="Batch of "+a.length+" items of size "+t.size+" with "+u,c.resultSignature=e+" Error",o.Log.error(573366354,o.LogCategory.CoreDefault,c.stop())}if(t.hasItemsWithCallbacks)for(var l=0,p=a;l<p.length;l++){var f=p[l];f.callback&&f.callback(s,i)}};try{s=n.multiplex(a.map((function(e){return e.input})))}catch(e){return void l("Multiplex",e)}this.submit(s.input,t,(function(e,r){var u;if(e||r&&("exceptionType"in r||r instanceof Error))l("Submit",e||r,r);else if(t.hasItemsWithCallbacks||n.summaryExtractor){var p=void 0;if(t.hasItemsWithCallbacks)try{if((p=s.demultiplex(r)).length!==a.length)throw new Error("Mismatched output length")}catch(e){return void l("Demultiplex",e)}var f=void 0,d=void 0;if(n.summaryExtractor)try{d=(u=n.summaryExtractor(r))[0],f=u[1]}catch(e){return void l("SummaryExtractor",e)}if(c.success=!0,o.Log.info(573366342,o.LogCategory.CoreDefault,c.stop()),t.hasItemsWithCallbacks)for(var h=0;h<a.length;h++)a[h].callback&&a[h].callback(void 0,p[h]);f&&i.onSummary(d,f,t.context)}else c.success=!0,o.Log.info(573366343,o.LogCategory.CoreDefault,c.stop())}))},e}();t.BatchManager=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLargerThan=t.estimateSize=void 0;t.estimateSize=function(e){return o(e,Number.POSITIVE_INFINITY)};t.isLargerThan=function(e,t){return o(e,t)>t};var o=function(e,t){for(var n=0,o=[],r=[e];r.length>0;){var i=r.pop(),s=typeof i;if("boolean"===s)n+=4;else if("string"===s)n+=2*i.length;else if("number"===s)n+=8;else if("object"===s&&i&&-1===o.indexOf(i))if(i instanceof Uint8Array)n+=i.length;else for(var a in o.push(i),i)r.push(i[a]);if(n>t)return n}return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.internalFetch=void 0;var o=n(110),r=n(48);t.internalFetch=function(e,t,n){var o=new r.Request(e,t);return i.add(o,n)};var i=new o.SequentialFetchQueue(r,2e4,12e4)},function(e,t){var n="undefined"!=typeof self?self:this,o=function(){function e(){this.fetch=!1,this.DOMException=n.DOMException}return e.prototype=n,new e}();!function(e){!function(t){var n="URLSearchParams"in e,o="Symbol"in e&&"iterator"in Symbol,r="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in e,s="ArrayBuffer"in e;if(s)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(e){return e&&a.indexOf(Object.prototype.toString.call(e))>-1};function c(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function l(e){return"string"!=typeof e&&(e=String(e)),e}function p(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return o&&(t[Symbol.iterator]=function(){return t}),t}function f(e){this.map={},e instanceof f?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function d(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function h(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function g(e){var t=new FileReader,n=h(t);return t.readAsArrayBuffer(e),n}function m(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function y(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:r&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:i&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:n&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():s&&r&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=m(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(e)||u(e))?this._bodyArrayBuffer=m(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r&&(this.blob=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?d(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(g)}),this.text=function(){var e,t,n,o=d(this);if(o)return o;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=h(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),o=0;o<t.length;o++)n[o]=String.fromCharCode(t[o]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(T)}),this.json=function(){return this.text().then(JSON.parse)},this}f.prototype.append=function(e,t){e=c(e),t=l(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},f.prototype.delete=function(e){delete this.map[c(e)]},f.prototype.get=function(e){return e=c(e),this.has(e)?this.map[e]:null},f.prototype.has=function(e){return this.map.hasOwnProperty(c(e))},f.prototype.set=function(e,t){this.map[c(e)]=l(t)},f.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},f.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),p(e)},f.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),p(e)},f.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),p(e)},o&&(f.prototype[Symbol.iterator]=f.prototype.entries);var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function S(e,t){var n,o,r=(t=t||{}).body;if(e instanceof S){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new f(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new f(t.headers)),this.method=(n=t.method||this.method||"GET",o=n.toUpperCase(),v.indexOf(o)>-1?o:n),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function T(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),o=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(o),decodeURIComponent(r))}})),t}function b(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new f(t.headers),this.url=t.url||"",this._initBody(e)}S.prototype.clone=function(){return new S(this,{body:this._bodyInit})},y.call(S.prototype),y.call(b.prototype),b.prototype.clone=function(){return new b(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},b.error=function(){var e=new b(null,{status:0,statusText:""});return e.type="error",e};var w=[301,302,303,307,308];b.redirect=function(e,t){if(-1===w.indexOf(t))throw new RangeError("Invalid status code");return new b(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function _(e,n){return new Promise((function(o,i){var s=new S(e,n);if(s.signal&&s.signal.aborted)return i(new t.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function u(){a.abort()}a.onload=function(){var e,t,n={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new f,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var n=e.split(":"),o=n.shift().trim();if(o){var r=n.join(":").trim();t.append(o,r)}})),t)};n.url="responseURL"in a?a.responseURL:n.headers.get("X-Request-URL");var r="response"in a?a.response:a.responseText;o(new b(r,n))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.onabort=function(){i(new t.DOMException("Aborted","AbortError"))},a.open(s.method,s.url,!0),"include"===s.credentials?a.withCredentials=!0:"omit"===s.credentials&&(a.withCredentials=!1),"responseType"in a&&r&&(a.responseType="blob"),s.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),s.signal&&(s.signal.addEventListener("abort",u),a.onreadystatechange=function(){4===a.readyState&&s.signal.removeEventListener("abort",u)}),a.send(void 0===s._bodyInit?null:s._bodyInit)}))}_.polyfill=!0,e.fetch||(e.fetch=_,e.Headers=f,e.Request=S,e.Response=b),t.Headers=f,t.Request=S,t.Response=b,t.fetch=_,Object.defineProperty(t,"__esModule",{value:!0})}({})}(o),o.fetch.ponyfill=!0,delete o.fetch.polyfill;var r=o;(t=r.fetch).default=r.fetch,t.fetch=r.fetch,t.Headers=r.Headers,t.Request=r.Request,t.Response=r.Response,e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TelemetryLogger=void 0;var o=n(8),r=function(){function e(e){this.level=o.LoggingLevel.info,this.hostCallbacks=e}return e.prototype.log=function(t){var n=this;if(null!=this.hostCallbacks&&null!=this.hostCallbacks.sendTelemetryEvent){var o=function(t,o,r,i){var s=o.charAt(0).toUpperCase()+o.slice(1);n.hostCallbacks.sendTelemetryEvent(r||e.augLoopAriaTenantToken,(i||e.augLoopAriaNamespace)+"_"+s,{ResourceId:t.resourceId,ResultDescription:t.resultDescription,ResultSignature:t.resultSignature,Dimension0:t.dimension0,Dimension1:t.dimension1,Dimension2:t.dimension2,Dimension3:t.dimension3},"Office.System.Activity",{CV:t.cv,Duration:1e3*t.durationMs,Count:t.count,AggMode:2,Success:t.success},!1,6,110)};if("Operation"===t.eventName){o(t,t.operationName)}else if("SessionHealth"===t.eventName){o(t,t.sessionHealthEventName)}else if("WorkflowOperation"===t.eventName){var r=t;o(r,r.operationName,r.ariaTenant,r.ariaNamespace)}}},e.augLoopAriaTenantToken="3de4087d4de34817b1c376e3d1e6e293-983c4292-5ba9-485a-ab10-9797863c788b-6770",e.augLoopAriaNamespace="Office_AugLoop_Client",e}();t.TelemetryLogger=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketWorker=void 0;var o=n(113),r=n(0),i=n(2),s=function(){function e(){this.hasBeenOpened=!1,this.hadEgressError=!1,this.lastEgressTime=0,this.lastPongTime=0,this.remainingPingFailures=3,this.pendingEgress=[]}return e.prototype.init=function(t,n,i,s){var a=this;this.ws=new o(t),this.logOp=new r.Operation({operationName:e.className,success:!0}).start();var u=function(e){a.logPingLatencyOp&&(a.logPingLatencyOp.success=e,r.Log.info(572838091,r.LogCategory.CoreDefault,a.logPingLatencyOp.stop()),a.logPingLatencyOp=void 0)};this.ws.addEventListener("open",(function(t){i(),e.logCountLimiter.log((function(){a.logOp.resourceId="OnOpen",a.logOp.resultDescription="",a.logOp.success=!0,r.Log.info(572838092,r.LogCategory.CoreDefault,a.logOp.stop())})),a.hasBeenOpened=!0,a.pendingEgress.forEach((function(e){a.egress(e)})),a.pendingEgress=[],a.pingInterval=setInterval((function(){a.logPingLatencyOp&&(--a.remainingPingFailures,u(!1)),a.remainingPingFailures>0&&a.hasBeenOpened&&a.lastPongTime<a.lastEgressTime&&(a.logPingLatencyOp=new r.Operation({operationName:"Ping",success:!0,dimension0:a.ws.bufferedAmount>=0?a.ws.bufferedAmount.toString().length.toString():void 0}).start(),a.ws.send(e.pingPongMessage,(function(e){e&&(--a.remainingPingFailures,u(!1))})))}),3e4)})),this.ws.addEventListener("message",(function(t){a.logPingLatencyOp&&"string"==typeof t.data&&1===t.data.length&&t.data[0]===e.pingPongMessage?(u(!0),a.lastPongTime=Date.now()):n(t.data)})),this.ws.addEventListener("error",(function(t){a.errorMessage=t.message,e.logCountLimiter.log((function(){a.logOp.resourceId="OnError",a.logOp.resultDescription=a.errorMessage,a.logOp.success=!1,r.Log.info(572838093,r.LogCategory.CoreDefault,a.logOp.stop())})),a.ws.close()})),this.ws.addEventListener("close",(function(t){e.logCountLimiter.log((function(){a.logOp.resourceId="OnClose",a.logOp.resultDescription=t?"code: "+t.code+". reason: "+t.reason:"",a.logOp.success=!0,r.Log.info(572838094,r.LogCategory.CoreDefault,a.logOp.stop())})),a.pingInterval&&(clearInterval(a.pingInterval),a.pingInterval=void 0),s(a.errorMessage)}))},e.prototype.egress=function(t){var n=this;this.lastEgressTime=Date.now(),this.hasBeenOpened?this.ws.send(t,(function(t){t&&!n.hadEgressError&&(n.hadEgressError=!0,e.logCountLimiter.log((function(){n.logOp.resourceId="OnFirstEgressError",n.logOp.resultDescription=t.message,n.logOp.success=!1,r.Log.info(572838095,r.LogCategory.CoreDefault,n.logOp.stop())})))})):this.pendingEgress.push(t)},e.prototype.close=function(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=void 0),this.ws.close()},e.className="WebSocketWorker",e.logCountLimiter=new i.LogCountLimiter(e.className),e.pingPongMessage="~",e}();t.WebSocketWorker=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenProvisionResponse=t.TokenProvisionMessage=t.AnnotationResultsMessage=t.SessionDeleteMessage=t.SyncResponse=t.MicroSyncMessage=t.SyncMessage=t.AnnotationConfigUpdateResponse=t.AnnotationConfigUpdateMessage=t.AnnotationReleaseResponse=t.AnnotationReleaseMessage=t.AnnotationResultStateMessage=t.AnnotationActivationResponse=t.AnnotationActivationMessage=t.CacheDumpRequestResponse=t.CacheDumpRequestMessage=t.SessionCloseMessage=t.SessionInitResponse=t.SessionInitMessage=t.TimeoutErrorResponse=t.ErrorResponse=t.Response=t.Message=void 0;var o=n(10),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Message"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Message=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Response"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Response=i;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_ErrorResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.ErrorResponse=s;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_TimeoutErrorResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_ErrorResponse","AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.TimeoutErrorResponse=a;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionInitMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SessionInitMessage=u;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionInitResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SessionInitResponse=c;var l=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionCloseMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SessionCloseMessage=l;var p=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_CacheDumpRequestMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.CacheDumpRequestMessage=p;var f=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_CacheDumpRequestResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.CacheDumpRequestResponse=f;var d=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationActivationMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AnnotationActivationMessage=d;var h=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationActivationResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AnnotationActivationResponse=h;var g=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationResultStateMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AnnotationResultStateMessage=g;var m=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationReleaseMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AnnotationReleaseMessage=m;var y=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationReleaseResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AnnotationReleaseResponse=y;var v=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationConfigUpdateMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AnnotationConfigUpdateMessage=v;var S=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationConfigUpdateResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AnnotationConfigUpdateResponse=S;var T=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SyncMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SyncMessage=T;var b=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_MicroSyncMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.MicroSyncMessage=b;var w=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SyncResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SyncResponse=w;var _=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionDeleteMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SessionDeleteMessage=_;var C=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationResultsMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_SyncMessage","AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AnnotationResultsMessage=C;var O=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_TokenProvisionMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.TokenProvisionMessage=O;var I=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_TokenProvisionResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.TokenProvisionResponse=I},function(e,t,n){"use strict";(function(e){var o=n(127),r=n(128),i=n(129);function s(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,n){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return p(this,e)}return c(this,e,t,n)}function c(e,t,n,o){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,o){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(o||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===o?new Uint8Array(t):void 0===o?new Uint8Array(t,n):new Uint8Array(t,n,o);u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=f(e,t);return e}(e,t,n,o):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var o=0|h(t,n),r=(e=a(e,o)).write(t,n);r!==o&&(e=e.slice(0,r));return e}(e,t,n):function(e,t){if(u.isBuffer(t)){var n=0|d(t.length);return 0===(e=a(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(o=t.length)!=o?a(e,0):f(e,t);if("Buffer"===t.type&&i(t.data))return f(e,t.data)}var o;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function p(e,t){if(l(t),e=a(e,t<0?0:0|d(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t){var n=t.length<0?0:0|d(t.length);e=a(e,n);for(var o=0;o<n;o+=1)e[o]=255&t[o];return e}function d(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function h(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var o=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return F(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return U(e).length;default:if(o)return F(e).length;t=(""+t).toLowerCase(),o=!0}}function g(e,t,n){var o=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,n);case"utf8":case"utf-8":return I(this,t,n);case"ascii":return A(this,t,n);case"latin1":case"binary":return k(this,t,n);case"base64":return O(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,n);default:if(o)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function m(e,t,n){var o=e[t];e[t]=e[n],e[n]=o}function y(e,t,n,o,r){if(0===e.length)return-1;if("string"==typeof n?(o=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=u.from(t,o)),u.isBuffer(t))return 0===t.length?-1:v(e,t,n,o,r);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,o,r);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,o,r){var i,s=1,a=e.length,u=t.length;if(void 0!==o&&("ucs2"===(o=String(o).toLowerCase())||"ucs-2"===o||"utf16le"===o||"utf-16le"===o)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,n/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(r){var l=-1;for(i=n;i<a;i++)if(c(e,i)===c(t,-1===l?0:i-l)){if(-1===l&&(l=i),i-l+1===u)return l*s}else-1!==l&&(i-=i-l),l=-1}else for(n+u>a&&(n=a-u),i=n;i>=0;i--){for(var p=!0,f=0;f<u;f++)if(c(e,i+f)!==c(t,f)){p=!1;break}if(p)return i}return-1}function S(e,t,n,o){n=Number(n)||0;var r=e.length-n;o?(o=Number(o))>r&&(o=r):o=r;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");o>i/2&&(o=i/2);for(var s=0;s<o;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function T(e,t,n,o){return q(F(t,e.length-n),e,n,o)}function b(e,t,n,o){return q(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,o)}function w(e,t,n,o){return b(e,t,n,o)}function _(e,t,n,o){return q(U(t),e,n,o)}function C(e,t,n,o){return q(function(e,t){for(var n,o,r,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),o=n>>8,r=n%256,i.push(r),i.push(o);return i}(t,e.length-n),e,n,o)}function O(e,t,n){return 0===t&&n===e.length?o.fromByteArray(e):o.fromByteArray(e.slice(t,n))}function I(e,t,n){n=Math.min(e.length,n);for(var o=[],r=t;r<n;){var i,s,a,u,c=e[r],l=null,p=c>239?4:c>223?3:c>191?2:1;if(r+p<=n)switch(p){case 1:c<128&&(l=c);break;case 2:128==(192&(i=e[r+1]))&&(u=(31&c)<<6|63&i)>127&&(l=u);break;case 3:i=e[r+1],s=e[r+2],128==(192&i)&&128==(192&s)&&(u=(15&c)<<12|(63&i)<<6|63&s)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:i=e[r+1],s=e[r+2],a=e[r+3],128==(192&i)&&128==(192&s)&&128==(192&a)&&(u=(15&c)<<18|(63&i)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,p=1):l>65535&&(l-=65536,o.push(l>>>10&1023|55296),l=56320|1023&l),o.push(l),r+=p}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",o=0;for(;o<t;)n+=String.fromCharCode.apply(String,e.slice(o,o+=4096));return n}(o)}t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return c(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,n){return function(e,t,n,o){return l(t),t<=0?a(e,t):void 0!==n?"string"==typeof o?a(e,t).fill(n,o):a(e,t).fill(n):a(e,t)}(null,e,t,n)},u.allocUnsafe=function(e){return p(null,e)},u.allocUnsafeSlow=function(e){return p(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,o=t.length,r=0,i=Math.min(n,o);r<i;++r)if(e[r]!==t[r]){n=e[r],o=t[r];break}return n<o?-1:o<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!i(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var o=u.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var s=e[n];if(!u.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(o,r),r+=s.length}return o},u.byteLength=h,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?I(this,0,e):g.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,o,r){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===o&&(o=0),void 0===r&&(r=this.length),t<0||n>e.length||o<0||r>this.length)throw new RangeError("out of range index");if(o>=r&&t>=n)return 0;if(o>=r)return-1;if(t>=n)return 1;if(this===e)return 0;for(var i=(r>>>=0)-(o>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(i,s),c=this.slice(o,r),l=e.slice(t,n),p=0;p<a;++p)if(c[p]!==l[p]){i=c[p],s=l[p];break}return i<s?-1:s<i?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},u.prototype.write=function(e,t,n,o){if(void 0===t)o="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)o=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===o&&(o="utf8")):(o=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");o||(o="utf8");for(var i=!1;;)switch(o){case"hex":return S(this,e,t,n);case"utf8":case"utf-8":return T(this,e,t,n);case"ascii":return b(this,e,t,n);case"latin1":case"binary":return w(this,e,t,n);case"base64":return _(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),i=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function A(e,t,n){var o="";n=Math.min(e.length,n);for(var r=t;r<n;++r)o+=String.fromCharCode(127&e[r]);return o}function k(e,t,n){var o="";n=Math.min(e.length,n);for(var r=t;r<n;++r)o+=String.fromCharCode(e[r]);return o}function P(e,t,n){var o=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>o)&&(n=o);for(var r="",i=t;i<n;++i)r+=j(e[i]);return r}function R(e,t,n){for(var o=e.slice(t,n),r="",i=0;i<o.length;i+=2)r+=String.fromCharCode(o[i]+256*o[i+1]);return r}function M(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function L(e,t,n,o,r,i){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<i)throw new RangeError('"value" argument is out of bounds');if(n+o>e.length)throw new RangeError("Index out of range")}function x(e,t,n,o){t<0&&(t=65535+t+1);for(var r=0,i=Math.min(e.length-n,2);r<i;++r)e[n+r]=(t&255<<8*(o?r:1-r))>>>8*(o?r:1-r)}function E(e,t,n,o){t<0&&(t=4294967295+t+1);for(var r=0,i=Math.min(e.length-n,4);r<i;++r)e[n+r]=t>>>8*(o?r:3-r)&255}function D(e,t,n,o,r,i){if(n+o>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function N(e,t,n,o,i){return i||D(e,0,n,4),r.write(e,t,n,o,23,4),n+4}function B(e,t,n,o,i){return i||D(e,0,n,8),r.write(e,t,n,o,52,8),n+8}u.prototype.slice=function(e,t){var n,o=this.length;if((e=~~e)<0?(e+=o)<0&&(e=0):e>o&&(e=o),(t=void 0===t?o:~~t)<0?(t+=o)<0&&(t=0):t>o&&(t=o),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=u.prototype;else{var r=t-e;n=new u(r,void 0);for(var i=0;i<r;++i)n[i]=this[i+e]}return n},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var o=this[e],r=1,i=0;++i<t&&(r*=256);)o+=this[e+i]*r;return o},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var o=this[e+--t],r=1;t>0&&(r*=256);)o+=this[e+--t]*r;return o},u.prototype.readUInt8=function(e,t){return t||M(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||M(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||M(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||M(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||M(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var o=this[e],r=1,i=0;++i<t&&(r*=256);)o+=this[e+i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*t)),o},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var o=t,r=1,i=this[e+--o];o>0&&(r*=256);)i+=this[e+--o]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},u.prototype.readInt8=function(e,t){return t||M(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||M(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){t||M(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return t||M(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||M(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||M(e,4,this.length),r.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||M(e,4,this.length),r.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||M(e,8,this.length),r.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||M(e,8,this.length),r.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,o){(e=+e,t|=0,n|=0,o)||L(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,i=0;for(this[t]=255&e;++i<n&&(r*=256);)this[t+i]=e/r&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,o){(e=+e,t|=0,n|=0,o)||L(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,i=1;for(this[t+r]=255&e;--r>=0&&(i*=256);)this[t+r]=e/i&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):x(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):x(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):E(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):E(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,o){if(e=+e,t|=0,!o){var r=Math.pow(2,8*n-1);L(this,e,t,n,r-1,-r)}var i=0,s=1,a=0;for(this[t]=255&e;++i<n&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},u.prototype.writeIntBE=function(e,t,n,o){if(e=+e,t|=0,!o){var r=Math.pow(2,8*n-1);L(this,e,t,n,r-1,-r)}var i=n-1,s=1,a=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):x(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):x(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):E(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):E(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return N(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return N(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return B(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return B(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,o){if(n||(n=0),o||0===o||(o=this.length),t>=e.length&&(t=e.length),t||(t=0),o>0&&o<n&&(o=n),o===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),e.length-t<o-n&&(o=e.length-t+n);var r,i=o-n;if(this===e&&n<t&&t<o)for(r=i-1;r>=0;--r)e[r+t]=this[r+n];else if(i<1e3||!u.TYPED_ARRAY_SUPPORT)for(r=0;r<i;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+i),t);return i},u.prototype.fill=function(e,t,n,o){if("string"==typeof e){if("string"==typeof t?(o=t,t=0,n=this.length):"string"==typeof n&&(o=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!u.isEncoding(o))throw new TypeError("Unknown encoding: "+o)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var s=u.isBuffer(e)?e:F(new u(e,o).toString()),a=s.length;for(i=0;i<n-t;++i)this[i+t]=s[i%a]}return this};var W=/[^+\/0-9A-Za-z-_]/g;function j(e){return e<16?"0"+e.toString(16):e.toString(16)}function F(e,t){var n;t=t||1/0;for(var o=e.length,r=null,i=[],s=0;s<o;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===o){(t-=3)>-1&&i.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&i.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function U(e){return o.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(W,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function q(e,t,n,o){for(var r=0;r<o&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}}).call(this,n(7))},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(133),t)},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(138),t)},function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.isAncestorOrEqualTo=t.getSafeNumber=t.isValidItemId=t.splitItemPathKey=t.makeItemPathKey=t.shallowCloneItemWithPath=void 0;t.shallowCloneItemWithPath=function(e,t){return o(o({},t),{parentPath:e})};t.makeItemPathKey=function(e){return Array.isArray(e)?5===e.length?e[0]+"\\"+e[1]+"\\"+e[2]+"\\"+e[3]+"\\"+e[4]:4===e.length?e[0]+"\\"+e[1]+"\\"+e[2]+"\\"+e[3]:3===e.length?e[0]+"\\"+e[1]+"\\"+e[2]:2===e.length?e[0]+"\\"+e[1]:1===e.length?e[0]:e.join("\\"):"(malformed path)"};t.splitItemPathKey=function(e){return e.split("\\")};t.isValidItemId=function(e){return e&&e.length>0&&e.length<100&&e.indexOf("\\")<0};t.getSafeNumber=function(e,t){return void 0===t&&(t=0),Number.isFinite(e)?e:t};t.isAncestorOrEqualTo=function(e,t){if(e.length>t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(139),t),r(n(140),t),r(n(142),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FormattedTextTileDelta=t.TextTileDelta=void 0;var o=n(10),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Text_TextTileDelta"},e.getBaseTypes=function(){return["AugLoop_Core_ItemDelta"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.TextTileDelta=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Text_FormattedTextTileDelta"},e.getBaseTypes=function(){return["AugLoop_Text_TextTileDelta","AugLoop_Core_ItemDelta"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.FormattedTextTileDelta=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextTileDeltaUnit=t.TextTileDeltaType=void 0,function(e){e[e.Add=0]="Add",e[e.Delete=1]="Delete",e[e.Update=2]="Update"}(t.TextTileDeltaType||(t.TextTileDeltaType={})),function(e){e[e.Chars=0]="Chars",e[e.Word=1]="Word",e[e.PartialSentence=2]="PartialSentence",e[e.Sentence=3]="Sentence",e[e.Paragraph=4]="Paragraph"}(t.TextTileDeltaUnit||(t.TextTileDeltaUnit={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DateTile=t.PersonTile=t.TaskTile=t.DynamicTextContext=t.FormattedTextTile=t.TextTile=void 0;var o=n(10),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Text_TextTile"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.TextTile=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Text_FormattedTextTile"},e.getBaseTypes=function(){return["AugLoop_Text_TextTile"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.FormattedTextTile=i;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Text_DynamicTextContext"},e.getBaseTypes=function(){return["AugLoop_Core_DynamicContext"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.DynamicTextContext=s;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Text_TaskTile"},e.getBaseTypes=function(){return["AugLoop_Text_FormattedTextTile","AugLoop_Text_TextTile"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.TaskTile=a;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Text_PersonTile"},e.getBaseTypes=function(){return["AugLoop_Text_TextTile"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.PersonTile=u;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Text_DateTile"},e.getBaseTypes=function(){return["AugLoop_Text_TextTile"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.DateTile=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WaitOnStrategy=void 0,function(e){e[e.All=0]="All",e[e.Any=1]="Any"}(t.WaitOnStrategy||(t.WaitOnStrategy={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Oart=void 0,function(e){!function(e){e[e.shape=0]="shape",e[e.groupShape=1]="groupShape",e[e.graphicFrame=2]="graphicFrame",e[e.connector=3]="connector",e[e.picture=4]="picture",e[e.ink=5]="ink"}(e.DrawingElementType||(e.DrawingElementType={}))}(t.Oart||(t.Oart={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Ppt=void 0,function(e){!function(e){e[e.Undefined=0]="Undefined",e[e.Delete=1]="Delete",e[e.Add=2]="Add",e[e.Change=3]="Change",e[e.Refresh=4]="Refresh"}(e.SlideTileEventType||(e.SlideTileEventType={}))}(t.Ppt||(t.Ppt={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JobState=void 0,function(e){e[e.Submitted=0]="Submitted",e[e.Pending=1]="Pending",e[e.Running=2]="Running",e[e.Completed=3]="Completed",e[e.Failed=4]="Failed",e[e.Aborted=5]="Aborted"}(t.JobState||(t.JobState={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tiling=void 0,function(e){!function(e){e[e.Unknown=0]="Unknown",e[e.Text=1]="Text",e[e.Slide=2]="Slide"}(e.TileType||(e.TileType={})),function(e){e[e.Generic=0]="Generic",e[e.Title=1]="Title",e[e.SmartArt=2]="SmartArt",e[e.TableCell=3]="TableCell",e[e.TextBox=4]="TextBox",e[e.Notes=5]="Notes"}(e.TextTileType||(e.TextTileType={})),function(e){e[e.Undefined=0]="Undefined",e[e.Word=1]="Word",e[e.Phrase=2]="Phrase",e[e.Sentence=3]="Sentence",e[e.Paragraph=4]="Paragraph"}(e.TextTileElementUnit||(e.TextTileElementUnit={})),function(e){e[e.Undefined=0]="Undefined",e[e.Bullet=1]="Bullet",e[e.Numbered=2]="Numbered"}(e.ListType||(e.ListType={})),function(e){e[e.Undefined=0]="Undefined",e[e.AlphaLcParenBoth=1]="AlphaLcParenBoth",e[e.AlphaUcParenBoth=2]="AlphaUcParenBoth",e[e.AlphaLcParenR=3]="AlphaLcParenR",e[e.AlphaUcParenR=4]="AlphaUcParenR",e[e.AlphaLcPeriod=5]="AlphaLcPeriod",e[e.AlphaUcPeriod=6]="AlphaUcPeriod",e[e.ArabicParenBoth=7]="ArabicParenBoth",e[e.ArabicParenR=8]="ArabicParenR",e[e.ArabicPeriod=9]="ArabicPeriod",e[e.ArabicPlain=10]="ArabicPlain",e[e.RomanLcParenBoth=11]="RomanLcParenBoth",e[e.RomanUcParenBoth=12]="RomanUcParenBoth",e[e.RomanLcParenR=13]="RomanLcParenR",e[e.RomanUcParenR=14]="RomanUcParenR",e[e.RomanLcPeriod=15]="RomanLcPeriod",e[e.RomanUcPeriod=16]="RomanUcPeriod",e[e.CircleNumDbPlain=17]="CircleNumDbPlain",e[e.CircleNumWdBlackPlain=18]="CircleNumWdBlackPlain",e[e.CircleNumWdWhitePlain=19]="CircleNumWdWhitePlain",e[e.ArabicDbPeriod=20]="ArabicDbPeriod",e[e.ArabicDbPlain=21]="ArabicDbPlain",e[e.Ea1ChsPeriod=22]="Ea1ChsPeriod",e[e.Ea1ChsPlain=23]="Ea1ChsPlain",e[e.Ea1ChtPeriod=24]="Ea1ChtPeriod",e[e.Ea1ChtPlain=25]="Ea1ChtPlain",e[e.Ea1JpnChsDbPeriod=26]="Ea1JpnChsDbPeriod",e[e.Ea1JpnKorPlain=27]="Ea1JpnKorPlain",e[e.Ea1JpnKorPeriod=28]="Ea1JpnKorPeriod",e[e.Arabic1Minus=29]="Arabic1Minus",e[e.Arabic2Minus=30]="Arabic2Minus",e[e.Hebrew2Minus=31]="Hebrew2Minus",e[e.ThaiAlphaPeriod=32]="ThaiAlphaPeriod",e[e.ThaiAlphaParenR=33]="ThaiAlphaParenR",e[e.ThaiAlphaParenBoth=34]="ThaiAlphaParenBoth",e[e.ThaiNumPeriod=35]="ThaiNumPeriod",e[e.ThaiNumParenR=36]="ThaiNumParenR",e[e.ThaiNumParenBoth=37]="ThaiNumParenBoth",e[e.HindiAlphaPeriod=38]="HindiAlphaPeriod",e[e.HindiNumPeriod=39]="HindiNumPeriod",e[e.HindiNumParenR=40]="HindiNumParenR",e[e.HindiAlpha1Period=41]="HindiAlpha1Period"}(e.ListNumeration||(e.ListNumeration={})),function(e){e[e.Undefined=0]="Undefined",e[e.Delete=1]="Delete",e[e.Add=2]="Add",e[e.Change=3]="Change",e[e.Refresh=4]="Refresh"}(e.TextTileEventType||(e.TextTileEventType={}))}(t.Tiling||(t.Tiling={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getIntFeatureGatePromise=t.convertBooleanArrayToNumber=void 0;t.convertBooleanArrayToNumber=function(e){return Array.isArray(e)?e.reverse().reduce((function(e,t){return 2*e+(t?1:0)}),0):0};t.getIntFeatureGatePromise=function(e,n,o){for(var r=[],i=0;i<n;i++)r.push(e.IsFeatureEnabled(o+"".concat(i),"None").then((function(e){return e})).catch((function(){return!1})));return Promise.all(r).then((function(e){return(0,t.convertBooleanArrayToNumber)(e)}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAuthTickets=void 0;var o=n(11);t.getAuthTickets=function(){return[{Provider:o.IdentityProvider.ADAL,ResourceId:"https://nleditor.osi.office.net/NlEditor",AuthorityUrl:"https://login.microsoftonline.com/common/oauth2/authorize"}]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.classificationReduceLambdaGetEditorUIResponse=t.classificationReduceRemoteLambda=void 0;var o=n(1),r=n(12),i=n(13);t.classificationReduceRemoteLambda={name:"ClassificationReduceLambda",source:o.LambdaSource.Remote,inputSchema:i.clpGlobals.classificationReduce,outputSchema:i.clpGlobals.classificationReduceResponse,canRunInPrivateMode:!0},t.classificationReduceLambdaGetEditorUIResponse={name:"ClassificationReduceLambdaUpdatePreviousResponse",source:o.LambdaSource.Custom,inputSchema:i.clpGlobals.classificationReduceResponse,outputSchema:i.clpGlobals.labellingEditorUIResponse,func:function(e,t,n,o){e.requestSequence===i.clpGlobals.documents.get(e.documentMetadata.docSessionID).getLabellingRequestSequence()?o((0,r.getEditorUIResponse)(e)):o(null)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inputSchemaName=void 0,t.inputSchemaName="SlideTile"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(219);t.MessageType=o.MessageType;var r=n(220);t.LoggingLevel=r.LoggingLevel;var i=n(221);t.ProviderErrorType=i.ProviderErrorType;var s=n(222);t.ProviderResultStatus=s.ProviderResultStatus;var a=n(223);t.SamplingPolicy=a.SamplingPolicy;var u=n(224);t.DesignerSlideProviderIdentifier=u.DesignerSlideProviderIdentifier,t.MakeItVisualProviderIdentifier=u.MakeItVisualProviderIdentifier,t.DesignerTextToSmartArtProviderIdentifier=u.DesignerTextToSmartArtProviderIdentifier,t.HubbleProviderIdentifier=u.HubbleProviderIdentifier,t.TapProviderIdentifier=u.TapProviderIdentifier,t.DictionaryProviderIdentifier=u.DictionaryProviderIdentifier,t.ImagesProviderIdentifier=u.ImagesProviderIdentifier,t.InsightsProviderIdentifier=u.InsightsProviderIdentifier},function(e,t,n){n(71),n(72),n(73),n(74),n(75),n(76),n(77),n(78),e.exports=n(79)},function(e,t,n){"use strict";(function(e){if(void 0!==e.__platformBundles){var t=e.__platformBundles.concat();Reflect.deleteProperty(e,"__platformBundles");for(var n=0;n<t.length;++n)console.log("PB start ".concat(n+1,"/").concat(t.length)),e.eval(t[n]),console.log("PB done  ".concat(n+1,"/").concat(t.length))}}).call(this,n(7))},function(e,t,n){Object.assign=function(e,t){for(var n=1;n<arguments.length;n++){var o=arguments[n];if(null!=o)for(var r in o){e[r]=o[r]}}return e},Object.setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e}},function(e,t,n){(function(e){var t=0,n=function(e){throw e},o={setGlobalHandler:function(e){n=e},getGlobalHandler:function(){return n},reportError:function(e){n&&n(e)},reportFatalError:function(e){n&&n(e,!0)},applyWithGuard:function(e,n,r){try{return t++,e.apply(n,r)}catch(e){o.reportError(e)}finally{t--}return null},applyWithGuardIfNeeded:function(e,t,n){return o.inGuard()?e.apply(t,n):(o.applyWithGuard(e,t,n),null)},inGuard:function(){return t},guard:function(e,t,n){if("function"!=typeof e)return null;return t=t||e.name||"<generated guard>",function(){return o.applyWithGuard(e,n||this,arguments,null,t)}}};e.ErrorUtils=o}).call(this,n(7))},function(e,t,n){(function(e){if(void 0===Number.EPSILON&&Object.defineProperty(Number,"EPSILON",{value:Math.pow(2,-52)}),void 0===Number.MAX_SAFE_INTEGER&&Object.defineProperty(Number,"MAX_SAFE_INTEGER",{value:Math.pow(2,53)-1}),void 0===Number.MIN_SAFE_INTEGER&&Object.defineProperty(Number,"MIN_SAFE_INTEGER",{value:-(Math.pow(2,53)-1)}),!Number.isNaN){var t=e.isNaN;Object.defineProperty(Number,"isNaN",{configurable:!0,enumerable:!1,value:function(e){return"number"==typeof e&&t(e)},writable:!0})}}).call(this,n(7))},function(e,t){String.prototype.startsWith||(String.prototype.startsWith=function(e){"use strict";if(null==this)throw TypeError();var t=String(this),n=arguments.length>1&&Number(arguments[1])||0,o=Math.min(Math.max(n,0),t.length);return t.indexOf(String(e),n)===o}),String.prototype.endsWith||(String.prototype.endsWith=function(e){"use strict";if(null==this)throw TypeError();var t=String(this),n=t.length,o=String(e),r=arguments.length>1?Number(arguments[1])||0:n,i=Math.min(Math.max(r,0),n),s=i-o.length;return!(s<0)&&t.lastIndexOf(o,s)===s}),String.prototype.repeat||(String.prototype.repeat=function(e){"use strict";if(null==this)throw TypeError();var t=String(this);if((e=Number(e)||0)<0||e===1/0)throw RangeError();if(1===e)return t;for(var n="";e;)1&e&&(n+=t),(e>>=1)&&(t+=t);return n}),String.prototype.includes||(String.prototype.includes=function(e,t){"use strict";return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)}),String.prototype.codePointAt||(String.prototype.codePointAt=function(e){if(null==this)throw TypeError();var t=String(this),n=t.length,o=e?Number(e):0;if(Number.isNaN(o)&&(o=0),!(o<0||o>=n)){var r,i=t.charCodeAt(o);return i>=55296&&i<=56319&&n>o+1&&(r=t.charCodeAt(o+1))>=56320&&r<=57343?1024*(i-55296)+r-56320+65536:i}})},function(e,t){function n(e,t){if(null==this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var n=Object(this),o=n.length>>>0,r=0;r<o;r++)if(e.call(t,n[r],r,n))return r;return-1}Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{enumerable:!1,writable:!0,configurable:!0,value:n}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{enumerable:!1,writable:!0,configurable:!0,value:function(e,t){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");var o=n.call(this,e,t);return-1===o?void 0:this[o]}}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{enumerable:!1,writable:!0,configurable:!0,value:function(e){var t=Object(this),n=parseInt(t.length)||0;if(0===n)return!1;var o,r,i=parseInt(arguments[1])||0;for(i>=0?o=i:(o=n+i)<0&&(o=0);o<n;){if(e===(r=t[o])||e!=e&&r!=r)return!0;o++}return!1}})},function(e,t){Array.from||(Array.from=function(e){if(null==e)throw new TypeError("Object is null or undefined");var t,n,o=arguments[1],r=arguments[2],i=this,s=Object(e),a="function"==typeof Symbol?Symbol.iterator:"@@iterator",u="function"==typeof o,c="function"==typeof s[a],l=0;if(c){t="function"==typeof i?new i:[];for(var p,f=s[a]();!(p=f.next()).done;)n=p.value,u&&(n=o.call(r,n,l)),t[l]=n,l+=1;return t.length=l,t}var d=s.length;for((isNaN(d)||d<0)&&(d=0),t="function"==typeof i?new i(d):new Array(d);l<d;)n=s[l],u&&(n=o.call(r,n,l)),t[l]=n,l+=1;return t.length=l,t})},function(e,t){!function(){"use strict";var e=Object.prototype.hasOwnProperty;"function"!=typeof Object.entries&&(Object.entries=function(t){if(null==t)throw new TypeError("Object.entries called on non-object");var n=[];for(var o in t)e.call(t,o)&&n.push([o,t[o]]);return n}),"function"!=typeof Object.values&&(Object.values=function(t){if(null==t)throw new TypeError("Object.values called on non-object");var n=[];for(var o in t)e.call(t,o)&&n.push(t[o]);return n})}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(80),r=n(81);(0,o.initReka)(),(0,n(83).initAugLoopSDX)(r.NativeServices.NativeService)},function(e,t){e.exports=OfficePlatformGlobal.ReactNativeReka},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.NativeServices=t.ServiceInfos=void 0;var i=n(82);i.CustomTypeRegistry.registerTypeInfos({"AugLoopData::InputData":{InputSchema:"$string",InputJson:"$string",CorrelationVector:"$string"},"AugLoopData::ResultData":{InputSchema:"$string",InputJson:"$string",OutputSchema:"$string",OutputJson:"$string"},"AugLoopData::ServiceGroups":{OfficeServiceGroup:"$number",ControllerServiceGroup:"$number"},"AugLoopData::HostMetadata":{AppName:"$string",AppPlatform:"$string",AppVersion:"$string",UILanguage:"$string",ClientId:"$string",ReleaseAudienceGroup:"$string",ReleaseChannel:"$string",ReleaseFork:"$string",SessionId:"$string",Flights:"$string",PrivateMode:"$boolean",DisabledServiceGroups:["$array","AugLoopData::ServiceGroups"]},"AugLoopData::ConfigTicket":{Provider:"$number",Policy:"$string",Target:"$string",ResourceId:"$string",AuthorityUrl:"$string"},"AugLoopData::AuthTokenRequest":{Tickets:["$array","AugLoopData::ConfigTicket"],DocId:["opt-field","$string"],DocSessionId:["opt-field","$string"]},"AugLoopData::AuthTokenResponse":{Token:"$string"},"AugLoopData::IdentityWithToken":{IdentityId:"$string",Token:"$string"},"AugLoopData::AuthTokensResponse":{Identites:["$array","AugLoopData::IdentityWithToken"]},"AugLoopData::CreateSessionParameters":{docSessionId:["opt-field","$string"],extensionConfigs:["opt-field",["$array","$string"]],flights:["opt-field","$string"],serviceUrl:["opt-field","$string"]},"AugLoopData::ActivateAnnotationParameters":{annotationType:"$string",token:"$string",config:["opt-field","$string"],docSessionId:["opt-field","$string"]},"AugLoopData::SubmitOperationsParameters":{operations:["$array","$string"],cv:["opt-field","$string"],docSessionId:["opt-field","$string"]},"AugLoopData::SubmitSeedOperationsParameters":{operations:["$array","$string"],cv:["opt-field","$string"],docSessionId:["opt-field","$string"]},"AugLoopData::SubmitSeedGroupOperationsParameters":{operations:["$array","$string"],groupComplete:["opt-field","$boolean"],cv:["opt-field","$string"],docSessionId:["opt-field","$string"]},"AugLoopData::SubmitCustomMessageParameters":{message:"$string",messageId:"$string",docSessionId:["opt-field","$string"]},"AugLoopData::ForceReconnectParameters":{docSessionId:["opt-field","$string"],extensionConfigs:["opt-field",["$array","$string"]]},"AugLoopData::CloseParameters":{docSessionId:["opt-field","$string"]},"AugLoopData::SetSessionCloseCallbackParameters":{docSessionId:["opt-field","$string"]},"AugLoopData::SetConnectCallbackParameters":{docSessionId:["opt-field","$string"]},"AugLoopData::SetDisconnectCallbackParameters":{docSessionId:["opt-field","$string"]},"AugLoopData::CreateSessionResult":{errMessage:["opt-field","$string"],docSessionId:["opt-field","$string"]},"AugLoopData::ActivateAnnotationResult":{errMessage:["opt-field","$string"],token:"$string",docSessionId:["opt-field","$string"]},"AugLoopData::AnnotationResult":{operation:"$string",token:"$string",docSessionId:["opt-field","$string"]},"AugLoopData::SubmitCustomMessageResult":{errMessage:["opt-field","$string"],response:["opt-field","$string"],messageId:"$string",docSessionId:["opt-field","$string"]},"AugLoopData::ForceReconnectResult":{errMessage:["opt-field","$string"],docSessionId:["opt-field","$string"]},"AugLoopData::SessionCloseResult":{sessionCloseMessage:["opt-field","$string"],docSessionId:["opt-field","$string"]},"AugLoopData::ConnectResult":{isSeedingRequired:"$boolean",sessionUrl:"$string",origin:"$string",authToken:"$string",docSessionId:["opt-field","$string"]},"AugLoopData::DisconnectResult":{error:"$string",docSessionId:["opt-field","$string"]}}),t.ServiceInfos={NativeService:["AugLoopData::NativeService",{OnResult:["FireAndForgetMethod",["AugLoopData::ResultData"]],OnCreateSessionResult:["FireAndForgetMethod",["AugLoopData::CreateSessionResult"]],OnActivateAnnotationResult:["FireAndForgetMethod",["AugLoopData::ActivateAnnotationResult"]],OnAnnotationResult:["FireAndForgetMethod",["AugLoopData::AnnotationResult"]],OnSubmitCustomMessageResult:["FireAndForgetMethod",["AugLoopData::SubmitCustomMessageResult"]],OnForceReconnectResult:["FireAndForgetMethod",["AugLoopData::ForceReconnectResult"]],OnSessionCloseResult:["FireAndForgetMethod",["AugLoopData::SessionCloseResult"]],OnConnectResult:["FireAndForgetMethod",["AugLoopData::ConnectResult"]],OnDisconnectResult:["FireAndForgetMethod",["AugLoopData::DisconnectResult"]],RequestAuthToken:["ReturnsPromiseMethod","AugLoopData::AuthTokenResponse",["AugLoopData::AuthTokenRequest"]],RequestAuthTokens:["ReturnsPromiseMethod","AugLoopData::AuthTokensResponse",["AugLoopData::AuthTokenRequest"]],IsFeatureEnabled:["ReturnsPromiseMethod","$boolean",["$string","$string"]],ExecuteLocalLambda:["ReturnsPromiseMethod","$string",["AugLoopData::InputData","$string","$string"]],AreLicenseFeaturesEnabled:["ReturnsPromiseMethod","$boolean",[["$array","$number"]]],SendDiagnosticTrace:["FireAndForgetMethod",["$number","$number","$string"]],OnSetServiceUrl:["Event","$string"],OnSetHostMetadata:["Event","AugLoopData::HostMetadata"],OnSubmit:["Event","AugLoopData::InputData"],OnCreateSession:["Event","AugLoopData::CreateSessionParameters"],OnActivateAnnotation:["Event","AugLoopData::ActivateAnnotationParameters"],OnSubmitOperations:["Event","AugLoopData::SubmitOperationsParameters"],OnSubmitSeedOperations:["Event","AugLoopData::SubmitSeedOperationsParameters"],OnSubmitSeedGroupOperations:["Event","AugLoopData::SubmitSeedGroupOperationsParameters"],OnSubmitCustomMessage:["Event","AugLoopData::SubmitCustomMessageParameters"],OnForceReconnect:["Event","AugLoopData::ForceReconnectParameters"],OnClose:["Event","AugLoopData::CloseParameters"],OnSetSessionCloseCallback:["Event","AugLoopData::SetSessionCloseCallbackParameters"],OnSetConnectCallback:["Event","AugLoopData::SetConnectCallbackParameters"],OnSetDisconnectCallback:["Event","AugLoopData::SetDisconnectCallbackParameters"]}]},t.NativeServices={NativeService:i.RekaServiceRegistry.getNativeService(t.ServiceInfos.NativeService)},r(n(16),t)},function(e,t){e.exports=OfficePlatformGlobal.Reka},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initAugLoopSDX=void 0;var o=n(16),r=n(84),i=n(0),s=n(1),a=n(9),u=n(173),c=n(207),l=n(12),p=n(209),f=n(212),d=n(213),h=n(214),g=n(217),m=n(218),y=n(228),v=n(229),S=n(230),T=n(231),b=function(){var e=new v.TelemetryLogger;e.setTenantTokens({Office:{AugLoop:{ariaTenantToken:"3de4087d4de34817b1c376e3d1e6e293-983c4292-5ba9-485a-ab10-9797863c788b-6770",nexusTenantToken:1780,Client:{}}}}),e.addSink((0,S.createOTelSink)());return function(t,n,o,r,i,s){var a={eventName:n.replace(/_/g,".")};a.eventFlags={samplingPolicy:v.SamplingPolicy.Measure,dataCategories:v.DataCategories.ProductServiceUsage|v.DataCategories.ProductServicePerformance,diagnosticLevel:v.DiagnosticLevel.NecessaryServiceDataEvent},"Office.System.Activity"===r&&(a.eventContract={name:r,dataFields:v.Contracts.Office.System.Activity.getFields({duration:i.Duration,count:i.Count,aggMode:i.AggMode,cV:i.CV,success:i.Success,result:i.Result?{code:i.Result.Code||0,type:i.Result.Type,tag:i.Result.Tag}:void 0})}),a.dataFields=Object.keys(o).filter((function(e){return void 0!==o[e]})).map((function(e){return function(e,t){var n=e.charAt(0).toUpperCase()+e.slice(1);return"string"==typeof t?{name:n,dataType:v.DataFieldType.String,value:t}:"boolean"==typeof t?{name:n,dataType:v.DataFieldType.Boolean,value:t}:"number"==typeof t?{name:n,dataType:v.DataFieldType.Double,value:t}:"object"==typeof t&&t.isInteger?{name:n,dataType:v.DataFieldType.Int64,value:t.value}:void 0}(e,o[e])})),e.sendTelemetryEvent(a)}};t.initAugLoopSDX=function(e){var t,n,v=null,S=new Map,w={onResult:function(t,n,o,r){e.OnResult({InputSchema:t,InputJson:JSON.stringify(n),OutputSchema:o,OutputJson:JSON.stringify(r)})},onAnnotationResult:null,requestAuthToken:function(t){return e.RequestAuthToken(t)},sendTelemetryEvent:b(),isFeatureEnabled:function(t,n){return e.IsFeatureEnabled(t,n)},executeLocalLambda:function(t,n,o,r){var i={InputSchema:t,InputJson:JSON.stringify(n),CorrelationVector:""};return e.ExecuteLocalLambda(i,o,"").then((function(e){return e?JSON.parse(e):void 0}))},areLicenseFeaturesEnabled:function(t){return e.AreLicenseFeaturesEnabled(t)}};i.Log.addLogger({level:r.LoggingLevel.info,log:function(t){var n,r,i;"Log"===t.eventName&&e.SendDiagnosticTrace(null!==(n=t.tagId)&&void 0!==n?n:0,null!==(r=t.traceLevel)&&void 0!==r?r:o.LogSeverity.Info,null!==(i=t.message)&&void 0!==i?i:"")}});var _=function(){return null!==v?v:v=e.IsFeatureEnabled("Microsoft.Office.AugLoop.EnableBatchOptions","None").then((function(o){return a.runtime.init(t,n,w,{telemetryAggregationIntervalSec:30,batchOptions:o?{delayMs:1e3,maxInputSize:1048576}:void 0}).then((function(){return s.runtimeALv1.init(t,n,w)})).then((function(){return"PowerPoint"===n.appName?Promise.all([(0,h.configureRuntimeForPowerPointWorkflows)(s.runtimeALv1),(0,m.configureRuntimeForIntentClassifierWorkflow)(s.runtimeALv1),(0,p.configureRuntimeForClpWorkflows)(s.runtimeALv1,n,t,(0,l.defaultThrottlingIntervalSecondsPromise)(),(0,l.defaultBatchIntervalSecondsPromise)(),(0,l.defaultBatchSizeKBPromise)(),e),(0,f.configureRuntimeForAUXv3PPTWorkflow)(s.runtimeALv1),(0,d.configureRuntimeForTopCommandsPerUserPPTWorkflow)(s.runtimeALv1)]).then((function(){})):"Word"===n.appName?Promise.all([(0,u.configureRuntimeForAcronymsWorkflow)(s.runtimeALv1,e),(0,u.configureRuntimeForAcronymsReduceWorkflow)(s.runtimeALv1),(0,c.configureRuntimeForSavePromptWorkflow)(s.runtimeALv1),(0,c.configureRuntimeForSavePromptReduceWorkflow)(s.runtimeALv1),(0,m.configureRuntimeForProviderResultWorkflow)(s.runtimeALv1),(0,m.configureRuntimeForInterProviderRankerWorkflow)(s.runtimeALv1),(0,p.configureRuntimeForClpWorkflows)(s.runtimeALv1,n,t,(0,l.defaultThrottlingIntervalSecondsPromise)(),(0,l.defaultBatchIntervalSecondsPromise)(),(0,l.defaultBatchSizeKBPromise)(),e),(0,g.configureRuntimeForSharingSuggestionWorkflow)(s.runtimeALv1,e)]).then((function(){})):"Outlook"===n.appName?Promise.all([(0,p.configureRuntimeForClpWorkflows)(s.runtimeALv1,n,t,(0,l.defaultThrottlingIntervalSecondsPromise)(),(0,l.defaultBatchIntervalSecondsPromise)(),(0,l.defaultBatchSizeKBPromise)(),e)]).then((function(){})):"OneNote"===n.appName?(0,T.configureRuntimeForLangDetectWorkflow)(s.runtimeALv1):"Testing"===n.appName?Promise.all([(0,y.configureRuntimeForIntegrationTestWorkflows)(s.runtimeALv1),(0,h.configureRuntimeForPowerPointWorkflows)(s.runtimeALv1),(0,u.configureRuntimeForAcronymsWorkflow)(s.runtimeALv1,e),(0,u.configureRuntimeForAcronymsReduceWorkflow)(s.runtimeALv1),(0,c.configureRuntimeForSavePromptWorkflow)(s.runtimeALv1),(0,c.configureRuntimeForSavePromptReduceWorkflow)(s.runtimeALv1)]).then((function(){})):void 0}))}))};e.OnSubmit.subscribe((function(t){"RekaPing"!==t.InputSchema?_().then((function(){s.runtimeALv1.submit(t.InputSchema,JSON.parse(t.InputJson),t.CorrelationVector)})):e.OnResult({InputSchema:"RekaPing",InputJson:t.InputJson,OutputSchema:"RekaPing",OutputJson:t.InputJson})})),e.OnSetServiceUrl.subscribe((function(e){t=e})),e.OnSetHostMetadata.subscribe((function(e){for(var t=[],o=0,r=e.DisabledServiceGroups;o<r.length;o++){var i=r[o];t.push({officeServiceGroup:i.OfficeServiceGroup,controllerServiceGroup:i.ControllerServiceGroup})}n={appName:e.AppName,appPlatform:e.AppPlatform,appVersion:e.AppVersion,uiLanguage:e.UILanguage,releaseAudienceGroup:e.ReleaseAudienceGroup,releaseChannel:e.ReleaseChannel,releaseFork:e.ReleaseFork,sessionId:e.SessionId,flights:e.Flights,privateMode:e.PrivateMode,disabledServiceGroups:t}}));var C=function(e){i.Log.error(593892183,i.LogCategory.CoreDefault,"Session not found for ".concat(e," event"))},O=function(e,t){i.Log.error(0,i.LogCategory.CoreDefault,"Bad input for ".concat(e,": ").concat(t))},I=function(e,t){i.Log.error(593892186,i.LogCategory.CoreDefault,"Promise rejected for ".concat(e," event with: ").concat(t))},A=function(e){if(e){if("string"==typeof e)return e;if("string"==typeof e.message)return e.message}return"Unknown error"};e.OnCreateSession.subscribe((function(t){var n=t.docSessionId,o=t.flights,r=t.serviceUrl;if(S.has(n))e.OnCreateSessionResult({errMessage:"docSessionId already exists",docSessionId:n});else{var i=_().then((function(){var e=[];try{for(var i=0,s=t.extensionConfigs||[];i<s.length;i++){var u=s[i];e.push(JSON.parse(u))}}catch(e){throw O("OnCreateSession",A(e)),new Error("Bad extension configs")}return a.runtime.createSession({docSessionId:n,extensionConfigs:e,flights:o,serviceUrl:r})})).then((function(t){return e.OnCreateSessionResult({docSessionId:n}),t})).catch((function(t){S.delete(n);var o=A(t);throw I("OnCreateSession",o),e.OnCreateSessionResult({errMessage:o,docSessionId:n}),new Error(o)}));S.set(n,i)}})),e.OnActivateAnnotation.subscribe((function(t){var n,o=t.annotationType,r=t.token,i=t.config,s=t.docSessionId,a=S.get(s);a?a.then((function(t){var n=i?JSON.parse(i):void 0;return t.activateAnnotation(o,{config:n,callback:function(t){e.OnAnnotationResult({operation:JSON.stringify(t),token:r,docSessionId:s})}})})).then((function(e){})).catch((function(e){n=A(e)})).then((function(){e.OnActivateAnnotationResult({errMessage:n,token:r,docSessionId:s})})).catch((function(e){I("OnActivateAnnotation",A(e))})):C("OnActivateAnnotation")})),e.OnSubmitOperations.subscribe((function(e){var t=e.operations,n=e.cv,o=e.docSessionId,r=S.get(o);r?r.then((function(e){e.submitOperations(t.map((function(e){return JSON.parse(e)})),n)})).catch((function(e){I("OnSubmitOperations",A(e))})):C("OnSubmitOperations")})),e.OnSubmitSeedOperations.subscribe((function(e){var t=e.operations,n=e.cv,o=e.docSessionId,r=S.get(o);r?r.then((function(e){e.submitSeedOperations(t.map((function(e){return JSON.parse(e)})),n)})).catch((function(e){I("OnSubmitSeedOperations",A(e))})):C("OnSubmitSeedOperations")})),e.OnSubmitSeedGroupOperations.subscribe((function(e){var t=e.operations,n=e.groupComplete,o=e.cv,r=e.docSessionId,i=S.get(r);i?i.then((function(e){e.submitSeedGroupOperations(t.map((function(e){return JSON.parse(e)})),n,o)})).catch((function(e){I("OnSubmitSeedGroupOperations",A(e))})):C("OnSubmitSeedGroupOperations")})),e.OnSubmitCustomMessage.subscribe((function(t){var n,o,r=t.message,i=t.messageId,s=t.docSessionId,a=S.get(s);a?a.then((function(e){return e.submitCustomMessage(JSON.parse(r))})).then((function(e){o=e})).catch((function(e){n=A(e)})).then((function(){e.OnSubmitCustomMessageResult({errMessage:n,response:JSON.stringify(o),messageId:i,docSessionId:s})})).catch((function(e){I("OnSubmitCustomMessage",A(e))})):C("OnSubmitCustomMessage")})),e.OnForceReconnect.subscribe((function(t){var n=t.docSessionId,o=S.get(n);if(o){var r,i=[];try{for(var s=0,a=t.extensionConfigs||[];s<a.length;s++){var u=a[s];i.push(JSON.parse(u))}}catch(e){return void O("OnForceReconnect",A(e))}o.then((function(e){return e.forceReconnect()})).catch((function(e){r=A(e)})).then((function(){e.OnForceReconnectResult({errMessage:r,docSessionId:n})})).catch((function(e){I("OnForceReconnect",A(e))}))}else C("OnForceReconnect")})),e.OnClose.subscribe((function(e){var t=e.docSessionId,n=S.get(t);n?n.then((function(e){e.close()})).catch((function(e){I("OnClose",A(e))})):C("OnClose")})),e.OnSetSessionCloseCallback.subscribe((function(t){var n=t.docSessionId,o=S.get(n);o?o.then((function(t){t.setSessionCloseCallback((function(t){e.OnSessionCloseResult({docSessionId:n,sessionCloseMessage:t?JSON.stringify(t):void 0})}))})).catch((function(e){I("OnSetSessionCloseCallback",A(e))})):C("OnSetSessionCloseCallback")})),e.OnSetConnectCallback.subscribe((function(t){var n=t.docSessionId,o=S.get(n);o?o.then((function(t){t.setConnectCallback((function(t,o,r,i){e.OnConnectResult({docSessionId:n,isSeedingRequired:t,sessionUrl:o,origin:r,authToken:i})}))})).catch((function(e){I("OnSetConnectCallback",A(e))})):C("OnSetConnectCallback")})),e.OnSetDisconnectCallback.subscribe((function(t){var n=t.docSessionId,o=S.get(n);o?o.then((function(t){t.setDisconnectCallback((function(t){e.OnDisconnectResult({error:t,docSessionId:n})}))})).catch((function(e){I("OnSetDisconnectCallback",A(e))})):C("OnSetDisconnectCallback")}))}},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(21),t),r(n(85),t),r(n(86),t),r(n(30),t),r(n(31),t),r(n(32),t),r(n(89),t),r(n(35),t),r(n(90),t),r(n(36),t),r(n(37),t),r(n(91),t),r(n(38),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnvironmentNameTranslation=t.Environment=void 0,function(e){e.dev="dev",e.int="int",e.test="test",e.dogfood="dogfood",e.prod="prod",e.gcc="gcc",e.dod="dod",e.gccHigh="gcchigh",e.ag08="ag08",e.ag09="ag09"}(t.Environment||(t.Environment={})),t.EnvironmentNameTranslation={gcc:"fairfax"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GridSubtreeFilter=t.SequentialItemFilter=t.ItemFilter=void 0;var o=n(10),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Interfaces_ItemFilter"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.ItemFilter=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Interfaces_SequentialItemFilter"},e.getBaseTypes=function(){return["AugLoop_Interfaces_ItemFilter"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SequentialItemFilter=i;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Interfaces_GridSubtreeFilter"},e.getBaseTypes=function(){return["AugLoop_Interfaces_ItemFilter"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.GridSubtreeFilter=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserCommand=t.Event=void 0;var o=n(6),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Event"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Event=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UserCommand"},e.getBaseTypes=function(){return["AugLoop_Core_Event"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.UserCommand=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SerializationProfile=void 0,function(e){e[e.JSONB=0]="JSONB",e[e.JSON=1]="JSON",e[e.JSOND=2]="JSOND",e[e.Disabled=3]="Disabled",e[e.COMPRESSEDJSON=4]="COMPRESSEDJSON"}(t.SerializationProfile||(t.SerializationProfile={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.gatewayType=void 0,t.gatewayType="Gateway"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationMetaDataChange=void 0;var i=function(e){function t(t){var n=e.call(this,t)||this;return n.eventName="AnnotationMetaDataChange",n}return r(t,e),t}(n(93).AnnotationMetaDataChangeEvent);t.AnnotationMetaDataChange=i},function(e,t){var n={util:{},roots:{default:{}}},o=(n.util,n.roots.default||(n.roots.default={}));o.AnnotationMetaDataChangeEvent=function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.sessionKey="",e.prototype.annotationType="",e.prototype.annotationState=0,e.prototype.workflowId="",e}(),e.exports=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CorrelationVector=void 0;var o=function(){function e(e){this.childCount=0,this.id=e||function(){for(var e=0;e<22;e++)i[e]=r[Math.floor(Math.random()*r.length)];return i.join("")}()}return e.fromString=function(t,n){if(!t)throw new Error("Received invalid correlation vector string");var o;return o=t.endsWith(".0")?new e(t.substring(0,t.length-2)):new e(t),n&&(o.childCount=n),o},e.prototype.newChild=function(){return++this.childCount,new e(this.id+"."+this.childCount.toString())},e.prototype.toString=function(){return this.id.length>127?this.id.substring(0,127)+"!":this.id},e}();t.CorrelationVector=o;var r=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],i=new Array(22)},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.LogCategory=t.tagIdToString=t.argsToString=t.Log=void 0;var o,r,i=n(8),s=void 0!==e&&Object({NODE_ENV:"production"})?Object({NODE_ENV:"production"}).SERVICE_NAME:"client",a="abcdefghijklmnopqrstuvwxyz0123456789",u={97:0,98:1,99:2,100:3,101:4,102:5,103:6,104:7,105:8,106:9,107:10,108:11,109:12,110:13,111:14,112:15,113:16,114:17,115:18,116:19,117:20,118:21,119:22,120:23,121:24,122:25,48:26,49:27,50:28,51:29,52:30,53:31,54:32,55:33,56:34,57:35},c=[],l=[],p=new Map,f=new Map,d=new Map,h=new Map;!function(e){e.defineCoreLogCategory=function(e){return{root:"Core",name:e}},e.defineWorkflowLogCategory=function(e){return{root:"Workflow",name:e}},e.clearLoggers=function(){c=[],l=[],f.clear(),d.clear()},e.addLogger=function(e){-1===c.indexOf(e)&&(c.push(e),g(f,e))},e.addDecidingLogger=function(e){-1===l.indexOf(e)&&(l.push(e),g(d,e))},e.setCorrelationContextCallback=function(e){o=e},e.addAggregator=function(e){e.init((function(e,t){S(e,t)})),p.set(e.eventName,e)},e.flushAggregators=function(e){p.forEach((function(t){t.flush(e)}))},e.setTagLevelOverride=function(e,t){var n=T(e);h.set(n,t)},e.resetTagLevelOverrides=function(){h.clear()},e.error=function(e,t,n,o,r,s,a,u,c,l){v(e,t,i.LoggingLevel.error,n,o,r,s,a,u,c,l)},e.warn=function(e,t,n,o,r,s,a,u,c,l){v(e,t,i.LoggingLevel.warn,n,o,r,s,a,u,c,l)},e.info=function(e,t,n,o,r,s,a,u,c,l){v(e,t,i.LoggingLevel.info,n,o,r,s,a,u,c,l)},e.verbose=function(e,t,n,o,r,s,a,u,c,l){v(e,t,i.LoggingLevel.verbose,n,o,r,s,a,u,c,l)},e.debug=function(e,t,n,o,r,s,a,u,c,l){v(e,t,i.LoggingLevel.debug,n,o,r,s,a,u,c,l)},e.metric=function(e,t,n,o,r,s,a,u,c,l){v(e,t,i.LoggingLevel.metric,n,o,r,s,a,u,c,l)},e.dynamic=function(e){S(e)}}(r=t.Log||(t.Log={}));var g=function(e,t){var n=t.level;Object.keys(i.LoggingLevel).map((function(e){return i.LoggingLevel[e]})).filter((function(e){return"string"!=typeof e})).filter((function(e){return e<=n})).forEach((function(n){e.has(n)?e.get(n).push(t):e.set(n,[t])}))};t.argsToString=function(e){return"string"==typeof e?e:e.map((function(e){return e instanceof Error?JSON.stringify({message:e.message,name:e.name,stack:e.stack}):"object"==typeof e?JSON.stringify(e):e})).join(" ")};var m=function(e){return void 0!==e?f.get(e)||[]:c},y=function(e,t){return(void 0!==e?d.get(e)||[]:l).filter((function(e){return e.shouldLog(t)}))},v=function(e,n,r,i,s,a,u,c,l,f,d){r=h.get(e)||r;var g=m(r),v=y(r,i);if(0!=g.length||0!=v.length){var T=(0,t.tagIdToString)(e),b=function(e,t,n,o,r,i,s,a){if(void 0===t&&("string"==typeof e||"object"==typeof e))return e;if(void 0===t&&"function"==typeof e)return e();for(var u=[],c=0,l=[e,t,n,o,r,i,s,a];c<l.length;c++){var p=l[c];void 0!==p&&u.push("function"==typeof p?p():p)}return u}(i,s,a,u,c,l,f,d);if(Array.isArray(b)||"object"!=typeof b){var w={};"Core"===n.root?w.TraceEventV2={dimensionNames:function(){return["Level","Tag"]},dimensionValues:function(){return[String(r),T]},value:function(){return 1}}:w.WorkflowTraceEvent={dimensionNames:function(){return["Level","Tag","Workflow"]},dimensionValues:function(){var e;return[String(r),T,o?null===(e=o())||void 0===e?void 0:e.workflow:""]},value:function(){return 1}},S({eventName:"Log",tagId:T,category:n.root+"."+n.name,traceLevel:r,message:(0,t.argsToString)(b),metrics:w},!1,g,v)}else{var _=b;_.tagId=T,"Operation"===_.eventName&&"Workflow"===n.root&&(_.eventName="WorkflowOperation",o&&(_.joinContextId=o().joinContextId)),_.traceLevel=r;var C=p.get(_.eventName);C?C.add(_):S(_,!1,g,v)}}},S=function(e,t,n,r){var i,a,u;if(void 0===t&&(t=!1),null==n&&(n=m(e.traceLevel)),r=r||[],n.length>0||r.length>0){if(e.serviceName=s,!t&&o){var c=o();if(c){e.cv=e.cv?e.cv:c.cv.toString(),e.sessionKey=e.sessionKey?e.sessionKey:c.sessionKey,e.workflow=e.workflow?e.workflow:c.workflow;var l=null===(i=c.clientMetadata)||void 0===i?void 0:i.appName;e.clientAppName=e.clientAppName?e.clientAppName:l;var p=null===(a=c.clientMetadata)||void 0===a?void 0:a.appPlatform;e.clientAppPlatform=e.clientAppPlatform?e.clientAppPlatform:p;var f=null===(u=c.clientMetadata)||void 0===u?void 0:u.releaseAudienceGroup;e.clientReleaseAudienceGroup=e.clientReleaseAudienceGroup?e.clientReleaseAudienceGroup:f}}for(var d=0,h=n;d<h.length;d++){h[d].log(e)}for(var g=0,y=r;g<y.length;g++){y[g].log(e)}}};t.tagIdToString=function(e){return a[e>>24&63]+a[e>>18&63]+a[e>>12&63]+a[e>>6&63]+a[e>>0&63]};var T=function(e){return e&&5===e.length?u[e.charCodeAt(0)]<<24|u[e.charCodeAt(1)]<<18|u[e.charCodeAt(2)]<<12|u[e.charCodeAt(3)]<<6|u[e.charCodeAt(4)]:-1},b=function(){function e(){}return e.CoreDefault=r.defineCoreLogCategory("Default"),e.WorkflowDefault=r.defineWorkflowLogCategory("Default"),e}();t.LogCategory=b}).call(this,n(39))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggingAggregator=void 0;var o=/\|\~/g,r=function(){this.count=0,this.measureSums=new Map},i=function(e,t,n,i,s){var a=this;this.buckets=new Map,this.init=function(e){a.log=e},this.add=function(e){if(a.condition&&a.condition(e)){for(var t=[],n=0,i=a.dimensions;n<i.length;n++){var s=i[n];if(void 0===e[s])t.push(null);else{var u="";"boolean"==typeof e[s]?u="b~":"number"==typeof e[s]&&(u="n~"),t.push(""+u+e[s].toString().replace(o,"_"))}}var c=t.join("|"),l=a.buckets.get(c);if(!l){(l=new r).traceLevel=e.traceLevel;for(var p=0,f=a.avgMeasures;p<f.length;p++){var d=f[p];l.measureSums.set(d,0)}a.buckets.set(c,l)}l.count++;for(var h=0,g=a.avgMeasures;h<g.length;h++)e[d=g[h]]&&l.measureSums.set(d,l.measureSums.get(d)+e[d])}else a.log(e,!1)},this.flush=function(e){void 0===e&&(e=!1),a.buckets.forEach((function(e,t){for(var n={traceLevel:e.traceLevel,eventName:a.eventName,count:e.count},o=t.split("|"),r=0;r<a.dimensions.length;r++){var i=a.dimensions[r],s=o[r];0===s.indexOf("b~")?n[i]="b~true"===s:0===s.indexOf("n~")?n[i]=parseInt(s.slice("n~".length),10):n[i]=s}for(var u=0,c=a.avgMeasures;u<c.length;u++){var l=c[u];n[l]=Math.round(e.measureSums.get(l)/e.count)}a.log(n,!0)})),a.buckets.clear(),e&&(a.condition=null,clearInterval(a.interval))},this.eventName=e,this.condition=t,this.dimensions=n,this.avgMeasures=i,s>0&&(this.interval=setInterval(this.flush,1e3*s))};t.LoggingAggregator=i},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Operation=void 0;var i=n(98),s=n(40),a=function(e){function t(t,n,o){var r=e.call(this,t)||this;return r.eventName="Operation",r.metrics={},t&&null!=t.count||(r.count=1),r.setClientMetadata(n),r.setUserContext(o),(null==t?void 0:t.operationName)&&r.setMetricsForOpName(t.operationName),r}return r(t,e),t.prototype.setClientMetadata=function(e){return e&&(this.clientAppName=e.appName,this.clientAppPlatform=e.appPlatform,this.clientAppVersion=e.appVersion,this.clientFlights=e.flights,this.clientReleaseAudienceGroup=e.releaseAudienceGroup,this.clientReleaseChannel=e.releaseChannel,this.clientReleaseFork=e.releaseFork,this.clientRuntimeVersion=e.runtimeVersion,this.clientSessionId=e.sessionId,this.clientDeviceId=e.deviceId,this.clientUserAgent=e.userAgent),this},t.prototype.setUserContext=function(e){return e&&(this.userId=e.puid||e.oid,this.userType=e.userType&&e.userType.toString()),this},t.prototype.start=function(){return this.startTime=(0,s.now)(),this},t.prototype.stop=function(){var e=(0,s.now)();return this.durationMs=Math.round(e-this.startTime),this},t.prototype.setMetricsForOpName=function(e){var t=this;switch(e){case"SessionHealthOrphanedEventsWithoutProperSessionKey":case"SessionHealthOrphanedSessions":case"WorkflowActivationState":this.metrics[e+".CountV2"]={dimensionNames:this.getOrphanedSessionHealthDimensionNames.bind(this),dimensionValues:this.getOrphanedSessionHealthDimensionValues.bind(this),value:function(){return t.count}};break;case"MarkUnhealthySession":case"MarkHealthWarningSession":this.metrics[e+".Reason"]={dimensionNames:this.getSessionHealthDimensionNames.bind(this),dimensionValues:this.getSessionHealthDimensionValues.bind(this),value:function(){return 1}};break;default:"matchmaker_timer"===e&&(this.metrics["Workflow.DurationMs"]={dimensionNames:this.getWorkflowDimensionNames.bind(this),dimensionValues:this.getWorkflowDimensionValues.bind(this),value:function(){return t.durationMs}},this.metrics["Workflow.Count"]={dimensionNames:this.getWorkflowDimensionNames.bind(this),dimensionValues:this.getWorkflowDimensionValues.bind(this),value:function(){return 1}}),this.metrics[e+".DurationMsV2"]={dimensionNames:this.getDimensionNames.bind(this),dimensionValues:this.getDimensionValues.bind(this),value:function(){return t.durationMs}},this.metrics[e+".CountV2"]={dimensionNames:this.getDimensionNames.bind(this),dimensionValues:this.getDimensionValues.bind(this),value:function(){return t.count}}}},t.prototype.getDimensionNames=function(){return["Success","ClientAppName","ClientAppPlatform","ResourceId","Dimension0","Dimension1","Dimension2","Dimension3"]},t.prototype.getDimensionValues=function(){return[this.success,this.clientAppName,this.clientAppPlatform,this.resourceId,this.dimension0,this.dimension1,this.dimension2,this.dimension3]},t.prototype.getOrphanedSessionHealthDimensionNames=function(){return["Success","ClientAppName","ClientAppPlatform","ClientReleaseAudienceGroup","ResourceId","Dimension0","Dimension1","Dimension2","Dimension3"]},t.prototype.getOrphanedSessionHealthDimensionValues=function(){return[this.success,this.clientAppName,this.clientAppPlatform,this.clientReleaseAudienceGroup,this.resourceId,this.dimension0,this.dimension1,this.dimension2,this.dimension3]},t.prototype.getSessionHealthDimensionNames=function(){return["Reason","ClientAppName","ClientAppPlatform","ClientAppVersion","Dimension0","Dimension1","Dimension2","Dimension3"]},t.prototype.getSessionHealthDimensionValues=function(){return[this.resultSignature,this.clientAppName,this.clientAppPlatform,this.clientAppVersion,this.dimension0,this.dimension1,this.dimension2,this.dimension3]},t.prototype.getWorkflowDimensionNames=function(){return["ResultSignature","WorkflowId","ResourceId","Success"]},t.prototype.getWorkflowDimensionValues=function(){return[this.resultSignature,this.resourceId,this.resourceId,this.success]},t}(i.OperationEvent);t.Operation=a},function(e,t){var n={util:{},roots:{default:{}}},o=(n.util,n.roots.default||(n.roots.default={}));o.OperationEvent=function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.count=0,e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.durationMs=0,e.prototype.success=!1,e.prototype.resultDescription="",e.prototype.resultSignature="",e.prototype.operationName="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e.prototype.clientDeviceId="",e.prototype.clientUserAgent="",e.prototype.userType="",e.prototype.userId="",e.prototype.ariaTenant="",e.prototype.ariaNamespace="",e}(),e.exports=o},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.SessionHealth=t.SessionHealthImpact=t.SessionHealthReason=t.SessionHealthSource=void 0;var i,s,a,u=n(100),c=n(40);!function(e){e[e.Unknown=0]="Unknown",e[e.Core=1]="Core",e[e.Workflow=2]="Workflow",e[e.SessionExtension=3]="SessionExtension",e[e.Client=4]="Client",e[e.ClientRuntime=5]="ClientRuntime"}(i=t.SessionHealthSource||(t.SessionHealthSource={})),function(e){e[e.Unknown=0]="Unknown",e[e.Core=1]="Core",e[e.Workflow=2]="Workflow",e[e.SessionExtension=3]="SessionExtension",e[e.Client=4]="Client",e[e.Network=5]="Network",e[e.AugLoopDependency=6]="AugLoopDependency",e[e.WorkflowDependency=7]="WorkflowDependency",e[e.ClientRuntime=8]="ClientRuntime"}(s=t.SessionHealthReason||(t.SessionHealthReason={})),function(e){e[e.Unknown=0]="Unknown",e[e.None=1]="None",e[e.MissingInput=2]="MissingInput",e[e.MissingOutput=3]="MissingOutput"}(a=t.SessionHealthImpact||(t.SessionHealthImpact={}));var l=function(e){function t(t,n){var o,r,u=e.call(this,{source:i[t.source],reason:s[t.reason],reasonDependency:t.reasonDependency,subReason:t.subReason,sessionHealthEventName:t.sessionHealthEventName,impact:a[t.impact],success:t.success,durationMs:null!==(o=t.durationMs)&&void 0!==o?o:0,count:"number"==typeof t.count?t.count:1,message:t.message,affectedWorkflows:(null!==(r=t.affectedWorkflows)&&void 0!==r?r:[]).join(","),resourceId:t.resourceId,dimension0:t.dimension0,dimension1:t.dimension1,dimension2:t.dimension2,dimension3:t.dimension3,cv:t.cv,resultSignature:t.resultSignature,resultDescription:t.resultDescription})||this;return u.eventName="SessionHealth",u.metrics={},u.dimensionNames=["ClientAppName","ClientAppPlatform","ClientAppVersion","Success","Reason","Impact","FirstAffectedWorkflow","ResourceId","Dimension0","Dimension1","Dimension2","Dimension3"],n&&u.setClientMetadata(n),u.metrics[t.sessionHealthEventName+".CountV2"]={dimensionNames:function(){return u.dimensionNames},dimensionValues:u.getDimensionValues.bind(u),value:function(){return u.count}},u.metrics[t.sessionHealthEventName+".DurationMsV2"]={dimensionNames:function(){return u.dimensionNames},dimensionValues:u.getDimensionValues.bind(u),value:function(){return u.durationMs}},u}return r(t,e),t.prototype.setClientMetadata=function(e){return e&&(this.clientAppName=e.appName,this.clientAppPlatform=e.appPlatform,this.clientAppVersion=e.appVersion,this.clientFlights=e.flights,this.clientReleaseAudienceGroup=e.releaseAudienceGroup,this.clientReleaseChannel=e.releaseChannel,this.clientReleaseFork=e.releaseFork,this.clientRuntimeVersion=e.runtimeVersion,this.clientSessionId=e.sessionId,this.clientUserAgent=e.userAgent,this.clientDeviceId=e.deviceId),this},t.prototype.setReason=function(e){return this.reason=s[e],this},t.prototype.setSource=function(e){return this.source=i[e],this},t.prototype.setImpact=function(e){return this.impact=a[e],this},t.prototype.setAffectedWorkflows=function(e){return this.affectedWorkflows=(null!=e?e:[]).join(","),this},t.prototype.getAffectedWorkflows=function(){return this.affectedWorkflows.split(",")},t.prototype.start=function(){return this.startTime=(0,c.now)(),this},t.prototype.stop=function(){var e=(0,c.now)();return this.durationMs=Math.round(e-this.startTime),this},t.prototype.getDimensionValues=function(){var e;return[this.clientAppName,this.clientAppPlatform,this.clientAppVersion,this.success?"1":"0",this.reason+"_"+this.reasonDependency,this.impact,null!==(e=this.getAffectedWorkflows()[0])&&void 0!==e?e:"",this.resourceId,this.dimension0,this.dimension1,this.dimension2,this.dimension3]},t}(u.SessionHealthEvent);t.SessionHealth=l},function(e,t){var n={util:{},roots:{default:{}}},o=(n.util,n.roots.default||(n.roots.default={}));o.SessionHealthEvent=function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e.prototype.clientDeviceId="",e.prototype.clientUserAgent="",e.prototype.userType="",e.prototype.userId="",e.prototype.sessionHealthEventName="",e.prototype.source="",e.prototype.reason="",e.prototype.reasonDependency="",e.prototype.subReason="",e.prototype.impact="",e.prototype.success=!1,e.prototype.durationMs=0,e.prototype.count=0,e.prototype.message="",e.prototype.affectedWorkflows="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.resultDescription="",e.prototype.resultSignature="",e}(),e.exports=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.runtimeALv1=t.ClientRuntimeALv1=t.getTypeFromSchema=t.Workflow=void 0;var r,i=n(103),s=n(0),a=n(9),u=n(166),c=n(4),l=n(167),p=n(168),f=n(169),d=n(171),h=n(41),g=n(172);!function(e){e[e.Restricted=0]="Restricted",e[e.Unrestricted=1]="Unrestricted",e[e.Suppressed=2]="Suppressed"}(r||(r={}));var m=function(){function e(){this.canaryTextTileEventSubmittedByDocSessionId=new Set,this.stateByDocSessionId=new Map,this.executionQueueByDocSessionId=new Map,this.executionCountByDocSessionId=new Map}return e.prototype.getOutputSchema=function(){return this.lambdas[this.lambdas.length-1].outputSchema},e.prototype.scheduleExecution=function(e,t){var n=this.docSessionIdExtractor?this.docSessionIdExtractor(e):void 0,o=this.getStateForDocSessionId(n);if(o===r.Restricted){var i=this.getExecutionQueueForDocSessionId(n);i.push(t),1===i.length&&t()}else o===r.Unrestricted?t():r.Suppressed},e.prototype.onStart=function(e){this.incrementExecutionCountForDocSessionId(e)},e.prototype.onFinish=function(e,t){if(this.decrementExecutionCountForDocSessionId(e),t===c.ExceptionType.Authentication)this.stateByDocSessionId.set(e,r.Suppressed),this.executionQueueByDocSessionId.delete(e);else if(this.stateByDocSessionId.get(e)===r.Restricted){var n=this.getExecutionQueueForDocSessionId(e);if(n.shift(),void 0===t){this.stateByDocSessionId.set(e,r.Unrestricted),this.executionQueueByDocSessionId.delete(e);for(var o=0,i=n;o<i.length;o++){(0,i[o])()}}else if(n.length>0){(0,n[0])()}}},e.prototype.onRefresh=function(e){this.stateByDocSessionId=new Map,this.triggerOnRefresh&&(e?(this.executionQueueByDocSessionId.delete(e),this.executionCountByDocSessionId.delete(e)):(this.executionQueueByDocSessionId=new Map,this.executionCountByDocSessionId=new Map)),this.canaryTextTileEventSubmittedByDocSessionId.delete(e)},e.prototype.getStateForDocSessionId=function(t){var n=this.stateByDocSessionId.get(t);return void 0===n&&(n=e.executionQueuesEnabled?r.Restricted:r.Unrestricted,this.stateByDocSessionId.set(t,n)),n},e.prototype.getExecutionQueueForDocSessionId=function(e){var t=this.executionQueueByDocSessionId.get(e);return void 0===t&&(t=[],this.executionQueueByDocSessionId.set(e,t)),t},e.prototype.incrementExecutionCountForDocSessionId=function(e){var t=this.executionCountByDocSessionId.get(e)||0;this.executionCountByDocSessionId.set(e,t+1)},e.prototype.decrementExecutionCountForDocSessionId=function(e){var t=this.executionCountByDocSessionId.get(e)||0;t<=1?this.executionCountByDocSessionId.delete(e):this.executionCountByDocSessionId.set(e,t-1)},e.executionQueuesEnabled=!0,e}();t.Workflow=m;t.getTypeFromSchema=function(e){return{category:c.TypeCategory.Schema,schema:{name:e}}};var y="Tiling.TextTileEvent",v=function(e,t){return e===y&&t&&t.type==u.Tiling.TextTileEventType.Refresh},S=function(e,t){return"ClpSlideTile"===e&&t&&t.eventType==u.Ppt.SlideTileEventType.Refresh},T=function(e,t){return v(e,t)||S(e,t)},b=function(e,t){var n,o;return e===y?null===(o=null===(n=t.tile)||void 0===n?void 0:n.metadata)||void 0===o?void 0:o.docSessionId:"ClpSlideTile"===e?t.docId:void 0},w=function(){function e(){this.inputSchemasToWorkflows=new Map,this.inputSchemasToReduceWorkflows=new Map,this.reduceWorkflowsGroupingKeyExtractors=new Map,this.defaultWorkflowOptions={canProduceNullResult:!1,shouldSendResultsToHost:!0,enabledByDefault:!1,throttleSettings:{shouldBeThrottled:!1},triggerOnRefresh:!1},this.resultCache=new d.ResultCache,this.reduceTimerCache=new l.ReduceTimerCache,this.lookupTableCache=new Map,this.throttling=new g.ExecutionWithThrottling,this.lastTileRefreshSeq=-1,this.lastTileRefreshSeqByDocSessionId=new Map,this.tileRefreshByDocSessionIdEnabled=!0}return e.prototype.init=function(e,t,n){var o=this,r=new s.Operation({operationName:"InitRuntimeALv1",resourceId:e});r.start(),this.clientMetadata=t,this.clientMetadata&&(this.clientMetadata.runtimeVersion=(0,a.getVersion)()),this.hostCallbacks=n;var i=[];return i.push(this.isFeatureEnabled("DisableWebSocket").then((function(n){if(!!n)return!1;return!(["Outlook Mac","Outlook Win32","PowerPoint Mac","PowerPoint Web","PowerPoint Win32","Word Mac","Word Win32"].indexOf(t.appName+" "+t.appPlatform)>=0)||f.testWebSocketConnection(a.Utils.convertServiceUrlToWebSocket(e),o.clientMetadata)})).then((function(t){e&&(o.serviceUrl=t?a.Utils.convertServiceUrlToWebSocket(e):e,o.executeRemoteLambda=t?f.executeRemoteLambda:p.executeRemoteLambda,o.clearRemoteLambdaTokenCache=t?f.clearTokenCache:p.clearTokenCache,o.serviceProtocol=o.serviceUrl.split(":")[0].toLowerCase())}))),i.push(this.isFeatureEnabled("WorkflowQueuesDisabled").then((function(e){m.executionQueuesEnabled=!e}))),i.push(this.isFeatureEnabled("TileRefreshByDocSessionIdDisabled").then((function(e){o.tileRefreshByDocSessionIdEnabled=!e}))),Promise.all(i).then((function(){o.logOperation(r,!0)})).catch((function(e){o.logOperation(r,!1,"Error",e?e.message:"(no error)")}))},e.prototype.getServiceProtocol=function(){return this.serviceProtocol},e.prototype.registerSchemas=function(e,t){return Promise.resolve()},e.prototype.registerSimpleLocalWorkflow=function(e,t,n){return void 0===n&&(n=this.defaultWorkflowOptions),t.source=t.source||h.LambdaSource.Custom,this.registerHardcodedWorkflow(e,[t],this.inputSchemasToWorkflows,n)},e.prototype.registerSimpleRemoteWorkflow=function(e,t,n,o,r){void 0===r&&(r=this.defaultWorkflowOptions);var i=[];return t&&(t.source=h.LambdaSource.Custom,i.push(t)),n.source=n.func?h.LambdaSource.Custom:h.LambdaSource.Remote,i.push(n),o&&(o.source=h.LambdaSource.Custom,i.push(o)),this.registerHardcodedWorkflow(e,i,this.inputSchemasToWorkflows,r)},e.prototype.registerMultipleLambdasWorkflow=function(e,t,n){return void 0===n&&(n=this.defaultWorkflowOptions),this.registerHardcodedWorkflow(e,t,this.inputSchemasToWorkflows,n)},e.prototype.registerReduceWorkflow=function(e,t,n,o,r){return void 0===o&&(o=10),void 0===r&&(r=this.defaultWorkflowOptions),this.reduceWorkflowsGroupingKeyExtractors.set(t.inputSchema,n),this.resultCache.setBucketSize(t.inputSchema,o),t.source=t.source||h.LambdaSource.Custom,this.registerHardcodedWorkflow(e,[t],this.inputSchemasToReduceWorkflows,r)},e.prototype.registerMultipleLambdasReduceWorkflow=function(e,t,n,o,r){return void 0===o&&(o=10),void 0===r&&(r=this.defaultWorkflowOptions),this.reduceWorkflowsGroupingKeyExtractors.set(t[0].inputSchema,n),this.resultCache.setBucketSize(t[0].inputSchema,o),this.registerHardcodedWorkflow(e,t,this.inputSchemasToReduceWorkflows,r)},e.prototype.submit=function(e,t,n){this.submitToWorkflows(e,t,n,this.inputSchemasToWorkflows)},e.prototype.getGroupingKey=function(e,t,n){var o=this.reduceWorkflowsGroupingKeyExtractors.get(n);if(null==o)throw new Error("Reduce workflow does not have a grouping extractor");return o(t,e)},e.prototype.submitToWorkflows=function(e,t,n,o){if(void 0===o&&(o=this.inputSchemasToWorkflows),this.hostCallbacks){var r;r=n?s.CorrelationVector.fromString(n):new s.CorrelationVector,this.handleTileRefresh(e,t,r);for(var i,a=0,u=o.get(e)||[];a<u.length;a++){var c=u[a];T(e,t)&&!c.triggerOnRefresh||(c.useCanaryTextTile&&e===y&&!c.canaryTextTileEventSubmittedByDocSessionId.has(b(e,t))&&(this.submitToWorkflow(y,{type:(i=t).type,tile:{metadata:{docSessionId:i.tile.metadata.docSessionId,docId:i.tile.metadata.docId,seqnoCLPRefresh:i.tile.metadata.seqnoCLPRefresh,tileId:"A56B3127DBDFD0D6"},elements:[{text:"B91153AE828B4E48"}]}},r,c,o),c.canaryTextTileEventSubmittedByDocSessionId.add(b(e,t))),this.submitToWorkflow(e,t,r,c,o))}}},e.prototype.submitToWorkflow=function(e,n,o,r,i){var a=this,u={messageType:c.MessageType.Input,correlationVector:o.newChild(),payload:n,payloadSchema:(0,t.getTypeFromSchema)(r.lambdas[0].inputSchema),clientMetadata:this.clientMetadata},l=new s.Operation({cv:u.correlationVector.toString(),operationName:"ExecuteWorkflow",resourceId:r.name});l.start(),r.scheduleExecution(n,(function(){try{if(u.payload&&u.payload.tile&&u.payload.tile.metadata&&u.payload.tile.metadata.tileId){var t=u.payload.tile.metadata.tileId;a.throttling.execute(t,r,(function(){return a.executeWorkflow(l,u,n,r,e,i)}))}else a.executeWorkflow(l,u,n,r,e,i)}catch(e){l.success=!1,l.resultSignature="ExecuteException",l.resultDescription=e?e.message:"(no error)",s.Log.error(559290447,s.LogCategory.CoreDefault,l.stop())}}))},e.prototype.handleTileRefresh=function(e,t,n){var o=this;if(T(e,t)){var r=this.tileRefreshByDocSessionIdEnabled?b(e,t):void 0,i=function(e,t){var n,o;return v(e,t)?null===(o=null===(n=t.tile)||void 0===n?void 0:n.metadata)||void 0===o?void 0:o.seqnoCLPRefresh:(S(e,t),-1)}(e,t);if(this.tileRefreshByDocSessionIdEnabled){var a=this.lastTileRefreshSeqByDocSessionId.get(r);if(a>=0&&i<=a)return}else if(i<=this.lastTileRefreshSeq)return;var u=new s.Operation({cv:n.toString(),operationName:"TileRefresh",resultDescription:"",success:!0});if(u.start(),this.tileRefreshByDocSessionIdEnabled&&!r)return u.success=!1,u.resultDescription="NoDocSessionId",void s.Log.info(559290448,s.LogCategory.CoreDefault,u.stop());this.inputSchemasToReduceWorkflows.forEach((function(e,t){e.some((function(e){return e.triggerOnRefresh}))&&(o.tileRefreshByDocSessionIdEnabled?(o.resultCache.clear(t,{primary:r}),o.resultCache.clear(o.getForcedDocLevelSchema(t),{primary:r}),o.reduceTimerCache.clear(t,r)):(o.resultCache.clear(t),o.resultCache.clear(o.getForcedDocLevelSchema(t)),o.reduceTimerCache.clear(t)),e.some((function(e){return!e.triggerOnRefresh}))&&(u.resultDescription+="X_"),u.resultDescription+=t+" ")})),this.clearRemoteLambdaTokenCache();var c=[];this.inputSchemasToWorkflows.forEach((function(e){return c.push.apply(c,e)})),this.inputSchemasToReduceWorkflows.forEach((function(e){return c.push.apply(c,e)}));for(var l=0,p=c;l<p.length;l++){var f=p[l];this.tileRefreshByDocSessionIdEnabled?f.onRefresh(r):f.onRefresh()}this.tileRefreshByDocSessionIdEnabled?this.lastTileRefreshSeqByDocSessionId.set(r,i):this.lastTileRefreshSeq=i,s.Log.info(559290449,s.LogCategory.CoreDefault,u.stop())}},e.prototype.executeWorkflow=function(e,t,n,o,r,a){var u=this,l=o.docIdExtractor?o.docIdExtractor(t.payload):void 0,p=o.docSessionIdExtractor(n),f=this.tileRefreshByDocSessionIdEnabled?this.lastTileRefreshSeqByDocSessionId.get(p):this.lastTileRefreshSeq;o.onStart(p);var d=function(t){var l=u.tileRefreshByDocSessionIdEnabled?u.lastTileRefreshSeqByDocSessionId.get(p):u.lastTileRefreshSeq;if(o.triggerOnRefresh&&l!==f)return e.success=!0,e.resultSignature="TileRefreshIgnore",void s.Log.info(559290450,s.LogCategory.CoreDefault,e.stop());var d=t.messageType==c.MessageType.Exception&&t.payload.exceptionType==c.ExceptionType.NoOutput,h=d&&o.canProduceNullResult,g=h?o.lambdas[o.lambdas.length-1].outputSchema:t.payloadSchema.schema.name,m=h?null:t.payload;t.messageType===c.MessageType.Input||h?(o.shouldSendResultsToHost&&(a===u.inputSchemasToReduceWorkflows?u.hostCallbacks.onResult("Reduce.Input",n,g,m):u.hostCallbacks.onResult(r,n,g,m)),e.success=!0,e.resultSignature=d?"NoOutput":"ValidOutput"):d?(e.success=!0,e.resultSignature="NoOutput"):(e.success=!1,e.resultSignature="Exception",e.resultDescription=(0,i.getMessageExceptionDescription)(t)),a!==u.inputSchemasToReduceWorkflows&&u.updateResultCacheForReduceWorkflows(r,n,g,m,t.correlationVector.toString()),t.moreResults||(e.stop(),s.Log.info(559290451,s.LogCategory.CoreDefault,e),o.onFinish(p,t.payload&&t.payload.exceptionType?(0,i.getMessageExceptionType)(t):void 0))};o.preExecutionPromise.then((function(){for(var e={lookupTable:u.lookupTableCache.get(o.name),docId:l,docSessionId:p},n=d,r=o.lambdas.length-1;r>=0;r--)n=u.createLambdaExecutionStep(o.name,o.lambdas[r],e,n,d);n(t)}))},e.prototype.getForcedDocLevelSchema=function(e){return"~"+e},e.prototype.updateResultCacheForReduceWorkflows=function(e,t,n,o,r){var i=this,a=this.inputSchemasToReduceWorkflows.get(n);if(a){var c;"docSessionId"===e?(c=this.getGroupingKey(e,t,n),this.resultCache.setResult(this.getForcedDocLevelSchema(n),c,o),c.secondary="*"):(c=this.getGroupingKey(e,t,n),!function(e,t){return e===y&&t&&t.type==u.Tiling.TextTileEventType.Delete||"ClpSlideTile"===e&&t&&t.eventType==u.Ppt.SlideTileEventType.Delete}(e,t)||null==c.primary||null==c.secondary?this.resultCache.setResult(n,c,o):this.resultCache.clear(void 0,c));var l=a.some((function(e){return e.deferReduceUntilIdle})),p=[];this.inputSchemasToWorkflows.forEach((function(e){return p.push.apply(p,e.filter((function(e){return e.getOutputSchema()===n})))}));var f=a.map((function(e){return e.deferReduceUntilIdleMaxDelayMs||0})).reduce((function(e,t){return Math.max(e,t)}));this.reduceTimerCache.setReduceTimer(n,c.primary,(function(){var e=i.resultCache.getResults(n,c);if(e.push.apply(e,i.resultCache.getResults(i.getForcedDocLevelSchema(n),{primary:c.primary})),Array.isArray(e)){var t={id:c.primary,values:e,isReduceInput:!0};i.submitToWorkflows(n,t,r,i.inputSchemasToReduceWorkflows)}else s.Log.error(559290452,s.LogCategory.CoreDefault,'Cached results have unexpected type "'+typeof e+'"')}),500,(function(){return l&&p.some((function(e){return e.executionCountByDocSessionId.get(c.primary)>0}))}),f)}},e.prototype.isFeatureEnabled=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n="None"),this.hostCallbacks&&this.hostCallbacks.isFeatureEnabled?this.hostCallbacks.isFeatureEnabled("Microsoft.Office.AugLoop."+e,n).catch((function(){return Promise.resolve(t)})):Promise.resolve(t)},e.prototype.areLicenseFeaturesEnabled=function(e){return this.hostCallbacks&&this.hostCallbacks.areLicenseFeaturesEnabled?this.hostCallbacks.areLicenseFeaturesEnabled(e).catch((function(){return Promise.resolve(!1)})):Promise.resolve(!1)},e.prototype.isWorkflowEnabled=function(e,t,n,o,r){var i=this;if(t.some((function(e){return e.source===h.LambdaSource.Remote||e.source===h.LambdaSource.BatchedRemote}))){if(!this.serviceUrl)return r.resultDescription="Disabled because no service URL available for remote workflow",Promise.resolve(!1);if(this.clientMetadata&&this.clientMetadata.privateMode&&t.some((function(e){return(e.source===h.LambdaSource.Remote||e.source===h.LambdaSource.BatchedRemote)&&!e.canRunInPrivateMode})))return r.resultDescription="Disabled because we are running in private mode",Promise.resolve(!1)}return(!this.clientMetadata||"Mac"!==this.clientMetadata.appPlatform&&"Win32"!==this.clientMetadata.appPlatform)&&(o=!0,r.resultDescription="Enabled by default due to platform name"),(o?Promise.resolve(!0):this.isFeatureEnabled("WorkflowEnabled."+e)).then((function(t){return t?i.isFeatureEnabled("WorkflowDisabled."+e).then((function(e){return e?(r.resultDescription="Disabled because explicitly disabled",!1):!n||i.areLicenseFeaturesEnabled(n).then((function(e){return e||(r.resultDescription="Disabled because license check failed"),e}))})):(r.resultDescription="Disabled because not explicitly enabled",!1)}))},e.prototype.registerHardcodedWorkflow=function(e,n,o,r){var i=this;if(void 0===o&&(o=this.inputSchemasToWorkflows),!e||e.length>40)throw new Error("Workflow name has invalid length");if(!1===new RegExp(/^[A-Z][a-zA-Z0-9_]+$/).test(e))throw new Error("Workflow name has invalid format");o.forEach((function(t){if(t.some((function(t){return t.name===e})))throw new Error("Workflow name already registered.")}));var a=new s.Operation({operationName:"WorkflowRegistration",resourceId:e,success:!0});return a.setClientMetadata(this.clientMetadata),a.start(),this.isWorkflowEnabled(e,n,r.licenseFeatures,r.enabledByDefault,a).then((function(u){if(a.resultSignature=u?"Enabled":"Disabled",a.stop(),s.Log.info(559290453,s.LogCategory.CoreDefault,a),u){var l=n[0].inputSchema,p=o.get(l);p||(p=[],o.set(l,p));var f=Promise.resolve();r.lookupTableLambda&&(f=new Promise((function(n,o){var a=new s.CorrelationVector,u={messageType:c.MessageType.Input,correlationVector:a,payloadSchema:(0,t.getTypeFromSchema)(r.lookupTableLambda.inputSchema),clientMetadata:i.clientMetadata,payload:{}},l=function(t){t.messageType===c.MessageType.Input&&t.payload&&i.lookupTableCache.set(e,t.payload),n()};i.createLambdaExecutionStep("",r.lookupTableLambda,{},l,l)(u)})));var d=new m;d.name=e,d.lambdas=n,d.canProduceNullResult=r.canProduceNullResult,d.shouldSendResultsToHost=r.shouldSendResultsToHost,d.triggerOnRefresh=r.triggerOnRefresh,d.throttleSettings=r.throttleSettings||i.defaultWorkflowOptions.throttleSettings,d.docIdExtractor=r.docIdExtractor,d.docSessionIdExtractor=function(e){return e.isReduceInput?e.id:b(l,e)},d.deferReduceUntilIdle=r.deferReduceUntilIdle,d.deferReduceUntilIdleMaxDelayMs=r.deferReduceUntilIdleMaxDelayMs,d.useCanaryTextTile=r.useCanaryTextTile,d.preExecutionPromise=f,p.push(d)}}))},e.prototype.logOperation=function(e,t,n,o){e.stop(),e.success=t,e.resultSignature=n,e.resultDescription=o,s.Log.info(559290454,s.LogCategory.CoreDefault,e)},e.prototype.handleLambdaError=function(e,t,n,o,r){null!=e.exceptionType?(0,i.setMessageException)(t,e):e instanceof Error?(0,i.setMessageException)(t,{exceptionType:o,message:e.message}):(0,i.setMessageException)(t,{exceptionType:c.ExceptionType.Unknown,message:e?e.toString():void 0}),this.logOperation(n,!1,"Exception",(0,i.getMessageExceptionDescription)(t)),r(t)},e.prototype.handleLambdaOutput=function(e,n,o,r,s,a){e&&e.exceptionType!==c.ExceptionType.NoOutput?null!=e.exceptionType?this.handleLambdaError(e,n,o,e.exceptionType,a):e instanceof Error?this.handleLambdaError(e,n,o,c.ExceptionType.LambdaErrorCallback,a):(n.payload=e,n.payloadSchema=(0,t.getTypeFromSchema)(r),this.logOperation(o,!0),s(n)):((0,i.setMessageException)(n,{exceptionType:c.ExceptionType.NoOutput}),this.logOperation(o,!0,"NoOutput"),a(n))},e.prototype.executeCustomLambdaStep=function(e,t,n,o,r,s){var a=this;if(null==n.func)(0,i.setMessageException)(e,{exceptionType:c.ExceptionType.LambdaThrow,message:"No lambda function set"}),this.logOperation(t,!1,"Error",(0,i.getMessageExceptionDescription)(e)),s(e);else{try{n.func(e.payload,n.config,o,(function(o){a.handleLambdaOutput(o,e,t,n.outputSchema,r,s)}),(function(n,o){a.handleLambdaOutput(n,e,t,o,s,s)}))}catch(n){this.handleLambdaError(n,e,t,c.ExceptionType.LambdaThrow,s)}}},e.prototype.executeLocalLambdaStep=function(e,t,n,o,r){var s=this;null==this.hostCallbacks.executeLocalLambda?((0,i.setMessageException)(e,{exceptionType:c.ExceptionType.LambdaThrow,message:"No local lambda host callback set"}),this.logOperation(t,!1,"Error",(0,i.getMessageExceptionDescription)(e)),r(e)):this.hostCallbacks.executeLocalLambda(n.inputSchema,e.payload,n.outputSchema).then((function(i){s.handleLambdaOutput(i,e,t,n.outputSchema,o,r)})).catch((function(n){s.handleLambdaError(n,e,t,c.ExceptionType.LambdaThrow,r)}))},e.prototype.executeRemoteLambdaStep=function(e,n,o,r,s,u){var l=this;if(this.serviceUrl){n.resourceId+="."+this.serviceProtocol;var p=function(t,r){t?l.handleLambdaError(t,e,n,t.exceptionType||c.ExceptionType.LambdaErrorCallback,u):l.handleLambdaOutput(r,e,n,o.outputSchema,s,u)};if(r.authTickets=o.authTickets,o.source===h.LambdaSource.Remote)this.executeRemoteLambda(this.serviceUrl,e,(0,t.getTypeFromSchema)(o.inputSchema),(0,t.getTypeFromSchema)(o.outputSchema),e.correlationVector,this.clientMetadata,this.hostCallbacks,r,p);else{this.batchedRemoteLambdaManager||(this.batchedRemoteLambdaManager=new a.BatchManager((function(e,n,o){var r=n.context,i=r.remoteLambda,s=r.lambdaContext;l.executeRemoteLambda(l.serviceUrl,{messageType:c.MessageType.Input,correlationVector:{id:n.cv},payload:e,payloadSchema:(0,t.getTypeFromSchema)(i.inputSchema),clientMetadata:l.clientMetadata},(0,t.getTypeFromSchema)(i.remoteInputSchema),(0,t.getTypeFromSchema)(i.remoteOutputSchema),{id:n.cv},l.clientMetadata,l.hostCallbacks,s,o)}),(function(e,t,n){var o,r=n.lambdaContext;l.updateResultCacheForReduceWorkflows("docSessionId",null!==(o=r.docSessionId)&&void 0!==o?o:r.docId,e,t)})));var f=o.batchOptions,d=this.normalizeBatchOptions(f),g=d.groupingKeyExtractor;d.groupingKeyExtractor=function(e){return o.name+"-"+g(e)};var m={name:o.name,remoteLambda:o,lambdaContext:r};this.batchedRemoteLambdaManager.addBatchItem(e.payload,d,m,e.correlationVector.id.length>127?e.correlationVector.id.substring(0,127)+"!":e.correlationVector.id,void 0,p)}}else(0,i.setMessageException)(e,{exceptionType:c.ExceptionType.LambdaThrow,message:"No URL for remote lambda"}),this.logOperation(n,!1,"Error",(0,i.getMessageExceptionDescription)(e)),u(e)},e.prototype.createLambdaExecutionStep=function(e,t,n,o,r){var a=this;return function(u){var l=new s.Operation({cv:u.correlationVector.toString(),operationName:"ExecuteLambda",resourceId:t.name,dimension0:e});l.start(),t.source===h.LambdaSource.Custom?a.executeCustomLambdaStep(u,l,t,n,o,r):t.source===h.LambdaSource.Local?a.executeLocalLambdaStep(u,l,t,o,r):t.source===h.LambdaSource.Remote||t.source===h.LambdaSource.BatchedRemote?a.executeRemoteLambdaStep(u,l,t,n,o,r):((0,i.setMessageException)(u,{exceptionType:c.ExceptionType.LambdaThrow,message:"Unknown/No lambda location set"}),a.logOperation(l,!1,"Error",(0,i.getMessageExceptionDescription)(u)),r(u))}},e.prototype.normalizeBatchOptions=function(e){if(!e)throw new Error("Expected batchConfig");var t=o({},e);return e.estimateSize||(t.estimateSize=a.estimateSize),t},e}();t.ClientRuntimeALv1=w,t.runtimeALv1=new w},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(42),t),r(n(43),t),r(n(104),t),r(n(105),t),r(n(106),t),r(n(107),t),r(n(108),t),r(n(109),t),r(n(44),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLogicalCondition=t.isComparisonCondition=t.isArrayCondition=void 0;var o=n(42),r=n(43),i=n(44);t.isArrayCondition=function(e){return e.operator in o.arrayOperators};t.isComparisonCondition=function(e){return e.operator in r.comparisonOperators};t.isLogicalCondition=function(e){return e.operator in i.logicalOperators}},function(e,t,n){"use strict";var o=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.getTypesFromLambdas=t.functionReviver=t.functionReplacer=void 0;var r=function(e,t,n){var r=this;this.reviver=function(e,t){if("string"==typeof t){var n=t.match(/function[^\(]*\(([^\)]*)\)\s*{([\w\W]*?)}$/)||t.match(/\(([^\)]*)\)\s*=>\s*{([\w\W]*?)}$/);if(n){var i=n[1].split(",").map((function(e){return e.replace(/\s+/,"")})),s=r.functionName?n[2].concat("//# sourceURL="+r.functionName+".js"):n[2];return r.debuggable&&(s="debugger;".concat(s)),r.dependencyArguments&&(i=i.concat(Array.from(r.dependencyArguments))),Function.apply(void 0,o(o([],i,!1),[s],!1))}}return t},this.functionName=e,this.debuggable=n,this.dependencyArguments=t};t.functionReplacer=function(e,t){return"function"==typeof t?t.toString():t};t.functionReviver=function(e,t,n){return void 0===t&&(t=null),void 0===n&&(n=!1),new r(e,t,n).reviver};t.getTypesFromLambdas=function(e){for(var t=[],n=0,o=e;n<o.length;n++){var r=o[n];r.inputSchema&&t.push(r.inputSchema),r.outputSchema&&t.push(r.outputSchema),r.configSchema&&t.push(r.configSchema)}return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isStopWorkflowMessage=t.setStopAndFilterWorkflowMessage=t.setMessageException=t.getMessageExceptionType=t.getMessageExceptionDescription=t.filterWorkflowSchema=t.exceptionSchema=void 0;var o=n(4);t.exceptionSchema={category:o.TypeCategory.Schema,schema:{name:"Exception",path:"message-schema.proto"}},t.filterWorkflowSchema={category:o.TypeCategory.Schema,schema:{name:"Filter",path:"message-schema.proto"}};t.getMessageExceptionDescription=function(e,t){if(void 0===t&&(t=!1),null==e)return"Invalid message passed";if(null==e.payload)return o.ExceptionType[o.ExceptionType.NoOutput]+": Payload is null";if(null==e.payload.exceptionType)return"Payload is not an exception";var n=o.ExceptionType[e.payload.exceptionType];return n+=e.payload.message?": "+e.payload.message:": No description",n+=t&&e.payload.data?"\n"+e.payload.data.toString():""};t.getMessageExceptionType=function(e){return null==e||null==e.payload||null==e.payload.exceptionType?o.ExceptionType.Unknown:e.payload.exceptionType};t.setMessageException=function(e,n){if(null==e)throw new Error("Cannot set exception on null message");e.payload=n,e.payloadSchema=t.exceptionSchema,e.messageType=o.MessageType.Exception};t.setStopAndFilterWorkflowMessage=function(e,n){if(null==e)throw new Error("Cannot set filter on null message");var r={condition:n};e.payload=r,e.payloadSchema=t.filterWorkflowSchema,e.messageType=o.MessageType.StopAndFilterWorkflow};t.isStopWorkflowMessage=function(e){return(e||{}).messageType==o.MessageType.StopAndFilterWorkflow}},function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.elementTypeFrom=t.arrayTypeFrom=t.isArrayType=t.schemaRefToString=t.typeToString=t.areTypesEqual=t.isTypePrimitive=t.MessageSchema=t.TypeSchema=t.FunctionType=t.BufferType=t.StringType=t.NumberType=t.BooleanType=t.UndefinedType=void 0;var r=n(4);t.UndefinedType={category:r.TypeCategory.Undefined},t.BooleanType={category:r.TypeCategory.Boolean},t.NumberType={category:r.TypeCategory.Number},t.StringType={category:r.TypeCategory.String},t.BufferType={category:r.TypeCategory.Buffer},t.FunctionType={category:r.TypeCategory.Function},t.TypeSchema={category:r.TypeCategory.Schema,schema:{name:"Type",path:"type-schema.proto"}},t.MessageSchema={category:r.TypeCategory.Schema,schema:{name:"BufferMessage",path:"message-schema.proto"}};t.isTypePrimitive=function(e){if(null==e)return!1;switch(e.category){case r.TypeCategory.Boolean:case r.TypeCategory.Number:case r.TypeCategory.String:return!0;default:return!1}};t.areTypesEqual=function(e,n){return(0,t.typeToString)(e)===(0,t.typeToString)(n)};t.typeToString=function(e){if(void 0===e)return"";if(null===e)return"null";var t,n=Object.keys(e).sort().map((function(t){return s(t,e[t])})).filter((function(e){return!!e}));return t="{".concat(n.join(",")).concat("}"),Number(t),t};var i=function(e){if(void 0===e)return"";if(null===e)return"null";var t=Object.keys(e).sort().map((function(t){return s(t,e[t])})).filter((function(e){return!!e}));return"{".concat(t.join(",")).concat("}")},s=function(e,t){return"schema"===e?'"'+e+'":'+i(t):"path"===e?"":"nestedArrayLevel"===e?t?'"'+e+'":'+t:"":void 0===t?"":"string"==typeof t?'"'+e+'":"'+t+'"':'"'+e+'":'+t};t.schemaRefToString=i;t.isArrayType=function(e){return!!e&&e.nestedArrayLevel>0};t.arrayTypeFrom=function(e){var n=o({},e);return n.nestedArrayLevel=(0,t.isArrayType)(e)?e.nestedArrayLevel+1:1,n};t.elementTypeFrom=function(e){var n=o({},e);return n.nestedArrayLevel=(0,t.isArrayType)(e)?e.nestedArrayLevel-1:0,n}},function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.matchmakerType=t.executeOnStopWorkflow=t.isBuiltInLambda=t.BuiltInLambdaType=void 0,function(e){e.Expression="Expression",e.MessageOutput="MessageOutput",e.Edge="Edge",e.EnterWorkflow="EnterWorkflow",e.ExitWorkflow="ExitWorkflow",e.Join="Join",e.SerializePayload="SerializePayload",e.DeserializePayload="DeserializePayload",e.Inline="Inline"}(o=t.BuiltInLambdaType||(t.BuiltInLambdaType={}));t.isBuiltInLambda=function(e){return!!o[e]};t.executeOnStopWorkflow=function(e){return(0,t.isBuiltInLambda)(e)&&e!=o.Inline||e==t.matchmakerType},t.matchmakerType="Matchmaker"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SequentialFetchQueue=void 0;var o=function(){function e(e,t,n){if(this.requestInProgress=!1,this.queuedRequests=[],null==e)throw new Error("No request.");this.fetch=e,this.fetchTimeout=t,this.queueTimeout=n}return e.prototype.tryProcessNextRequest=function(){if(this.requestInProgress=!1,this.queuedRequests.length>0){var e=this.queuedRequests.shift(),t=e[0],n=e[1],o=e[2];clearTimeout(o),this.add(t,n)}},e.prototype.add=function(e,t){var n=this;if(this.requestInProgress){var o=setTimeout((function(){t(new Error("Timed out waiting in queue"),null),n.queuedRequests.shift()}),this.queueTimeout);this.queuedRequests.push([e,t,o])}else{this.requestInProgress=!0,new Promise((function(t,o){var r=!1,i=setTimeout((function(){r=!0,o(new Error("Fetch timed out"))}),n.fetchTimeout);n.fetch(e).then((function(e){r||(clearTimeout(i),t(e))})).catch((function(e){r||(clearTimeout(i),o(e))}))})).then((function(e){t(null,e),n.tryProcessNextRequest()})).catch((function(e){t(e,null),n.tryProcessNextRequest()}))}},e}();t.SequentialFetchQueue=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.createRuntime=t.runtime=t.ClientRuntime=t.getVersion=void 0;var r=n(0),i=n(49),s=n(50),a=n(116),u=n(132),c=n(2),l=n(143),p=n(144),f=n(145),d=n(146),h=n(154);t.getVersion=function(){return n(161).version};var g=function(){function e(e,t,n){var o=this;this.sessionsByDocSessionId=new Map,this.settings={dropOnlySequencedSyncsOnReseedEnabled:!0,closeWSBlockedSessionEnabled:!0,sessionOfflineModeEnabled:!0,annotationsOrderingEnabled:!1,deltaOperationsEnabled:!1,checkIdbByFeatures:!1},this.isDownloaderCompatible=function(){if(o.settings.checkIdbByFeatures)return"undefined"!=typeof Array&&void 0!==Array.from&&"undefined"!=typeof URL&&void 0!==URL.createObjectURL;if("undefined"!=typeof window&&window.navigator&&window.navigator.userAgent){var e=window.navigator.userAgent;return!(!e.indexOf||e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0)}return!1},this.workerFactory=e||function(){return new s.WebSocketWorker};var r=this.createDefaultSessionManagerFactory();this.sessionManagerFactory=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return(null==t?void 0:t.apply(void 0,e))||r.apply(void 0,e)},this.sessionFactory=n||function(e){return new u.SessionProxy(e)}}return e.prototype.init=function(e,n,o,s){var a=this,u=new r.Operation({operationName:"InitRuntime",resourceId:e});u.start(),this.annotationResultsProcessor=new h.RoutingAnnotationResultsProcessor((function(){return a.settings.annotationsOrderingEnabled})),this.inferenceServiceFactory=s.inferenceServiceFactory,this.clientMetadata=n,this.clientMetadata&&(this.clientMetadata.runtimeVersion=(0,t.getVersion)()),this.hostCallbacks=o,r.Log.addLogger(new i.TelemetryLogger(this.hostCallbacks));var l=s.telemetryAggregationIntervalSec;if(void 0===l&&(l=30),l>0){var p=function(e,t,n){return new r.LoggingAggregator(e,(function(e){return e.success&&n.indexOf(e[t])>=0}),[t,"resourceId","success","resultSignature","dimension0","dimension1","dimension2","dimension3"],["durationMs"],l)};r.Log.addAggregator(p("Operation","operationName",["ExecuteLambda","ExecuteWorkflow","ExecuteBatch","ProcessResponse","LocalDeltaUpdate","ApplyFormattedTextTileDeltaForLocalWorkflows","ApplyTextTileDeltaForLocalWorkflows","FindRangeForDelta","RunModelForInferencing","GetResource"])),r.Log.addAggregator(p("SessionHealth","sessionHealthEventName",["ProcessMessage","SendMessage"]))}this.batchOptions=s.batchOptions,e&&(this.defaultServiceUrl=c.Utils.convertServiceUrlToWebSocket(e),this.serviceProtocol=this.defaultServiceUrl.split(":")[0].toLowerCase());var f=[];return f.push(this.isFeatureEnabled("CheckIdbByFeatures",!1).then((function(e){a.settings.checkIdbByFeatures=e}))),f.push(this.isFeatureEnabled("DropOnlySequencedSyncsOnReseedDisabled").then((function(e){a.settings.dropOnlySequencedSyncsOnReseedEnabled=!e}))),f.push(this.isFeatureEnabled("CloseWSBlockedSessionDisabled").then((function(e){a.settings.closeWSBlockedSessionEnabled=!e}))),f.push(this.isFeatureEnabled("SessionOfflineModeDisabled").then((function(e){a.settings.sessionOfflineModeEnabled=!e}))),f.push(this.isFeatureEnabled("AnnotationsOrderingEnabled",!1).then((function(e){a.settings.annotationsOrderingEnabled=e}))),f.push(this.isFeatureEnabled("DeltaOperationsEnabled").then((function(e){a.localWorkflowManager=new d.LocalWorkflowExecutionManager(s.modelDownloader&&a.isDownloaderCompatible()?s.modelDownloader:void 0,a.inferenceServiceFactory,{enableDeltas:e})})).catch((function(){a.localWorkflowManager=new d.LocalWorkflowExecutionManager(s.modelDownloader&&a.isDownloaderCompatible()?s.modelDownloader:void 0,a.inferenceServiceFactory,{enableDeltas:!1})}))),Promise.all(f).then((function(){a.logOperation(u,!0)})).catch((function(e){a.logOperation(u,!1,"Error",e?e.message:"(no error)")}))},e.prototype.getServiceProtocol=function(){return this.serviceProtocol},e.prototype.registerLocalWorkflow=function(e){this.localWorkflowManager.registerLocalWorkflow(e)},e.prototype.flushTelemetry=function(e){r.Log.flushAggregators(e)},e.prototype.createSession=function(e){var t,n=e?e.docSessionId:void 0,r=this.sessionsByDocSessionId.get(n);if(r&&!1===r.isClosed)throw new Error("docSessionId already exists");var i=e&&null!==(t=e.serviceUrl)&&void 0!==t?t:this.defaultServiceUrl;if(!(i=c.Utils.convertServiceUrlToWebSocket(i)))return Promise.reject(new Error("EmptyUrl"));var s=o({},this.clientMetadata);s.docSessionId=n,e&&e.flights&&(s.flights=s.flights?s.flights+";"+e.flights:e.flights);var a=this.sessionFactory({hostCallbacks:this.hostCallbacks,sessionManager:this.sessionManagerFactory(s,i,null==e?void 0:e.enableComplexLocalWorkflows),batchOptions:this.batchOptions,extensionConfigs:(null==e?void 0:e.extensionConfigs)||[],clientMetadata:s,localWorkflowManager:this.localWorkflowManager,annotationResultsProcessor:this.annotationResultsProcessor});return this.sessionsByDocSessionId.set(n,a),e&&e.onSessionConnect&&a.setConnectCallback(e.onSessionConnect),e&&e.onSessionDisconnect&&a.setDisconnectCallback(e.onSessionDisconnect),e&&e.onSessionReconnect&&a.setReconnectCallback(e.onSessionReconnect),e&&e.onSessionClose&&a.setSessionCloseCallback(e.onSessionClose),a.initialize?a.initialize():Promise.resolve(a)},e.prototype.getSessionManagerFactory=function(){return this.sessionManagerFactory},e.prototype.createDefaultSessionManagerFactory=function(){var e=this;return function(t,n,o){if(o)throw new Error("NYI");var i=new f.TokenRefreshManager,s=new l.SessionStats,u=function(){r.Log.error(573321615,r.LogCategory.CoreDefault,"Unexpectedly not set sendMessage")},d=new p.SessionInitializer((function(){return s}),t,i,(function(e,t){u(e,t)}),{getAuthToken:e.getAuthToken.bind(e,t.docSessionId),overrideSessionInitMessage:e.hostCallbacks.overrideSessionInitMessage}),h=new a.WebSocketSessionManager(c.Utils.convertServiceUrlToWebSocket(n),s,e.workerFactory,d,t,i,e.settings);return u=h.sendMessage.bind(h),h.on("disconnect",(function(){return i.clearRefreshTimeouts()})),h.on("connect",(function(t,n,o,r){t&&e.hostCallbacks.setSessionData&&e.hostCallbacks.setSessionData(n,o,r)})),h}},e.prototype.getAuthToken=function(e){var t={Tickets:[]};return e&&(t.DocSessionId=e),this.hostCallbacks.requestAuthToken(t).then((function(e){if(e)return e.Token})).catch((function(){}))},e.prototype.isFeatureEnabled=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n="None"),c.Utils.isFeatureEnabled(this.hostCallbacks,e,t,n)},e.prototype.logOperation=function(e,t,n,o){e.stop(),e.success=t,e.resultSignature=n,e.resultDescription=o,r.Log.info(573321622,r.LogCategory.CoreDefault,e)},e}();t.ClientRuntime=g,t.runtime=new g;t.createRuntime=function(){return new g}},function(e,t,n){(function(t){var n=null;"undefined"!=typeof WebSocket?n=WebSocket:"undefined"!=typeof MozWebSocket?n=MozWebSocket:void 0!==t?n=t.WebSocket||t.MozWebSocket:"undefined"!=typeof window?n=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(n=self.WebSocket||self.MozWebSocket),e.exports=n}).call(this,n(7))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketSessionManager=void 0;var i=n(0),s=n(5),a=n(3),u=n(20),c=n(2),l=n(121),p=n(123),f=n(124),d=function(e){function t(t,n,o,r,a,u,d){var h,g=e.call(this)||this;return g.cvParent=new i.CorrelationVector,g.logOp=new i.Operation({operationName:"SessionState",success:!0}).start(),g.sessionStateChangeLogCountLimiter=new c.LogCountLimiter("SessionState"),g.stats=n,g.allStates=((h={})[p.SessionState.Initing]=new p.InitingState(g),h[p.SessionState.Running]=new p.RunningState(g),h[p.SessionState.Disconnected]=new p.DisconnectedState(g),h[p.SessionState.Closed]=new p.ClosedState(g),h),g.setState(p.SessionState.Initing),g.messageEndpoint=new s.MessageEndpoint("c"),g.messageEndpoint.setClientMetadata(a),g.messageEndpoint.setEgress(g.egress.bind(g)),g.messageEndpoint.onMessage(s.SessionCloseMessage.getTypeName(),(function(e,t){g.onSessionCloseMessage(e,t)})),g.webSocketWorkerManager=new f.WebSocketWorkerManager(t,a,o,r,g.ingress.bind(g),g.onConnectionClose.bind(g),(function(){g.onSessionClose(void 0,"WSNotSupported")}),d),g.messageQueue=new l.MessageQueue({sendMessage:function(e,t,n){return g.state.sendMessage(e,t,n)},sendBytes:g.sendBytes.bind(g),canSendMessage:function(){return g.state.canSendMessage()},dropOnlySequencedSyncsOnReseed:d.dropOnlySequencedSyncsOnReseedEnabled}),r.on("connect",(function(e,t,n,o,r,i){g.setState(p.SessionState.Running,"",{isSessionReseedingStarted:e&&t}),g.emit("connect",e,n,o,r,i)})),r.on("reconnect",(function(){return g.emit("reconnect")})),g.resetNextSyncSequenceId=function(){return g.emit("resetNextSyncSequenceId")},g.tokenRefreshManager=u,g}return r(t,e),t.prototype.setState=function(e,t,n){var o=this;if(!this.state||e!==this.state.stateName){var r=this.state&&this.state.stateName?p.SessionState[this.state.stateName]:"undefined",s="undefined"===r&&e===p.SessionState.Initing||this.state.possibleNextStates.indexOf(e)>=0;this.sessionStateChangeLogCountLimiter.log((function(){o.logOp.stop(),o.logOp.resourceId="New state: "+(s?p.SessionState[e]:r),o.logOp.resultDescription="Previous state: "+r,o.logOp.dimension0="Attempted state: "+(e?p.SessionState[e]:"undefined"),o.logOp.resultSignature=t+(o.state&&!s?"Unexpected state change":""),o.logOp.success=s,i.Log.info(573167323,i.LogCategory.CoreDefault,o.logOp)})),s&&(this.state=this.allStates[e],this.logOp.start(),this.state.onEnter(n))}},t.prototype.init=function(e,t){return this.extensionConfigs=e,this.customInitPromise=t,this.webSocketWorkerManager.init(this.extensionConfigs,this.customInitPromise,!0)},t.prototype.sendMessage=function(e,n){this.retrySendMessage(e,n,t.maxRetries)},t.prototype.sendBytes=function(e){this.state.sendBytes(e)},t.prototype.onMessage=function(e,t){this.messageEndpoint.onMessage(e,t)},t.prototype.getCorrelationVector=function(){return this.cvParent},t.prototype.forceReconnect=function(e){var t=this;return this.extensionConfigs=e||this.extensionConfigs,this.webSocketWorkerManager.close(!1),new Promise((function(e){return setTimeout((function(){e(t.webSocketWorkerManager.init(t.extensionConfigs))}),100)}))},t.prototype.closeSession=function(){this.sendMessage(new s.SessionCloseMessage),this.webSocketWorkerManager.close(!0),this.onSessionClose(void 0,"ClientRequested")},t.prototype.ingress=function(e){var t,n=this;try{t=JSON.parse(e)}catch(e){i.Log.error(573167324,i.LogCategory.CoreDefault,new i.SessionHealthEvent({sessionHealthEventName:"ProcessMessage",resourceId:"Unknown",success:!1,resultSignature:"ParseError",resultDescription:e.message,durationMs:0,source:i.SessionHealthSource.ClientRuntime,reason:i.SessionHealthReason.Client,impact:i.SessionHealthImpact.MissingOutput,affectedWorkflows:["All"],message:""}))}t&&this.messageEndpoint.ingress(t,(function(e,t){return n.egress(e||t,(function(){}))}))},t.prototype.egress=function(e,t){e&&this.webSocketWorkerManager.egress(e).then((function(){return t()})).catch((function(e){return t(e)}))},t.prototype.onSessionCloseMessage=function(e,t){e.reconnectAllowed?this.webSocketWorkerManager.close():this.onSessionClose(e,"CloseMessageReceived"),t()},t.prototype.onSessionClose=function(e,t){this.setState(p.SessionState.Closed,t),this.tokenRefreshManager.clearAllTimeouts(),this.onConnectionClose(void 0),e&&this.emit("sessionClose",e)},t.prototype.onConnectionClose=function(e){this.state.onConnectionClose(),this.stats.lastConnectionClose=c.Utils.getCurrentTimeMs(),this.emit("disconnect",e)},t.prototype.retrySendMessage=function(e,n,o){var r=this,i=t.maxRetries-o;this.state.sendMessage(e,(function(t,i){t&&o>0&&r.canBeRetried(e)&&r.isTransientError(t)?r.retrySendMessage(e,n,o-1):n&&n(t,i)}),i)},t.prototype.canBeRetried=function(e){return!a.SchemaObject.matchesTypesFor(e,[s.SessionInitMessage.getTypeName(),s.MicroSyncMessage.getTypeName()])},t.prototype.isTransientError=function(e){var t=e.error;return t!==s.SendMessageErrorReason.SyncMessageUnsupportedBatch&&t!==s.SendMessageErrorReason.UnexpectedSeedMessage&&t!==s.SendMessageErrorReason.UnsupportedSyncMessage&&t!==s.SendMessageErrorReason.AnnotationTokenNotFound&&t!==l.ClientSendMessageErrorReason.ArrivedBeforeReseeding&&t!==l.ClientSendMessageErrorReason.DroppedAsOldestInQueue},t.maxRetries=2,t}(u.EventEmitter);t.WebSocketSessionManager=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageEndpoint=t.extractMessageNameFromTypeName=t.ProcessMessageErrorReason=t.SendMessageErrorReason=void 0;var o,r,i=n(0),s=n(3),a=n(51),u=n(118);function c(e){for(var t,n=0,o=["AugLoop_Excel_Session_Protocol_","AugLoop_Powerpoint_Session_Protocol_","AugLoop_Session_Protocol_"];n<o.length;n++){var r=o[n];if(0===e.indexOf(r)){t=r;break}}if(!t)return"MalformedMessageName";var i=e.indexOf("Message",e.length-"Message".length)===e.length-"Message".length;return e.slice(t.length,i?-"Message".length:void 0)}!function(e){e.ClientDisconnected="Client disconnected.",e.UnsupportedSyncMessage="SyncMessages with seq = -1 are not supported anymore.",e.UnexpectedSeedMessage="Unexpected seed message",e.SyncMessageUnsupportedBatch="SyncMessage with unsupported batching.",e.AnnotationTokenNotFound="Token not found"}(o=t.SendMessageErrorReason||(t.SendMessageErrorReason={})),function(e){e.ProvisionTokenValidationError="Token provision message didn't pass token validation."}(r=t.ProcessMessageErrorReason||(t.ProcessMessageErrorReason={})),t.extractMessageNameFromTypeName=c;var l=function(){function e(e){this.nextMessageId=1,this.pendingResponseCallbacks=new u.Cache({sweepInterval:5e3}),this.pendingMessageCallbacks=new u.Cache({sweepInterval:5e3}),this.messageCallbacks=new Map,this.messageIdPrefix=e,this.source="c"===e?i.SessionHealthSource.ClientRuntime:i.SessionHealthSource.Core,this.stats={sendMessageCount:0,sendMessageClientDisconnectedErrors:0,sendMessageErrors:0,sendMessageDurationMsMax:0,processMessageCount:0,processMessageProvisionTokenErrors:0,processMessageErrors:0,processMessageDurationMsMax:0}}return e.prototype.setClientMetadata=function(e){this.clientMetadata=e},e.prototype.setEgress=function(e){this.egress=e},e.prototype.ingress=function(e,t){var n=s.SchemaObject.getBaseTypesFor(e),o=s.SchemaObject.getTypeNameFor(e);o===a.Response.getTypeName()||n&&n.indexOf(a.Response.getTypeName())>=0?(this.processResponse(e),t()):this.processMessage(e,t),o!==a.SessionCloseMessage.getTypeName()||e.reconnectAllowed||this.clearAllPendingResponses()},e.prototype.sendMessage=function(e,t,n,o){var r=this;void 0===o&&(o=0);var u=new i.SessionHealth({sessionHealthEventName:"SendMessage",source:this.source,reason:i.SessionHealthReason.Client,impact:this.source===i.SessionHealthSource.ClientRuntime?i.SessionHealthImpact.MissingInput:i.SessionHealthImpact.MissingOutput,success:!0,message:"",affectedWorkflows:["All"],cv:e.cv,resourceId:c(s.SchemaObject.getTypeNameFor(e)),dimension0:o.toString()}).start(),l=function(){if(u.setClientMetadata(r.clientMetadata),u.success)i.Log.info(572836e3,i.LogCategory.CoreDefault,u.stop());else{var e="ErrorWithoutPendingResponse"===u.resultSignature||"ResponseCallbackException"===u.resultSignature||"We called into done callback"!==u.message;u.message=JSON.stringify({errorNotPropagatedToDoneCallback:e}),i.Log.error(572836001,i.LogCategory.CoreDefault,u.stop())}};e.messageId=""+this.messageIdPrefix+this.nextMessageId++;var p=s.SchemaObject.getTypeNameFor(e)===a.SessionCloseMessage.getTypeName();if(!n&&!p){var f=function(n,o){var i;if(n?(u.success=!1,u.resultSignature=n.error,u.resultDescription="Error for "+s.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+n.error):u.resultSignature="Success",t)try{u.message="We called into done callback",t(n,o)}catch(e){u.success=!1,u.resultSignature="ResponseCallbackException",u.resultDescription="Web"===(null===(i=r.clientMetadata)||void 0===i?void 0:i.appPlatform)?JSON.stringify({message:e.message,stack:e.stack}):JSON.stringify({message:e.message})}r.pendingMessageCallbacks.del(e.messageId),l(),r.updateSendMessageStats(u.success,u.durationMs,n?new Error(n.error):void 0)};this.pendingResponseCallbacks.put(e.messageId,f,1e4,(function(){f(new a.TimeoutErrorResponse({error:"Timeout waiting for response"}),void 0)}))}this.egress(e,(function(t){var n,o;if(t){var i=r.pendingResponseCallbacks.get(e.messageId);i?(r.pendingResponseCallbacks.del(e.messageId),i(new a.ErrorResponse({error:t.message}))):p?(u.success=null!==(o=null===(n=t.message)||void 0===n?void 0:n.endsWith("Client disconnected."))&&void 0!==o&&o,u.resultSignature="ErrorSendingSessionCloseMessage",u.resultDescription="Error for "+s.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+t.message,l()):(u.success=!1,u.resultSignature="ErrorWithoutPendingResponse",u.resultDescription="Error for "+s.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+t.message,l())}}))},e.prototype.onMessage=function(e,t){this.messageCallbacks.set(e,t)},e.prototype.getStats=function(){return this.stats},e.prototype.hasMessageCallback=function(e){return this.messageCallbacks.has(e)},e.prototype.cancelPendingResponseCallbacks=function(){var e=this;this.pendingResponseCallbacks.forEach((function(t,n){t&&(e.pendingResponseCallbacks.del(n),t(new a.ErrorResponse({error:"Cancelled"})))}))},e.prototype.clearAllPendingResponses=function(){if(0!=this.pendingResponseCallbacks.size()){var e=new i.Operation({operationName:"PurgePendingResponses",resultDescription:this.pendingResponseCallbacks.size().toString(),success:!0});i.Log.info(572836002,i.LogCategory.CoreDefault,e),this.pendingResponseCallbacks.clear()}},e.prototype.processMessage=function(e,t){var n,o=this,r=new i.SessionHealth({sessionHealthEventName:"ProcessMessage",source:this.source,reason:i.SessionHealthReason.Client,impact:this.source===i.SessionHealthSource.ClientRuntime?i.SessionHealthImpact.MissingOutput:i.SessionHealthImpact.MissingInput,success:!0,message:"",affectedWorkflows:["All"],cv:e.cv}).start(),u=function(){if(r.setClientMetadata(o.clientMetadata),r.success)i.Log.info(572836003,i.LogCategory.CoreDefault,r.stop());else{var e="UnsupportedMessage"===r.resourceId||"Timeout"===r.resultSignature||"OnResponseInvokedMoreThanOnce"===r.resultSignature||"MessageCallbackException"===r.resultSignature||"We called into messageCallback"!==r.message;r.message=JSON.stringify({errorHappenedOutsideRegisteredMessageCallback:e}),i.Log.error(572836032,i.LogCategory.CoreDefault,r.stop())}},l=this.messageCallbacks.get(s.SchemaObject.getTypeNameFor(e));l?r.resourceId=c(s.SchemaObject.getTypeNameFor(e)):l=function(t,n){r.resourceId=c(s.SchemaObject.getTypeNameFor(e)),"MalformedMessageName"!==r.resourceId&&(r.resourceId="UnsupportedMessage"),n(new a.ErrorResponse({error:"Message type "+s.SchemaObject.getTypeNameFor(e)+" is not supported"}))};this.pendingMessageCallbacks.put(e.messageId,void 0,1e4,(function(){r.success=!1,r.resultSignature="Timeout",r.resultDescription="Timeout processing message callback",u(),i.Log.error(572836033,i.LogCategory.CoreDefault,"Timeout processing "+r.resourceId),o.updateProcessMessageStats(!1,r.durationMs,new Error("timeout"))}));var p=!1;try{r.message="We called into messageCallback",l(e,(function(n,i){o.pendingMessageCallbacks.del(e.messageId),p?(r.success=!1,r.resultSignature="OnResponseInvokedMoreThanOnce",r.resultDescription="Invoked onResponse for "+s.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+" more than once"):n?(r.success=!1,r.resultSignature=n.error,r.resultDescription="Error for "+s.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+n.error):r.resultSignature="Success",p=!0,u(),n&&!s.SchemaObject.matchesTypesFor(n,[a.ErrorResponse.getTypeName()])&&(n=new a.ErrorResponse({error:"Internal Server Error"})),o.updateProcessMessageStats(r.success,r.durationMs,n?new Error(n.error):void 0),n?(n.messageId=e.messageId,t(n)):i?(i.messageId=e.messageId,t(void 0,i)):t()}))}catch(o){this.pendingMessageCallbacks.del(e.messageId),r.success=!1,r.resultSignature="MessageCallbackException",r.resultDescription="Web"===(null===(n=this.clientMetadata)||void 0===n?void 0:n.appPlatform)?JSON.stringify({message:o.message,stack:o.stack}):JSON.stringify({message:o.message}),u(),this.updateProcessMessageStats(!1,r.durationMs,o),t()}},e.prototype.processResponse=function(e){var t,n=new i.Operation({operationName:"ProcessResponse"});n.success=!0,n.setClientMetadata(this.clientMetadata),n.start();var o=this.pendingResponseCallbacks.get(e.messageId);o?(this.pendingResponseCallbacks.del(e.messageId),s.SchemaObject.matchesTypesFor(e,[a.ErrorResponse.getTypeName()])?o(e):o(void 0,e)):(n.resultSignature="NoPendingMessage",n.resultDescription=""+e.messageId,n.success=!1),"Production"!==(null===(t=this.clientMetadata)||void 0===t?void 0:t.releaseAudienceGroup)&&(n.resourceId=c(s.SchemaObject.getTypeNameFor(e)),i.Log.info(572836034,i.LogCategory.CoreDefault,n.stop()))},e.prototype.updateSendMessageStats=function(e,t,n){this.stats.sendMessageCount++,this.stats.sendMessageDurationMsMax=Math.max(t,this.stats.sendMessageDurationMsMax),e||n?e&&n&&i.Log.warn(572836036,i.LogCategory.CoreDefault,"Succeeded send message provided error object."):i.Log.warn(572836035,i.LogCategory.CoreDefault,"Failed send message did not provide error object."),e||(n&&n.message===o.ClientDisconnected?this.stats.sendMessageClientDisconnectedErrors++:this.stats.sendMessageErrors++)},e.prototype.updateProcessMessageStats=function(e,t,n){this.stats.processMessageCount++,this.stats.processMessageDurationMsMax=Math.max(t,this.stats.processMessageDurationMsMax),e||n?e&&n&&i.Log.warn(572836038,i.LogCategory.CoreDefault,"Succeeded process message provided error object."):i.Log.warn(572836037,i.LogCategory.CoreDefault,"Failed process message did not provide error object."),e||(n&&n.message===r.ProvisionTokenValidationError?this.stats.processMessageProvisionTokenErrors++:this.stats.processMessageErrors++)},e}();t.MessageEndpoint=l},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(119),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cache=void 0;var o=function(){function e(e){if(this.cache=new Map,this.options=e||{sweepInterval:100},null!=this.options.idleDurationMs&&this.options.idleDurationMs<=0)throw new Error("Idle duration must be positive");if(this.interval=this.options.sweepInterval||100,this.interval<=0)throw new Error("Sweep interval must be a positive number")}return e.prototype.put=function(e,t,n,o,r,i,s){if(null==n||n<=0)throw new Error("Cache timeout must be a positive number");(null==r||r<=0)&&(r=this.options.idleDurationMs);var a={value:t,lastUsed:r?Date.now():void 0,expire:n+Date.now(),idleDurationMs:r,expireCallback:o,expiringTriggerTime:i+Date.now(),expiringCallback:s};return this.cache.set(e,a),this.timeout||(this.timeout=setInterval(this.onInterval.bind(this),this.interval),this.timeout.unref&&this.timeout.unref()),t},e.prototype.del=function(e){if(this.options.delCallback){var t=this.cache.get(e);t&&this.options.delCallback(e,t.value)}var n=this.cache.delete(e);return 0===this.size()&&this.clear(),n},e.prototype.clear=function(){this.timeout&&(clearInterval(this.timeout),this.timeout=void 0),this.cache.clear()},e.prototype.get=function(e){var t=this.cache.get(e);if(t)return this.options.idleDurationMs&&(t.lastUsed=Date.now()),t.value},e.prototype.keys=function(){return this.cache.keys()},e.prototype.forEach=function(e){this.cache.forEach((function(t,n){e(t.value,n)}))},e.prototype.size=function(){return this.cache.size},e.prototype.updateExpireTime=function(e,t){return!!(this.cache.has(e)&&t>=0)&&(this.cache.get(e).expire=t+Date.now(),!0)},e.prototype.onInterval=function(){var e=this,t=Date.now();this.cache.forEach((function(n,o){if(n.idleDurationMs&&n.lastUsed<t-n.idleDurationMs)return e.del(o),void(e.options.idleCallback&&e.options.idleCallback(o,n.value));n.expire<t&&(e.del(o),n.expireCallback&&n.expireCallback(o,n.value)),n.expiringTriggerTime<t&&n.expiringCallback&&(n.expiringCallback(o,n.value),n.expiringCallback=void 0)}))},e}();t.Cache=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.currentProtocolVersion=void 0,t.currentProtocolVersion=2},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageQueue=t.ClientSendMessageErrorReason=void 0;var o,r=n(5),i=n(3),s=n(122),a=n(2),u=n(0);!function(e){e.ArrivedBeforeReseeding="Message is dropped from queue since it arrived before reseeding is started",e.DroppedAsOldestInQueue="Message is dropped as oldest in full queue"}(o=t.ClientSendMessageErrorReason||(t.ClientSendMessageErrorReason={}));var c=function(){function e(e){this.logOp=new u.Operation({operationName:"MessageQueue",success:!0}),this.messageQueueLogCountLimiter=new a.LogCountLimiter("MessageQueue"),this.queue=new s(1e3),this.callbacks=e}return e.prototype.push=function(e,t,n){var i=this,s=this.queue;if(1e3===s.length){this.messageQueueLogCountLimiter.log((function(){i.logOp.resourceId="QueueFull",i.logOp.durationMs=0,u.Log.warn(573187741,u.LogCategory.CoreDefault,i.logOp)}));var c=s.shift();c.onResponse&&c.onResponse(new r.ErrorResponse({error:o.DroppedAsOldestInQueue}))}s.push({message:e,onResponse:t,timeQueued:a.Utils.getCurrentTimeMs(),attemptNumber:n})},e.prototype.sendOnSessionInitialized=function(e){var t=this,n=this.queue.length,s=0;if(n>0){for(var c=a.Utils.getCurrentTimeMs()-this.queue.get(0).timeQueued;this.queue.length>0&&this.callbacks.canSendMessage();){var l=this.queue.shift();e&&l.message instanceof r.SyncMessage&&i.SchemaObject.matchesTypesFor(l.message,[r.SyncMessage.getTypeName()])&&(!this.callbacks.dropOnlySequencedSyncsOnReseed||l.message.seq>=0)?(s++,l.onResponse&&l.onResponse(new r.ErrorResponse({error:o.ArrivedBeforeReseeding}))):l.message instanceof Uint8Array?this.callbacks.sendBytes(l.message):this.callbacks.sendMessage(l.message,l.onResponse,l.attemptNumber)}this.messageQueueLogCountLimiter.log((function(){t.logOp.resourceId="SendOnSessionInitialized",t.logOp.resultDescription="Queue size before: "+n+", after: "+t.queue.length+". droppedSyncMessages: "+s,t.logOp.durationMs=c,u.Log.warn(573187742,u.LogCategory.CoreDefault,t.logOp)}))}},e}();t.MessageQueue=c},function(e,t,n){"use strict";function o(e){if(this._capacity=i(e),this._length=0,this._front=0,r(e)){for(var t=e.length,n=0;n<t;++n)this[n]=e[n];this._length=t}}o.prototype.toArray=function(){for(var e=this._length,t=new Array(e),n=this._front,o=this._capacity,r=0;r<e;++r)t[r]=this[n+r&o-1];return t},o.prototype.push=function(e){var t=arguments.length,n=this._length;if(t>1){var o=this._capacity;if(n+t>o){for(var r=0;r<t;++r){this._checkCapacity(n+1),this[i=this._front+n&this._capacity-1]=arguments[r],n++,this._length=n}return n}for(var i=this._front,r=0;r<t;++r)this[i+n&o-1]=arguments[r],i++;return this._length=n+t,n+t}return 0===t?n:(this._checkCapacity(n+1),this[r=this._front+n&this._capacity-1]=e,this._length=n+1,n+1)},o.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,n=this[t];return this[t]=void 0,this._length=e-1,n}},o.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,n=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,n}},o.prototype.unshift=function(e){var t=this._length,n=arguments.length;if(n>1){if(t+n>(r=this._capacity)){for(var o=n-1;o>=0;o--){this._checkCapacity(t+1);var r=this._capacity;this[s=(this._front-1&r-1^r)-r]=arguments[o],t++,this._length=t,this._front=s}return t}var i=this._front;for(o=n-1;o>=0;o--){var s;this[s=(i-1&r-1^r)-r]=arguments[o],i=s}return this._front=i,this._length=t+n,t+n}if(0===n)return t;this._checkCapacity(t+1);r=this._capacity;return this[o=(this._front-1&r-1^r)-r]=e,this._length=t+1,this._front=o,t+1},o.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},o.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},o.prototype.get=function(e){var t=e;if(t===(0|t)){var n=this._length;if(t<0&&(t+=n),!(t<0||t>=n))return this[this._front+t&this._capacity-1]}},o.prototype.isEmpty=function(){return 0===this._length},o.prototype.clear=function(){for(var e=this._length,t=this._front,n=this._capacity,o=0;o<e;++o)this[t+o&n-1]=void 0;this._length=0,this._front=0},o.prototype.toString=function(){return this.toArray().toString()},o.prototype.valueOf=o.prototype.toString,o.prototype.removeFront=o.prototype.shift,o.prototype.removeBack=o.prototype.pop,o.prototype.insertFront=o.prototype.unshift,o.prototype.insertBack=o.prototype.push,o.prototype.enqueue=o.prototype.push,o.prototype.dequeue=o.prototype.shift,o.prototype.toJSON=o.prototype.toArray,Object.defineProperty(o.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),o.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(i(1.5*this._capacity+16))},o.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var n=this._front,o=this._length;n+o>t&&function(e,t,n,o,r){for(var i=0;i<r;++i)n[i+o]=e[i+t],e[i+t]=void 0}(this,0,this,t,n+o&t-1)};var r=Array.isArray;function i(e){if("number"!=typeof e){if(!r(e))return 16;e=e.length}return t=Math.min(Math.max(16,e),1073741824),t>>>=0,t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16);var t}e.exports=o},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.ClosedState=t.DisconnectedState=t.RunningState=t.InitingState=t.BaseState=t.queueBytes=t.queueMessage=t.sendMessageNow=t.SessionState=void 0;var i,s=n(5),a=n(3);!function(e){e[e.Initing=0]="Initing",e[e.Running=1]="Running",e[e.Disconnected=2]="Disconnected",e[e.Closed=3]="Closed"}(i=t.SessionState||(t.SessionState={}));t.sendMessageNow=function(e,t,n,o){t&&(t.cv||(t.cv=e.cvParent.newChild().toString()),e.messageEndpoint.sendMessage(t,(function(t,o){t||a.SchemaObject.getTypeNameFor(o)!==s.SyncResponse.getTypeName()||(e.stats.lastSyncMessage=Date.now()),n&&n(t,o)}),void 0,o))};t.queueMessage=function(e,t,n,o){t&&(e.messageQueue.push(t,n,o),e.webSocketWorkerManager.init(void 0,e.customInitPromise))};t.queueBytes=function(e,t){t&&(e.messageQueue.push(t),e.webSocketWorkerManager.init(void 0,e.customInitPromise))};var u=function(){function e(e){this.context=e}return e.prototype.onEnter=function(e){},e.prototype.sendMessage=function(e,t,n){},e.prototype.sendBytes=function(e){},e.prototype.canSendMessage=function(){return!1},e.prototype.onConnectionClose=function(){},e}();t.BaseState=u;var c=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateName=i.Initing,t.possibleNextStates=[i.Running,i.Disconnected,i.Closed],t}return r(n,e),n.prototype.sendMessage=function(e,n,o){a.SchemaObject.matchesTypesFor(e,[s.SessionInitMessage.getTypeName()])?(0,t.sendMessageNow)(this.context,e,n,o):(0,t.queueMessage)(this.context,e,n)},n.prototype.sendBytes=function(e){(0,t.queueBytes)(this.context,e)},n.prototype.onConnectionClose=function(){this.context.setState(i.Disconnected)},n}(u);t.InitingState=c;var l=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateName=i.Running,t.possibleNextStates=[i.Disconnected,i.Closed],t}return r(n,e),n.prototype.onEnter=function(e){e&&e.isSessionReseedingStarted&&this.context.resetNextSyncSequenceId(),this.context.messageQueue.sendOnSessionInitialized(e&&e.isSessionReseedingStarted)},n.prototype.sendMessage=function(e,n,o){(0,t.sendMessageNow)(this.context,e,n,o)},n.prototype.sendBytes=function(e){e&&this.context.webSocketWorkerManager.egressBytes(e)},n.prototype.canSendMessage=function(){return!0},n.prototype.onConnectionClose=function(){this.context.setState(i.Disconnected)},n}(u);t.RunningState=l;var p=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateName=i.Disconnected,t.possibleNextStates=[i.Initing,i.Closed],t}return r(n,e),n.prototype.onEnter=function(e){this.context.messageEndpoint.cancelPendingResponseCallbacks()},n.prototype.sendMessage=function(e,n,o){a.SchemaObject.matchesTypesFor(e,[s.SessionInitMessage.getTypeName()])?(this.context.setState(i.Initing),(0,t.sendMessageNow)(this.context,e,n,o)):a.SchemaObject.matchesTypesFor(e,[s.SessionCloseMessage.getTypeName()])?this.context.setState(i.Closed):(0,t.queueMessage)(this.context,e,n,o)},n.prototype.sendBytes=function(e){(0,t.queueBytes)(this.context,e)},n}(u);t.DisconnectedState=p;var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=i.Closed,t.possibleNextStates=[],t}return r(t,e),t}(u);t.ClosedState=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketWorkerManager=t.calculateTimeToWaitForNextTry=void 0;var o=n(3),r=n(5),i=n(0),s=n(2),a=n(125),u=n(47);t.calculateTimeToWaitForNextTry=function(e,t){var n=0,o=s.Utils.getCurrentTimeMs()?s.Utils.getCurrentTimeMs()-t:0,r=[1e3,2e3,5e3,1e4,6e4];return n=r[Math.max(0,Math.min(r.length-1,e-1))],n=Math.max(n-o,1e3)};var c=function(){function e(t,n,o,r,a,c,l,p){var f=this;this.logCountLimiter=new s.LogCountLimiter(e.className),this.isWorkerReady=!1,this.permanentlyClosed=!1,this.currentReconnectAttempt=0,this.lastInitializationAttemptTimeMs=0,this.offlineInterval=void 0,this.alreadyLoggedReconnectAttempt=!1,this.httpTestsLeft=5,this.httpTestsSuccessCount=0,this.wsOpenCount=0,this.testHttpConnection=function(e){var t=s.Utils.convertWebSocketUrlToHttp(f.globalUrl),n=!e,o=null!=e?e:new i.Operation({operationName:"HttpsTest",resourceId:t,success:!1,resultDescription:"",resultSignature:"HttpResponse:"}).start(),r={method:"POST",headers:{"content-type":"application/json","X-CorrelationId":o.cv},body:JSON.stringify(s.Utils.createHealthCheckRequest(f.clientMetadata))};(0,u.internalFetch)(t,r,(function(e,t){e?(o.dimension1="HttpErr",o.resultDescription+="HttpErr: "+e.message):t&&t.ok?(o.dimension1="HttpOK",f.leaveOfflineMode(),f.httpTestsSuccessCount++,n&&(o.success=!0)):(o.dimension1="HttpNoResp",o.resultDescription+="HttpStatus: "+(null==t?void 0:t.status)),n&&o.stop(),f.logCountLimiter.log((function(){i.Log.info(558445283,i.LogCategory.CoreDefault,o)}))}))},this.globalUrl=t,this.clientMetadata=n,this.workerFactory=o,this.sessionInitializer=r,this.ingress=a,this.onConnectionClose=c,this.onDetectedWSBlock=l,this.closeWSBlockedSession=p.closeWSBlockedSessionEnabled,this.sessionOfflineModeEnabled=p.sessionOfflineModeEnabled}return e.prototype.init=function(t,n,o){var r=this;if(void 0===o&&(o=!1),this.permanentlyClosed)return Promise.reject("permanentlyClosed");if(this.isWorkerReady||this.pendingInitPromise)return this.pendingInitPromise?this.pendingInitPromise:Promise.resolve();this.extensionConfigs=t||this.extensionConfigs;var s=function(){if(o||!r.alreadyLoggedReconnectAttempt){var t=o?e.initialAttemptTimeout:e.reconnectAttemptTimeout;r.connTimeout=setTimeout((function(){var e=new i.Operation({operationName:"ConnectionFailingOrSlow",dimension0:o?"Initial":"Reconnect",dimension1:t.toString(),dimension2:r.currentReconnectAttempt.toString()});i.Log.info(572838096,i.LogCategory.CoreDefault,e),r.alreadyLoggedReconnectAttempt=!o,r.connTimeout=void 0}),t)}};return n?this.pendingInitPromise=n().catch((function(e){i.Log.error(572838097,i.LogCategory.CoreDefault,"Error occurred during calling the custom init promise: "+e)})).then((function(){s(),r.initInternal()})):(this.pendingInitPromise=Promise.resolve(),s(),this.initInternal()),this.pendingInitPromise},e.prototype.egress=function(e){var t=this;return!this.isWorkerReady&&this.pendingInitPromise?this.pendingInitPromise.then((function(){t.egressInternal(e)})):(this.egressInternal(e),Promise.resolve())},e.prototype.egressBytes=function(e){var t=this;return!this.isWorkerReady&&this.pendingInitPromise?this.pendingInitPromise.then((function(){t.egressBytesInternal(e)})):(this.egressBytesInternal(e),Promise.resolve())},e.prototype.close=function(e){this.worker&&this.worker.close(),this.isWorkerReady=!1,this.worker=null,this.permanentlyClosed=e||this.permanentlyClosed,this.permanentlyClosed&&(this.leaveOfflineMode(),clearTimeout(this.connTimeout))},e.prototype.initInternal=function(){var e=this;this.isWorkerReady=!1,this.permanentlyClosed||this.isOffline()||(this.currentReconnectAttempt>0?setTimeout((function(){e.tryToConnectAndInitializeSession()}),(0,t.calculateTimeToWaitForNextTry)(this.currentReconnectAttempt,this.lastInitializationAttemptTimeMs)):this.tryToConnectAndInitializeSession())},e.prototype.egressInternal=function(e){var t;this.isWorkerReady||o.SchemaObject.matchesTypesFor(e,[r.SessionInitMessage.getTypeName()])?(o.SchemaObject.matchesTypesFor(e,[r.MicroSyncMessage.getTypeName()])?(this.castBinaryData(e),t=a.JSOND.serialize(e)):t=JSON.stringify(e),this.worker.egress(t)):o.SchemaObject.matchesTypesFor(e,[r.Response.getTypeName()])||i.Log.error(572838098,i.LogCategory.CoreDefault,new i.Operation({operationName:"UnexpectedEgressCall",resultDescription:"isWorkerReady: "+this.isWorkerReady}))},e.prototype.egressBytesInternal=function(e){this.isWorkerReady?this.worker.egress(e):i.Log.error(572838099,i.LogCategory.CoreDefault,new i.Operation({operationName:"UnexpectedEgressBytesCall",resultDescription:"isWorkerReady: "+this.isWorkerReady}))},e.prototype.tryToConnectAndInitializeSession=function(){var e=this;this.currentReconnectAttempt++,this.lastInitializationAttemptTimeMs=s.Utils.getCurrentTimeMs();var t=function(n){e.permanentlyClosed||e.isOffline()||(e.connect(e.sliceUrl?e.sliceUrl:e.globalUrl),e.sessionInitializer.initSession({isTokenRefresh:!1,isReconnectOnSameSlice:!!e.sliceUrl,extensionConfigs:e.extensionConfigs,onResponse:function(o,r){if(n.success=!o,n.resultDescription=o?"WS Error: "+o.error:"",n.resourceId=r?r.sliceUrl:"",n.dimension0=n.success?"WSOK":"WSFail",o||!e.worker)return e.sliceUrl=void 0,e.close(),e.httpTestsLeft>0?(e.httpTestsLeft--,e.testHttpConnection(n.stop())):(e.closeWSBlockedSession&&0===e.wsOpenCount&&e.httpTestsSuccessCount>=5?(e.permanentlyClosed=!0,n.dimension1="WSBlocked",e.onDetectedWSBlock()):e.sessionOfflineModeEnabled&&0===e.httpTestsSuccessCount&&(e.startOfflineMode(),n.dimension1="WSOffline"),e.logCountLimiter.log((function(){i.Log.info(572838100,i.LogCategory.CoreDefault,n.stop())}))),void e.initInternal();if(e.logCountLimiter.log((function(){i.Log.info(555823373,i.LogCategory.CoreDefault,n.stop())})),r.forceReconnect){e.close();var s=new i.Operation({operationName:"ForcedReconnect"}).start();s.resultSignature="globalUrl: "+e.globalUrl+". sliceUrl: "+e.sliceUrl,e.sliceUrl=void 0,setTimeout((function(){t(s)}),1e3)}else clearTimeout(e.connTimeout),e.sliceUrl=r.sliceUrl,e.ready();e.resetHttpTestsCounter()}}))},n=new i.Operation({operationName:"TryToConnectAndInitializeSession",resultSignature:"Reconnection attempt #"+this.currentReconnectAttempt}).start();t(n)},e.prototype.connect=function(e){var t=this;this.worker=this.workerFactory(),this.worker.init(e,this.ingress,(function(){t.wsOpenCount++,t.leaveOfflineMode()}),(function(e){t.onConnectionClose(e),t.close()}))},e.prototype.ready=function(){this.isWorkerReady=!0,this.pendingInitPromise=void 0,this.currentReconnectAttempt=0},e.prototype.castBinaryData=function(e){if(e){if(Array.isArray(e.__binaryMembers__))for(var t=0,n=e.__binaryMembers__;t<n.length;t++){var o=n[t];ArrayBuffer.isView(e[o])||(e[o]=new Uint8Array(e[o]))}for(var r=0,i=Object.keys(e);r<i.length;r++){var s=i[r];"object"==typeof e[s]&&null!==e[s]&&this.castBinaryData(e[s])}}},e.prototype.isOffline=function(){return!!this.offlineInterval},e.prototype.startOfflineMode=function(){var e=this;this.offlineInterval=setInterval((function(){e.testHttpConnection()}),6e4)},e.prototype.leaveOfflineMode=function(){this.isOffline()&&(clearInterval(this.offlineInterval),this.offlineInterval=void 0,this.resetHttpTestsCounter(),this.tryToConnectAndInitializeSession())},e.prototype.resetHttpTestsCounter=function(){this.httpTestsLeft=5,this.httpTestsSuccessCount=0},e.initialAttemptTimeout=1e5,e.reconnectAttemptTimeout=2e4,e.className="WebSocketWorkerManager",e}();t.WebSocketWorkerManager=c},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(126),t)},function(e,t,n){"use strict";(function(e){var o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0}),t.JSOND=void 0;var r=n(130),i=function(){function t(){}return t.deserialize=function(n,o){if(void 0===o&&(o=function(e){return e}),n[0]!==t.IDENTIFIERBYTE)throw"Invalid Binary: Incorrect Identifier";for(var r=1,i=[],s=new DataView(n.buffer,n.byteOffset,n.byteLength);r<n.byteLength;){if(r+4>n.byteLength)throw"Invalid Binary: Error reading fragment length";var a=s.getUint32(r);if(r+a+4>n.byteLength)throw"Invalid Binary: Fragment out of range";void 0!==e&&e.from?i.push(e.from(n.buffer,n.byteOffset+r+4,a)):i.push(new Uint8Array(n.buffer,n.byteOffset+r+4,a)),r+=4+a}if(i.length<1)throw"Invalid Binary: No fragments found";var u=t.textDecoder.decode(i[0]);return JSON.parse(u,(function(e,n){if("string"==typeof n){if(n.substring(0,t.BINARYKEYWORD.length)===t.BINARYKEYWORD){var r=parseInt(n.substring(t.BINARYKEYWORD.length),10);if("number"!=typeof r||r>=i.length-1)throw"Invalid Binary: Binary index out of range";return o(i[r+1])}if(n.substring(0,t.ESCAPEKEYWORD.length)===t.ESCAPEKEYWORD)return n.substring(t.ESCAPEKEYWORD.length)}return n}))},t.serialize=function(e){var n,r,i=[void 0],s=JSON.stringify(e,(function(e,n){return ArrayBuffer.isView(n)?(i.push(n),""+t.BINARYKEYWORD+(i.length-2)):n&&"Buffer"===n.type&&Array.isArray(n.data)?(i.push(new Uint8Array(n.data)),""+t.BINARYKEYWORD+(i.length-2)):"string"==typeof n&&n.substring(0,t.ESCAPEKEYWORD.length)===t.ESCAPEKEYWORD?t.ESCAPEKEYWORD+n:n}));i[0]=t.textEncoder.encode(s);var a=i.reduce((function(e,t){return e+4+t.byteLength}),0),u=new Uint8Array(a+1);u[0]=t.IDENTIFIERBYTE;var c=1,l=new DataView(u.buffer,u.byteOffset,u.byteLength);try{for(var p=o(i),f=p.next();!f.done;f=p.next()){var d=f.value;l.setUint32(c,d.byteLength),u.set(d,c+4),c+=4+d.byteLength}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=p.return)&&r.call(p)}finally{if(n)throw n.error}}return u},t.IDENTIFIERBYTE=3,t.BINARYKEYWORD=":b",t.ESCAPEKEYWORD=":",t.textDecoder=new r.AugLoopTextDecoder,t.textEncoder=new r.AugLoopTextEncoder,t}();t.JSOND=i}).call(this,n(52).Buffer)},function(e,t,n){"use strict";t.byteLength=function(e){var t=c(e),n=t[0],o=t[1];return 3*(n+o)/4-o},t.toByteArray=function(e){var t,n,o=c(e),s=o[0],a=o[1],u=new i(function(e,t,n){return 3*(t+n)/4-n}(0,s,a)),l=0,p=a>0?s-4:s;for(n=0;n<p;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;2===a&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,u[l++]=255&t);1===a&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t);return u},t.fromByteArray=function(e){for(var t,n=e.length,r=n%3,i=[],s=0,a=n-r;s<a;s+=16383)i.push(l(e,s,s+16383>a?a:s+16383));1===r?(t=e[n-1],i.push(o[t>>2]+o[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],i.push(o[t>>10]+o[t>>4&63]+o[t<<2&63]+"="));return i.join("")};for(var o=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,u=s.length;a<u;++a)o[a]=s[a],r[s.charCodeAt(a)]=a;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var r,i,s=[],a=t;a<n;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(o[(i=r)>>18&63]+o[i>>12&63]+o[i>>6&63]+o[63&i]);return s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,o,r){var i,s,a=8*r-o-1,u=(1<<a)-1,c=u>>1,l=-7,p=n?r-1:0,f=n?-1:1,d=e[t+p];for(p+=f,i=d&(1<<-l)-1,d>>=-l,l+=a;l>0;i=256*i+e[t+p],p+=f,l-=8);for(s=i&(1<<-l)-1,i>>=-l,l+=o;l>0;s=256*s+e[t+p],p+=f,l-=8);if(0===i)i=1-c;else{if(i===u)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,o),i-=c}return(d?-1:1)*s*Math.pow(2,i-o)},t.write=function(e,t,n,o,r,i){var s,a,u,c=8*i-r-1,l=(1<<c)-1,p=l>>1,f=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=o?0:i-1,h=o?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+p>=1?f/u:f*Math.pow(2,1-p))*u>=2&&(s++,u/=2),s+p>=l?(a=0,s=l):s+p>=1?(a=(t*u-1)*Math.pow(2,r),s+=p):(a=t*Math.pow(2,p-1)*Math.pow(2,r),s=0));r>=8;e[n+d]=255&a,d+=h,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;e[n+d]=255&s,d+=h,s/=256,c-=8);e[n+d-h]|=128*g}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.AugLoopTextDecoder=t.AugLoopTextEncoder=void 0;t.AugLoopTextEncoder=(o=function(){if("undefined"==typeof TextEncoder){n(131);var e={AugLoopTextEncoder:TextEncoder,AugLoopTextDecoder:TextDecoder};return TextEncoder=void 0,TextDecoder=void 0,e}return{AugLoopTextEncoder:TextEncoder,AugLoopTextDecoder:TextDecoder}}()).AugLoopTextEncoder,t.AugLoopTextDecoder=o.AugLoopTextDecoder},function(e,t,n){(function(e,t){!function(e){function n(){}function o(e,t){if(e=void 0===e?"utf-8":e,t=void 0===t?{fatal:!1}:t,-1===i.indexOf(e.toLowerCase()))throw new RangeError("Failed to construct 'TextDecoder': The encoding label provided ('"+e+"') is invalid.");if(t.fatal)throw Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}function r(e){for(var t=0,n=Math.min(65536,e.length+1),o=new Uint16Array(n),r=[],i=0;;){var s=t<e.length;if(!s||i>=n-1){if(r.push(String.fromCharCode.apply(null,o.subarray(0,i))),!s)return r.join("");e=e.subarray(t),i=t=0}if(0==(128&(s=e[t++])))o[i++]=s;else if(192==(224&s)){var a=63&e[t++];o[i++]=(31&s)<<6|a}else if(224==(240&s)){a=63&e[t++];var u=63&e[t++];o[i++]=(31&s)<<12|a<<6|u}else if(240==(248&s)){65535<(s=(7&s)<<18|(a=63&e[t++])<<12|(u=63&e[t++])<<6|63&e[t++])&&(s-=65536,o[i++]=s>>>10&1023|55296,s=56320|1023&s),o[i++]=s}}}if(e.TextEncoder&&e.TextDecoder)return!1;var i=["utf-8","utf8","unicode-1-1-utf-8"];Object.defineProperty(n.prototype,"encoding",{value:"utf-8"}),n.prototype.encode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to encode: the 'stream' option is unsupported.");t=0;for(var n=e.length,o=0,r=Math.max(32,n+(n>>>1)+7),i=new Uint8Array(r>>>3<<3);t<n;){var s=e.charCodeAt(t++);if(55296<=s&&56319>=s){if(t<n){var a=e.charCodeAt(t);56320==(64512&a)&&(++t,s=((1023&s)<<10)+(1023&a)+65536)}if(55296<=s&&56319>=s)continue}if(o+4>i.length&&(r+=8,r=(r*=1+t/e.length*2)>>>3<<3,(a=new Uint8Array(r)).set(i),i=a),0==(4294967168&s))i[o++]=s;else{if(0==(4294965248&s))i[o++]=s>>>6&31|192;else if(0==(4294901760&s))i[o++]=s>>>12&15|224,i[o++]=s>>>6&63|128;else{if(0!=(4292870144&s))continue;i[o++]=s>>>18&7|240,i[o++]=s>>>12&63|128,i[o++]=s>>>6&63|128}i[o++]=63&s|128}}return i.slice?i.slice(0,o):i.subarray(0,o)},Object.defineProperty(o.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(o.prototype,"fatal",{value:!1}),Object.defineProperty(o.prototype,"ignoreBOM",{value:!1});var s=r;"function"==typeof t&&t.from?s=function(e){return t.from(e.buffer,e.byteOffset,e.byteLength).toString("utf-8")}:"function"==typeof Blob&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&(s=function(e){var t=URL.createObjectURL(new Blob([e],{type:"text/plain;charset=UTF-8"}));try{var n=new XMLHttpRequest;return n.open("GET",t,!1),n.send(),n.responseText}catch(t){return r(e)}finally{URL.revokeObjectURL(t)}}),o.prototype.decode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to decode: the 'stream' option is unsupported.");return e=e instanceof Uint8Array?e:e.buffer instanceof ArrayBuffer?new Uint8Array(e.buffer):new Uint8Array(e),s(e)},e.TextEncoder=n,e.TextDecoder=o}("undefined"!=typeof window?window:void 0!==e?e:this)}).call(this,n(7),n(52).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionProxy=void 0;var o=n(5),r=n(53),i=n(3),s=n(4),a=n(136),u=n(45),c=n(46),l=n(137),p=n(8),f=n(2),d=n(0),h=n(54),g=n(55),m=n(56),y=function(){function e(e){this.annotationActivationTrackers=new Map,this.annotationCallbacks=new Map,this.annotationResultStates=new Map,this.tokensByAnnotationType=new Map,this.registeredContextTypes=new Set,this.availableContexts=new Map,this.nextSyncSequenceId=1,this.allowSeed=!0,this.allowGroupSeed=!0,this.seedGroupSize=0,this.hasSessionConnected=!1,this.isSessionClosed=!1,this.isSessionConnected=!1,this.workflowDefinitionManager=new m.DynamicWorkflowDefinitionManager,this.joinAnnotationManager=new m.JoinAnnotationsManager(this.workflowDefinitionManager),this.hostCallbacks=e.hostCallbacks,this.sessionManager=e.sessionManager,this.operationBatchConfig=e.batchOptions?this.getOperationBatchConfig(e.batchOptions):void 0,this.extensionConfigs=e.extensionConfigs,this.clientMetadata=e.clientMetadata,this.localWorkflowManager=e.localWorkflowManager,this.annotationResultsProcessor=e.annotationResultsProcessor,this.localWorkflowOrchestrationMode=e.localWorkflowOrchestrationMode||0,this.sessionManager.on("sessionClose",this.onSessionClose.bind(this)),this.sessionManager.on("reconnect",this.onReconnect.bind(this)),this.sessionManager.on("connect",this.onConnect.bind(this)),this.sessionManager.on("disconnect",this.onDisconnect.bind(this)),this.sessionManager.on("resetNextSyncSequenceId",this.resetNextSyncSequenceId.bind(this)),this.sessionManager.onMessage(o.AnnotationResultsMessage.getTypeName(),this.onAnnotationResultsFromServer.bind(this)),this.sessionManager.onMessage(o.AnnotationResultStateMessage.getTypeName(),this.onAnnotationResultStateMessage.bind(this)),1===this.localWorkflowOrchestrationMode&&this.sessionManager.onMessage(r.WorkflowExecutionRequest.getTypeName(),this.onWorkflowExecutionRequest.bind(this))}return e.prototype.initialize=function(){var e=this;return this.sessionManager.init(this.extensionConfigs,this.hostCallbacks.onInitSession?this.hostCallbacks.onInitSession:void 0).then((function(){return e.localWorkflowManager.addSession(e,e.joinAnnotationManager,e.workflowDefinitionManager),e.localWorkflowManager.setTokenCallback(e.getAuthToken.bind(e)),e}))},Object.defineProperty(e.prototype,"isConnected",{get:function(){return this.isSessionConnected},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasConnected",{get:function(){return this.hasSessionConnected},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isClosed",{get:function(){return this.isSessionClosed},enumerable:!1,configurable:!0}),e.prototype.registerLocalWorkflow=function(e){this.localWorkflowManager.registerLocalWorkflow(e,this),1===this.localWorkflowOrchestrationMode&&this.sessionManager.sendMessage(new r.WorkflowRegistrationMessage({workflowDefinition:e}))},e.prototype.activateAnnotation=function(e,t){var n,o=new a.AnnotationActivationTracker(this.getSessionManager.bind(this),e,t);if(t&&t.callback){var r=this.annotationCallbacks.get(e);r||(r=new Map,this.annotationCallbacks.set(e,r)),r.set(o.token,t.callback)}var i=null!==(n=this.tokensByAnnotationType.get(e))&&void 0!==n?n:[];return-1===i.indexOf(o.token)&&i.push(o.token),this.tokensByAnnotationType.set(e,i),this.annotationActivationTrackers.set(o.token,o),o.activate(!1),o.asPromise()},e.prototype.updateAnnotationConfig=function(e,t){var n=new o.AnnotationConfigUpdateMessage({token:e,config:t});this.getSessionManager().sendMessage(n);var r=this.annotationActivationTrackers.get(e);r&&r.options&&(r.options.config=t)},e.prototype.releaseAnnotation=function(e){var t=this.annotationActivationTrackers.get(e);if(t){this.annotationActivationTrackers.delete(e);var n=this.annotationCallbacks.get(t.annotationType);return n&&(n.delete(e),0==n.size&&this.annotationCallbacks.delete(t.annotationType)),t.release()}return Promise.resolve(!1)},e.prototype.setAnnotationState=function(e,t,n){var o={state:n};this.submitOperation(new i.UpdateAnnotationMetaDataOperation({parentPath:e,items:[{id:t}],M_:o}))},e.prototype.setAnnotationMetadata=function(e,t,n){this.submitOperation(new i.UpdateAnnotationMetaDataOperation({parentPath:e,items:[{id:t}],M_:n}))},e.prototype.submitOperation=function(e,t){this.submitOperations([e],t)},e.prototype.submitOperations=function(e,t){var n=this;this.localWorkflowManager.getJoinAnnotationManagerForSession(this).applyContextIdOnOperations(e);var o=e.filter((function(e){return(0,f.isServerOp)(e,n.serverInputTypes)}));this.submitOperationsToServer(o,t),0===this.localWorkflowOrchestrationMode&&this.localWorkflowManager.runLocalWorkflows(e,this,!0)},e.prototype.submitSeedOperations=function(e,t){if(!this.allowSeed)throw new Error("Cannot submit seed operations more than once per session");this.allowSeed=!1,this.allowGroupSeed=!1,this.operationBatchConfig?this.sendSeedMessagesViaBatchManager(e,!0,t):this.getSessionManager().sendMessage(new o.SyncMessage({cv:t,seq:0,ops:e}))},e.prototype.submitSeedGroupOperations=function(e,t,n){if(!this.allowGroupSeed)throw new Error("Seed operations are not allowed for this session");t&&(this.allowGroupSeed=!1),this.allowSeed=!1,this.operationBatchConfig?this.sendSeedMessagesViaBatchManager(e,!!t,n):(this.seedGroupSize++,this.getSessionManager().sendMessage(new o.SyncMessage({cv:n,seq:0,ops:e,groupId:"Seed",groupSize:t?this.seedGroupSize:void 0,groupComplete:t||void 0})))},e.prototype.submitCustomMessage=function(e){var t=this;return new Promise((function(n,o){t.getSessionManager().sendMessage(e,(function(e,t){e?o(new Error(e.error)):n(t)}))}))},e.prototype.requestCacheDump=function(e){var t=this;if(e)throw new Error("NYI");return new Promise((function(e,n){t.getSessionManager().sendMessage(new o.CacheDumpRequestMessage,(function(t,o){t?n(t):e(o)}))}))},e.prototype.forceReconnect=function(e){return this.extensionConfigs=e,this.getSessionManager().forceReconnect(e)},e.prototype.close=function(){this.isSessionClosed=!0,this.getSessionManager().closeSession(),this.localWorkflowManager.closeSession(this)},e.prototype.getClientMetadata=function(){return this.clientMetadata},e.prototype.setSessionCloseCallback=function(e){this.sessionCloseCallback=e},e.prototype.setConnectCallback=function(e){this.connectCallback=e},e.prototype.setDisconnectCallback=function(e){this.disconnectCallback=e},e.prototype.setReconnectCallback=function(e){this.reconnectCallback=e},e.prototype.onAnnotationResults=function(e,t,n){var r=this;n(void 0,new o.Response),this.annotationResultsProcessor.process(e,(function(e,n){r.applyOperationForContext(e,n,t)}),(function(t){if(r.callAnnotationCallbacks(t,e.annotationType),r.hostCallbacks.onAnnotationResult)try{r.hostCallbacks.onAnnotationResult(t)}catch(e){d.Log.error(540301151,d.LogCategory.WorkflowDefault,"onAnnotationResult error: "+e)}}),(function(e){if(r.localWorkflowManager.getJoinAnnotationManagerForSession(r).applyContextIdOnOperations(e.ops),1!==t){var n=e.ops.filter((function(e){return(0,f.isServerOp)(e,r.serverInputTypes)}));r.submitOperationsToServer(n,e.cv)}0===r.localWorkflowOrchestrationMode&&r.localWorkflowManager.runLocalWorkflows(e.ops,r)}))},e.prototype.onAnnotationResultStateMessage=function(e,t){var n;t(void 0,new o.Response);for(var r=0,i=e.updates;r<i.length;r++){var s=i[r],a=s.annotationType,u=s.state;if(this.tokensByAnnotationType.has(a)){var c=void 0;c=this.annotationResultStates.has(a)?this.annotationResultStates.get(a):0===u?1:0;for(var l=0,p=this.tokensByAnnotationType.get(a);l<p.length;l++){var f=p[l],d=this.annotationActivationTrackers.get(f);(null===(n=d.options)||void 0===n?void 0:n.stateUpdateCallback)&&d.options.stateUpdateCallback(c,u)}}}},e.prototype.onWorkflowExecutionRequest=function(e,t){this.localWorkflowManager.onWorkflowExecutionRequest(this,e.workflowId,e.batchExecutionInputs[0],(function(e,n){t(void 0,e?new r.WorkflowExecutionResponse({error:e.message}):new r.WorkflowExecutionResponse({batchExecutionResults:[n]}))}))},e.prototype.submitOperationsToServer=function(e,t){var n=this,r=function(e){return i.SchemaObject.getTypeNameFor(e)===i.SignalOperation.getTypeName()},s=e.filter((function(e){return r(e)})),a=e.filter((function(e){return!r(e)}));if(s.length>0&&this.getSessionManager().sendMessage(new o.SyncMessage({cv:t,ops:s})),a.length>0)if(this.operationBatchConfig){if(!this.batchedOperationsManager){this.batchedOperationsManager=new u.BatchManager((function(e,t,r){n.getSessionManager().sendMessage(new o.SyncMessage({cv:t.cv,seq:n.nextSyncSequenceId++,ops:e}),(function(e){r(e?new Error(e.error):void 0)}))}))}this.batchedOperationsManager.addBatchItem(a,this.operationBatchConfig,{name:"SubmitOperations"},t)}else this.getSessionManager().sendMessage(new o.SyncMessage({cv:t,seq:this.nextSyncSequenceId++,ops:a}))},e.prototype.registerContextTypes=function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t];this.activateAnnotation(o),this.registeredContextTypes.add(o)}},e.prototype.applyOperationForContext=function(e,t,n){var o=this,r=i.SchemaObject.getTypeNameFor(e);if(r==i.AddOperation.getTypeName()||r==i.Operation.getTypeName()||r==i.UpdateOperation.getTypeName()||r==i.DeleteOperation.getTypeName()){r==i.Operation.getTypeName()&&(r=i.AddOperation.getTypeName());var s=(0,g.shallowCloneItemWithPath)(this.resolvePlaceholdersInOperationParentPath(e.parentPath),t),a=(0,g.makeItemPathKey)(s.parentPath);if(r==i.AddOperation.getTypeName()||r==i.UpdateOperation.getTypeName()){if(!s.body)return;var u=i.SchemaObject.getTypeNameFor(s.body);if(!this.registeredContextTypes.has(u))return;var c=this.availableContexts.get(u);c||(c=new Map,this.availableContexts.set(u,c));var l=c.get(n);if(l||(l=[],c.set(n,l)),s.id||(s.id=this.localWorkflowManager.getNextClientAnnotationId()),r==i.AddOperation.getTypeName())0==l.filter((function(e){return(0,g.makeItemPathKey)(e.parentPath)==a&&e.id==s.id})).length?l.push(s):d.Log.info(540848911,d.LogCategory.WorkflowDefault,"AddOperation for ("+n+", "+s.id+", "+s.source+") can't be applied as the context item with matching path and ID already exists. Use UpdateOperation instead.");else for(var p=0;p<l.length;p++)if(l[p].id==s.id&&(0,g.makeItemPathKey)(l[p].parentPath)==a){if(l[p].source==s.source){l[p]=s;break}d.Log.warn(540848912,d.LogCategory.WorkflowDefault,"UpdateOperation for ("+n+", "+s.id+", "+s.source+") can't be applied as the context item with provided path and ID has different source: "+l[p].source)}else d.Log.warn(540848913,d.LogCategory.WorkflowDefault,"UpdateOperation for ("+n+", "+s.id+", "+s.source+") can't be applied as the context item with matching path and ID was not found. AddOperation should be used instead")}else if(r==i.DeleteOperation.getTypeName()){if(!s.id)return;this.availableContexts.forEach((function(e,t){var r=e.get(n);r&&(0==(r=r.filter((function(e){return!((0,g.makeItemPathKey)(e.parentPath)==a&&e.id==s.id)}))).length?e.delete(n):e.set(n,r),0==e.size?o.availableContexts.delete(t):o.availableContexts.set(t,e))}))}}},e.prototype.resolveRequestedContexts=function(e){for(var t=[],n=0,o=(0,h.getContextTypes)(e.requestedContextTypesRules);n<o.length;n++){var r=o[n],i=r[0],s=r[1];if(this.availableContexts.has(i)){var a=Array.from(this.availableContexts.get(i).values()).reduce((function(e,t){return e.concat(t)}),[]);if(0==a.length)throw new Error("Assert: availableContexts have the entry for "+i+" which does not contain any context annotation.");t.push.apply(t,a)}else if(-3==s)return[!1,[]]}return[!0,t]},e.prototype.getContextAnnotations=function(e,t,n,o){var r,i,s=n?(0,g.makeItemPathKey)(n):void 0;return null===(i=null===(r=this.availableContexts.get(e))||void 0===r?void 0:r.get(t))||void 0===i?void 0:i.filter((function(e){return!(s&&(0,g.makeItemPathKey)(e.parentPath)!=s||o&&e.source!=o)}))},e.prototype.onWorkflowDefinitionOverrideMessage=function(e){var t=new d.Operation({operationName:"WorkflowDefinitionOverride",success:!0}),n=function(e){throw t.resultDescription=e,t.success=!1,d.Log.error(527472287,d.LogCategory.CoreDefault,t.stop()),Error("WorkflowDefinitionOverride: "+e)},o=this.localWorkflowManager.getWorkflowDefinitionsByName(this),r=o.get(e.sourceWorkflowId);if(r){var i=o.get(e.targetWorkflowId);i?i.allowDefinitionOverride?-1!==r.definitionOverrideTargetWorkflows.indexOf(i.id)?(this.workflowDefinitionManager.mergeWorkflowDefinition(i,e.definition,e.contextId),t.success=!0,t.resourceId=r.id,t.resultDescription="Updated config for workflow: "+e.targetWorkflowId+", context id: "+e.contextId,d.Log.info(527472288,d.LogCategory.CoreDefault,t.stop())):n("Workflow '"+r.id+"' does not allow workflow definition for workflow '"+i.id+"'."):n("Workflow '"+i.id+"' does not allow workflow definition override."):n("Workflow registration for target workflow '"+e.targetWorkflowId+"' was not found.")}else n("Workflow registration for source workflow '"+e.targetWorkflowId+"' was not found.")},e.prototype.getAuthToken=function(e,t){var n={Tickets:[]};this.clientMetadata.docSessionId&&(n.DocSessionId=this.clientMetadata.docSessionId);var o=function(e){if(e===p.AuthTokenType.Substrate)return s.AuthTokenType.Substrate}(e);o&&(n.TokenType=o),this.hostCallbacks.requestAuthToken(n).then((function(e){e?t(void 0,e.Token):t(new Error("Missing AuthTokenResponse from requestAutToken"))})).catch((function(e){return t(e)}))},e.prototype.resetNextSyncSequenceId=function(){this.nextSyncSequenceId=1},e.prototype.onReconnect=function(){this.isSessionConnected=!0,this.annotationActivationTrackers.forEach((function(e){e.activate(!0)})),this.reconnectCallback&&this.reconnectCallback()},e.prototype.onSessionClose=function(e){this.isSessionClosed=!0,this.isSessionConnected=!1,this.sessionCloseCallback&&this.sessionCloseCallback(e)},e.prototype.onConnect=function(e,t,n,o,r){this.hasSessionConnected&&e&&(this.allowSeed=!0,this.allowGroupSeed=!0,this.seedGroupSize=0,this.seedBatchedOperationsManager&&(this.seedBatchedOperationsManager.removeAllBatchedItems(),this.seedBatchedOperationsManager=void 0),this.batchedOperationsManager&&(this.batchedOperationsManager.removeAllBatchedItems(),this.batchedOperationsManager=void 0)),this.isSessionConnected=!0,this.hasSessionConnected=!0,this.connectCallback&&this.connectCallback(e,t,n,o),this.serverInputTypes=r},e.prototype.onDisconnect=function(e){this.isSessionConnected=!1,this.disconnectCallback&&this.disconnectCallback(e)},e.prototype.getSessionManager=function(){return this.sessionManager||(this.sessionManager=new l.EmptySessionManager),this.sessionManager},e.prototype.callAnnotationCallbacks=function(e,t){if(0!==this.annotationCallbacks.size){var n=this.annotationCallbacks.get(t);n&&n.forEach((function(t){t(e)}))}},e.prototype.getOperationBatchConfig=function(e){return{delayMs:e.delayMs,maxInputSize:e.maxInputSize,estimateSize:c.estimateSize,groupingKeyExtractor:function(){return"operations"},multiplex:function(e){return{input:e.filter((function(e){return e.length})).reduce((function(e,t){return e.concat(t)}),[]),demultiplex:function(){return[[]]}}},split:function(e){if(!(e.length<=1))return{inputs:e.reduce((function(e,t){return e.push([t]),e}),[]),join:function(){return[]}}}}},e.prototype.sendSeedMessagesViaBatchManager=function(e,t,n){var r=this;if(!this.seedBatchedOperationsManager){this.seedBatchedOperationsManager=new u.BatchManager((function(e,t,n){r.seedGroupSize++,r.getSessionManager().sendMessage(new o.SyncMessage({cv:t.cv,seq:0,ops:e,groupId:"Seed",groupSize:t.groupComplete?r.seedGroupSize:void 0,groupComplete:t.groupComplete?t.groupComplete:void 0}),(function(e){n(e?new Error(e.error):void 0)}))}))}this.seedBatchedOperationsManager.addBatchItem(e,this.operationBatchConfig,{name:"SubmitSeedOperations"},n,t)},e.prototype.onAnnotationResultsFromServer=function(e,t){this.onAnnotationResults(e,1,t)},e.prototype.resolvePlaceholdersInOperationParentPath=function(e){var t=e;return 3==t.length&&"session"==t[0]&&"user"==t[1]&&t[2].startsWith("user_")&&(d.Log.info(540848914,d.LogCategory.WorkflowDefault,"Replacing user context placeholder for: "+(0,g.makeItemPathKey)(e)+"."),t=["session","#userContext#"]),3==t.length&&"session"==t[0]&&"user"==t[1]&&t[2].startsWith("tenant_")&&(d.Log.info(540848915,d.LogCategory.WorkflowDefault,"Replacing tenant context placeholder for: "+(0,g.makeItemPathKey)(e)+"."),t=["session","#tenantContext#"]),t},e}();t.SessionProxy=y},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(134),t),r(n(135),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkflowDefinitionOverrideMessage=t.SessionCloseResponse=t.TelemetryFlushMessage=t.TelemetryMessage=t.DiagnosticTraceMessage=t.RuntimeInitMessage=t.WorkflowExecutionResponse=t.WorkflowExecutionRequest=t.WorkflowRegistrationMessage=void 0;var o=n(10),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Internal_WorkflowRegistrationMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.WorkflowRegistrationMessage=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_WorkflowExecutionRequest"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.WorkflowExecutionRequest=i;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_WorkflowExecutionResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.WorkflowExecutionResponse=s;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Internal_RuntimeInitMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.RuntimeInitMessage=a;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Internal_DiagnosticTraceMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.DiagnosticTraceMessage=u;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Internal_TelemetryMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.TelemetryMessage=c;var l=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Internal_TelemetryFlushMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.TelemetryFlushMessage=l;var p=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Internal_SessionCloseResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SessionCloseResponse=p;var f=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Internal_WorkflowDefinitionOverrideMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.WorkflowDefinitionOverrideMessage=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationActivationTracker=void 0;var o=n(5),r=function(){function e(t,n,o){var r=this;this.sessionManager=t,this.annotationType=n,this.options=o,this.token=n+"-"+e.nextActivationResultBatchId++,this.promise=new Promise((function(e,t){r.resolve=e,r.reject=t}))}return e.prototype.asPromise=function(){return this.promise},e.prototype.activate=function(e){var t=this;this.sessionManager().sendMessage(new o.AnnotationActivationMessage({annotationType:this.annotationType,token:this.token,config:this.options?this.options.config:void 0,ignoreExistingAnnotations:e,sendStateUpdates:this.options?!!this.options.stateUpdateCallback:void 0}),(function(e,n){t.complete(e?new Error(e.error):void 0)}))},e.prototype.release=function(){var e=this;return new Promise((function(t,n){e.sessionManager().sendMessage(new o.AnnotationReleaseMessage({token:e.token}),(function(e,o){e?n(new Error(e.error)):t(o.lastRelease)}))}))},e.prototype.complete=function(e){this.isComplete||(this.isComplete=!0,e?this.reject(e):this.resolve({token:this.token}))},e.nextActivationResultBatchId=1,e}();t.AnnotationActivationTracker=r},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.EmptySessionManager=void 0;var i=n(0),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.init=function(){return Promise.resolve()},t.prototype.sendMessage=function(e,t){},t.prototype.onMessage=function(e,t){},t.prototype.forceReconnect=function(){return Promise.resolve()},t.prototype.closeSession=function(){},t.prototype.sendBytes=function(e){},t.prototype.getCorrelationVector=function(){return new i.CorrelationVector},t.prototype.setState=function(e){},t}(n(20).EventEmitter);t.EmptySessionManager=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getContextTypes=void 0;t.getContextTypes=function(e,t){for(var n=[],o=0,r=null!=e?e:[];o<r.length;o++){var i=r[o];if(void 0===t||t===i.cardinality)for(var s=0,a=i.contextTypes;s<a.length;s++){var u=a[s];n.push([u,i.cardinality])}}return n}},function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s},i=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0}),t.findRangeForDeltaType=t.applyFormattedTextTileDelta=t.applyTextTileDelta=void 0;var a=n(3),u=n(0),c=n(57),l=n(58),p=n(59);function f(e,t,n){var o=new u.Operation({operationName:"FindRangeForDelta",success:!0});if(o.start(),!e)return o.resultDescription="No formatted ranges found within the tile, skipping.",void u.Log.info(538798212,u.LogCategory.CoreDefault,o.stop());if(t===l.TextTileDeltaType.Add){var r=e.find((function(e){return e.start===n&&0===e.length}));if(r)return o.resultDescription="Found a zero-length formatted range for add operation with start "+r.start+".",u.Log.info(538798213,u.LogCategory.CoreDefault,o.stop()),r;n=Math.max(n-1,0)}var i=e.find((function(e){return 0===e.length?e.start===n:e.start<=n&&n<e.start+e.length}));return i?(o.resultDescription="Updating formatted range for operation with start: "+i.start+" and length: "+i.length,u.Log.info(538798214,u.LogCategory.CoreDefault,o.stop())):(o.resultDescription="Unable to find formatted range for operation at position "+n+", skipping.",u.Log.info(538798215,u.LogCategory.CoreDefault,o.stop())),i}t.applyTextTileDelta=function(e,t){var n=new u.Operation({operationName:"ApplyTextTileDeltaForLocalWorkflows",success:!0});n.start();try{if(!t)return n.success=!1,n.resultDescription="Unable to apply text tile delta, parent tile is undefined",void u.Log.info(538798173,u.LogCategory.CoreDefault,n.stop());if(a.SchemaObject.getTypeNameFor(t)!==p.TextTile.getTypeName())return n.success=!1,n.resultDescription="Unable to apply text tile delta, parent tile is not proper type: expected "+c.TextTileDelta.getTypeName()+", received "+a.SchemaObject.getTypeNameFor(t),void u.Log.info(538798174,u.LogCategory.CoreDefault,n.stop());var o=e,r=t.content,i="";if(void 0===o.position||o.position<0)return n.success=!1,n.resultDescription="Unable to apply text tile delta, invalid text tile position",void u.Log.info(538798175,u.LogCategory.CoreDefault,n.stop());switch(o.deltaType){case l.TextTileDeltaType.Add:i=o.position<r.length?""+r.slice(0,o.position)+o.content+r.slice(o.position,r.length):r+o.content;break;case l.TextTileDeltaType.Update:i=""+r.slice(0,o.position)+o.content+r.slice(o.position+(o.length||0),r.length);break;case l.TextTileDeltaType.Delete:i=""+r.slice(0,o.position)+r.slice(o.position+(o.length||0),r.length)}return u.Log.info(538837071,u.LogCategory.CoreDefault,n.stop()),new p.TextTile({content:i})}catch(e){return n.success=!1,n.resultDescription="Error applying text tile delta: "+e,void u.Log.info(538798176,u.LogCategory.CoreDefault,n.stop())}},t.applyFormattedTextTileDelta=function(e,t){var n,c,d,h,g,m,y=new u.Operation({operationName:"ApplyFormattedTextTileDeltaForLocalWorkflows",success:!0});y.start();try{if(!t)return y.success=!1,y.resultDescription="Unable to apply formatted text tile delta, parent tile is undefined",void u.Log.info(538798177,u.LogCategory.CoreDefault,y.stop());if(a.SchemaObject.getTypeNameFor(t)!==p.FormattedTextTile.getTypeName())return y.success=!1,y.resultDescription="Unable to apply formatted text tile delta, parent tile is not proper type: expected "+p.FormattedTextTile.getTypeName()+", received "+a.SchemaObject.getTypeNameFor(t),void u.Log.info(538798178,u.LogCategory.CoreDefault,y.stop());var v=t,S=e,T=v.content,b="";if(void 0===S.position||S.position<0)return y.success=!1,y.resultDescription="Unable to apply formatted text tile delta, invalid text tile position",void u.Log.info(538798179,u.LogCategory.CoreDefault,y.stop());if(void 0===S.content&&S.deltaType!==l.TextTileDeltaType.Delete)return y.success=!1,y.resultDescription="Unable to apply formatted text tile delta, non-delete operation without content defined",void u.Log.info(538798208,u.LogCategory.CoreDefault,y.stop());S.deltaType===l.TextTileDeltaType.Add&&0!==S.length?u.Log.info(538798209,u.LogCategory.CoreDefault,new u.Operation({operationName:"ApplyDeltaChecks",resultDescription:"Received formatted text tile delta add operation with delta length, expected length 0",success:!0})):S.deltaType===l.TextTileDeltaType.Delete&&void 0!==S.content&&u.Log.info(538798210,u.LogCategory.CoreDefault,new u.Operation({operationName:"ApplyDeltaChecks",resultDescription:"Received formatted text tile delta delete operation with content defined, expected undefined",success:!0}));var w=f(v.formattedRanges,S.deltaType,S.position),_=v.formattedRanges?i([],r(v.formattedRanges),!1):[],C=w?_.indexOf(w):-1;switch(-1!==C&&(S.position+(S.length||0)>w.start+w.length?w.length=S.position+(null!==(d=S.content)&&void 0!==d?d:"").length-w.start:w.length+=(null!==(h=S.content)&&void 0!==h?h:"").length-(S.length||0),_[C]=w),S.deltaType){case l.TextTileDeltaType.Add:b=S.position<T.length?""+T.slice(0,S.position)+S.content+T.slice(S.position,T.length):T+S.content;break;case l.TextTileDeltaType.Update:b=""+T.slice(0,S.position)+S.content+T.slice(S.position+(S.length||0),T.length);break;case l.TextTileDeltaType.Delete:b=""+T.slice(0,S.position)+T.slice(S.position+(S.length||0),T.length)}try{for(var O=s(_.slice(C+1)),I=O.next();!I.done;I=O.next()){var A=I.value;A.start<S.position||(S.position+(S.length||0)>A.start?(A.length=A.start+A.length-(S.position+(S.length||0)),A.start=S.position+(null!==(g=S.content)&&void 0!==g?g:"").length):A.start+=(null!==(m=S.content)&&void 0!==m?m:"").length-(S.length||0))}}catch(e){n={error:e}}finally{try{I&&!I.done&&(c=O.return)&&c.call(O)}finally{if(n)throw n.error}}_=_.filter((function(e){return e.length>0}));var k=new p.FormattedTextTile(o(o({},v),{content:b,formattedRanges:_,queryRange:S.queryRange}));return u.Log.info(538837073,u.LogCategory.CoreDefault,y.stop()),k}catch(e){return y.success=!1,y.resultDescription="Error applying formatted text tile delta: "+e,void u.Log.info(538798211,u.LogCategory.CoreDefault,y.stop())}},t.findRangeForDeltaType=f},function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.DynamicWorkflowDefinitionManager=void 0;var r=n(141),i=function(){function e(){this.workflowDefByWorkflowAndContextId=new Map,this.workflowDefByWorkflow=new Map}return e.mergeDefinitions=function(e,t,n){return o(o(o({},e),t),n)},e.prototype.mergeWorkflowDefinition=function(t,n,o){if(o){var i=(0,r.getOrSetDefaultValue)(this.workflowDefByWorkflowAndContextId,t.id,(function(){return new Map}));i.set(o,e.mergeDefinitions(t,i.get(o),n))}else this.workflowDefByWorkflow.set(t.id,e.mergeDefinitions(t,this.workflowDefByWorkflow.get(t.id),n))},e.prototype.getWorkflowDefinition=function(e,t){var n,o;return t&&(o=null===(n=this.workflowDefByWorkflowAndContextId.get(e.id))||void 0===n?void 0:n.get(t)),o||(o=this.workflowDefByWorkflow.get(e.id)),o||(o=e),o},e.prototype.deleteWorkflowDefinition=function(e,t){var n=this.workflowDefByWorkflowAndContextId.get(e.id);n&&(n.delete(t),0===n.size&&this.workflowDefByWorkflowAndContextId.delete(e.id))},e}();t.DynamicWorkflowDefinitionManager=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOrSetDefaultValue=void 0;t.getOrSetDefaultValue=function(e,t,n){var o=e.get(t);return o||(o=n(),e.set(t,o)),o}},function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s},s=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.JoinAnnotationsManager=void 0;var a=n(3),u=n(0),c=new Set([a.AddOperation.getTypeName(),a.UpdateOperation.getTypeName(),a.SignalOperation.getTypeName(),a.DeltaUpdateOperation.getTypeName()]),l=function(){function e(e){this.collectionScopeTypesOnJoinWorkflows=new Set,this.updatesByScopeItemPath=new Map,this.scopeItemsByContextId=new Map,this.annotationsByWorkflowAndScopeItem=new Map,this.workflowDefinitionManager=e}return e.prototype.setActiveCollectionScopeType=function(e){this.collectionScopeTypesOnJoinWorkflows.add(e)},e.prototype.applyContextIdOnOperations=function(e){var t,n,i,s,c,l;try{for(var p=r(e),f=p.next();!f.done;f=p.next()){var d=f.value,h=a.SchemaObject.getTypeNameFor(d);if(this.isSupportedOperation(h))try{for(var g=(i=void 0,r(d.items)),m=g.next();!m.done;m=g.next()){var y=m.value,v=new u.Operation({operationName:"ApplyContextIdOnOperations",success:!1}).start();if(y.contextId)u.Log.verbose(539854490,u.LogCategory.CoreDefault,this.successLogMessage(v,"JAM :: Item of id: "+y.id+" already has a contextId "+y.contextId).stop());else{var S=o({parentPath:d.parentPath},y);if(h===a.DeltaUpdateOperation.getTypeName()){var T=o(o({},y),{parentPath:d.parentPath.slice(0,-1)});this.updatesByScopeItemPath.has(this.makeItemPathStr(T))?(y.contextId=this.getNewContextId(T),u.Log.verbose(539776014,u.LogCategory.CoreDefault,this.successLogMessage(v,"JAM :: DeltaUpdateOperation "+y.id+" already has a related TextTile, its new contextId is "+y.contextId).stop())):u.Log.verbose(539776015,u.LogCategory.CoreDefault,this.successLogMessage(v,"JAM :: DeltaUpdateOperation "+y.id+" don't have a related TextTile with contextId").stop());continue}if(this.isScopeTypeOfAnyJoinWorkflow(y.body))y.contextId=this.getNewContextId(S),u.Log.verbose(539854488,u.LogCategory.CoreDefault,this.successLogMessage(v,"JAM :: Item of id: "+y.id+" is scope item of a join and its contextId is "+y.contextId).stop());else{var b=this.makeItemPathStr(S);try{for(var w=(c=void 0,r(this.updatesByScopeItemPath.keys())),_=w.next();!_.done;_=w.next()){var C=_.value;b.indexOf(C)>=0&&(y.contextId=this.getContextId(C),u.Log.verbose(539854489,u.LogCategory.CoreDefault,this.successLogMessage(v,"JAM :: Item of id: "+y.id+" is not scope item of a join and its contextId is "+y.contextId).stop()))}}catch(e){c={error:e}}finally{try{_&&!_.done&&(l=w.return)&&l.call(w)}finally{if(c)throw c.error}}y.contextId||u.Log.verbose(539109088,u.LogCategory.CoreDefault,this.successLogMessage(v,"JAM :: Item of id: "+y.id+" does not belong to any join workflow execution").stop())}}}}catch(e){i={error:e}}finally{try{m&&!m.done&&(s=g.return)&&s.call(g)}finally{if(i)throw i.error}}}}catch(e){t={error:e}}finally{try{f&&!f.done&&(n=p.return)&&n.call(p)}finally{if(t)throw t.error}}},e.prototype.getNewContextId=function(e){var t=this.makeItemPathStr(e),n=this.updatesByScopeItemPath.get(t)||0;return this.updatesByScopeItemPath.set(t,n+1),this.getContextId(t)},e.prototype.setScopeItem=function(e,t){var n=e.contextId;if(this.scopeItemsByContextId.has(n)){var o=new u.Operation({resultDescription:"JAM.setScopeItem :: Trying to set new scope item: "+e.id+" with already existing contextId "+n,operationName:"JoinSetScopeItem",success:!0}).start();u.Log.verbose(539854491,u.LogCategory.CoreDefault,o.stop())}else this.scopeItemsByContextId.set(n,e);this.annotationsByWorkflowAndScopeItem.has(t.id)||this.annotationsByWorkflowAndScopeItem.set(t.id,new Map),this.annotationsByWorkflowAndScopeItem.get(t.id).set(n,[])},e.prototype.getScopeItem=function(e,t){var n;if(null===(n=this.annotationsByWorkflowAndScopeItem.get(t.id))||void 0===n?void 0:n.has(e))return this.scopeItemsByContextId.get(e)},e.prototype.addItemOnContextIdList=function(e,t){var n,o,r=e.contextId,i=this.annotationsByWorkflowAndScopeItem.get(t.id);if(i){null===(n=i.get(r))||void 0===n||n.push(e);var s=new u.Operation({resultDescription:"JAM.addItemOnContextIdList :: Items for contextId "+r+": ["+(null===(o=i.get(r))||void 0===o?void 0:o.map((function(e){return e.id})).join(","))+"]",operationName:"JoinAddInputItem",success:!0}).start();u.Log.verbose(539854492,u.LogCategory.CoreDefault,s.stop())}},e.prototype.isJoinReady=function(e,t){var n=this.workflowDefinitionManager.getWorkflowDefinition(t,e).maxAnnotations;return this.getGeneratedItems(e,t).length>=n},e.prototype.getItemsToExecute=function(e,t){var n=this.getGeneratedItems(e,t);return this.annotationsByWorkflowAndScopeItem.get(t.id).delete(e),n},e.prototype.registerWorkflowExecution=function(e,t){var n=e.contextId,o=this.annotationsByWorkflowAndScopeItem.get(t.id);o&&(o.delete(n),0===o.size&&this.annotationsByWorkflowAndScopeItem.delete(t.id)),this.hasWorkflowsAwaitingExecution(n)||this.scopeItemsByContextId.delete(n)},e.prototype.getGeneratedItems=function(e,t){var n;if(!(null===(n=this.annotationsByWorkflowAndScopeItem.get(t.id))||void 0===n?void 0:n.get(e)))return[];var o=this.workflowDefinitionManager.getWorkflowDefinition(t,e).maxAnnotations;return this.annotationsByWorkflowAndScopeItem.get(t.id).get(e).slice(0,o)},e.prototype.isSupportedOperation=function(e){return c.has(e)},e.prototype.isScopeTypeOfAnyJoinWorkflow=function(e){var t=s([],i(this.collectionScopeTypesOnJoinWorkflows),!1);return 0!==t.length&&a.SchemaObject.matchesTypesFor(e,t)},e.prototype.hasWorkflowsAwaitingExecution=function(e){var t,n,o,i;try{for(var s=r(this.annotationsByWorkflowAndScopeItem.values()),a=s.next();!a.done;a=s.next()){var u=a.value;try{for(var c=(o=void 0,r(u.keys())),l=c.next();!l.done;l=c.next()){if(l.value===e)return!0}}catch(e){o={error:e}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(o)throw o.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return!1},e.prototype.makeItemPathStr=function(e){return s(s([],i(e.parentPath),!1),[e.id],!1).join("/")},e.prototype.getContextId=function(e){return e+"@"+this.updatesByScopeItemPath.get(e)},e.prototype.successLogMessage=function(e,t){return e.success=!0,e.resultDescription=t,e},e}();t.JoinAnnotationsManager=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionStats=void 0;var o=function(){};t.SessionStats=o},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.SessionInitializer=void 0;var i=n(0),s=n(5),a=n(2),u=function(e){function t(t,n,o,r,i){var s=e.call(this)||this;return s.getSessionStats=t,s.clientMetadata=n,s.tokenRefreshManager=o,s.sendMessage=r,s.options=i||{},s.options.overrideSessionInitMessage=s.options.overrideSessionInitMessage||function(e){return e},s}return r(t,e),t.prototype.initSession=function(e){var t=this;e.onResponse=e.onResponse||function(){};var n=a.Utils.getCurrentTimeMs(),o=this.getSessionStats().lastConnectionClose&&n-this.getSessionStats().lastConnectionClose,r=this.getSessionStats().lastSyncMessage&&n-this.getSessionStats().lastSyncMessage,u=new i.Operation({operationName:"SessionInit"}),c={sessionKey:this.sessionKey,sessionId:this.clientMetadata.sessionId,timeSinceLastConnectionClose:o,timeSinceLastSyncMessage:r,isTokenRefresh:e.isTokenRefresh,error:void 0},l=this.options.overrideSessionInitMessage(new s.SessionInitMessage({protocolVersion:s.currentProtocolVersion,clientMetadata:this.clientMetadata,sessionKey:this.sessionKey,origin:this.origin,authToken:this.anonymousToken,extensionConfigs:e.extensionConfigs,returnWorkflowInputTypes:!0}));this.sendMessage(l,(function(n,o){u.success=!n,u.resultSignature=t.getSessionStats().lastConnectionClose?"Reconnect":"FirstConnect",u.resourceId=null==o?void 0:o.sliceUrl,(null==o?void 0:o.sessionKey)&&c.sessionKey!==o.sessionKey&&(c.sessionKey=o.sessionKey),n&&(c.error=n.error),u.resultDescription=JSON.stringify(c),i.Log.info(572838103,i.LogCategory.CoreDefault,u),e.onResponse(n,o),n||e.isReconnectOnSameSlice&&o.forceReconnect||(o.anonymousToken&&o.tokenExpirationSeconds?(t.anonymousToken=o.anonymousToken,t.onSuccessfulSessionInitOnServerSide(o)):i.Log.error(572838104,i.LogCategory.CoreDefault,"AL Anonymous token was not generated for the session"))}))},t.prototype.onSuccessfulSessionInitOnServerSide=function(e){var t=this;this.tokenRefreshManager.scheduleRefresh(0,e.tokenExpirationSeconds,this.initSession.bind(this,{isTokenRefresh:!0}),(function(){t.anonymousToken=void 0})),this.initHostAuthToken();var n=!!this.sessionKey,o=this.sessionKey!==e.sessionKey;this.sessionKey=e.sessionKey,this.origin=e.origin,this.emit("connect",o,n,e.sessionUrlBase+"/"+e.sessionKey,e.origin,this.anonymousToken,e.workflowInputTypes),n&&this.emit("reconnect")},t.prototype.initHostAuthToken=function(){var e=this;this.options.getAuthToken&&this.options.getAuthToken().then((function(t){t?e.sendTokenProvisionMessage(t):i.Log.info(572838105,i.LogCategory.CoreDefault,"Host auth token provision failed")})).catch((function(e){i.Log.error(572838106,i.LogCategory.CoreDefault,"Error happened while attempting to fetch host token: "+e)}))},t.prototype.sendTokenProvisionMessage=function(e){var t=new s.TokenProvisionMessage({authToken:e});this.sendMessage(t,this.onTokenProvisionResponse.bind(this))},t.prototype.onTokenProvisionResponse=function(e,t){!e&&t&&t.tokenExpirationSeconds&&this.tokenRefreshManager.scheduleRefresh(1,t.tokenExpirationSeconds,this.initHostAuthToken.bind(this))},t}(n(20).EventEmitter);t.SessionInitializer=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenRefreshManager=void 0;var o=function(){function e(){this.timers=new Map}return e.prototype.scheduleRefresh=function(t,n,o,r){var i=this.timers.get(t);i||(i={numberOfAttempts:0},this.timers.set(t,i)),i.refreshTimeoutId&&(clearTimeout(i.refreshTimeoutId),i.refreshTimeoutId=void 0),i.expiredTimeoutId&&(clearTimeout(i.expiredTimeoutId),i.expiredTimeoutId=void 0);var s=1e3*n-e.tokenRefreshBufferMs,a=1e3*n-e.tokenExpirationBufferMs;s>0?i.numberOfAttempts=0:(++i.numberOfAttempts,s=e.tokenRefreshBackoffIntervalMs,a=e.tokenExpirationBufferMs),i.numberOfAttempts<=e.tokenRefreshMaximumAttempts&&(i.refreshTimeoutId=setTimeout((function(){o()}),s)),r&&(i.expiredTimeoutId=setTimeout((function(){r()}),a))},e.prototype.clearRefreshTimeouts=function(){this.clearTimeouts(!1)},e.prototype.clearAllTimeouts=function(){this.clearTimeouts(!0)},e.prototype.clearTimeouts=function(e){var t=this;this.timers.forEach((function(n,o){n.refreshTimeoutId&&(clearTimeout(n.refreshTimeoutId),n.refreshTimeoutId=void 0),e&&n.expiredTimeoutId&&(clearTimeout(n.expiredTimeoutId),n.expiredTimeoutId=void 0),n.expiredTimeoutId||t.timers.delete(o)}))},e.tokenRefreshBufferMs=24e4,e.tokenExpirationBufferMs=12e4,e.tokenRefreshBackoffIntervalMs=3e4,e.tokenRefreshMaximumAttempts=3,e}();t.TokenRefreshManager=o},function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.LocalWorkflowExecutionManager=void 0;var i=n(3),s=n(8),a=n(0),u=n(5),c=n(53),l=n(147),p=n(2),f=n(56),d=n(148),h=n(54),g=n(151),m=n(153),y=function(){function e(e,t,n){var o=this;this.workflowsWithSessionAffinity=new Map,this.workflowDefinitionsWithSessionAffinity=[],this.workflowsWithoutSessionAffinity=[],this.pendingScopeExecutionNotificationsByWorkflow=new Map,this.sweepIntervalMs=200,this.sweepTimers=new Map,this.joinAnnotationManagerMapBySession=new Map,this.workflowDefinitionManagerMapBySession=new Map,this.getResourceAsArrayBuffer=function(e,t){return o.modelDownloader?o.modelDownloader.getResourceAsArrayBuffer(e,t):Promise.reject(new Error("Resource Downloader never created"))},this.getResourceAsURL=function(e,t){return o.modelDownloader?o.modelDownloader.getResourceAsURL(e,t):Promise.reject(new Error("Resource Downloader never created"))},this.createModel=function(e){return!o.inferenceService&&o.inferenceServiceFactory&&(o.inferenceService=o.inferenceServiceFactory()),o.inferenceService?o.inferenceService.then((function(t){return t.createModel(e)})):Promise.reject(new Error("Inference Service never created"))},this.createModelInputs=function(){if(!o.inferenceService&&o.inferenceServiceFactory&&(o.inferenceService=o.inferenceServiceFactory()),o.inferenceService)return o.inferenceService.then((function(e){return e.createInputs()}));throw new Error("Inference Service never created")},this.nextAnnotationId=1,this.nextSignalId=1,this.modelDownloader=e,this.inferenceServiceFactory=t,n.enableDeltas&&(this.deltaHandlers=(new Map).set(i.SchemaObject.getTypeNameFor(g.TextTileDelta),f.applyTextTileDelta).set(i.SchemaObject.getTypeNameFor(g.FormattedTextTileDelta),f.applyFormattedTextTileDelta),this.deltaItems=new Map),this.site={getResourceAsArrayBuffer:this.getResourceAsArrayBuffer,getResourceAsURL:this.getResourceAsURL,createModel:this.createModel,createModelInputs:this.createModelInputs}}return e.prototype.getNextClientAnnotationId=function(){return"#AC"+this.nextAnnotationId++},e.prototype.getNextClientSignalId=function(){return"#SC"+this.nextSignalId++},e.prototype.registerLocalWorkflow=function(e,t){var n=this,o=new a.Operation({operationName:"WorkflowRegistration",resourceId:e.id}).start();if(0===e.inputTypes.length)throw new Error("Invalid workflow params");e.kind===s.WorkflowKind.Join&&(t?this.joinAnnotationManagerMapBySession.get(t).setActiveCollectionScopeType(e.collectionScopeType):this.joinAnnotationManagerMapBySession.forEach((function(t){return t.setActiveCollectionScopeType(e.collectionScopeType)}))),t?(this.workflowsWithSessionAffinity.get(t).push(this.createWorkflowImplementation(e,t)),t.registerContextTypes((0,h.getContextTypes)(e.requestedContextTypesRules).map((function(e){var t=e[0];e[1];return t})))):(e.isStateful?(this.workflowDefinitionsWithSessionAffinity.push(e),this.workflowsWithSessionAffinity.forEach((function(o){o.push(n.createWorkflowImplementation(e,t))}))):this.workflowsWithoutSessionAffinity.push(this.createWorkflowImplementation(e)),this.workflowsWithSessionAffinity.forEach((function(t,n){return n.registerContextTypes((0,h.getContextTypes)(e.requestedContextTypesRules).map((function(e){var t=e[0];e[1];return t})))}))),o.success=!0,a.Log.info(572838110,a.LogCategory.CoreDefault,o.stop())},e.prototype.getWorkflowDefinitionsByName=function(e){var t,n=new Map;return null===(t=this.workflowsWithSessionAffinity.get(e))||void 0===t||t.forEach((function(e){return n.set(e.workflow.id,e.workflow)})),n},e.prototype.addSession=function(e,t,n){this.workflowDefinitionManagerMapBySession.set(e,n),this.joinAnnotationManagerMapBySession.set(e,t);for(var o=[],r=0,i=this.workflowDefinitionsWithSessionAffinity;r<i.length;r++){var a=i[r];o.push(this.createWorkflowImplementation(a)),a.kind===s.WorkflowKind.Join&&t.setActiveCollectionScopeType(a.collectionScopeType)}this.workflowsWithSessionAffinity.set(e,o)},e.prototype.closeSession=function(e){this.cancelSweepTimer(e);for(var t=0,n=this.workflowsWithSessionAffinity.get(e)||[];t<n.length;t++){n[t].workflowLambda.dispose()}this.workflowsWithSessionAffinity.delete(e)},e.prototype.setTokenCallback=function(e){this.getAuthTokenCallback=e},e.prototype.runLocalWorkflows=function(e,t,n){var o,u,c,l=this;void 0===n&&(n=!1);var p=this.joinAnnotationManagerMapBySession.get(t),f=function(e,n,o){var u,c=e.workflow,f=c.inputTypes.concat(c.kind===s.WorkflowKind.Join?c.collectionScopeType:[]);if(i.SchemaObject.matchesTypesFor(n.body,f)){var d=(0,m.shallowCloneItemWithPath)(o.parentPath,n);if(c.kind===s.WorkflowKind.Join)if(i.SchemaObject.matchesTypesFor(n.body,[c.collectionScopeType]))p.setScopeItem(d,c);else{if(!p.getScopeItem(n.contextId,c)){var h=new a.Operation({resultDescription:"Filtered out join invalidation: out of scope type ("+c.collectionScopeType+")",operationName:"RunLocalWorkflows",success:!1}).start();return void a.Log.info(541173894,a.LogCategory.CoreDefault,h.stop())}p.addItemOnContextIdList(d,c)}if(i.SchemaObject.getBaseTypesFor(n.body).indexOf(i.ContextHolder.getTypeName())>=0){for(var g=r(r([],d.parentPath,!0),[d.id],!1),y=!0,v=0,S=null!==(u=c.outputTypes)&&void 0!==u?u:[];v<S.length;v++){var T=S[v];if(!t.getContextAnnotations(T,0,g,c.id)){y=!1;break}}if(y)return}var b=function(){var o,r=t.resolveRequestedContexts(c),i=r[0],u=r[1];if(i){if(c.kind===s.WorkflowKind.SingleItem)l.executeLocalWorkflow(e,d,[d],t,u,0).catch((function(e){a.Log.error(572838111,a.LogCategory.CoreDefault,e)}));else if(c.kind===s.WorkflowKind.Join){var f=n.contextId,h=p.getScopeItem(f,e.workflow);if(p.isJoinReady(f,c)&&i){var g=p.getItemsToExecute(f,c);if(l.executeLocalWorkflow(e,h,g,t,u,0).catch((function(e){a.Log.error(541173895,a.LogCategory.CoreDefault,e)})).finally((function(){return p.registerWorkflowExecution(h,c)})),null===(o=l.pendingScopeExecutionNotificationsByWorkflow.get(c.id))||void 0===o?void 0:o.get(f))l.pendingScopeExecutionNotificationsByWorkflow.get(c.id).delete(f),0===l.pendingScopeExecutionNotificationsByWorkflow.get(c.id).size&&l.pendingScopeExecutionNotificationsByWorkflow.delete(c.id);else{var m=new a.Operation({resultDescription:"Workflow "+c.id+", contextId "+f+", already queued, skipping new scope execution"}).start();a.Log.info(528048977,a.LogCategory.CoreDefault,m.stop())}}else l.setScopeExecutionNotification(t,e,h,0)}}else a.Log.info(545837259,a.LogCategory.WorkflowDefault,"Required contexts are not ready for "+c.id+". Retrying execution in 500 milliseconds..."),setTimeout(b,500)};b()}},d=e;n&&(d=[new i.AddOperation({parentPath:["session"],items:[{id:"#userContext#",body:new i.UserContextHolder}]}),new i.AddOperation({parentPath:["session"],items:[{id:"#tenantContext#",body:new i.TenantContextHolder}]})],p.applyContextIdOnOperations(d),d=d.concat(e));for(var h=0,g=d;h<g.length;h++)for(var y=g[h],v=i.SchemaObject.getTypeNameFor(y),S=0,T=y.items;S<T.length;S++){var b=T[S];if(t.applyOperationForContext(y,b,2),v!==i.DeleteOperation.getTypeName()){if(b.body)if(v===i.DeltaUpdateOperation.getTypeName()&&this.deltaHandlers&&this.deltaItems){var w=new a.Operation({operationName:"LocalDeltaUpdate",dimension0:i.SchemaObject.getTypeNameFor(b.body),success:!0});w.start();try{var _=this.deltaHandlers.get(i.SchemaObject.getTypeNameFor(b.body)),C=this.deltaItems.get(b.id);if(_&&C){var O=_(b.body,C);if(O){var I={id:b.id,revId:b.revId,body:O,parentPath:y.parentPath,delta:b.body},A=new i.Operation({parentPath:I.parentPath,items:[I]});a.Log.info(539637591,a.LogCategory.CoreDefault,w.stop()),this.runLocalWorkflows([A],t)}else w.success=!1,w.resultDescription="Failed because the handler did not produce valid updated item",a.Log.info(539637592,a.LogCategory.CoreDefault,w.stop())}else w.success=!1,w.resultDescription="Failed due to lack of handler or parent item",a.Log.info(539637593,a.LogCategory.CoreDefault,w.stop())}catch(e){w.success=!1,w.resultDescription="Failed to apply delta, error: "+e,a.Log.info(539637594,a.LogCategory.CoreDefault,w.stop())}}else{null===(u=this.deltaItems)||void 0===u||u.set(b.id,b.body);for(var k=0,P=this.workflowsWithoutSessionAffinity;k<P.length;k++){f(P[k],b,y)}for(var R=0,M=null!==(c=this.workflowsWithSessionAffinity.get(t))&&void 0!==c?c:[];R<M.length;R++){f(M[R],b,y)}}}else null===(o=this.deltaItems)||void 0===o||o.delete(b.id)}},e.prototype.getJoinAnnotationManagerForSession=function(e){return this.joinAnnotationManagerMapBySession.get(e)},e.prototype.onWorkflowExecutionRequest=function(e,t,n,o){var r,i=null===(r=this.workflowsWithSessionAffinity.get(e))||void 0===r?void 0:r.find((function(e){return e.workflow.id===t}));this.executeLocalWorkflow(i,n.scopeItem,n.inputItems,e,n.requestedContexts,1).then((function(e){o(void 0,e)})).catch((function(e){o(new Error(e))}))},e.prototype.createWorkflowImplementation=function(e,t){var n=e.factory();return{workflow:e,workflowLambda:n,initPromise:this.initWorkflow(e.kind,n,t)}},e.prototype.initWorkflow=function(e,t,n){var o=new d.LocalWorkflowContext({model:void 0,clientMetadata:n?n.getClientMetadata():void 0,site:this.site,getTokenCallback:this.getAuthTokenCallback.bind(this)});return e===s.WorkflowKind.SingleItem||e===s.WorkflowKind.Join?t.init(this.site,o):Promise.resolve()},e.prototype.executeLocalWorkflow=function(e,t,n,r,p,f){var h=this;return new Promise((function(g,m){var y,v={annotations:[]},S=e.workflow,T=new a.Operation({operationName:"ExecuteWorkflow",resourceId:S.id});T.start();var b=null===(y=null==n?void 0:n[0])||void 0===y?void 0:y.contextId;T.dimension3=null!=b?b:"";var w=function(e){return e?(T.resultDescription=e,T.resultSignature="Exception",a.Log.error(572838112,a.LogCategory.CoreDefault,T.stop())):(T.success=!0,a.Log.info(572838113,a.LogCategory.CoreDefault,T.stop())),e},_=new d.LocalWorkflowContext({model:new l.WorkflowModel(n[0],p),clientMetadata:r.getClientMetadata(),site:h.site,getTokenCallback:h.getAuthTokenCallback.bind(h)}),C=function(e){w(e?e.message:null),e?m(e):g(v)},O={setAnnotations:function(c,l,p,d){for(var g,y=function(t){a.Log.info(555866112,a.LogCategory.CoreDefault,new a.AnnotationMetaDataChange({annotationType:l,annotationState:t,workflowId:e.workflow.id}))},T=0,_=p;T<_.length;T++){(R=_[T]).metadata=o(o({},R.metadata),{state:i.AnnotationState.Created}),y(i.AnnotationState.Created)}if(S.kind!==s.WorkflowKind.SingleItem||n[0].body===c)if(S.kind!==s.WorkflowKind.Join||(null==t?void 0:t.body)===c){var C,O,I=n[0],A=i.SchemaObject.getTypeNameFor(I.body);if(Array.isArray(p))if(!S.outputTypes||S.outputTypes.indexOf(l)<0)C="Workflow said it would output one of ["+S.outputTypes+"] but instead output "+l;else if(I)for(var k=0,P=p;k<P.length;k++){var R=P[k];i.SchemaObject.matchesTypesFor(R,[i.Annotation.getTypeName()])?i.SchemaObject.getTypeNameFor(R)!==l&&(C="Workflow produced inconsistent annotation types in setAnnotations call ("+i.SchemaObject.getTypeNameFor(R)+" did not match expected "+l+")"):C="Workflow produced an output that is not an annotation "+i.SchemaObject.getTypeNameFor(R)}else C="No item provided";else C="Workflow produced an invalid annotation array";if(C)m(w(C));else if(O=d&&d.isSessionAnnotation?["session"]:d&&d.ancestorType?I.parentPath:I.parentPath.concat(I.id),v.annotations.push({path:O,annotationType:l,annotations:p}),1!==f){for(var M=[],L=[],x=function(e){e.metadata=o(o({},e.metadata),{state:i.AnnotationState.Sent}),y(i.AnnotationState.Sent);var t=e.id,n=t?null===(g=r.getContextAnnotations(l,0,O,S.id))||void 0===g?void 0:g.filter((function(e){var n;return(null===(n=e.body)||void 0===n?void 0:n.id)==t})):void 0;1==(null==n?void 0:n.length)?1==n.length?L.push({id:n[0].id,source:S.id,body:e,contextId:b}):a.Log.error(545837260,a.LogCategory.CoreDefault,"Assert: Multiple existing context annotations with body id "+t+" found for "+l+" and local workflow "+S.id+")."):M.push({id:h.getNextClientAnnotationId(),source:S.id,body:e,contextId:b})},E=0,D=p;E<D.length;E++){x(R=D[E])}var N=[];M.length>0&&N.push(new i.AddOperation({parentPath:O,items:M})),L.length>0&&N.push(new i.UpdateOperation({parentPath:O,items:L})),r.onAnnotationResults(new u.AnnotationResultsMessage({annotationType:l,ops:N}),0,(function(){})),(A==i.UserContextHolder.getTypeName()||A==i.TenantContextHolder.getTypeName()||i.SchemaObject.matchesTypesFor(I.body,[i.Document.getTypeName(),i.SubDocument.getTypeName()]))&&r.submitOperationsToServer(N)}}else m(w("Expected obj to be "+(null==t?void 0:t.body)+" but instead it was "+c));else m(w("Expected obj to be "+n[0].body+" but instead it was "+c))},submitSignals:function(e){if(1!==f){var t=e.map((function(e){return{id:h.getNextClientSignalId(),source:S.id,body:e,contextId:b}})),n=new i.SignalOperation({parentPath:["session"],items:t});r.submitOperations([n])}else m(w("NYI"))},done:C,overrideWorkflowDefinition:function(e,n,o){var i;switch(o){case 0:if(!t.contextId){var s="ContextId is not defined for this scope item.";throw a.Log.error(527472289,a.LogCategory.CoreDefault,s),new Error(s)}i=t.contextId;break;case 1:i=void 0;break;default:s="Defined scope is not supported. "+o;throw a.Log.error(527472290,a.LogCategory.CoreDefault,s),new Error(s)}var u=new c.WorkflowDefinitionOverrideMessage({definition:n,contextId:i,sourceWorkflowId:S.id,targetWorkflowId:e});r.onWorkflowDefinitionOverrideMessage(u)}},I=e.workflowLambda;if(S.kind===s.WorkflowKind.SingleItem){1!==n.length&&C(new Error("Single item workflows expect a single input")),_.delta=n[0].delta;try{var A=I;e.initPromise||(e.initPromise=A.init(h.site,_)),e.initPromise.then((function(){A.execute(n[0].body,_,O)})).catch((function(e){w(e)}))}catch(e){w(e)}}else if(S.kind===s.WorkflowKind.Join){0===n.length&&C(new Error("Join workflows expect an inputs array")),_.delta=t.delta;try{var k=I;e.initPromise||(e.initPromise=k.init(h.site,_)),e.initPromise.then((function(){k.execute(t.body,n.map((function(e){return e.body})),_,O)})).catch((function(e){w(e)}))}catch(e){w(e)}}else w("Workflow kind "+S.kind+" not supported")}))},e.prototype.ensureSweepTimer=function(e){if(!this.sweepTimers.get(e)){var t=setInterval(this.onSweep.bind(this),this.sweepIntervalMs);this.sweepTimers.set(e,t)}},e.prototype.cancelSweepTimer=function(e){var t=this.sweepTimers.get(e);this.sweepTimers.get(e)&&(clearInterval(t),this.sweepTimers.delete(e))},e.prototype.onSweep=function(){this.sweepScopeExecutionNotifications()},e.prototype.setScopeExecutionNotification=function(e,t,n,o){var r=Date.now(),i={session:e,workflowImplementation:t,scopeItem:n,startTime:r,minTime:r+(0,p.getSafeNumber)(t.workflow.minDelayMs,1e3),maxTime:r+(0,p.getSafeNumber)(t.workflow.maxDelayMs,5e3),orchestrationMode:o},u=t.workflow.kind===s.WorkflowKind.Join?n.contextId:i.scopeItem.parentPath.concat(n.id).join("\\");if(this.pendingScopeExecutionNotificationsByWorkflow.get(t.workflow.id)||this.pendingScopeExecutionNotificationsByWorkflow.set(t.workflow.id,new Map),!this.pendingScopeExecutionNotificationsByWorkflow.get(t.workflow.id).get(u)){var c=new a.Operation({resultDescription:"New pending scope execution for "+t.workflow.id+" at "+u,operationName:"LocalScopeExecutionNotification",success:!0}).start();a.Log.info(539883075,a.LogCategory.CoreDefault,c.stop()),this.pendingScopeExecutionNotificationsByWorkflow.get(t.workflow.id).set(u,i)}this.ensureSweepTimer(e)},e.prototype.sweepScopeExecutionNotifications=function(){for(var e=this,t=new Set(Array.from(this.sweepTimers.keys())),n=0,o=Array.from(this.pendingScopeExecutionNotificationsByWorkflow.entries());n<o.length;n++)for(var r=o[n],i=r[0],u=r[1],c=function(n,o){var r=o.session,u=o.workflowImplementation.workflow,c=o.orchestrationMode,p=l.getJoinAnnotationManagerForSession(r);!function(){if(!function(){if(u.kind===s.WorkflowKind.Join){var t=Date.now(),n=o.workflowImplementation.workflow,i=o.scopeItem.contextId,c=e.workflowDefinitionManagerMapBySession.get(r).getWorkflowDefinition(n,i).maxDelayMs;if(p.isJoinReady(i,n)){var l=new a.Operation({resultDescription:"Join Workflow: "+n.id+" queuing by maxAnnotation, contextId: "+i}).start();return a.Log.info(528048978,a.LogCategory.CoreDefault,l.stop()),!0}if(o.startTime+c<t){l=new a.Operation({resultDescription:"Join Workflow: "+n.id+" queuing by maxTimeout, contextId: "+i}).start();return a.Log.info(528048979,a.LogCategory.CoreDefault,l.stop()),!0}return!1}return!0}())return!1;var t=r.resolveRequestedContexts(u),n=t[0],i=t[1];if(!n)return!1;var l=new a.Operation({operationName:"LocalScopeExecutionNotification"}).start();try{if(u.kind===s.WorkflowKind.Join){var f=o.scopeItem.contextId,d=p.getScopeItem(f,u);if(d){var h=p.getItemsToExecute(f,u);if(0===h.length)return a.Log.info(527472291,a.LogCategory.CoreDefault,"Failed to retrieve items for workflow: "+u.id+", contextId: "+f+", skipping execution"),!0;e.executeLocalWorkflow(o.workflowImplementation,d,h,r,i,c).finally((function(){return p.registerWorkflowExecution(d,u)}))}else l.resultDescription="ContextId no longer exists, skipping workflow execution",a.Log.debug(539883076,a.LogCategory.CoreDefault,l.stop())}else l.resultDescription="Workflow in type "+u.kind+" is not supported",a.Log.error(539883077,a.LogCategory.CoreDefault,l.stop())}catch(e){l.resultDescription="Trying to execute "+u.id+" caused an exception: "+e,a.Log.warn(539883078,a.LogCategory.CoreDefault,l.stop())}return!0}()?t.delete(r):(l.pendingScopeExecutionNotificationsByWorkflow.get(i).delete(n),0===l.pendingScopeExecutionNotificationsByWorkflow.get(i).size&&l.pendingScopeExecutionNotificationsByWorkflow.delete(i))},l=this,p=0,f=Array.from(u.entries());p<f.length;p++){var d=f[p];c(d[0],d[1])}if(0!==t.size)for(var h=0,g=Array.from(t);h<g.length;h++){var m=g[h],y=new a.Operation({resultDescription:"No pending scope notifications left, cancelling sweep timer",operationName:"LocalScopeExecutionNotification",success:!0}).start();a.Log.debug(539883079,a.LogCategory.CoreDefault,y.stop()),this.cancelSweepTimer(m)}},e}();t.LocalWorkflowExecutionManager=y},function(e,t,n){"use strict";var o=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.WorkflowModel=void 0;var r=n(3),i=function(){function e(e,t){void 0===t&&(t=[]),this.scopeItem=void 0,this.rootItem=void 0,this.normalizeFilter=function(e){if(!e)return function(e){return void 0!==e};if("function"==typeof e)throw new Error("Not implemented yet");if((e.id?1:0)+(e.ids?1:0)+(e.itemType?1:0)+(e.itemTypes?1:0)!=1)throw new Error("Exactly one condition expected on IItemFilter");if(e.itemType)return function(t){return t&&r.SchemaObject.matchesTypesFor(t.body,[e.itemType])};if(e.itemTypes)return function(t){return t&&r.SchemaObject.matchesTypesFor(t.body,e.itemTypes)};throw new Error("Not implemented yet")},this.items=o(o([],t,!0),[e],!1)}return e.prototype.getItem=function(e){throw new Error("Method not implemented.")},e.prototype.getItems=function(e){throw new Error("Method not implemented.")},e.prototype.getItemBody=function(e){return this.getItemBodies(e)[0]},e.prototype.getItemBodies=function(e){var t=this.normalizeFilter(e);return this.items.filter(t).map((function(e){return e.body}))},e.prototype.getItemByReference=function(e){throw new Error("Method not implemented.")},e.prototype.getItemBodyByReference=function(e){throw new Error("Method not implemented.")},e}();t.WorkflowModel=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalWorkflowContext=void 0;var o=n(149),r=function(){function e(e){this.model=e.model,this.clientMetadata=e.clientMetadata,this.site=e.site,this.getToken=e.getTokenCallback}return Object.defineProperty(e.prototype,"flights",{get:function(){var e;return null!==(e=this._flights)&&void 0!==e||(this._flights=(0,o.parseFlights)(this.clientMetadata.flights)),this._flights},enumerable:!1,configurable:!0}),e.prototype.getToken=function(e,t){return this.getToken(e,t)},e}();t.LocalWorkflowContext=r},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(150),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkflowFlights=t.parseFlights=void 0;t.parseFlights=function(e){if(!e)return new o([],new Set,new Map);for(var t=e.split(";"),n=new Set,r=new Map,i=0,s=t;i<s.length;i++){var a=s[i].trim();if(""!==a){n.add(o.normalizeName(a));var u=a.split(":"),c=u[0],l=u[1],p=o.normalizeName(c);p&&r.set(p,l)}}return new o(t,n,r)};var o=function(){function e(e,t,n){this.originalFlights=e,this.normalizedFlights=t,this.keyValueFlightsMap=n}return e.normalizeName=function(e){return null==e?void 0:e.toLowerCase()},e.prototype.hasFlight=function(t){var n=e.normalizeName(t),o=this.normalizedFlights.has(n),r=this.keyValueFlightsMap.has(n);return o||r},e.prototype.getBooleanValue=function(e,t){var n;switch(null===(n=this.getStringValue(e))||void 0===n?void 0:n.toLowerCase()){case"true":return!0;case"false":return!1;default:return t}},e.prototype.getIntValue=function(e,t){var n=this.getStringValue(e),o=Number.parseInt(n,10);return Number.isNaN(o)?t:o},e.prototype.getStringValue=function(t,n){var o;return null!==(o=this.keyValueFlightsMap.get(e.normalizeName(t)))&&void 0!==o?o:n},e.prototype.getAll=function(){return this.originalFlights},e}();t.WorkflowFlights=o},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(58),t),r(n(57),t),r(n(59),t),r(n(152),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpecialIndentType=t.ObjectType=t.Alignment=t.UnderlineType=t.CapsType=t.FontWeight=t.ListType=t.AnchorMode=void 0,function(e){e[e.Unspecified=0]="Unspecified",e[e.Inline=1]="Inline",e[e.Floating=2]="Floating"}(t.AnchorMode||(t.AnchorMode={})),function(e){e[e.Undefined=0]="Undefined",e[e.Bullet=1]="Bullet",e[e.Numbered=2]="Numbered",e[e.Lim=3]="Lim",e[e.Nil=4]="Nil",e[e.Any=5]="Any",e[e.NoList=6]="NoList",e[e.Invalid=7]="Invalid"}(t.ListType||(t.ListType={})),function(e){e[e.DontCare=1]="DontCare",e[e.Thin=2]="Thin",e[e.ExtraLight=3]="ExtraLight",e[e.Light=4]="Light",e[e.Normal=5]="Normal",e[e.Medium=6]="Medium",e[e.SemiBold=7]="SemiBold",e[e.Bold=8]="Bold",e[e.ExtraBold=9]="ExtraBold",e[e.Heavy=10]="Heavy"}(t.FontWeight||(t.FontWeight={})),function(e){e[e.NoCaps=0]="NoCaps",e[e.SmallCaps=1]="SmallCaps",e[e.AllCaps=2]="AllCaps",e[e.AllPetiteCaps=3]="AllPetiteCaps",e[e.PetiteCaps=4]="PetiteCaps",e[e.Unicase=5]="Unicase",e[e.Titling=6]="Titling",e[e.Other=7]="Other"}(t.CapsType||(t.CapsType={})),function(e){e[e.None=0]="None",e[e.Words=1]="Words",e[e.SingleLine=2]="SingleLine",e[e.DoubleLine=3]="DoubleLine",e[e.HeavyLine=4]="HeavyLine",e[e.DottedLine=5]="DottedLine",e[e.DottedHeavyLine=6]="DottedHeavyLine",e[e.DashLine=7]="DashLine",e[e.DashHeavyLine=8]="DashHeavyLine",e[e.DashLongLine=9]="DashLongLine",e[e.DashLongHeavyLine=10]="DashLongHeavyLine",e[e.DotDashLine=11]="DotDashLine",e[e.DotDashHeavyLine=12]="DotDashHeavyLine",e[e.DotDotDashLine=13]="DotDotDashLine",e[e.DotDotDashHeavyLine=14]="DotDotDashHeavyLine",e[e.WavyLine=15]="WavyLine",e[e.WavyHeavyLine=16]="WavyHeavyLine",e[e.WavyDoubleLine=17]="WavyDoubleLine"}(t.UnderlineType||(t.UnderlineType={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Center=2]="Center",e[e.Justified=3]="Justified",e[e.Other=4]="Other",e[e.None=5]="None",e[e.JustifyLow=6]="JustifyLow",e[e.Distributed=7]="Distributed",e[e.ThaiDistributed=8]="ThaiDistributed"}(t.Alignment||(t.Alignment={})),function(e){e[e.Image=0]="Image",e[e.TextBox=1]="TextBox",e[e.Chart=2]="Chart",e[e.SmartArt=3]="SmartArt",e[e.Drawing=4]="Drawing",e[e.EquationObject=5]="EquationObject",e[e.Ink=6]="Ink",e[e.InkSpace=7]="InkSpace",e[e.InkEndOfLine=8]="InkEndOfLine",e[e.LineBreak=9]="LineBreak",e[e.PageBreak=10]="PageBreak",e[e.PageNumbers=11]="PageNumbers",e[e.FootnoteEndnote=12]="FootnoteEndnote",e[e.FootnoteEndnoteReferenceMark=13]="FootnoteEndnoteReferenceMark",e[e.Tab=14]="Tab",e[e.UnsupportedObject=15]="UnsupportedObject",e[e.Other=16]="Other"}(t.ObjectType||(t.ObjectType={})),function(e){e[e.Initial=0]="Initial",e[e.FirstLine=1]="FirstLine",e[e.Hanging=2]="Hanging"}(t.SpecialIndentType||(t.SpecialIndentType={}))},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(55),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoutingAnnotationResultsProcessor=void 0;var o=n(155),r=n(160),i=function(){function e(e,t,n){this.isOrderingEnabled=e,this.orderedAnnotationResultsProcessor=null!=t?t:new o.OrderedAnnotationResultsProcessor,this.unorderedAnnotationResultsProcessor=null!=n?n:new r.UnorderedAnnotationResultsProcessor}return e.prototype.process=function(e,t,n,o){this.isOrderingEnabled()?this.orderedAnnotationResultsProcessor.process(e,t,n,o):this.unorderedAnnotationResultsProcessor.process(e,t,n,o)},e}();t.RoutingAnnotationResultsProcessor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrderedAnnotationResultsProcessor=void 0;var o=n(156),r=function(){function e(e){this.annotationSequencer=null!=e?e:new o.AnnotationSequencer}return e.prototype.process=function(e,t,n,o){for(var r=[],i=function(e){var o=[];if(null==e?void 0:e.items)for(var i=function(n){var r=s.annotationSequencer.sequence(n.body).then((function(){t(e,n)}));o.push(r)},a=0,u=e.items;a<u.length;a++){i(u[a])}r.push(Promise.all(o).then((function(){n(e)})))},s=this,a=0,u=e.ops;a<u.length;a++){i(u[a])}Promise.all(r).then((function(){return o(e)}))},e}();t.OrderedAnnotationResultsProcessor=r},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationSequencer=void 0;var i=n(157),s=function(){function e(e,t){void 0===e&&(e=500),this.sequencerFactory=null!=t?t:new i.BufferingSequencerFactory(e)}return e.prototype.sequence=function(e){var t;return o(this,void 0,void 0,(function(){var n;return r(this,(function(o){switch(o.label){case 0:return(null===(t=null==e?void 0:e.metadata)||void 0===t?void 0:t.seq)&&(n=this.sequencerFactory.create(e))?[4,n.sequence(e.metadata.seq)]:[2];case 1:return o.sent(),[2]}}))}))},e}();t.AnnotationSequencer=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BufferingSequencerFactory=void 0;var o=n(158),r=function(){function e(e){void 0===e&&(e=500),this.bufferingTimeMs=500,this.workflowIdToSequencersMap=new Map,this.bufferingTimeMs=e}return e.prototype.create=function(e){if(!e.ownerId)return null;var t=this.workflowIdToSequencersMap.get(e.ownerId);return t||(t=new o.BufferingSequencer(this.bufferingTimeMs),this.workflowIdToSequencersMap.set(e.ownerId,t)),t},e}();t.BufferingSequencerFactory=r},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(159),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BufferingSequencer=void 0;var o=n(0),r=function(){function e(e,t){void 0===e&&(e=500),void 0===t&&(t=!1),this.prevSeq=-1,this.bufferingTimeMs=e,this.rejectOutdatedSequenceNumbers=t}return e.prototype.sequence=function(t){var n=this;return new Promise((function(r,i){if(t<n.prevSeq){if(n.rejectOutdatedSequenceNumbers){var s=new Error("BufferingSequencer: Item out of order. Expecting seqId > "+n.prevSeq+". Actual seqId "+t);return s.name=e.Rejected,void i(s)}n.prevSeq=-1}t!=n.prevSeq+1&&o.Log.warn(542712385,o.LogCategory.WorkflowDefault,"BufferingSequencer: got out of order sequence number. Got "+t+", expected "+(n.prevSeq+1));var a={seq:t,resolve:r};n.insertItem(a),n.runInOrder(a,!0,!1)}))},e.prototype.insertItem=function(e){if(!this.firstQueueItem)return this.firstQueueItem=e,void(this.lastQueueItem=e);var t=this.lastQueueItem,n=null;do{if(e.seq>t.seq)return e.prev=t,t.next=e,void(n?n.prev=e:this.lastQueueItem=e);n=t,t=t.prev}while(t);n&&(n.prev=e),e.next=n,this.firstQueueItem=e},e.prototype.runInOrder=function(e,t,n){for(var o=this,r=this.prevSeq,i=!1,s=[];this.firstQueueItem;){var a=this.firstQueueItem;if(r+1!=a.seq&&(!n||a.seq>e.seq))break;r=a.seq,a.timeout&&clearTimeout(a.timeout),s.push(a),e==a&&(i=!0),this.firstQueueItem=this.firstQueueItem.next,this.firstQueueItem&&(this.firstQueueItem.prev=null)}s.length>0&&setTimeout((function(){for(var e=0,t=s;e<t.length;e++){var n=t[e];n.resolve(n.seq)}}),0),this.prevSeq=r,!i&&t&&(e.timeout=setTimeout((function(){o.runInOrder(e,!1,!0)}),this.bufferingTimeMs))},e.Rejected="SequenceItemRejected",e}();t.BufferingSequencer=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnorderedAnnotationResultsProcessor=void 0;var o=function(){function e(){}return e.prototype.process=function(e,t,n,o){for(var r=0,i=e.ops;r<i.length;r++){var s=i[r];if(null==s?void 0:s.items)for(var a=0,u=s.items;a<u.length;a++){t(s,u[a])}n(s)}o(e)},e}();t.UnorderedAnnotationResultsProcessor=o},function(e){e.exports=JSON.parse('{"version":"2.26.110"}')},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SingleItemWorkflow=void 0;var o=n(8),r=n(2),i=function(){function e(e,t){var n,r,i,s;this.kind=o.WorkflowKind.SingleItem,this.isStateful=!1,this.id=e,t&&(this.inputTypes=null!==(n=t.inputTypes)&&void 0!==n?n:this.inputTypes,this.outputTypes=null!==(r=t.outputTypes)&&void 0!==r?r:this.outputTypes,this.requestedContextTypesRules=null!==(i=t.requestedContextTypesRules)&&void 0!==i?i:this.requestedContextTypesRules,this.definitionOverrideTargetWorkflows=null!==(s=t.definitionOverrideTargetWorkflows)&&void 0!==s?s:this.definitionOverrideTargetWorkflows)}return e.create=function(t){return new e(t)},e.prototype.setInputTypes=function(e){return this.inputTypes=(0,r.buildArrayOfTypes)(e),this},e.prototype.setOutputTypes=function(e){return this.outputTypes=(0,r.buildArrayOfTypes)(e),this},e.prototype.setRequiredContextTypes=function(e){var t;return(null!==(t=this.requestedContextTypesRules)&&void 0!==t?t:this.requestedContextTypesRules=[]).push({contextTypes:e,cardinality:-3}),this},e.prototype.setOptionalContextTypes=function(e){var t;return(null!==(t=this.requestedContextTypesRules)&&void 0!==t?t:this.requestedContextTypesRules=[]).push({contextTypes:e,cardinality:-1}),this},e.prototype.setLambdaType=function(e){return this.factory=e,this},e.prototype.setDefinitionOverrideTargetWorkflows=function(e){return this.definitionOverrideTargetWorkflows=e,this},e.prototype.setLambda=function(e,t){return this.factory=function(){return{init:t||function(e){return Promise.resolve()},execute:e,dispose:function(){}}},this},e.prototype.validateOptions=function(){return{isValid:!0}},e}();t.SingleItemWorkflow=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JoinWorkflow=void 0;var o=n(8),r=n(2),i=function(){function e(e,t){var n,r,i,s;this.kind=o.WorkflowKind.Join,this.isStateful=!1,this.maxDelayMs=1e3,this.maxAnnotations=1,this.allowDefinitionOverride=!1,this.id=e,t&&(this.inputTypes=null!==(n=t.inputTypes)&&void 0!==n?n:this.inputTypes,this.outputTypes=null!==(r=t.outputTypes)&&void 0!==r?r:this.outputTypes,this.maxDelayMs=null!==(i=t.maxDelayMs)&&void 0!==i?i:this.maxDelayMs,this.requestedContextTypesRules=null!==(s=t.requestedContextTypesRules)&&void 0!==s?s:this.requestedContextTypesRules)}return e.create=function(t){return new e(t)},e.prototype.setCollectionScopeType=function(e){return this.collectionScopeType=e,this},e.prototype.setInputTypes=function(e){return this.inputTypes=(0,r.buildArrayOfTypes)(e),this},e.prototype.setOutputTypes=function(e){return this.outputTypes=(0,r.buildArrayOfTypes)(e),this},e.prototype.setMaxDelayTime=function(e){return this.maxDelayMs=e?Math.max(0,e):void 0,this},e.prototype.setMaxAnnotations=function(e){return this.maxAnnotations=e,this},e.prototype.setRequiredContextTypes=function(e){var t;return(null!==(t=this.requestedContextTypesRules)&&void 0!==t?t:this.requestedContextTypesRules=[]).push({contextTypes:e,cardinality:-3}),this},e.prototype.setOptionalContextTypes=function(e){var t;return(null!==(t=this.requestedContextTypesRules)&&void 0!==t?t:this.requestedContextTypesRules=[]).push({contextTypes:e,cardinality:-1}),this},e.prototype.setLambdaType=function(e){return this.factory=e,this},e.prototype.setAllowDefinitionOverride=function(){return this.allowDefinitionOverride=!0,this},e.prototype.setLambda=function(e,t){return this.factory=function(){return{init:t||function(e){return Promise.resolve()},execute:e,dispose:function(){}}},this},e.prototype.validateOptions=function(){return{isValid:!0}},e}();t.JoinWorkflow=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenCache=void 0;var o=n(2),r=function(){function e(e){void 0===e&&(e=33e5),this.tokenCache=new Map,this.requestMap=new Map,this.requestRecordMap=new Map,this.tokenExpirationMs=e}return e.prototype.updateAuthToken=function(e,t){var n=this,r=JSON.stringify(t),i=this.requestRecordMap.get(r);return(void 0===i||this.isTokenExpired(i))&&(i={requestPromise:e.requestAuthToken(t).then((function(e){if(!e||!e.Token)throw new Error("No token available for request "+r);n.tokenCache.set(r,e.Token)})),requestTime:o.Utils.getCurrentTimeMs()},this.requestRecordMap.set(r,i)),i.requestPromise},e.prototype.getAuthTokenEntries=function(e,t){var n=this;return Array.from(this.tokenCache.keys()).map((function(e){var t=n.requestMap.get(e);return void 0===t&&(t=JSON.parse(e),n.requestMap.set(e,t)),{requestKey:e,request:t}})).filter((function(e){var n=e.request;return!t||n.DocId===t})).map((function(t){var o=t.requestKey,r=t.request;return n.isTokenExpired(n.requestRecordMap.get(o))&&n.updateAuthToken(e,r),{ticket:r.Tickets[0],token:n.tokenCache.get(o)}}))},e.prototype.isTokenExpired=function(e){return o.Utils.getCurrentTimeMs()>e.requestTime+this.tokenExpirationMs},e}();t.TokenCache=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Net=void 0;var o=n(48);!function(e){e.httpProxy=function(e){var r=t(e),i=r[0],s=r[1],a=new o.Request(i,s);return o.fetch(a).then((function(e){return n(e)}))};var t=function(e){var t={method:e.method},n=new URL(e.url);if(e.body&&(t.body=e.body),e.headers){for(var o=[],r=0,i=e.headers;r<i.length;r++){var s=i[r],a=s.key,u=s.value;o.push([a,u])}t.headers=o}if(e.queryParameters)for(var c=0,l=e.queryParameters;c<l.length;c++){var p=l[c];n.searchParams.append(p.key,p.value)}return[n.toString(),t]},n=function(e){var t={data:e,httpStatusCode:e.status};if(e.headers){var n=[];e.headers.forEach((function(e,t){return n.push({key:t,value:e})})),t.headers=n}return t}}(t.Net||(t.Net={}))},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageType=t.ExceptionType=void 0,r(n(17),t),r(n(60),t);var i=n(18);Object.defineProperty(t,"ExceptionType",{enumerable:!0,get:function(){return i.ExceptionType}}),Object.defineProperty(t,"MessageType",{enumerable:!0,get:function(){return i.MessageType}}),r(n(61),t),r(n(62),t),r(n(63),t),r(n(64),t),r(n(19),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReduceTimerCache=void 0;var o=function(){function e(){this.cache=new Map}return e.prototype.setReduceTimer=function(e,t,n,o,r,i){var s=this;void 0===o&&(o=500),void 0===r&&(r=function(){return!1}),void 0===i&&(i=5e3),this.cache.has(e)||this.cache.set(e,new Map);var a=this.cache.get(e);a.has(t)&&clearTimeout(a.get(t).timer);var u=function(){var u=a.get(t),c=Date.now()-u.start;r()&&c<i?u.timer=setTimeout(u.timerCallback,Math.min(o,i-c)):(a.size>1?a.delete(t):s.cache.delete(e),n())};a.set(t,{start:Date.now(),timerCallback:u,timer:setTimeout(u,o)})},e.prototype.clear=function(e,t){this.cache.forEach((function(n,o){e&&e!==o||n.forEach((function(e,n){t&&t!==n||clearTimeout(e.timer)}))})),this.cache.clear()},e}();t.ReduceTimerCache=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.executeRemoteLambda=t.clearTokenCache=void 0;var o,r=n(0),i=n(9),s=n(4);t.clearTokenCache=function(){o=new i.TokenCache},(0,t.clearTokenCache)();var a=function(e,t,n,u,c,l,p,f,d,h){var g={method:"POST",headers:{"content-type":"application/json","X-CorrelationId":c},body:JSON.stringify({payload:t.payload,payloadSchema:n,requestedSchema:u,clientMetadata:l,tokens:o.getAuthTokenEntries(p,d.docId)})};(0,i.internalFetch)(e,g,(function(i,g){i?h(new Error("Fetch error in remote lambda request to "+e+": "+i)):401===g.status?f>0?(r.Log.info(572838109,r.LogCategory.CoreDefault,"Auth token required for remote lambda request"),g.json().then((function(e){return o.updateAuthToken(p,{Tickets:[e],DocId:d.docId})})).then((function(){a(e,t,n,u,c,l,p,f-1,d,h)})).catch((function(e){h({exceptionType:s.ExceptionType.Authentication,message:e.message})}))):h({exceptionType:s.ExceptionType.Authentication,message:"Remote lambda request retry with authentication token failed"}):g.ok?g.json().then((function(e){if(Array.isArray(e))if(e.length>0)for(var n=0,o=0,r=e;o<r.length;o++){var i=r[o];t.moreResults=++n<e.length,h(null,i)}else h(new Error("No output"));else h(new Error("Did not receive a valid response for remote lambda request"))})).catch((function(e){h({exceptionType:s.ExceptionType.LambdaThrow,message:e.message})})):h(new Error("Remote lambda request failed with status "+g.status))}))};t.executeRemoteLambda=function(e,t,n,r,i,u,c,l,p){Array.isArray(l.authTickets)?o.updateAuthToken(c,{Tickets:l.authTickets,DocId:l.docId}).then((function(){a(e,t,n,r,i.id,u,c,1,l,p)})).catch((function(e){p({exceptionType:s.ExceptionType.Authentication,message:e.message})})):a(e,t,n,r,i.id,u,c,1,l,p)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testWebSocketConnection=t.executeRemoteLambda=t.clearTokenCache=void 0;var o,r=n(0),i=n(9),s=n(4),a=n(170);t.clearTokenCache=function(){o=new i.TokenCache},(0,t.clearTokenCache)();var u=new a.WebSocketRequestManager(3e4,(function(){return new i.WebSocketWorker}),50),c=function(e,t,n,i,a,l,p,f,d,h){var g={payload:t.payload,payloadSchema:n,requestedSchema:i,clientMetadata:l,tokens:o.getAuthTokenEntries(p,d.docId)},m="";i&&i.schema&&(m=i.schema.name);var y=!1;u.addRequest(e,g,a,m,(function(u,g,m){if(!y)if(y=!0,null!=g)if(g.exceptionType===s.ExceptionType.Authentication)try{var v=JSON.parse(g.data);f>0?(r.Log.info(572838108,r.LogCategory.CoreDefault,"Auth token required for remote lambda WebSocket request"),o.updateAuthToken(p,{Tickets:[v],DocId:d.docId}).then((function(){c(e,t,n,i,a,l,p,f-1,d,h)})).catch((function(e){h({exceptionType:s.ExceptionType.Authentication,message:e.message})}))):h({exceptionType:s.ExceptionType.Authentication,message:"Remote lambda request retry with authentication token failed"})}catch(e){h({exceptionType:s.ExceptionType.Authentication,message:e.message})}else h(new Error("Error in remote lambda WebSocket request to "+e+": "+g));else t.moreResults=!1,h(null,u)}))};t.executeRemoteLambda=function(e,t,n,r,i,a,u,l,p){Array.isArray(l.authTickets)?o.updateAuthToken(u,{Tickets:l.authTickets,DocId:l.docId}).then((function(){c(e,t,n,r,i.id,a,u,1,l,p)})).catch((function(e){p({exceptionType:s.ExceptionType.Authentication,message:e.message})})):c(e,t,n,r,i.id,a,u,1,l,p)};t.testWebSocketConnection=function(e,t){return u.testConnection(e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketRequestManager=void 0;var o=n(0),r=n(9),i=function(){function e(e,t,n,o,r,i){this.requestId=e,this.correlationId=t,this.schemaName=n,this.data=o,this.callback=r,this.requestTimeoutInMs=i,this.ended=!1,this.startTime=0}return e.prototype.startRequest=function(){this.startTime=r.Utils.getCurrentTimeMs()},e.prototype.getMsUntilTimeout=function(){var e=r.Utils.getCurrentTimeMs()-this.startTime;return this.requestTimeoutInMs-e},e.prototype.endRequest=function(e){this.ended||(this.invokeCallback(null,e,!0),this.ended=!0)},e.prototype.addResponseData=function(e){this.invokeCallback(e,null,!1)},e.prototype.invokeCallback=function(e,t,n){var o=this;new Promise((function(){return o.callback(e,t,n)})).catch((function(e){}))},e}(),s=function(){function e(e,t,n){this.requestCounter=0,this.activeRequests=[],this.pendingRequests=[],this.requestTimeoutInMs=e,this.workerFactory=t,this.maxActiveRequests=n}return e.prototype.testConnection=function(e,t){var n=this,i=!1,s=new o.Operation({cv:(new o.CorrelationVector).toString(),operationName:"WebSocketTest",resourceId:e,success:!0}).start();return new Promise((function(a){var u=r.Utils.createHealthCheckRequest(t);e?n.addRequest(e,u,s.cv,"HealthCheckRequest",(function(e,t,n){t&&(s.success=!1,s.resultSignature="Error",s.resultDescription=t.message||t),e&&"OK"===e.status&&(i=!0),n&&(s.success&&!i&&(s.success=!1,s.resultSignature="NoResponseData"),o.Log.info(556617949,o.LogCategory.CoreDefault,s.stop()),a(s.success))})):(s.success=!1,s.resultSignature="EmptyUrl",o.Log.info(557641870,o.LogCategory.CoreDefault,s.stop()),a(s.success))}))},e.prototype.addRequest=function(e,t,n,o,r){var s=(this.requestCounter++).toString(),a=new i(s,n,o,t,r,this.requestTimeoutInMs);this.getWorker(e),this.pendingRequests.push(a),this.egressPendingRequests()},e.prototype.egressPendingRequests=function(){for(;this.pendingRequests.length>0&&this.activeRequests.length<this.maxActiveRequests;){var e=this.pendingRequests.shift();if(this.activeRequests.push(e),1===this.activeRequests.length){var t=e.getMsUntilTimeout();setTimeout(this.onTimeout.bind(this),t)}e.startRequest(),this.worker&&this.worker.egress(this.createRequestMessage(e.data,e.requestId,e.correlationId))}},e.prototype.createRequestMessage=function(e,t,n){return JSON.stringify({correlationId:n,requestId:t,body:e})},e.prototype.onTimeout=function(){for(;this.activeRequests.length>0;){var e=this.activeRequests[0],t=e.getMsUntilTimeout();if(!(t<=0))return void setTimeout(this.onTimeout.bind(this),t);var n=new Error("Request timed out");e.endRequest(n),this.activeRequests.shift(),this.egressPendingRequests()}},e.prototype.onMessage=function(e){try{for(var t=JSON.parse(e),n=0;n<this.activeRequests.length;n++){var r=this.activeRequests[n];if(r.requestId===t.requestId){t.end?(this.activeRequests.splice(n,1),r.endRequest(t.error),this.egressPendingRequests()):t.body&&r.addResponseData(t.body);break}}}catch(e){o.Log.error(557641871,o.LogCategory.CoreDefault,e)}},e.prototype.onClose=function(e){for(var t=new Error("Connection closed: "+e),n=0,o=this.activeRequests;n<o.length;n++){o[n].endRequest(t)}this.activeRequests=[];for(var r=0,i=this.pendingRequests;r<i.length;r++){i[r].endRequest(t)}this.pendingRequests=[],this.worker=void 0},e.prototype.getWorker=function(e){return this.worker||(this.worker=this.workerFactory(),this.worker.init(e,this.onMessage.bind(this),(function(){}),this.onClose.bind(this))),this.worker},e}();t.WebSocketRequestManager=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResultCache=void 0;var o=function(){function e(){this.cache=new Map,this.bucketSizes=new Map}return e.prototype.setBucketSize=function(e,t){this.bucketSizes.set(e,t)},e.prototype.setResult=function(e,t,n){if(t.primary){var o=this.cache.get(e);o||(o=new Map,this.cache.set(e,o));var r=o.get(t.primary);if(r||(r=t.secondary?new Map:[],o.set(t.primary,r)),t.secondary){r.set(t.secondary,n)}else{var i=r;i.length==this.getBucketSize(e)&&i.shift(),i.push(n)}}},e.prototype.getResults=function(e,t){var n=this.cache.get(e);if(n){var o=n.get(t.primary);if(o){if(!t.secondary)return o;var r=Array.from(o.values());if(r.length>0)return r}}return[]},e.prototype.clear=function(e,t){t?this.cache.forEach((function(n,o){if(!e||e===o)if(t.secondary){var r=n.get(t.primary);r&&r.delete(t.secondary)}else n.delete(t.primary)})):e?this.cache.delete(e):this.cache.clear()},e.prototype.getBucketSize=function(e){return this.bucketSizes.get(e)||10},e}();t.ResultCache=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExecutionWithThrottling=void 0;var o=n(9),r=function(){function e(){this.throttleInfoMap=new Map}return e.prototype.execute=function(e,t,n){var r=this;if(t.throttleSettings.shouldBeThrottled&&t.throttleSettings.throttlingInterval>0){var i=this.getWorkflowThrottleInfo(t.name);if(null==i.currentTileId)i.currentTileId=e,i.timeOfPreviousStartedEvent=o.Utils.getCurrentTimeMs(),n();else if(i.currentTileId===e){var s=o.Utils.getCurrentTimeMs(),a=this.delayTime(i,s,t.throttleSettings.throttlingInterval);a>0?(i.latestCallback=n,null==i.lastTimeout&&(i.lastTimeout=setTimeout((function(){var e=r.getWorkflowThrottleInfo(t.name);e.lastTimeout=void 0,e.timeOfPreviousStartedEvent=o.Utils.getCurrentTimeMs(),e.latestCallback()}),a))):(i.timeOfPreviousStartedEvent=s,n())}else null!=i.lastTimeout&&(clearTimeout(i.lastTimeout),i.latestCallback(),i.lastTimeout=void 0),i.currentTileId=e,i.timeOfPreviousStartedEvent=o.Utils.getCurrentTimeMs(),n()}else n()},e.prototype.delayTime=function(e,t,n){var o=t-e.timeOfPreviousStartedEvent;return Math.max(n-o,0)},e.prototype.getWorkflowThrottleInfo=function(e){var t=this.throttleInfoMap.get(e);return t||(t={currentTileId:void 0,timeOfPreviousStartedEvent:-1,latestCallback:function(){},lastTimeout:void 0},this.throttleInfoMap.set(e,t)),t},e}();t.ExecutionWithThrottling=r},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.configureRuntimeForAcronymsReduceWorkflow=t.configureRuntimeForAcronymsWorkflow=void 0;var i=n(1),s=n(14),a=n(174),u=n(175),c=n(206),l=n(65),p=n(66);t.configureRuntimeForAcronymsWorkflow=function(e,t){return o(void 0,void 0,void 0,(function(){var n,o,s,a,l,d,h,g,m;return r(this,(function(r){switch(r.label){case 0:return[4,t.IsFeatureEnabled("Microsoft.Office.Augloop.ShouldAcronymsUseLookupTable","None")];case 1:return n=r.sent(),o={name:"AcronymsLambdaBefore",source:i.LambdaSource.Custom,inputSchema:"Tiling.TextTileEvent",outputSchema:"Acronyms.Request",func:function(e,t,o,r){r((0,u.getAcronymsRequest)(e,o,n))}},[4,t.IsFeatureEnabled("Microsoft.Office.AugLoop.RemoteLambdaAuthTickets","Production")];case 2:return s=r.sent(),[4,t.IsFeatureEnabled("Microsoft.Office.AugLoop.AcronymsLocalLambda","None")];case 3:return a=r.sent(),[4,f(t,s,a)];case 4:return l=r.sent(),[4,t.IsFeatureEnabled("Microsoft.Office.AugLoop.AcronymsWordBatchedWorkflow","None")];case 5:return r.sent()?[4,(0,c.getBatchedLambda)(t,s)]:[3,7];case 6:return d=r.sent(),h=[],g={name:"AcronymsLocalLambda",inputSchema:"Tiling.TextTileEvent",outputSchema:"Tiling.TextTileEvent",source:i.LambdaSource.Local},a&&h.push(g),h.push(o),h.push(d),[2,e.registerMultipleLambdasWorkflow("AcronymsWorkflow",h,l)];case 7:return m={name:"AcronymsLambdaRemote",source:i.LambdaSource.Remote,inputSchema:"Acronyms.Request",outputSchema:"Acronyms.Response",authTickets:s?(0,p.getAuthTickets)():void 0},[2,e.registerSimpleRemoteWorkflow("AcronymsWorkflow",o,m,null,l)]}}))}))};var f=function(e,t,n){return o(void 0,void 0,void 0,(function(){var o;return r(this,(function(r){switch(r.label){case 0:return[4,d(e,t)];case 1:return o=r.sent(),[4,(0,l.getIntFeatureGatePromise)(e,7,"Microsoft.Office.Augloop.AcronymsThrottlingInterval")];case 2:return[2,{canProduceNullResult:!0,shouldSendResultsToHost:!0,enabledByDefault:!1,throttleSettings:{shouldBeThrottled:!0,throttlingInterval:1e3*r.sent()},licenseFeatures:[898989898],lookupTableLambda:o,triggerOnRefresh:n}]}}))}))},d=function(e,t){return o(void 0,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return[4,e.IsFeatureEnabled("Microsoft.Office.Augloop.AcronymsLookupTable","None")];case 1:return n.sent()?[2,{name:"AcronymsLambdaLookup",source:i.LambdaSource.Remote,inputSchema:"Acronyms.LookupRequest",outputSchema:"Acronyms.LookupResponse",authTickets:t?(0,p.getAuthTickets)():void 0}]:[2,void 0]}}))}))};t.configureRuntimeForAcronymsReduceWorkflow=function(e){var t={name:"AcronymsReduceLambda",source:i.LambdaSource.Custom,inputSchema:"Acronyms.Response",outputSchema:"Acronyms.CountReduceOutput",func:function(e,t,n,o){o((0,a.getReduceOutput)(e))}},n={canProduceNullResult:!1,shouldSendResultsToHost:!0,enabledByDefault:!1,throttleSettings:{shouldBeThrottled:!1},licenseFeatures:[898989898]};return e.registerReduceWorkflow("AcronymsReduceWorkflow",t,s.textTileGroupingKeyExtractor,10,n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getReduceOutput=void 0;t.getReduceOutput=function(e){var t=new Map,n=!1,o=new Map;if(e&&Array.isArray(e.values))for(var r=0,i=0,s=e.values;i<s.length;i++){var a=s[i];if(a&&Array.isArray(a.acronyms)){r+=a.acronyms.length;for(var u=function(e){if(void 0!==e.annotationId&&e.annotationId.indexOf("=")>=0){var n=e.annotationId.substring(0,e.annotationId.indexOf("=")),r=t.get(n);t.set(n,void 0===r?1:r+1);var i=void 0;if(Array.isArray(a.annotations)){var s=a.annotations.filter((function(t){return t.annotationId===e.annotationId}));1===s.length&&s[0]&&s[0].tileInfo&&s[0].tileInfo.tileId&&(i=s[0].tileInfo.tileId)}if(!o.has(n)){var u={paragraphId:i,acronym:n,expansions:[],sourceTransactionId:a.transactionId};o.set(n,u)}var c=o.get(n).expansions;if(c.every((function(t){return t.name!==e.name}))){var l={name:e.name,description:e.description,sourceType:e.sourceType,sourceEmail:e.sourceEmail,sourceFile:e.sourceFile,sourceAdmin:e.sourceAdmin,score:e.score,instrumentationId:e.instrumentationId,sourceTransactionIds:[a.transactionId]};c.push(l)}}},c=0,l=a.acronyms;c<l.length;c++){u(l[c])}(r>=10||t.size>=3)&&(n=!0)}}var p=[];return o.forEach((function(e,t){p.push(e)})),{acronymsThresholdHit:n,paragraphAcronyms:0===o.size?[]:p}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAcronymsRequest=void 0;var o=n(11),r=n(205),i=/(\b[0-9A-Z][A-Z/\.]*([a-z/]){0,3}[A-Z0-9/\.]*[- #\s&\+]?[A-Z0-9/\.]*[- #\s&\+]?[A-Z0-9/\.]*([a-z/]){0,50}[A-Z0-9\./]*([a-z/]){0,50}[\.]?s?([\+]|([\.])|\b))/,s=/(\b(([A-Z]([a-z/]){0,50})|([0-9])*)[\.]?s?([\+]|([\.])|\b))/,a=function(e){if(!e)return[];var t=e.trim().split(/[\s,?!'"]/g);return t.length>1&&(0,r.isStringAllUpperCase)(e)?[]:t.filter((function(e){return e&&function(e){if(!e)return!1;e=(0,r.trimCharsFromString)(e,[" ","","."]);var t=i.exec(e),n=t&&t.length>0?t[0].trim():"",o=s.exec(e),a=o&&o.length>0?o[0].trim():"";return n===e&&n.length>1&&n.length<=20&&a!==e}(e)}))};t.getAcronymsRequest=function(e,t,n){if(!e||!e.tile||!e.tile.metadata)return null;if(e.type===o.Tiling.TextTileEventType.Delete)return null;var r=e.tile.elements;if(!Array.isArray(r)||0===r.length)return null;var i=a(r.map((function(e){return e.text})).join(" "));if(!i.length)return null;if(t&&t.lookupTable&&t.lookupTable.acronymsMap&&n){var s=t.lookupTable.acronymsMap;if(i.every((function(e){return!u(e,s)})))return null}return{documentId:e.tile.metadata.docId,documentSessionId:e.tile.metadata.docSessionId,tiles:[e.tile]}};var u=function(e,t){return void 0!==t[e]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Classification=void 0,function(e){!function(e){e[e.Unknown=0]="Unknown",e[e.FullDocument=1]="FullDocument",e[e.PartialDocument=2]="PartialDocument"}(e.SensitiveTypeScope||(e.SensitiveTypeScope={}))}(t.Classification||(t.Classification={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditorService=void 0,function(e){!function(e){e[e.ActiveMonitoring=0]="ActiveMonitoring",e[e.Test=1]="Test",e[e.User=2]="User",e[e.Observer=3]="Observer",e[e.Watchdog=4]="Watchdog"}(e.ClientType||(e.ClientType={})),function(e){e[e.High=0]="High",e[e.Medium=1]="Medium",e[e.Low=2]="Low"}(e.ConfidenceLevel||(e.ConfidenceLevel={})),function(e){e[e.NotificationOnly=0]="NotificationOnly",e[e.Delete=1]="Delete",e[e.Ignore=2]="Ignore",e[e.IgnoreAll=4]="IgnoreAll",e[e.IgnoreCritiqueType=8]="IgnoreCritiqueType",e[e.AddToDictionary=16]="AddToDictionary",e[e.ShowDetails=32]="ShowDetails"}(e.CritiqueActionFlags||(e.CritiqueActionFlags={})),function(e){e[e.None=0]="None",e[e.Active=1]="Active",e[e.Provisional=2]="Provisional"}(e.CritiqueStatus||(e.CritiqueStatus={})),function(e){e[e.None=0]="None",e[e.Consistency=1]="Consistency"}(e.CritiqueTagFlags||(e.CritiqueTagFlags={})),function(e){e[e.High=0]="High",e[e.Medium=1]="Medium",e[e.Low=2]="Low",e[e.Informational=3]="Informational"}(e.Priority||(e.Priority={})),function(e){e[e.Success=0]="Success",e[e.PartialSuccess=1]="PartialSuccess",e[e.Error=2]="Error",e[e.Disabled=3]="Disabled"}(e.ResponseStatus||(e.ResponseStatus={})),function(e){e[e.None=0]="None",e[e.ChangeOnce=1]="ChangeOnce",e[e.ChangeAll=2]="ChangeAll",e[e.AutoCorrect=4]="AutoCorrect",e[e.ReadAloud=8]="ReadAloud"}(e.SuggestionActionFlags||(e.SuggestionActionFlags={})),function(e){e[e.Default=0]="Default",e[e.Word=1]="Word",e[e.Phrase=2]="Phrase",e[e.Sentence=4]="Sentence",e[e.Paragraph=8]="Paragraph",e[e.Page=16]="Page",e[e.Section=32]="Section",e[e.Chapter=64]="Chapter",e[e.Document=256]="Document",e[e.RawChars=16384]="RawChars"}(e.TextUnitFlags||(e.TextUnitFlags={})),function(e){e[e.Unknown=0]="Unknown",e[e.Paragraph=1]="Paragraph",e[e.Group=2]="Group",e[e.Page=3]="Page",e[e.Document=4]="Document"}(e.TopologyNodeType||(e.TopologyNodeType={})),function(e){e[e.Unknown=0]="Unknown",e[e.DocumentText=1]="DocumentText"}(e.TilingType||(e.TilingType={})),function(e){e[e.High=0]="High",e[e.Medium=1]="Medium",e[e.Low=2]="Low",e[e.Informational=3]="Informational"}(e.ReadingCritiquePriority||(e.ReadingCritiquePriority={})),function(e){e[e.Default=0]="Default",e[e.Word=1]="Word",e[e.Phrase=2]="Phrase",e[e.Sentence=4]="Sentence",e[e.Paragraph=8]="Paragraph",e[e.Page=16]="Page",e[e.Section=32]="Section",e[e.Chapter=64]="Chapter",e[e.Document=256]="Document",e[e.RawChars=16384]="RawChars"}(e.TileNodeType||(e.TileNodeType={})),function(e){e[e.Undefined=0]="Undefined",e[e.Word=1]="Word",e[e.Phrase=2]="Phrase",e[e.Sentence=4]="Sentence",e[e.Paragraph=8]="Paragraph"}(e.TextUnit||(e.TextUnit={}))}(t.EditorService||(t.EditorService={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Guardlist=void 0,function(e){!function(e){e[e.Unknown=0]="Unknown",e[e.HighRisk=1]="HighRisk",e[e.SometimesProblematic=2]="SometimesProblematic",e[e.ContextDependent=3]="ContextDependent"}(e.TermType||(e.TermType={})),function(e){e[e.Category=0]="Category",e[e.Language=1]="Language"}(e.TermMetadataKeys||(e.TermMetadataKeys={})),function(e){e[e.Abuse=0]="Abuse",e[e.Child_Endangerment=1]="Child_Endangerment",e[e.Country_Name=2]="Country_Name",e[e.Criminal=3]="Criminal",e[e.Drugs=4]="Drugs",e[e.Famous_People=5]="Famous_People",e[e.General=6]="General",e[e.Geopolitical=7]="Geopolitical",e[e.Human_Identity=8]="Human_Identity",e[e.Medical=9]="Medical",e[e.Mildly_Objectionable=10]="Mildly_Objectionable",e[e.Narcotics=11]="Narcotics",e[e.Objectionable=12]="Objectionable",e[e.Polarizing=13]="Polarizing",e[e.Political=14]="Political",e[e.Profanity=15]="Profanity",e[e.Proper_Name=16]="Proper_Name",e[e.Religion_Spirituality=17]="Religion_Spirituality",e[e.Self_Harm=18]="Self_Harm",e[e.Sensitive_Topics=19]="Sensitive_Topics",e[e.Sexual_Content=20]="Sexual_Content",e[e.Sexually_Explicit=21]="Sexually_Explicit",e[e.Sexually_NonExplicit=22]="Sexually_NonExplicit",e[e.Slang_Jargon=23]="Slang_Jargon",e[e.Technical_Clinical=24]="Technical_Clinical",e[e.Violence=25]="Violence",e[e.Weapons=26]="Weapons"}(e.TermCategory||(e.TermCategory={}))}(t.Guardlist||(t.Guardlist={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageToTable=void 0,function(e){!function(e){e[e.Unknown=-1]="Unknown",e[e.Success=0]="Success",e[e.UploadFailed=1]="UploadFailed",e[e.ConversionFailed=2]="ConversionFailed"}(e.ConversionErrorCode||(e.ConversionErrorCode={}))}(t.ImageToTable||(t.ImageToTable={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QAS=void 0,function(e){!function(e){e[e.Numeric=0]="Numeric",e[e.Match=1]="Match",e[e.String=2]="String"}(e.FeatureType||(e.FeatureType={}))}(t.QAS||(t.QAS={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeNLP=void 0,function(e){!function(e){e[e.None=0]="None",e[e.SentenceBreaking=1]="SentenceBreaking",e[e.Tokenization=2]="Tokenization",e[e.ValidateUserVisibleString=3]="ValidateUserVisibleString",e[e.ValidateUserInputString=4]="ValidateUserInputString"}(e.Operation||(e.Operation={}))}(t.OfficeNLP||(t.OfficeNLP={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Proofing=void 0,function(e){!function(e){e[e.NoLicense=0]="NoLicense",e[e.Perpetual=1]="Perpetual",e[e.Subscription=2]="Subscription"}(e.LicenseType||(e.LicenseType={})),function(e){e[e.NotApplicable=0]="NotApplicable",e[e.High=1]="High",e[e.Medium=2]="Medium",e[e.Low=3]="Low"}(e.ConfidenceLevel||(e.ConfidenceLevel={})),function(e){e[e.None=0]="None",e[e.Active=1]="Active",e[e.Provisional=2]="Provisional"}(e.CritiqueStatus||(e.CritiqueStatus={})),function(e){e[e.High=0]="High",e[e.Medium=1]="Medium",e[e.Low=2]="Low",e[e.Informational=3]="Informational"}(e.CritiquePriority||(e.CritiquePriority={}))}(t.Proofing||(t.Proofing={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResumeAnalysis=void 0,function(e){!function(e){e[e.No=0]="No",e[e.Maybe=1]="Maybe",e[e.Yes=2]="Yes"}(e.ClassificationResult||(e.ClassificationResult={})),function(e){e[e.Success=0]="Success",e[e.PartialSuccess=1]="PartialSuccess",e[e.Error=2]="Error",e[e.Disabled=3]="Disabled",e[e.ResumeClassifierNotRan=4]="ResumeClassifierNotRan"}(e.Status||(e.Status={}))}(t.ResumeAnalysis||(t.ResumeAnalysis={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Skills=void 0,function(e){!function(e){e[e.None=0]="None",e[e.Low=1]="Low",e[e.Medium=2]="Medium",e[e.High=3]="High"}(e.ConfidenceLevel||(e.ConfidenceLevel={})),function(e){e[e.NoIntent=0]="NoIntent",e[e.ReuseSlides=1]="ReuseSlides"}(e.IntentType||(e.IntentType={})),function(e){e[e.NullSignal=0]="NullSignal",e[e.CommandClick=1]="CommandClick",e[e.Activity=2]="Activity",e[e.TabSetActivate=3]="TabSetActivate",e[e.Search=4]="Search"}(e.SignalType||(e.SignalType={})),function(e){e[e.NullSurface=0]="NullSurface",e[e.SmartLookup=1]="SmartLookup",e[e.Tap=2]="Tap",e[e.TellMe=3]="TellMe",e[e.Canvas=4]="Canvas"}(e.SurfaceType||(e.SurfaceType={})),function(e){e[e.NotSet=0]="NotSet",e[e.Timeout=1]="Timeout",e[e.NetworkError=2]="NetworkError",e[e.ServiceError=3]="ServiceError",e[e.ParsingError=4]="ParsingError",e[e.AuthenticationError=5]="AuthenticationError",e[e.UnhandledException=6]="UnhandledException"}(e.ProviderErrorType||(e.ProviderErrorType={})),function(e){e[e.Invalid=0]="Invalid",e[e.Success=1]="Success",e[e.Error=2]="Error",e[e.Pending=3]="Pending",e[e.NoResult=4]="NoResult"}(e.ProviderResultStatus||(e.ProviderResultStatus={}))}(t.Skills||(t.Skills={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Text=void 0,function(e){!function(e){e[e.NotApplicable=0]="NotApplicable",e[e.High=1]="High",e[e.Medium=2]="Medium",e[e.Low=3]="Low"}(e.ConfidenceLevel||(e.ConfidenceLevel={})),function(e){e[e.None=0]="None",e[e.Active=1]="Active",e[e.Provisional=2]="Provisional"}(e.AnnotationStatus||(e.AnnotationStatus={})),function(e){e[e.High=0]="High",e[e.Medium=1]="Medium",e[e.Low=2]="Low",e[e.Informational=3]="Informational"}(e.AnnotationPriority||(e.AnnotationPriority={}))}(t.Text||(t.Text={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.trimCharsFromString=t.isStringAllUpperCase=void 0;t.isStringAllUpperCase=function(e){return!!e&&e===e.toUpperCase()};t.trimCharsFromString=function(e,t){if(!e)return e;for(var n=0,o=e.length-1;-1!==t.indexOf(e[n])&&n<o;)n++;for(;-1!==t.indexOf(e[o])&&o>=n;)o--;return e.substring(n,o+1)}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.getBatchedLambda=t.multiplex=t.demultiplex=t.groupingKeyExtractor=t.estimateSize=void 0;var i=n(1),s=n(65),a=n(15),u=n(66);t.estimateSize=function(e){try{return e.tiles[0].elements[0].text.length}catch(e){throw new Error("invalid estimateSize input ".concat(e))}};t.groupingKeyExtractor=function(e){return(0,a.expectDefinedAndNotNull)("request",e),e.documentId};t.demultiplex=function(e){return(0,a.expectDefinedAndNotNull)("acronymsBatchResponse",e),e.responses};t.multiplex=function(e){return{input:{requests:e},demultiplex:t.demultiplex}};t.getBatchedLambda=function(e,n){return o(void 0,void 0,void 0,(function(){var o,a,c,l;return r(this,(function(r){switch(r.label){case 0:return[4,(0,s.getIntFeatureGatePromise)(e,7,"Microsoft.Office.Augloop.AcronymsBatchingInterval")];case 1:return o=r.sent(),[4,(0,s.getIntFeatureGatePromise)(e,7,"Microsoft.Office.Augloop.AcronymsBatchingSizeInKB")];case 2:return a=r.sent(),c=0===o?1:o,l=0===a?20:a,[2,{name:"AcronymsLambdaRemoteBatched",source:i.LambdaSource.BatchedRemote,inputSchema:"Acronyms.Request",outputSchema:"Acronyms.Response",remoteInputSchema:"Acronyms.BatchRequest",remoteOutputSchema:"Acronyms.BatchResponse",authTickets:n?(0,u.getAuthTickets)():void 0,batchOptions:{delayMs:1e3*c,maxInputSize:1024*l,estimateSize:t.estimateSize,groupingKeyExtractor:t.groupingKeyExtractor,multiplex:t.multiplex}}]}}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.configureRuntimeForSavePromptReduceWorkflow=t.generateReduceOutput=t.configureRuntimeForSavePromptWorkflow=t.calcTextProperties=void 0;var o=n(1),r=n(14);t.calcTextProperties=function(e){if(null===e)throw new Error("savepromptRequest must be defined and non null");var t=e.tiles;if(t&&!(t.length<1)){if(t.length>1)throw new Error("There are more than 1 tiles in input. Expecting max 1 tile");for(var n="",o=0,r=t[0].elements;o<r.length;o++){var i=r[o];i.text&&(n+=n?"\n"+i.text:i.text)}return{rowCount:function(e){return""===(e=e.replace(/(^\s*)|(\s*$)/gi,""))?0:e.split(/\r\n|\r|\n/).length}(n),wordCount:function(e){return(e=(e=(e=(e=(e=(e=e.replace(/(^\s*)|(\s*$)/gi,"")).replace(/[ ]{2,}/gi," ")).replace(/\n /gi,"\n")).replace(/\r /gi,"\r")).replace(/\r\n /gi,"\r\n")).replace(/\r\n|\r|\n/gi," ")).split(" ").filter((function(e){return""!==e})).length}(n),charCount:n.length,documentId:e.documentId}}};t.configureRuntimeForSavePromptWorkflow=function(e){var n={name:"SavePromptLambdaBefore",source:o.LambdaSource.Custom,inputSchema:"Tiling.TextTileEvent",outputSchema:"SavePrompt.Request",func:function(e,t,n,o){o(function(e){if(!e||!e.tile||!e.tile.metadata)return null;var t=e.tile.elements;return Array.isArray(t)&&0!==t.length?{documentId:e.tile.metadata.docId,documentSessionId:e.tile.metadata.docSessionId,tiles:[e.tile]}:null}(e))}},r={name:"SavePromptLambdaNew",source:o.LambdaSource.Custom,inputSchema:"SavePrompt.Request",outputSchema:"SavePrompt.Response",func:function(e,n,o,r){r((0,t.calcTextProperties)(e))}};return e.registerSimpleRemoteWorkflow("SavePromptWorkflow",n,r,null,{canProduceNullResult:!1,shouldSendResultsToHost:!0,enabledByDefault:!1,throttleSettings:{shouldBeThrottled:!0,throttlingInterval:7e3},licenseFeatures:[]})};t.generateReduceOutput=function(e){var t=!1,n=0,o=0,r=0;if(e&&Array.isArray(e.values)){for(var i=0,s=e.values;i<s.length;i++){var a=s[i];a&&(n+=a.rowCount,o+=a.wordCount,r+=a.charCount)}t=r>=300}return{thresholdHit:t,rowCount:n,wordCount:o,charCount:r}};t.configureRuntimeForSavePromptReduceWorkflow=function(e){var n={name:"SavePromptReduceLambda",source:o.LambdaSource.Custom,inputSchema:"SavePrompt.Response",outputSchema:"SavePrompt.ReduceCountSignal",func:function(e,n,o,r){r((0,t.generateReduceOutput)(e))}};return e.registerReduceWorkflow("SavePromptReduceWorkflow",n,r.textTileGroupingKeyExtractor,10,{canProduceNullResult:!1,shouldSendResultsToHost:!0,enabledByDefault:!1,throttleSettings:{shouldBeThrottled:!1},licenseFeatures:[]})}},function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.getEnvironment=t.Environment=void 0,function(e){e[e.dev=0]="dev",e[e.int=1]="int",e[e.test=2]="test",e[e.dogfood=3]="dogfood",e[e.prod=4]="prod",e[e.gcc=5]="gcc",e[e.dod=6]="dod",e[e.gccHigh=7]="gccHigh"}(o=t.Environment||(t.Environment={}));t.getEnvironment=function(e){return e?e.indexOf("augloop.office.com")>=0?o.prod:e.indexOf("augloop-gcc.office.com")>=0?o.gcc:e.indexOf("augloop.gov.online.office365.us")>=0?o.gccHigh:e.indexOf("augloop.dod.online.office365.us")>=0?o.dod:e.indexOf("localhost:20080")>=0?o.dev:e.indexOf("augloop-dogfood.officeppe.com")>=0?o.dogfood:e.indexOf("augloop-int.officeppe.com")>=0?o.int:-1:-1}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.configureRuntimeForClpWorkflows=void 0;var i=n(210),s=n(211),a=n(13),u=n(12);t.configureRuntimeForClpWorkflows=function(e,t,n,c,l,p,f){return o(this,void 0,void 0,(function(){var o,d,h,g,m,y,v,S,T;return r(this,(function(r){switch(r.label){case 0:return a.clpGlobals.officeUILanguage=t.uiLanguage,a.clpGlobals.serviceUrl=n,[4,f.IsFeatureEnabled("Microsoft.Office.Security.CLP.FG.AutoCLPV2Transition","None")];case 1:return r.sent()?[2]:(o=(0,u.isWin32)(t.appPlatform),d=!(!1===t.privateMode),"Word"!==t.appName&&"Outlook"!==t.appName||!o&&"Mac"!==t.appPlatform?[3,7]:[4,Promise.all([f.IsFeatureEnabled("Microsoft.Office.AugLoop.EnableLocalClassificationFallback","None"),o||f.IsFeatureEnabled("Microsoft.Office.AugLoop.RemoteLambdaAuthTickets","Production")])]);case 2:return h=r.sent(),g=h[0],T=h[1],m="Word"===t.appName&&o,d?[3,5]:[4,Promise.all([l,p])];case 3:return y=r.sent(),v=y[0],S=y[1],[4,Promise.all([(0,i.registerClassificationServiceBackedBatchedWorkflowWord)(e,v,S,T),(0,i.registerClassificationReduceWorkflowWord)(e,T,!0,a.clpGlobals.maxReduceDelayUntilIdleSeconds)])];case 4:return r.sent(),[3,7];case 5:return(d||g)&&m?[4,Promise.all([(0,i.registerClassificationLocalBackedWorkflowWord)(e,c),(0,i.registerClassificationReduceWorkflowWord)(e,T)])]:[3,7];case 6:r.sent(),r.label=7;case 7:return"PowerPoint"!==t.appName||!o&&"Mac"!==t.appPlatform?[3,12]:[4,o||f.IsFeatureEnabled("Microsoft.Office.AugLoop.RemoteLambdaAuthTickets","Production")];case 8:return T=r.sent(),d?[3,10]:[4,Promise.all([(0,s.registerClassificationServiceBackedWorkflowPpt)(e,c,T),(0,s.registerClassificationReduceWorkflowPpt)(e,T)])];case 9:return r.sent(),[3,12];case 10:return o?[4,Promise.all([(0,s.registerClassificationLocalBackedWorkflowPpt)(e,c),(0,s.registerClassificationReduceWorkflowPpt)(e,T)])]:[3,12];case 11:r.sent(),r.label=12;case 12:return[2]}}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.registerClassificationServiceBackedBatchedWorkflowWord=t.registerClassificationReduceWorkflowWord=t.registerClassificationLocalBackedWorkflowWord=void 0;var o=n(1),r=n(11),i=n(12),s=n(67),a=n(13),u="Tiling.TextTileEvent";t.registerClassificationLocalBackedWorkflowWord=function(e,t){var n=[],r={name:"LocalClassificationLambdaBefore",source:o.LambdaSource.Custom,inputSchema:u,outputSchema:u,func:function(e,t,n,o){o((0,i.fixKnownErrorsForTextTileEventAndIgnoreIfTrivial)(e))}};n.push(r);var s={name:"ClpLocalClassification",inputSchema:u,outputSchema:a.clpGlobals.classificationResponse,source:o.LambdaSource.Local};return n.push(s),t.then((function(t){var o={canProduceNullResult:!0,shouldSendResultsToHost:!1,enabledByDefault:!1,throttleSettings:{shouldBeThrottled:!0,throttlingInterval:1e3*t},licenseFeatures:a.clpGlobals.autoClpLicenseFeatures,docIdExtractor:function(e){return e&&e.tile&&e.tile.metadata?e.tile.metadata.docId:void 0}};return e.registerMultipleLambdasWorkflow("ClassificationWordLocalWorkflow",n,o)}))};t.registerClassificationReduceWorkflowWord=function(e,t,n,r){void 0===n&&(n=!1),void 0===r&&(r=0);var u={name:"ClassificationReduceLambdaBefore",source:o.LambdaSource.Custom,inputSchema:a.clpGlobals.classificationResponse,outputSchema:a.clpGlobals.classificationReduce,func:function(e,t,n,o,r){if(a.clpGlobals.documents.has(e.id)||a.clpGlobals.documents.set(e.id,new i.DocumentMetadata(0)),0===(0,i.getSensitiveItemsCount)(e)){r((0,i.getEmptyLabellingEditorUIResponse)(e.id),a.clpGlobals.labellingEditorUIResponse)}else{var s=e.values.filter((function(e){return null!==e}));o({id:e.id,classficationResponses:s,suppressSensitiveItems:[],officeUILanguage:a.clpGlobals.officeUILanguage,requestSequence:(0,i.getNewRequestSequence)(e.id)})}}},c={canProduceNullResult:!0,shouldSendResultsToHost:!0,enabledByDefault:!0,licenseFeatures:a.clpGlobals.autoClpLicenseFeatures,triggerOnRefresh:n,deferReduceUntilIdle:r>0,deferReduceUntilIdleMaxDelayMs:1e3*r,docIdExtractor:function(e){return e?a.clpGlobals.docSessionIdToDocIdMap.get(e.id):void 0}};return t&&(0,i.setAuthTicketsOnSharedLambda)(s.classificationReduceRemoteLambda),e.registerMultipleLambdasReduceWorkflow("ClassificationReduceWordWorkflow",[u,s.classificationReduceRemoteLambda,s.classificationReduceLambdaGetEditorUIResponse],i.clpTextTileGroupingKeyExtractor,null,c)};var c=function(e,t){return e>0?e:t};t.registerClassificationServiceBackedBatchedWorkflowWord=function(e,t,n,s){var l=[],p={name:"ClassificationLambdaBefore",source:o.LambdaSource.Custom,inputSchema:u,outputSchema:u,func:function(e,t,n,o){o((0,i.fixKnownErrorsForTextTileEventAndIgnoreIfTrivial)(e))}};l.push(p),t=c(t,a.clpGlobals.defaultBatchIntervalSeconds),n=c(n,a.clpGlobals.defaultBatchSizeKB);var f={name:"ClassificationLambdaRemoteBatched",source:o.LambdaSource.BatchedRemote,inputSchema:u,outputSchema:a.clpGlobals.classificationResponse,remoteInputSchema:"Tiling.BatchTextTileEvent",remoteOutputSchema:a.clpGlobals.classificationBatchedResponse,authTickets:s?(0,i.getAuthTickets)():void 0,batchOptions:{delayMs:1e3*t,maxInputSize:1024*n,estimateSize:function(e){return e.tile.elements[0].text.length},groupingKeyExtractor:function(e){var t;return null!==(t=e.tile.metadata.docSessionId)&&void 0!==t?t:e.tile.metadata.docId},summaryExtractor:function(e){for(var t=[void 0,void 0],n=!1,o={sensitiveItems:[]},i=0,s=e.responses;i<s.length;i++)for(var a=0,u=s[i].sensitiveItems;a<u.length;a++){var c=u[a];c.scope===r.Classification.SensitiveTypeScope.FullDocument&&(n=!0,o.sensitiveItems.push(c))}return n?["Classification.Response",o]:t},multiplex:function(e){return{input:{textTileEvents:e,refreshEnabled:!0},demultiplex:function(e){for(var t=[],n=0,o=e.responses;n<o.length;n++){for(var i=[],s=0,a=o[n].sensitiveItems;s<a.length;s++){var u=a[s];u.scope===r.Classification.SensitiveTypeScope.PartialDocument&&i.push(u)}t.push({sensitiveItems:i})}return t}}}}};l.push(f);var d={canProduceNullResult:!0,shouldSendResultsToHost:!1,enabledByDefault:!0,triggerOnRefresh:!0,throttleSettings:{shouldBeThrottled:!0,throttlingInterval:1e3*(t+1)},licenseFeatures:a.clpGlobals.autoClpLicenseFeatures,useCanaryTextTile:!0,docIdExtractor:function(e){return e&&e.tile&&e.tile.metadata?e.tile.metadata.docId:void 0}};return e.registerMultipleLambdasWorkflow("ClassificationWordBatchedWorkflow",l,d)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.registerClassificationReduceWorkflowPpt=t.registerClassificationLocalBackedWorkflowPpt=t.registerClassificationServiceBackedWorkflowPpt=void 0;var o=n(1),r=n(12),i=n(15),s=n(67),a=n(14),u=n(13);t.registerClassificationServiceBackedWorkflowPpt=function(e,t,n){var s={name:"ClassificationLambdaPptBefore",source:o.LambdaSource.Custom,inputSchema:"ClpSlideTile",outputSchema:"Ppt.SlideTile",func:function(e,t,n,o){o((0,i.fixKnownErrorsForSlideTile)(e))}},a={name:"ClassificationLambdaRemote",source:o.LambdaSource.Remote,inputSchema:"Ppt.SlideTile",outputSchema:u.clpGlobals.classificationResponse,authTickets:n?(0,r.getAuthTickets)():void 0};return t.then((function(t){var n={canProduceNullResult:!0,shouldSendResultsToHost:!1,enabledByDefault:!0,throttleSettings:{shouldBeThrottled:!0,throttlingInterval:1e3*t},licenseFeatures:u.clpGlobals.autoClpLicenseFeatures,docIdExtractor:function(e){return e?e.docId:void 0}};return e.registerSimpleRemoteWorkflow("ClassificationPptWorkflow",s,a,null,n)}))};t.registerClassificationLocalBackedWorkflowPpt=function(e,t){var n=[],r={name:"ClassificationLambdaPptBefore",source:o.LambdaSource.Custom,inputSchema:"ClpSlideTile",outputSchema:"Ppt.SlideTile",func:function(e,t,n,o){o((0,i.fixKnownErrorsForSlideTile)(e))}};n.push(r);var s={name:"ClpLocalClassification",inputSchema:"ClpSlideTile",outputSchema:u.clpGlobals.classificationResponse,source:o.LambdaSource.Local};return n.push(s),t.then((function(t){var o={canProduceNullResult:!0,shouldSendResultsToHost:!0,enabledByDefault:!0,throttleSettings:{shouldBeThrottled:!0,throttlingInterval:1e3*t},licenseFeatures:u.clpGlobals.autoClpLicenseFeatures,docIdExtractor:function(e){return e?e.docId:void 0}};return e.registerMultipleLambdasWorkflow("ClassificationPptLocalWorkflow",n,o)}))};var c={name:"ClassificationReduceLambdaBefore",source:o.LambdaSource.Custom,inputSchema:u.clpGlobals.classificationResponse,outputSchema:u.clpGlobals.classificationReduce,func:function(e,t,n,o,i){if(u.clpGlobals.documents.has(e.id)||u.clpGlobals.documents.set(e.id,new r.DocumentMetadata(0)),0===(0,r.getSensitiveItemsCount)(e)){var s=(0,r.getEmptyLabellingEditorUIResponse)(e.id),a=u.clpGlobals.documents.get(e.id);a.getPreviousCacheSensitiveItems()&&a.getPreviousCacheSensitiveItems().clear(),i(s,u.clpGlobals.labellingEditorUIResponse)}else if((0,r.isCacheModified)(e)){var c=e.values.filter((function(e){return null!==e}));o({id:e.id,classficationResponses:c,suppressSensitiveItems:[],officeUILanguage:u.clpGlobals.officeUILanguage,requestSequence:(0,r.getNewRequestSequence)(e.id)})}else o(null)}};t.registerClassificationReduceWorkflowPpt=function(e,t){var n={canProduceNullResult:!0,shouldSendResultsToHost:!0,enabledByDefault:!0,licenseFeatures:u.clpGlobals.autoClpLicenseFeatures,docIdExtractor:function(e){return e?e.id:void 0}};return t&&(0,r.setAuthTicketsOnSharedLambda)(s.classificationReduceRemoteLambda),e.registerMultipleLambdasReduceWorkflow("ClassificationReducePptWorkflow",[c,s.classificationReduceRemoteLambda,s.classificationReduceLambdaGetEditorUIResponse],a.slideTileGroupingKeyExtractor,null,n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.configureRuntimeForAUXv3PPTWorkflow=void 0;var o=n(1);t.configureRuntimeForAUXv3PPTWorkflow=function(e){var t={name:"AUXv3PPTLambdaBefore",source:o.LambdaSource.Custom,inputSchema:"CommandPredict",outputSchema:"CommandPredictRequest",func:function(e,t,n,o){o(e||null)}},n={name:"AUXv3PPTLambdaRemote",source:o.LambdaSource.Remote,inputSchema:"CommandPredictRequest",outputSchema:"AUXv3Response"};return e.registerSimpleRemoteWorkflow("AUXv3PPTWorkflow",t,n,null)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.configureRuntimeForTopCommandsPerUserPPTWorkflow=void 0;var o=n(1);t.configureRuntimeForTopCommandsPerUserPPTWorkflow=function(e){var t={name:"TopCommandsPerUserPPTLambdaBefore",source:o.LambdaSource.Custom,inputSchema:"TopCommandsPerUser",outputSchema:"TopCommandsPerUserRequest",func:function(e,t,n,o){o(e||null)}},n={name:"TopCommandsPerUserPPTLambdaRemote",source:o.LambdaSource.Remote,inputSchema:"TopCommandsPerUserRequest",outputSchema:"TopCommandsPerUserResponse"};return e.registerSimpleRemoteWorkflow("TopCommandsPerUserPPTWorkflow",t,n,null)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.configureRuntimeForPowerPointWorkflows=void 0;var o=n(215),r=n(216);t.configureRuntimeForPowerPointWorkflows=function(e){return(0,o.registerReplaceObjectWorkflow)(e).then((function(){return(0,r.registerProofingWorkflow)(e)}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.registerReplaceObjectWorkflow=void 0;var o=n(1),r=n(68),i="".concat("TextAnalysis.").concat("TextAnalysisRequest"),s="".concat("TextAnalysis.").concat("TextAnalysisResponse"),a=function(e){var t={shapeId:e.mk.id,isPh:!0,texts:[]};return e.textTile&&(t.texts=e.textTile.elements.map((function(e){return{text:e.text,bullet:"-"}}))),t};t.registerReplaceObjectWorkflow=function(e){var t={name:"ReplaceObjectLambdaBefore",source:o.LambdaSource.Custom,inputSchema:r.inputSchemaName,outputSchema:i,func:function(e,t,n,o){var r=e;o(function(e){if(0===e.slides.length)return null;for(var t=e.slides[0],n=function(e){return{slideId:e.mk.sId,runNlxAnalysis:!0,shapeInputMetaData:[]}}(t),o={presentationInputMetaData:{slideInputMetaData:[n]},textInputData:{title:"Title",textBoxes:[]}},r=0,i=t.drawingElems;r<i.length;r++){var s=i[r],u=a(s);u&&(n.shapeInputMetaData.push({shapeId:s.mk.id,runCeousAnalysis:!0,runSmartArtAnalysis:!0}),o.textInputData.textBoxes.push(u))}return o}(JSON.parse(r.content)))}},n={name:"ReplaceObjectLambdaRemote",source:o.LambdaSource.Remote,inputSchema:i,outputSchema:s};return e.registerSimpleRemoteWorkflow("ReplaceObjectWorkflow",t,n,null)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.registerProofingWorkflow=void 0;var o=n(1),r=n(68),i="".concat("Proofing.").concat("ProofingRequest"),s="".concat("Proofing.").concat("ProofingResponse");t.registerProofingWorkflow=function(e){var t={name:"ProofingLambdaBefore",source:o.LambdaSource.Custom,inputSchema:r.inputSchemaName,outputSchema:i,func:function(e,t,n,o){var r=e;o(function(e,t){if(0===t.slides.length)return null;var n=[];e.appMetadata&&e.appMetadata.overriddenCritiqueTypeOptions&&(n=e.appMetadata.overriddenCritiqueTypeOptions),n.push({id:"818BCDBE-64CE-46E8-A3D7-75A1EA8365A8",languageId:"en-US",value:"0"});var o={documentId:e.docId,languageUxId:e.appMetadata?e.appMetadata.languageUxId:"en-US",descriptors:{isCompliant:!e.appMetadata||e.appMetadata.descriptor.isCompliant,licenseType:e.appMetadata?e.appMetadata.descriptor.licenseType:2},tiles:[],requestOrderInSession:e.reqOrd,runOnProfileId:"827D1907-1E10-4F04-987A-B13FEC819C3C",overriddenCritiqueTypeOptions:n},r=t.slides[0];if(r.drawingElems)for(var i=0,s=r.drawingElems;i<s.length;i++){var a=s[i],u=a.textTile;u.metadata={tileId:a.id,revisionId:"revision",tileType:1};for(var c=0,l=u.elements;c<l.length;c++){var p=l[c];p.languageId||(p.languageId="en-US"),p.textUnit=4}o.tiles.push(u)}return o}(r,JSON.parse(r.content)))}},n={name:"ProofingLambdaRemote",source:o.LambdaSource.Remote,inputSchema:i,outputSchema:s};return e.registerSimpleRemoteWorkflow("ProofingWorkflow",t,n,null,{canProduceNullResult:!1,shouldSendResultsToHost:!0,enabledByDefault:!0})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.configureRuntimeForSharingSuggestionWorkflow=void 0;var o=n(1),r=n(16),i={};t.configureRuntimeForSharingSuggestionWorkflow=function(e,t){var n={name:"SharingSuggestionLambdaBefore",source:o.LambdaSource.Custom,inputSchema:"Tiling.TextTileEvent",outputSchema:"SharingSuggestion.Request",func:function(e,n,o,s){var a={Provider:r.IdentityProvider.ADAL,ResourceId:"https://substrate.office.com",AuthorityUrl:"https://login.microsoftonline.com/common/oauth2/authorize",Target:"https://substrate.office.com",Policy:"MBI_SSL"};i[e.tile.metadata.docId]?s(null):t.RequestAuthToken({Tickets:[a]}).then((function(t){s({tiles:[e.tile],tokens:[{token:t.Token,ticket:a}]})})).catch((function(){s(null)}))}},s={name:"SharingSuggestionLambdaRemote",source:o.LambdaSource.Remote,inputSchema:"SharingSuggestion.Request",outputSchema:"SharingSuggestion.Response"},a={name:"SharingSuggestionLambdaAfter",source:o.LambdaSource.Custom,inputSchema:"SharingSuggestion.Response",outputSchema:"SharingSuggestion.Response",func:function(e,t,n,o){i[e.docId]=!e.retry,e.identities.length>0&&e.identities[0].suggestions.length>0?(delete e.retry,delete e.docId,o(e)):o(null)}},u={canProduceNullResult:!1,shouldSendResultsToHost:!0,enabledByDefault:!1,throttleSettings:{shouldBeThrottled:!0,throttlingInterval:1e4},licenseFeatures:[]};return e.registerSimpleRemoteWorkflow("SharingSuggestionWorkflow",n,s,a,u)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.configureRuntimeForInterProviderRankerWorkflow=t.configureRuntimeForProviderResultWorkflow=t.configureRuntimeForIntentClassifierWorkflow=void 0;var o,r=n(1),i=n(69),s=n(225),a=n(227);t.configureRuntimeForIntentClassifierWorkflow=function(e){var t={name:"IntentClassifierLambdaRemote",source:r.LambdaSource.Remote,inputSchema:"Skills.Signal",outputSchema:"Skills.Intent"};return e.registerSimpleRemoteWorkflow("IntentClassifierWorkflow",null,t,null)};t.configureRuntimeForProviderResultWorkflow=function(e){var t={name:"ProviderResultLambdaRemote",source:r.LambdaSource.Remote,inputSchema:"Skills.Signal",outputSchema:"Skills.ProviderResult"};return e.registerSimpleRemoteWorkflow("ProviderResultWorkflow",null,t,null)};t.configureRuntimeForInterProviderRankerWorkflow=function(e){var t={name:"InterProviderRanker",source:r.LambdaSource.Custom,inputSchema:"Skills.ProviderResult",outputSchema:"Skills.RankedResult",func:function(e,t,n,r){var u=function(e){for(var t={},n=[],o=0,r=e.values;o<r.length;o++){var s=r[o];if(s){var a=s;try{var u={id:a.id,surfaceType:a.surfaceType,providerId:a.providerId,resultStatus:i.ProviderResultStatus[a.resultStatus],statusCode:a.statusCode,error:a.error?{errorType:i.ProviderErrorType[a.error.errorType],detail:a.error.detail}:null,additionalInfo:a.additionalInfo?JSON.parse(a.additionalInfo):null,entityGroups:a.entityGroups.map((function(e){return{groupTypeId:e.groupTypeId,providerId:e.providerId,data:e.data?JSON.parse(e.data):null,rank:e.rank}}))},c={providerId:u.providerId,resultStatus:u.resultStatus,statusCode:u.statusCode,error:u.error,additionalInfo:u.additionalInfo,entityGroups:u.entityGroups,id:a.id,surfaceType:a.surfaceType};u.resultStatus===i.ProviderResultStatus.Success&&u.entityGroups?n=n.concat(u.entityGroups):u.resultStatus===i.ProviderResultStatus.NoResult&&u.entityGroups&&(c.entityGroups=void 0),t[u.providerId]=c}catch(e){t[a.providerId]=void 0}}}return{transactionId:null,providerStatuses:t,rankedEntityGroups:n}}(e);(function(){if(!o){var e=new a.SkillsPlatformLogger;o=new s.SmartLookupRanker(e,{shouldQueryMatchQfDocumentTitle:!0})}return o})().rank({transactionId:null,interactionId:null},u),r(u)}};return e.registerReduceWorkflow("InterProviderRankerWorkflow",t,(function(e){return{primary:e.id,secondary:null}}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.DesignerSlideSuggestion="Designer.Slides",e.TextToSmartArtSuggestion="Designer.TextToSmartArt",e.PowerPointTextTileChanged="PowerPoint.TextTileChanged",e.SlideContentChange="PowerPoint.SlideContentChange",e.IdeasExecuteAction="Ideas.ExecuteAction"}(t.MessageType||(t.MessageType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Error=0]="Error",e[e.Warn=1]="Warn",e[e.Info=2]="Info",e[e.Debug=3]="Debug"}(t.LoggingLevel||(t.LoggingLevel={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.NotSet="NotSet",e.Timeout="Timeout",e.NetworkError="NetworkError",e.ServiceError="ServiceError",e.ParsingError="ParsingError",e.AuthenticationError="AuthenticationError",e.UnhandledException="UnhandledException"}(t.ProviderErrorType||(t.ProviderErrorType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Invalid="Invalid",e.Success="Success",e.Error="Error",e.Pending="Pending",e.NoResult="NoResult"}(t.ProviderResultStatus||(t.ProviderResultStatus={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NotSet=0]="NotSet",e[e.Measure=1]="Measure",e[e.Diagnostics=2]="Diagnostics",e[e.CriticalBusinessImpact=191]="CriticalBusinessImpact",e[e.CriticalCensus=192]="CriticalCensus",e[e.CriticalExperimentation=193]="CriticalExperimentation",e[e.CriticalUsage=194]="CriticalUsage"}(t.SamplingPolicy||(t.SamplingPolicy={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.DESIGNER_SLIDE_PROVIDER_ID="Provider.Designer.Slide",e.SLIDE_SUGGESTION_ID="EntityGroup.Designer.Slide.Suggestion"}(t.DesignerSlideProviderIdentifier||(t.DesignerSlideProviderIdentifier={})),function(e){e.MAKE_IT_VISUAL_PROVIDER_ID="Provider.UCI.MakeItVisual",e.MAKE_IT_VISUAL_KEYWORDS_ID="EntityGroup.UCI.MakeItVisual.Keywords"}(t.MakeItVisualProviderIdentifier||(t.MakeItVisualProviderIdentifier={})),function(e){e.DESIGNER_TEXT_TO_SMARTART_PROVIDER_ID="Provider.Designer.TextToSmartArt",e.TEXT_TO_SMARTART_SUGGESTION_ID="EntityGroup.Designer.TextToSmartArt.Suggestion"}(t.DesignerTextToSmartArtProviderIdentifier||(t.DesignerTextToSmartArtProviderIdentifier={})),function(e){e.HUBBLE_PROVIDER_ID="Provider.Hubble",e.HUBBLE_IMAGES_GROUP_ID="EntityGroup.Hubble.Images"}(t.HubbleProviderIdentifier||(t.HubbleProviderIdentifier={})),function(e){e.TAP_SEARCH_QF_PROVIDER_ID="Provider.Tap.Search.QF",e.TAP_SEARCH_QF_AND_OLS_PROVIDER_ID="Provider.Tap.Search.QFAndOLS",e.TAP_SEARCH_OLS_PROVIDER_ID="Provider.Tap.Search.OLS",e.TAP_SEARCH_SP_PROVIDER_ID="Provider.Tap.Search.SP",e.TAP_SEARCH_ZERO_TERM_QF_PROVIDER_ID="Provider.Tap.Search.ZeroTerm.QF",e.TAP_SEARCH_ZERO_TERM_QF_AND_OLS_PROVIDER_ID="Provider.Tap.Search.ZeroTerm.QFAndOLS",e.TAP_SEARCH_ZERO_TERM_OLS_PROVIDER_ID="Provider.Tap.Search.ZeroTerm.OLS",e.TAP_SEARCH_ZERO_TERM_SP_PROVIDER_ID="Provider.Tap.Search.ZeroTerm.SP",e.DOCUMENT_ID="EntityGroup.Tap.Document"}(t.TapProviderIdentifier||(t.TapProviderIdentifier={})),function(e){e.DICTIONARY_PROVIDER_ID="Provider.UCI.Dictionary",e.DICTIONARY_WORDS_GROUP_ID="EntityGroup.UCI.Dictionary.Words"}(t.DictionaryProviderIdentifier||(t.DictionaryProviderIdentifier={})),function(e){e.IMAGES_PROVIDER_ID="Provider.UCI.Images",e.IMAGES_ID="EntityGroup.UCI.Images.Images"}(t.ImagesProviderIdentifier||(t.ImagesProviderIdentifier={})),function(e){e.INSIGHTS_PROVIDER_ID="Provider.UCI.Insights",e.BINGANSWER_COMPUTATION_ID="EntityGroup.UCI.Insights.BingAnswer.Computation",e.BINGANSWER_CURRENCY_ID="EntityGroup.UCI.Insights.BingAnswer.Currency",e.BINGANSWER_FACTS_ID="EntityGroup.UCI.Insights.BingAnswer.Facts",e.BINGANSWER_FINANCE_ID="EntityGroup.UCI.Insights.BingAnswer.Finance",e.BINGANSWER_NEWS_ID="EntityGroup.UCI.Insights.BingAnswer.News",e.BINGANSWER_WEATHER_ID="EntityGroup.UCI.Insights.BingAnswer.Weather",e.DICTIONARY_ID="EntityGroup.UCI.Insights.Dictionary",e.ENTITIES_ID="EntityGroup.UCI.Insights.Entities",e.IMAGES_ID="EntityGroup.UCI.Insights.Images",e.WEBRESULTS_ID="EntityGroup.UCI.Insights.WebResults",e.WIKIPEDIARESULTS_ID="EntityGroup.UCI.Insights.WikipediaResults"}(t.InsightsProviderIdentifier||(t.InsightsProviderIdentifier={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(226);t.SmartLookupRanker=o.SmartLookupRanker},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r=n(69),i=function(){function e(t,n){this.logger=t,this.configuration=n,this.shouldMatchDocumentTitle=!1,this.shouldMatchDocumentTitle=this.configuration?this.configuration.shouldQueryMatchQfDocumentTitle:e.defaultShouldQueryMatchQfDocumentTitle}return e.prototype.rank=function(e,t){var n=this,o=t.rankedEntityGroups.slice();return o.sort((function(t,o){var i=n.getProviderRank(e,t),s=n.getProviderRank(e,o);return t.providerId==o.providerId&&t.providerId==r.InsightsProviderIdentifier.INSIGHTS_PROVIDER_ID?t.rank-o.rank:i-s})),t.rankedEntityGroups=o,this.logger.info(595994314,"[SmartLookupRanker] RankedResults",{interactionId:e.interactionId,transactionId:e.transactionId,queryMatchEnabled:this.shouldMatchDocumentTitle,ranking:t.rankedEntityGroups.map((function(e){return e.groupTypeId}))}),t},e.prototype.getProviderRank=function(t,n){var o=this;if(n.providerId==r.TapProviderIdentifier.TAP_SEARCH_QF_PROVIDER_ID&&this.shouldMatchDocumentTitle){var i=n;if(i.groupTypeId==r.TapProviderIdentifier.DOCUMENT_ID){var s=t,a=null!=s&&null!=s.tapContext?s.tapContext.queryText.toLocaleLowerCase().split(e.separators).filter((function(e){return e})):void 0;if(!i.data.find((function(e){return o.isTextContainsSearchWords(e.Title.toLocaleLowerCase(),a)})))return this.logger.debug(595973526,"[SmartLookupRanker] Query match with Qf Document failed",{interactionId:t.interactionId,transactionId:t.transactionId}),Number.MAX_VALUE;this.logger.debug(595973527,"[SmartLookupRanker] Query match with Qf Document succeeded",{interactionId:t.interactionId,transactionId:t.transactionId})}}return e.providerRank[n.providerId]?e.providerRank[n.providerId]:Number.MAX_VALUE},e.prototype.isTextContainsSearchWords=function(t,n){if(null==n||null==t)return!1;var o=t.split(e.separators);return n.every((function(e){return null!=o.find((function(t){return t.indexOf(e)>=0}))}))},e.providerRank=((o={})[r.TapProviderIdentifier.TAP_SEARCH_QF_PROVIDER_ID]=1,o[r.InsightsProviderIdentifier.INSIGHTS_PROVIDER_ID]=2,o),e.separators=/[\s]+/,e.defaultShouldQueryMatchQfDocumentTitle=!1,e}();t.SmartLookupRanker=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkillsPlatformLogger=void 0;var o=function(){function e(){}return e.prototype.log=function(e,t,n,o){},e.prototype.info=function(e,t,n){},e.prototype.warn=function(e,t,n){},e.prototype.error=function(e,t,n){},e.prototype.debug=function(e,t,n){},e.prototype.logEvent=function(e,t,n,o,r,i){},e}();t.SkillsPlatformLogger=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.configureRuntimeForIntegrationTestWorkflows=void 0;var o=n(1);t.configureRuntimeForIntegrationTestWorkflows=function(e){var t={name:"BazBarLambda",source:o.LambdaSource.Custom,inputSchema:"Microsoft.AugLoop.BazBar",outputSchema:"Microsoft.AugLoop.BazBar",func:function(e,t,n,o){var r;o((r=e)?{bar:r.baz,baz:r.bar}:null)}},n={name:"HealthCheckRemoteLambda",source:o.LambdaSource.Remote,inputSchema:"HealthCheckRequest",outputSchema:"HealthCheckResponse"},r={name:"BazBarNativeLambda",source:o.LambdaSource.Local,inputSchema:"BazBarNativeRequest",outputSchema:"BazBarNativeResponse"},i={name:"BazBarMissingNativeLambda",source:o.LambdaSource.Local,inputSchema:"BazBarMissingNativeRequest",outputSchema:"BazBarNativeResponse"};return Promise.all([e.registerSimpleLocalWorkflow("BazBarWorkflow",t),e.registerSimpleLocalWorkflow("BazBarNativeWorkflow",r),e.registerSimpleLocalWorkflow("BazBarMissingNativeWorkflow",i),e.registerSimpleRemoteWorkflow("HealthCheckWorkflow",null,n,null)]).then((function(){}))}},function(e,t){e.exports=OfficePlatformGlobal.Telemetry.OTel},function(e,t){e.exports=OfficePlatformGlobal.Telemetry.OTelSDX},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.configureRuntimeForLangDetectWorkflow=t.registerLangDetectWorkflow=void 0;var o=n(1),r=n(15);t.registerLangDetectWorkflow=function(e){var t={name:"LangDetectLambdaBefore",source:o.LambdaSource.Custom,inputSchema:"Tiling.TextTileEvent",outputSchema:"Tiling.TextTileEvent",func:function(e,t,n,o){var i=(0,r.fixKnownErrorsForTextTileEvent)(e);i?o({context:i.tile.elements.map((function(e){return e.text})).join(" ")}):o(null)}},n={name:"LangDetectLambdaRemote",source:o.LambdaSource.Remote,inputSchema:"LangDetect.Request",outputSchema:"LangDetect.Response"};return e.registerSimpleRemoteWorkflow("LangDetectWorkflow",t,n,null,{canProduceNullResult:!0,shouldSendResultsToHost:!0,enabledByDefault:!0})},t.configureRuntimeForLangDetectWorkflow=function(e){return(0,t.registerLangDetectWorkflow)(e)}}]);
//# sourceMappingURL=index.win32.bundle.map