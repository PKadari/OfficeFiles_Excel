(this.webpackJsonpfluidhost=this.webpackJsonpfluidhost||[]).push([[275],{674:function(e,t,r){"use strict";r.r(t),r.d(t,"CacheKeys",(function(){return X})),r.d(t,"SharepointInformationProtectionService",(function(){return ee}));var n=r(6),a=r(1),i=r(3),s=r(2),o=r(4),c=r(5),u=r(0),p=r.n(u),l=r(892),b=r(79),d=r(334),f=r(582),h=r(42);function v(e,t){var r=e.filter((function(e){return e.id===t}));return 1===r.length?r[0]:void 0}var g,m=r(227),y=r(1260),k=r(212),x=r(1287);function w(e,t){var r=e.querySelector(t);return(null===r||void 0===r?void 0:r.textContent)?r.textContent:""}function P(e,t){var r=e.querySelector(t),n=[];if(r)for(var a=0;a<r.children.length;a+=1){var i=r.children[a].textContent;n.push(i||"")}return n}function L(e){return O.apply(this,arguments)}function O(){return(O=Object(a.a)(p.a.mark((function e(t){var r,n,a,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new DOMParser,n=r.parseFromString(t,"text/xml"),!(a=n.querySelector("parsererror"))){e.next=5;break}throw new Error("parseDlpPolicyTip failed to parse : ".concat(a.textContent));case 5:if(!(i=n.querySelector("content"))){e.next=8;break}return e.abrupt("return",{generalText:w(i,"d\\:GeneralText"),appliedActionsText:w(i,"d\\:AppliedActionsText"),complianceUrl:w(i,"d\\:ComplianceUrl"),overrideOptions:parseInt(w(i,"d\\:OverrideOptions"),10),lastProcessedTime:w(i,"d\\:LastProcessedTime"),matchedConditionDescriptions:P(i,"d\\:MatchedConditionDescriptions")});case 8:return e.abrupt("return",void 0);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,t){return[t?"onedrive.readwrite":"".concat(e,"/files.readwrite.all")]}function I(e){var t,r=null===(t=null===e||void 0===e?void 0:e.value)||void 0===t?void 0:t.filter((function(e){if(e["@odata.type"]===g.Watermark)return e}));return 1===r.length?r[0]:void 0}function C(e){var t,r=null===(t=null===e||void 0===e?void 0:e.value)||void 0===t?void 0:t.filter((function(e){if(e["@odata.type"]===g.Metadata)return e}));return 1===r.length?r[0]:void 0}!function(e){e.Watermark="#microsoft.graph.security.addWatermarkAction",e.Metadata="#microsoft.graph.security.metadataAction"}(g||(g={}));var E={maxRetries:2,backoffFn:Object(m.a)(500),filter:Object(m.e)([408,409,429])},R="https://graph.microsoft.com/beta/",S=["InformationProtectionPolicy.Read"];function T(e,t){return G.apply(this,arguments)}function G(){return(G=Object(a.a)(p.a.mark((function e(t,r){var n,a,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R+"me/security/informationProtection/sensitivityLabels",n=function(e){return t.getToken(S,e)},e.next=4,Object(y.c)(n,"https://graph.microsoft.com/beta/me/security/informationProtection/sensitivityLabels","GetPolicyLabels",r,void 0);case 4:if((a=e.sent).ok&&200===a.status){e.next=7;break}throw new Error("getPolicyLabel failed with status : ".concat(a.status));case 7:return e.next=9,a.json();case 9:return i=e.sent,e.abrupt("return",i.value);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e){return{metadata:[{name:"MSIP_Label_".concat(e,"_Enabled"),value:"true"}]}}function M(e,t,r,n,a){return A.apply(this,arguments)}function A(){return(A=Object(a.a)(p.a.mark((function e(t,r,n,a,i){var s,o,c,u,l,b;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R+"me/security/informationProtection/sensitivityLabels/evaluateApplication",s={contentInfo:a||D(r),labelingOptions:{labelId:r,downgradeJustification:{isDowngradeJustified:!!n,justificationMessage:n||""}}},o=function(e){return t.getToken(S,e)},e.next=5,Object(y.c)(o,"https://graph.microsoft.com/beta/me/security/informationProtection/sensitivityLabels/evaluateApplication","EvaluateApplication",i,void 0,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});case 5:if((c=e.sent).ok&&200===c.status){e.next=8;break}throw new Error("evaluateLabelApplication failed with status : ".concat(c.status));case 8:return e.next=10,c.json();case 10:if(u=e.sent,l=I(u),!(null===(b=C(u))||void 0===b?void 0:b.metadataToAdd)){e.next=15;break}return e.abrupt("return",{changeLabel:!0,contentInfo:{metadata:b.metadataToAdd},watermark:l});case 15:return e.abrupt("return",{changeLabel:!1});case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e,t,r,n,a){return N.apply(this,arguments)}function N(){return(N=Object(a.a)(p.a.mark((function e(t,r,n,a,i){var s,o,c,u,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R+"me/security/informationProtection/sensitivityLabels/evaluateRemoval",s={contentInfo:n||D(r),downgradeJustification:{isDowngradeJustified:!!a,justificationMessage:a||""}},o=function(e){return t.getToken(S,e)},e.next=5,Object(y.c)(o,"https://graph.microsoft.com/beta/me/security/informationProtection/sensitivityLabels/evaluateRemoval","EvaluateRemoval",i,void 0,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});case 5:if((c=e.sent).ok&&200===c.status){e.next=8;break}throw new Error("evaluateLabelRemoval failed with status : ".concat(c.status));case 8:return e.next=10,c.json();case 10:if(u=e.sent,!(null===(l=C(u))||void 0===l?void 0:l.metadataToRemove)){e.next=14;break}return e.abrupt("return",{changeLabel:!0});case 14:return e.abrupt("return",{changeLabel:!1});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e,t,r,n,a){return q.apply(this,arguments)}function q(){return(q=Object(a.a)(p.a.mark((function e(t,r,n,a,i){var s,o,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=Object(k.a)(a),o={getToken:function(e){var i=Object.assign(Object.assign({},e),{siteUrl:a,driveId:n,itemId:r});return t.getToken(j(s,!1),i)},url:"".concat(a,"/_api/v2.1/drives/").concat(n,"/items/").concat(r,"/opStream/capabilities?$select=canWrite,canPrint,canExtract,supportsCLP"),retryPolicy:E},!i){e.next=8;break}return e.next=5,Object(x.b)(Object.assign(Object.assign({},o),{logger:i,nameForLogging:"GetItemIrmCapabilities"}));case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,Object(x.a)(o);case 10:e.t0=e.sent;case 11:if((c=e.t0).result.ok&&200===c.result.status){e.next=14;break}throw new Error("getItemIrmCapabilities failed with status : ".concat(c.result.status));case 14:return e.next=16,c.result.json();case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e,t,r,n,a,i){return J.apply(this,arguments)}function J(){return(J=Object(a.a)(p.a.mark((function e(t,r,n,a,i,s){var o,c,u,l,b,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new URL(a).hostname,c="".concat(R,"sites/").concat(o,"/drives/").concat(n,"/items/").concat(r,"/extractSensitivityLabels"),u=function(e){return t.getToken(["Files.ReadWrite.All"],e)},e.next=5,Object(y.c)(u,c,"extractSensitivityLabels",s,i,{method:"POST"});case 5:if((l=e.sent).ok&&200===l.status){e.next=8;break}throw new Error("extractInformationProtectionContentLabels failed with status : ".concat(l.status));case 8:return e.next=10,l.json();case 10:return b=e.sent,d=b.labels.find((function(e){return e.tenantId===i})),e.abrupt("return",d);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t,r,n,a,i){return F.apply(this,arguments)}function F(){return(F=Object(a.a)(p.a.mark((function e(t,r,n,a,i,s){var o,c,u,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=Object(k.a)(a),c=Object.assign({},i),i.id||(c.id=null),u={getToken:function(e){var i=Object.assign(Object.assign({},e),{siteUrl:a,driveId:n,itemId:r});return t.getToken(j(o,!1),i)},url:"".concat(o,"/_api/v2.0/drives/").concat(n,"/items/").concat(r,"/setSensitivityLabel"),requestInit:{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)},retryPolicy:E},!s){e.next=10;break}return e.next=7,Object(x.b)(Object.assign(Object.assign({},u),{logger:s,nameForLogging:"SetLabel"}));case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,Object(x.a)(u);case 12:e.t0=e.sent;case 13:return l=e.t0,e.abrupt("return",200===l.result.status);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,t,r,n,a){return z.apply(this,arguments)}function z(){return(z=Object(a.a)(p.a.mark((function e(t,r,n,a,i){var s,o,c,u,b,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=Object(k.a)(a),e.next=3,Object(l.a)(t,a,n,r);case 3:if(o=e.sent,c=null===o||void 0===o?void 0:o.webDavUrl.replace(s,""),u={getToken:function(e){var i=Object.assign(Object.assign({},e),{siteUrl:a,driveId:n,itemId:r});return t.getToken(j(s,!1),i)},url:"".concat(a,"/_api/web/getListItem('").concat(c,"')/getdlppolicytip"),retryPolicy:E},!i){e.next=12;break}return e.next=9,Object(x.b)(Object.assign(Object.assign({},u),{logger:i,nameForLogging:"GetDlpPolicyTip"}));case 9:e.t0=e.sent,e.next=15;break;case 12:return e.next=14,Object(x.a)(u);case 14:e.t0=e.sent;case 15:if((b=e.t0).result.ok&&200===b.result.status){e.next=18;break}throw new Error("getDlpTooltip failed with status : ".concat(b.result.status));case 18:return e.next=20,b.result.text();case 20:return d=e.sent,e.next=23,L(d);case 23:return e.abrupt("return",e.sent);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e,t){return $.apply(this,arguments)}function $(){return($=Object(a.a)(p.a.mark((function e(t,r){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R+"me/security/informationProtection/labelPolicySettings",n=function(e){return t.getToken(S,e)},e.next=4,Object(y.c)(n,"https://graph.microsoft.com/beta/me/security/informationProtection/labelPolicySettings","GetPolicySettings",r,void 0);case 4:if((a=e.sent).ok&&200===a.status){e.next=7;break}throw new Error("getPolicySettings failed with status : ".concat(a.status));case 7:return e.next=9,a.json();case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var B,Q=r(768);!function(e){e.RefreshTimerTriggered="RefreshTimerTriggered"}(B||(B={}));var X,Y=r(769),Z=r(153);!function(e){e[e.AppliedLabel=0]="AppliedLabel",e[e.IrmCapabilities=1]="IrmCapabilities",e[e.IsProtectionEnabled=2]="IsProtectionEnabled",e[e.PolicySettings=3]="PolicySettings",e[e.Watermark=4]="Watermark",e[e.DlpPolicyTip=5]="DlpPolicyTip",e[e.Labels=6]="Labels",e[e.IsMandatoryLabelingRequired=7]="IsMandatoryLabelingRequired"}(X||(X={}));var ee=function(e){Object(o.a)(r,e);var t=Object(c.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this)).props=e,n.PromiseCache=new Map,n}return Object(s.a)(r,[{key:"InformationProtectionService",get:function(){return this}},{key:"getCacheKey",value:function(e,t){return e+"_"+t}},{key:"getCurrentLabel",value:function(){var e=Object(a.a)(p.a.mark((function e(t){var r,n,i,s,o=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(l.c)(t)){e.next=3;break}return this.props.logger&&Object(b.c)(this.props.logger,{eventName:Q.a.InvalidResolvedUrl,scenario:Y.a.GetAppliedLabel}),e.abrupt("return",void 0);case 3:if(r=this.getCacheKey(X.AppliedLabel,t.hashedDocumentId),!(n=this.PromiseCache.get(r))){e.next=7;break}return e.abrupt("return",n);case 7:if(i=d.a.start("GetAppliedLabel",this.props.logger),s=Object(f.b)(t.siteUrl,this.props.logger)){e.next=12;break}return i.setResult(!1,{errorType:Q.a.InvalidTenantId}),e.abrupt("return");case 12:return n=new Promise(function(){var e=Object(a.a)(p.a.mark((function e(r){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,K(o.props.tokenProvider,t.itemId,t.driveId,t.siteUrl,s,o.props.logger);case 3:return n=e.sent,o.monitorAppliedLabel(t),o.processPolicySettings(t,n),i.setResult(!0,{appliedLabel:!!n,assignmentMethod:null===n||void 0===n?void 0:n.assignmentMethod}),e.abrupt("return",r(n));case 10:return e.prev=10,e.t0=e.catch(0),i.setResult(!1,{errorType:Q.a.GetAppliedLabelError},e.t0),e.abrupt("return",r(void 0));case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()),this.PromiseCache.set(r,n),e.abrupt("return",n);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getHasProtection",value:function(){var e=Object(a.a)(p.a.mark((function e(t){var r,i,s,o=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(l.c)(t)){e.next=3;break}return this.props.logger&&Object(b.c)(this.props.logger,{eventName:Q.a.InvalidResolvedUrl,scenario:Y.a.GetIsProtectionEnabled}),e.abrupt("return",void 0);case 3:if(r=this.getCacheKey(X.IsProtectionEnabled,t.hashedDocumentId),!(i=this.PromiseCache.get(r))){e.next=7;break}return e.abrupt("return",i);case 7:return s=d.a.start("IsProtectionEnabled",this.props.logger),i=new Promise(function(){var e=Object(a.a)(p.a.mark((function e(r){var a,i,c,u,l,b;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([o.getCurrentLabel(t),o.getLabels()]);case 2:if(a=e.sent,i=Object(n.a)(a,2),c=i[0],u=i[1]){e.next=9;break}return s.setResult(!1,{hasProtection:!1,appliedLabel:!!c,allLabels:!!u}),e.abrupt("return",r(void 0));case 9:return l=!1,c&&(b=v(u,c.sensitivityLabelId),l=!!(null===b||void 0===b?void 0:b.hasProtection)),s.setResult(!0,{appliedLabel:!!c,allLabels:!!u,hasProtection:l}),e.abrupt("return",r(l));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.PromiseCache.set(r,i),e.abrupt("return",i);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getIrmInformation",value:function(){var e=Object(a.a)(p.a.mark((function e(t){var r,n,i,s=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(l.c)(t)){e.next=3;break}return this.props.logger&&Object(b.c)(this.props.logger,{eventName:Q.a.InvalidResolvedUrl,scenario:Y.a.GetIrmCapabilities}),e.abrupt("return",void 0);case 3:if(r=this.getCacheKey(X.IrmCapabilities,t.hashedDocumentId),!(n=this.PromiseCache.get(r))){e.next=7;break}return e.abrupt("return",n);case 7:return i=d.a.start("GetIrmCapabilities",this.props.logger),n=new Promise(function(){var e=Object(a.a)(p.a.mark((function e(r){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,W(s.props.tokenProvider,t.itemId,t.driveId,t.siteUrl,s.props.logger);case 3:return n=e.sent,i.setResult(!0,{supportsCLP:n.supportsCLP,canWrite:n.canWrite,canExtract:n.canExtract,canPrint:n.canPrint}),e.abrupt("return",r(n));case 8:return e.prev=8,e.t0=e.catch(0),i.setResult(!1,{errorType:Q.a.GetIrmCapabilitiesError},e.t0),e.abrupt("return",r(void 0));case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()),this.PromiseCache.set(r,n),e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPolicySettings",value:function(){var e=Object(a.a)(p.a.mark((function e(){var t,r,n=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.PromiseCache.get(X.PolicySettings.toString()))){e.next=3;break}return e.abrupt("return",t);case 3:return r=d.a.start("GetPolicySettings",this.props.logger),t=new Promise(function(){var e=Object(a.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,H(n.props.tokenProvider,n.props.logger);case 3:return a=e.sent,r.setResult(!0,{infoUrl:!!a.moreInfoUrl,isMandatory:a.isMandatory,isDefault:!!a.defaultLabelId,isDowngradeJustificationRequired:a.isDowngradeJustificationRequired}),e.abrupt("return",t(a));case 8:return e.prev=8,e.t0=e.catch(0),r.setResult(!1,{errorType:Q.a.GetPolicySettingsError},e.t0),e.abrupt("return",t(void 0));case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()),this.PromiseCache.set(X.PolicySettings.toString(),t),e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWatermarkInformation",value:function(){var e=Object(a.a)(p.a.mark((function e(t){var r,n,i,s=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(l.c)(t)){e.next=3;break}return this.props.logger&&Object(b.c)(this.props.logger,{eventName:Q.a.InvalidResolvedUrl,scenario:Y.a.GetWatermarking}),e.abrupt("return",void 0);case 3:if(r=this.getCacheKey(X.Watermark,t.hashedDocumentId),!(n=this.PromiseCache.get(r))){e.next=7;break}return e.abrupt("return",n);case 7:return i=d.a.start("GetWatermarking",this.props.logger),n=new Promise(function(){var e=Object(a.a)(p.a.mark((function e(r){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.getCurrentLabel(t);case 3:if(!(n=e.sent)){e.next=11;break}return e.next=7,M(s.props.tokenProvider,n.sensitivityLabelId);case 7:return a=e.sent,s.labelMetadataCache=a.contentInfo,i.setResult(!0,{appliedLabel:!0,isWatermark:!!a.watermark,isContentInfo:!!a.contentInfo}),e.abrupt("return",r(a.watermark));case 11:return i.setResult(!0,{appliedLabel:!!n}),e.abrupt("return",r(void 0));case 15:return e.prev=15,e.t0=e.catch(0),i.setResult(!1,{errorType:Q.a.GetWatermarkingError},e.t0),e.abrupt("return",r(void 0));case 19:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t){return e.apply(this,arguments)}}()),this.PromiseCache.set(r,n),e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"overrideDlpPolicyTip",value:function(){var e=Object(a.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not Implemented..");case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getLabels",value:function(){var e=Object(a.a)(p.a.mark((function e(){var t,r,n=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.PromiseCache.get(X.Labels.toString()))){e.next=3;break}return e.abrupt("return",t);case 3:return r=d.a.start("GetLabels",this.props.logger),t=new Promise(function(){var e=Object(a.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T(n.props.tokenProvider,n.props.logger);case 3:return a=e.sent,r.setResult(!0),e.abrupt("return",t(a));case 8:return e.prev=8,e.t0=e.catch(0),r.setResult(!1,{errorType:Q.a.GetLabelsError},e.t0),e.abrupt("return",t(void 0));case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()),this.PromiseCache.set(X.Labels.toString(),t),e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"changeLabel",value:function(){var e=Object(a.a)(p.a.mark((function e(t,r){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(l.c)(t)){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,_(this.props.tokenProvider,t.itemId,t.driveId,t.siteUrl,r,this.props.logger);case 4:return(n=e.sent)&&this.refreshAppliedLabel(t),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setCurrentLabel",value:function(){var e=Object(a.a)(p.a.mark((function e(t,r){var n,a,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(Z.b)(this.props.settingsProvider)){e.next=4;break}return d.a.start("SetLabel",this.props.logger).setResult(!1,{settingName:Z.c,settingValue:Object(Z.b)(this.props.settingsProvider),settingsProviderExists:void 0!==this.props.settingsProvider}),e.abrupt("return",!1);case 4:if(Object(l.c)(t)){e.next=7;break}return this.props.logger&&Object(b.c)(this.props.logger,{eventName:Q.a.InvalidResolvedUrl,scenario:Y.a.SetLabel}),e.abrupt("return",!1);case 7:return n=d.a.start("SetLabel",this.props.logger),a=!1,e.prev=9,e.next=12,M(this.props.tokenProvider,r.id,r.justificationText,this.labelMetadataCache,this.props.logger);case 12:if(!(i=e.sent).changeLabel){e.next=17;break}return e.next=16,this.changeLabel(t,r);case 16:a=e.sent;case 17:n.setResult(!0,{changeLabel:i.changeLabel,changeLabelStatus:a,assignmentMethod:r.assignmentMethod,actionSource:r.actionSource}),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(9),n.setResult(!1,{errorType:Q.a.SetLabelError},e.t0);case 23:return a||this.emit("sensitivityError"),e.abrupt("return",a);case 25:case"end":return e.stop()}}),e,this,[[9,20]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"removeCurrentLabel",value:function(){var e=Object(a.a)(p.a.mark((function e(t,r){var n,a,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(Z.b)(this.props.settingsProvider)){e.next=4;break}return d.a.start("RemoveLabel",this.props.logger).setResult(!1,{settingName:Z.c,settingValue:Object(Z.b)(this.props.settingsProvider),settingsProviderExists:void 0!==this.props.settingsProvider}),e.abrupt("return",!1);case 4:if(Object(l.c)(t)){e.next=7;break}return this.props.logger&&Object(b.c)(this.props.logger,{eventName:Q.a.InvalidResolvedUrl,scenario:Y.a.RemoveLabel}),e.abrupt("return",!1);case 7:return n=d.a.start("RemoveLabel",this.props.logger),a=!1,e.prev=9,e.next=12,U(this.props.tokenProvider,r.id,this.labelMetadataCache,r.justificationText,this.props.logger);case 12:if(!(i=e.sent).changeLabel){e.next=18;break}return r.id="",e.next=17,this.changeLabel(t,r);case 17:a=e.sent;case 18:a&&(this.labelMetadataCache=void 0),n.setResult(!0,{changeLabel:i.changeLabel,removeCurrentLabelStatus:a,assignmentMethod:r.assignmentMethod,actionSource:r.actionSource}),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(9),n.setResult(!1,{errorType:Q.a.RemoveLabelError},e.t0);case 25:return a||this.emit("sensitivityError"),e.abrupt("return",a);case 27:case"end":return e.stop()}}),e,this,[[9,22]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getDlpTooltip",value:function(){var e=Object(a.a)(p.a.mark((function e(t){var r,n,i,s=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(l.c)(t)){e.next=3;break}return this.props.logger&&Object(b.c)(this.props.logger,{eventName:Q.a.InvalidResolvedUrl,scenario:Y.a.GetDlpPolicyTip}),e.abrupt("return",void 0);case 3:if(r=this.getCacheKey(X.DlpPolicyTip,t.hashedDocumentId),!(n=this.PromiseCache.get(r))){e.next=7;break}return e.abrupt("return",n);case 7:return i=d.a.start("GetDlpPolicyTip",this.props.logger),n=new Promise(function(){var e=Object(a.a)(p.a.mark((function e(r){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V(s.props.tokenProvider,t.itemId,t.driveId,t.siteUrl,s.props.logger);case 3:return(n=e.sent)&&s.emit("dlpPolicyTip",n),i.setResult(!0,{tip:!!n,moreInfoUrl:!!(null===n||void 0===n?void 0:n.complianceUrl),overrideOptions:null===n||void 0===n?void 0:n.overrideOptions}),e.abrupt("return",r(n));case 9:return e.prev=9,e.t0=e.catch(0),i.setResult(!1,{errorType:Q.a.GetDlpPolicyTipError},e.t0),e.abrupt("return",r(void 0));case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}()),this.PromiseCache.set(r,n),e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getIsMandatoryLabeling",value:function(){var e=Object(a.a)(p.a.mark((function e(t){var r,i,s,o=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(l.c)(t)){e.next=3;break}return this.props.logger&&Object(b.c)(this.props.logger,{eventName:Q.a.InvalidResolvedUrl,scenario:Y.a.GetIsProtectionEnabled}),e.abrupt("return",void 0);case 3:if(r=this.getCacheKey(X.IsMandatoryLabelingRequired,t.hashedDocumentId),!(i=this.PromiseCache.get(r))){e.next=7;break}return e.abrupt("return",i);case 7:return s=d.a.start("IsMandatoryLabelingRequired",this.props.logger),i=new Promise(function(){var e=Object(a.a)(p.a.mark((function e(r){var a,i,c,u,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([o.getCurrentLabel(t),o.getPolicySettings()]);case 2:if(a=e.sent,i=Object(n.a)(a,2),c=i[0],u=i[1]){e.next=9;break}return s.setResult(!1,{appliedLabel:!!c,policySettings:!!u}),e.abrupt("return",r(void 0));case 9:return l=u.isMandatory&&!c,s.setResult(!0,{appliedLabel:!!c,policySettings:!!u,isMandatoryLabelingRequired:l}),e.abrupt("return",r(l));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.PromiseCache.set(r,i),e.abrupt("return",i);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"initialize",value:function(){var e=Object(a.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=d.a.start("Initialization",this.props.logger),e.next=3,Promise.all([this.getLabels(),this.getPolicySettings()]);case 3:t.setResult(!0);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"monitorAppliedLabel",value:function(){var e=Object(a.a)(p.a.mark((function e(t){var r=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.clearInterval(this.refreshTimer),9e5,this.refreshTimer=window.setInterval(Object(a.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.props.logger&&Object(b.c)(r.props.logger,{eventName:B.RefreshTimerTriggered}),e.next=3,r.refreshAppliedLabel(t);case 3:case"end":return e.stop()}}),e)}))),9e5);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshAppliedLabel",value:function(){var e=Object(a.a)(p.a.mark((function e(t){var r,a,i,s,o,c,u,b,f;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(l.c)(t)){e.next=2;break}return e.abrupt("return");case 2:return r=d.a.start("RefreshAppliedLabel",this.props.logger),e.next=5,this.getCurrentLabel(t);case 5:return a=e.sent,this.PromiseCache.delete(this.getCacheKey(X.AppliedLabel,t.hashedDocumentId)),e.next=9,this.getCurrentLabel(t);case 9:if(i=e.sent,!(s=(null===a||void 0===a?void 0:a.sensitivityLabelId)!==(null===i||void 0===i?void 0:i.sensitivityLabelId))){e.next=28;break}return this.emit("sensitivityLabelChanged",i),this.PromiseCache.delete(this.getCacheKey(X.IrmCapabilities,t.hashedDocumentId)),this.PromiseCache.delete(this.getCacheKey(X.Watermark,t.hashedDocumentId)),e.next=17,Promise.all([this.getIrmInformation(t),this.getWatermarkInformation(t)]);case 17:return o=e.sent,c=Object(n.a)(o,2),u=c[0],b=c[1],this.emit("IrmCapabilitiesChanged",u),this.emit("watermarkingChanged",b),this.PromiseCache.delete(this.getCacheKey(X.IsProtectionEnabled,t.hashedDocumentId)),e.next=26,this.getHasProtection(t);case 26:f=e.sent,this.emit("protectionChanged",f);case 28:r.setResult(!0,{isRefreshed:s});case 29:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"processPolicySettings",value:function(){var e=Object(a.a)(p.a.mark((function e(t,r){var n,a,i,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=d.a.start("ProcessPolicySettings",this.props.logger),Object(Z.b)(this.props.settingsProvider)){e.next=4;break}return n.setResult(!1,{settingName:Z.c,settingValue:Object(Z.b)(this.props.settingsProvider),settingsProviderExists:void 0!==this.props.settingsProvider}),e.abrupt("return");case 4:return e.next=6,this.getPolicySettings();case 6:if(a=e.sent){e.next=10;break}return n.setResult(!1,{errorType:Q.a.GetPolicySettingsError,scenario:Y.a.ProcessPolicySettings}),e.abrupt("return");case 10:if(i=!1,!a.defaultLabelId||(null===r||void 0===r?void 0:r.sensitivityLabelId)){e.next=16;break}return e.next=14,this.executeDefaultLabeling(t,a.defaultLabelId);case 14:i=e.sent,n.addAdditionalProps({defaultLabelingStatus:i});case 16:s=!1,!a.isMandatory||(null===r||void 0===r?void 0:r.sensitivityLabelId)||i||(s=!0,this.executeMandatoryLabeling()),n.setResult(!0,{isDefault:!!a.defaultLabelId,defaultLabelingStatus:i,isMandatory:a.isMandatory,executeMandatoryLabel:s});case 19:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeDefaultLabeling",value:function(){var e=Object(a.a)(p.a.mark((function e(t,r){var n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(Z.b)(this.props.settingsProvider)){e.next=2;break}return e.abrupt("return",!1);case 2:return n={id:r,assignmentMethod:"standard",actionSource:"defaultLabel"},e.next=5,this.setCurrentLabel(t,n);case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeMandatoryLabeling",value:function(){var e=Object(a.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(Z.b)(this.props.settingsProvider)&&this.emit("mandatoryLabelRequired");case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAppliedLabel",value:function(){var e=Object(a.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not Implemented..");case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getIsProtectionEnabled",value:function(){var e=Object(a.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not Implemented..");case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getWatermarking",value:function(){var e=Object(a.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not Implemented..");case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getIrmCapabilities",value:function(){var e=Object(a.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not Implemented..");case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getDlpPolicyTip",value:function(){var e=Object(a.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not Implemented..");case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setLabel",value:function(){var e=Object(a.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not Implemented..");case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"removeLabel",value:function(){var e=Object(a.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not Implemented..");case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),r}(h.EventEmitter)},768:function(e,t,r){"use strict";var n;r.d(t,"a",(function(){return n})),function(e){e.GetAppliedLabelError="GetAppliedLabelError",e.GetDlpPolicyTipError="GetDlpPolicyTipError",e.GetIrmCapabilitiesError="GetIrmCapabilitiesError",e.GetLabelsError="GetLabelsError",e.GetPolicySettingsError="GetPolicySettingsError",e.GetWatermarkingError="GetWatermarkingError",e.InvalidResolvedUrl="InvalidResolvedUrl",e.InvalidTenantId="InvalidTenantId",e.RemoveLabelError="RemoveLabelError",e.SetLabelError="SetLabelError",e.EnforceInformationProtectionError="EnforceInformationProtectionError"}(n||(n={}))},769:function(e,t,r){"use strict";var n;r.d(t,"a",(function(){return n})),function(e){e.GetAppliedLabel="GetAppliedLabel",e.GetIsProtectionEnabled="GetIsProtectionEnabled",e.GetIrmCapabilities="GetIrmCapabilities",e.GetWatermarking="GetWatermarking",e.SetLabel="SetLabel",e.RemoveLabel="RemoveLabel",e.GetDlpPolicyTip="GetDlpPolicyTip",e.ProcessPolicySettings="ProcessPolicySettings",e.EnforceInformationProtection="EnforceInformationProtection"}(n||(n={}))}}]);
//# sourceMappingURL=275.1ae2bcc6.chunk.js.map