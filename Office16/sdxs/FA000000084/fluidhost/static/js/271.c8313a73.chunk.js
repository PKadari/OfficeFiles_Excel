/*! For license information please see 271.c8313a73.chunk.js.LICENSE.txt */
(this.webpackJsonpfluidhost=this.webpackJsonpfluidhost||[]).push([[271],{1277:function(e,t,r){"use strict";r.r(t),r.d(t,"DebugReplayController",(function(){return W})),r.d(t,"DebuggerUI",(function(){return Y})),r.d(t,"FluidDebugger",(function(){return ie}));var n=r(1),i=r(3),a=r(2),s=r(4),o=r(5),c=r(0),u=r.n(c),p=r(322),l=r(100),d=r(705),h=r(19),f=r(8),m=r(103),y=r(60),v=r(719),b=r(223);function g(e,t,r){var n,i=[],a=Object(f.a)(t);try{for(a.s();!(n=a.n()).done;){var s=n.value,o="".concat(e).concat(s.path);if(s.type===y.b.Blob){var c=s.value,u=Object(m.d)(c.contents,c.encoding),p=Object(b.a)();r.set(p,u);var d={mode:y.a[s.mode],path:o,sha:p,size:0,type:"blob",url:""};i.push(d)}else if(s.type===y.b.Tree){Object(l.a)(s.type===y.b.Tree,257);var v=s.value,w={mode:y.a[s.mode],path:o,sha:"",size:-1,type:"tree",url:""};i.push(w);var x=g("".concat(o,"/"),v.entries,r);i.push.apply(i,Object(h.a)(x))}}}catch(O){a.e(O)}finally{a.f()}return i}function w(e,t){return{sha:"",tree:g("",e,t),url:""}}function x(e,t){var r=w(e,t);return Object(v.a)(r)}var O=r(729),k=function(){function e(){Object(i.a)(this,e)}return Object(a.a)(e,[{key:"fetchMessages",value:function(e,t,r,n){return O.a}}]),e}(),S=function(){function e(){Object(i.a)(this,e)}return Object(a.a)(e,[{key:"uploadSummaryWithContext",value:function(){var e=Object(n.a)(u.a.mark((function e(t,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject(new Error("Invalid operation")));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=Object(n.a)(u.a.mark((function e(t,r,n,i){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject(new Error("Invalid operation")));case 1:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"createBlob",value:function(){var e=Object(n.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject(new Error("Invalid operation")));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"downloadSummary",value:function(){var e=Object(n.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject(new Error("Invalid operation")));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"repositoryUrl",get:function(){throw new Error("Invalid operation")}}]),e}(),j=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(){return Object(i.a)(this,r),t.apply(this,arguments)}return Object(a.a)(r)}(S),A=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this)).commits={},n.trees={},n.commits=e.commits,n.blobs=new Map,n.docTree=x(e.tree.entries,n.blobs),n}return Object(a.a)(r,[{key:"getVersions",value:function(){var e=Object(n.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.docId&&this.docId!==t&&null!==t){e.next=3;break}return null!==t&&(this.docId=t),e.abrupt("return",[{id:"latest",treeId:""}]);case 3:if(void 0===this.commits[t]){e.next=5;break}return e.abrupt("return",[{id:t,treeId:r.FileStorageVersionTreeId}]);case 5:throw new Error("Unknown version ID: ".concat(t));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSnapshotTree",value:function(){var e=Object(n.a)(u.a.mark((function e(t){var n,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&"latest"!==t.id){e.next=2;break}return e.abrupt("return",this.docTree);case 2:if(t.treeId===r.FileStorageVersionTreeId){e.next=4;break}throw new Error("Unknown version id: ".concat(t));case 4:if(void 0!==(n=this.trees[t.id])){e.next=10;break}if(void 0!==(i=this.commits[t.id])){e.next=9;break}throw new Error("Can't find version ".concat(t.id));case 9:this.trees[t.id]=n=x(i.entries,this.blobs);case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readBlob",value:function(){var e=Object(n.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(r=this.blobs.get(t))){e.next=3;break}return e.abrupt("return",r);case 3:throw new Error("Unknown blob ID: ".concat(t));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(S);A.FileStorageVersionTreeId="FileStorageTreeId";var E,T=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e,n){var a;return Object(i.a)(this,r),(a=t.call(this)).storage=e,a.docTree=n,Object(l.a)(!!a.docTree,176),a}return Object(a.a)(r,[{key:"getVersions",value:function(){var e=Object(n.a)(u.a.mark((function e(t,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.docId&&this.docId!==t&&null!==t){e.next=3;break}return null!==t&&(this.docId=t),e.abrupt("return",[{id:"latest",treeId:""}]);case 3:return e.abrupt("return",this.storage.getVersions(t,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSnapshotTree",value:function(){var e=Object(n.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||"latest"===t.id){e.next=2;break}return e.abrupt("return",this.storage.getSnapshotTree(t));case 2:return e.abrupt("return",this.docTree);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readBlob",value:function(){var e=Object(n.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storage.readBlob(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(S),F=r(870),P={type:"null"},C={type:"object",properties:{clientId:{type:"string"},detail:{type:"object",properties:{details:{type:"object"},mode:{type:"string"},permission:{type:"array"},scopes:{type:"array"},type:{type:"string"},user:{type:"object",properties:{id:{type:"string"},name:{type:"string"},email:{type:"string"}},required:["id","name","email"],additionalProperties:!1}},required:["user"],additionalProperties:!1}},required:["clientId","detail"],additionalProperties:!1},M={type:["string","object"],properties:{key:{type:"string"},value:{type:"string"}},required:["key"],additionalProperties:!1},I={type:"object",properties:{mode:{type:"string"},path:{type:"string"},type:{enum:["Blob","Tree"]},value:{type:"object",oneOf:[{properties:{contents:{type:"string"},encoding:{type:"string"},id:{type:"null"}},required:["contents","encoding"],additionalProperties:!1},{properties:{entries:{type:"array",items:{$ref:"#/definitions/entries"}},id:{type:"null"}},required:["entries"],additionalProperties:!1}]}},required:["mode","path","type","value"],additionalProperties:!1},z={definitions:{entries:I},type:"object",properties:{id:{type:"string"},snapshot:{type:"object",properties:{entries:{type:"array",items:{$ref:"#/definitions/entries"}},id:{type:"null"}},required:["entries"],additionalProperties:!1},type:{type:"string"}},required:["id","snapshot","type"],additionalProperties:!1},q={type:"object",properties:{chunkId:{type:"number"},contents:{type:"string"},originalType:{type:"string"},totalChunks:{type:"number"}},required:["chunkId","contents","originalType","totalChunks"],additionalProperties:!1},$={definitions:{content:{type:"object",properties:{address:{type:"string"},contents:{type:"object",properties:{content:{type:"object"},type:{type:"string"}},required:["content","type"],additionalProperties:!1}},required:["address","contents"],additionalProperties:!1},entries:I,attachContents:z,chunkedOpContents:q},type:"object",oneOf:[{properties:{type:{enum:["component"]},contents:{$ref:"#/definitions/content"}},required:["type","contents"],additionalProperties:!1},{properties:{type:{enum:["attach"]},contents:{$ref:"#/definitions/attachContents"}},required:["type","contents"],additionalProperties:!1},{properties:{type:{enum:["chunkedOp"]},contents:{$ref:"#/definitions/chunkedOpContents"}},required:["type","contents"],additionalProperties:!1},{$ref:"#/definitions/content"}]},D={type:"object",properties:{address:{type:"string"},contents:{type:"object",properties:{key:{type:"string"},refSeq:{type:"number"},serializedValue:{type:"string"},value:{type:"object",properties:{type:{type:"string"},value:{}},required:["type","value"],additionalProperties:!1},type:{type:"string",enum:["write"]}},required:["key","type"],additionalProperties:!1}},required:["address","contents"],additionalProperties:!1},N={type:"object",properties:{address:{type:"string"},contents:{type:"object",properties:{key:{type:"string"},path:{type:"string"},subdirName:{type:"string"},value:{type:"object",properties:{type:{type:"string"},value:{}},required:["type"],additionalProperties:!1},type:{type:"string",enum:["act","set","delete","clear","createSubDirectory","deleteSubDirectory"]}},required:["type"],additionalProperties:!1,oneOf:[{properties:{type:{enum:["act"]}},required:["key","path","value"]},{properties:{type:{enum:["set"]}},required:["key","value"]},{properties:{type:{enum:["delete"]}},required:["key"]},{properties:{type:{enum:["clear"]}},required:["path"]},{properties:{type:{enum:["createSubDirectory","deleteSubDirectory"]}},required:["path","subdirName"]}]}},required:["address","contents"],additionalProperties:!1},V={type:"object",properties:{id:{type:"string"},before:{type:"boolean"},offset:{type:"number"}},additionalProperties:!1},R={type:"object",properties:{type:{type:"number",minimum:0,maximum:2}},required:["type"],oneOf:[{properties:{type:{enum:[0]},seg:{type:["string","object"]},pos1:{type:"number"}},required:["pos1"],additionalProperties:!1},{properties:{type:{enum:[1]},register:{type:"string"},pos1:{type:"number"},pos2:{type:"number"}},required:["pos1"],additionalProperties:!1},{properties:{type:{enum:[2]},combiningOp:{type:"object",properties:{defaultValue:{},maxValue:{},minValue:{},name:{type:"string"}},required:["name"],additionalProperties:!1},pos1:{type:"number"},pos2:{type:"number"},props:{type:"object"},register:{type:"string"},relativePos1:{$ref:"#/definitions/relativePos"},relativePos2:{$ref:"#/definitions/relativePos"}},required:["props"],additionalProperties:!1}]},Z={definitions:{relativePos:V,deltaOp:R},type:"object",properties:{address:{type:"string"},contents:{$ref:"#/definitions/deltaOp"}},required:["address","contents"],additionalProperties:!1},B={definitions:{relativePos:V,deltaOp:R,groupOp:{type:"object",properties:{ops:{type:"array",items:{$ref:"#/definitions/deltaOp"}},type:{type:"number",minimum:3,maximum:3}},required:["ops","type"],additionalProperties:!1}},type:"object",properties:{address:{type:"string"},contents:{$ref:"#/definitions/groupOp"}},required:["address","contents"],additionalProperties:!1};!function(e){e[e.Generic=0]="Generic",e[e.Email=1]="Email",e[e.Name=2]="Name",e[e.FluidObject=3]="FluidObject",e[e.MapKey=4]="MapKey"}(E||(E={}));var _={valid:!1,toString:function(){return"Unmatched format"}},J=function(){function e(t,r){Object(i.a)(this,e),this.validateSchemaFn=t,this.debug=r,this.messages=new Array,this.parsedMessageContents=new Array,this.writtenBack=!1,this.concatenatedLength=0}return Object(a.a)(e,[{key:"debugMsg",value:function(e){this.debug&&console.error(e)}},{key:"addMessage",value:function(e){var t;this.messages.push(e);try{t=JSON.parse(e.contents),"op"===e.type&&(t=t.contents)}catch(r){this.debugMsg(r),this.debugMsg(e.contents)}this.validateSchemaFn(t,q),this.parsedMessageContents.push(t)}},{key:"hasAllMessages",value:function(){var e=this.parsedMessageContents[this.parsedMessageContents.length-1];return void 0!==e.chunkId&&e.chunkId===e.totalChunks}},{key:"getConcatenatedContents",value:function(){var e=this.parsedMessageContents.reduce((function(e,t){return e+t.contents}),"");this.concatenatedLength=e.length;try{return JSON.parse(e)}catch(t){return this.debugMsg(e),void this.debugMsg(t)}}},{key:"writeSanitizedContents",value:function(e){var t,r=this.parsedMessageContents[0].contents.length;try{t=JSON.stringify(e),Object(l.a)(t.length<=this.concatenatedLength,137)}catch(u){throw this.debugMsg(u),u}for(var n=0;n<this.messages.length;n++){var i=t.substring(n*r,(n+1)*r),a=this.parsedMessageContents[n];a.contents=i;var s=this.messages[n],o=void 0;try{if("op"===s.type){var c={type:"chunkedOp",contents:a};o=JSON.stringify(c)}else o=JSON.stringify(a)}catch(u){this.debugMsg(u)}s.contents=o}this.writtenBack=!0}},{key:"reset",value:function(){Object(l.a)(this.writtenBack,138),this.messages=new Array,this.parsedMessageContents=new Array,this.writtenBack=!1,this.concatenatedLength=0}},{key:"isPendingProcessing",value:function(){return 0!==this.messages.length}}]),e}(),L=function(){function e(t,r,n){var a=this,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Object(i.a)(this,e),this.messages=t,this.fullScrub=r,this.noBail=n,this.debug=s,this.validator=new F.Validator,this.defaultExcludedKeys=new Set,this.mergeTreeExcludedKeys=new Set,this.replacementMap=new Map,this.objectMatchesSchema=function(e,t){var r=!1===t?_:a.validator.validate(e,t);if(!r.valid){var n="Bad msg fmt:\n".concat(r.toString(),"\n").concat(JSON.stringify(e,void 0,2));if(!a.fullScrub&&!a.noBail)throw new Error(n);a.debugMsg(n)}return r.valid},this.chunkProcessor=new J(this.objectMatchesSchema,this.debug),this.wordTokenRegex=/\S+/g,this.replaceRandomTextFn=function(e){if(a.replacementMap.has(e))return a.replacementMap.get(e);var t=a.getRandomText(e.length);return a.replacementMap.set(e,t),t},this.defaultExcludedKeys.add("type"),this.defaultExcludedKeys.add("id"),this.defaultExcludedKeys.add("pkg"),this.defaultExcludedKeys.add("snapshotFormatVersion"),this.defaultExcludedKeys.add("packageVersion"),this.mergeTreeExcludedKeys.add("nodeType")}return Object(a.a)(e,[{key:"debugMsg",value:function(e){this.debug&&console.error(e)}},{key:"isFluidObjectKey",value:function(e){return"type"===e||"id"===e}},{key:"getRandomText",value:function(e){for(var t="";t.length<e;)t+=Math.random().toString(36).substring(2);return t.substr(0,e)}},{key:"replaceText",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E.Generic;if(void 0!==e)return r===E.FluidObject?this.replacementMap.has(e)?this.replacementMap.get(e):(t=this.fullScrub?this.getRandomText(e.length):e,this.replacementMap.set(e,t),t):e.replace(this.wordTokenRegex,this.replaceRandomTextFn)}},{key:"replaceArray",value:function(e){for(var t=0;t<e.length;t++){var r=e[t];"string"===typeof r?e[t]=this.replaceText(r):Array.isArray(r)?e[t]=this.replaceArray(r):"object"===typeof r&&(e[t]=this.replaceObject(r))}return e}},{key:"replaceObject",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.defaultExcludedKeys;if(null===e||void 0===e)return e;var n=Object.keys(e);return n.forEach((function(n){if(t.fullScrub||!r.has(n)){var i=e[n];"string"===typeof i?e[n]=t.replaceText(i,t.isFluidObjectKey(n)?E.FluidObject:E.Generic):Array.isArray(i)?e[n]=t.replaceArray(i):"object"===typeof i&&(e[n]=t.replaceObject(i,r))}})),e}},{key:"replaceAny",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.defaultExcludedKeys;return null===e||void 0===e?e:"string"===typeof e?this.replaceText(e):Array.isArray(e)?this.replaceArray(e):"object"===typeof e?this.replaceObject(e,t):e}},{key:"fixJoin",value:function(e){this.objectMatchesSchema(e.contents,P)||(e.contents=this.replaceAny(e.contents));try{var t=JSON.parse(e.data);if(this.objectMatchesSchema(t,C)){var r=t.detail.user;r.id=this.replaceText(r.id,E.Email),r.email=this.replaceText(r.email,E.Email),r.name=this.replaceText(r.name,E.Name)}else t=this.replaceAny(t);e.data=JSON.stringify(t)}catch(n){this.debugMsg(n)}}},{key:"fixPropose",value:function(e){var t,r,n,i;if(this.objectMatchesSchema(e.contents,M))if("string"===typeof e.contents)try{var a=JSON.parse(e.contents);if(this.fullScrub){var s=null===(t=a.value)||void 0===t?void 0:t.package;(null===s||void 0===s?void 0:s.name)&&(s.name=this.replaceText(s.name,E.FluidObject)),Array.isArray(null===(i=null===(n=null===(r=null===s||void 0===s?void 0:s.fluid)||void 0===r?void 0:r.browser)||void 0===n?void 0:n.umd)||void 0===i?void 0:i.files)&&(s.fluid.browser.umd.files=this.replaceArray(s.fluid.browser.umd.files))}}catch(o){this.debugMsg(o)}else this.fullScrub&&(e.contents.value=this.replaceText(e.contents.value,E.FluidObject));else e.contents=this.replaceAny(e.contents)}},{key:"fixAttachEntries",value:function(e){var t=this;e.forEach((function(e){if(e.value.entries)t.fixAttachEntries(e.value.entries);else try{if("string"===typeof e.value.contents){var r=JSON.parse(e.value.contents);r=t.replaceObject(r),e.value.contents=JSON.stringify(r)}}catch(n){t.debugMsg(n)}}))}},{key:"fixAttachContents",value:function(e){Object(l.a)("object"===typeof e,139),this.objectMatchesSchema(e,z)?(this.fullScrub&&(e.id=this.replaceText(e.id,E.FluidObject),e.type=this.replaceText(e.type,E.FluidObject)),this.fixAttachEntries(e.snapshot.entries)):this.replaceObject(e)}},{key:"fixAttach",value:function(e){if("string"===typeof e.contents)try{var t=JSON.parse(e.contents);this.fixAttachContents(t),e.contents=JSON.stringify(t)}catch(r){return void this.debugMsg(r)}else this.fixAttachContents(e.contents)}},{key:"fixDeltaOp",value:function(e){"string"===typeof e.seg?e.seg=this.replaceText(e.seg):e.seg=this.replaceObject(e.seg,this.mergeTreeExcludedKeys)}},{key:"fixOpContentsObject",value:function(e){var t=this;if(this.objectMatchesSchema(e,$)){this.fullScrub&&(e.address=this.replaceText(e.address,E.FluidObject));var r=e.contents.content;if(Object(l.a)(void 0!==r,140),"attach"===e.contents.type)if("string"===typeof e.contents.content)try{var n=JSON.parse(e.contents.content);this.fixAttachContents(n),e.contents.content=JSON.stringify(n)}catch(i){this.debugMsg(i)}else this.fixAttachContents(e.contents.content);else this.validator.validate(r,N).valid?(this.fullScrub&&(r.address=this.replaceText(r.address,E.FluidObject),r.contents.key=this.replaceText(r.contents.key,E.MapKey)),void 0!==r.contents.value&&(r.contents.value.value=this.replaceAny(r.contents.value.value))):this.validator.validate(r,B).valid?(this.fullScrub&&(r.address=this.replaceText(r.address,E.FluidObject)),r.contents.ops.forEach((function(e){t.fixDeltaOp(e)}))):this.validator.validate(r,Z).valid?(this.fullScrub&&(r.address=this.replaceText(r.address,E.FluidObject)),this.fixDeltaOp(r.contents)):this.validator.validate(r,D).valid?(this.fullScrub&&(r.address=this.replaceText(r.address,E.FluidObject),r.contents.key=this.replaceText(r.contents.key,E.MapKey)),void 0!==r.contents.value&&(r.contents.value.value=this.replaceAny(r.contents.value.value))):this.objectMatchesSchema(e,!1)}else this.replaceAny(e)}},{key:"fixOp",value:function(e){var t;if("string"===typeof e.contents)try{t=JSON.parse(e.contents)}catch(r){return void this.debugMsg(r)}else t=e.contents;if("attach"===t.type)this.fixAttach(t);else if("component"===t.type)this.fixOpContentsObject(t.contents);else{if("chunkedOp"===t.type)return this.fixChunkedOp(e);if("blobAttach"===t.type)return void this.debugMsg("TODO: blobAttach ops are skipped/unhandled");this.fixOpContentsObject(t)}if("string"===typeof e.contents)try{e.contents=JSON.stringify(t)}catch(r){return void this.debugMsg(r)}}},{key:"fixChunkedOp",value:function(e){if(this.chunkProcessor.addMessage(e),this.chunkProcessor.hasAllMessages()){var t=this.chunkProcessor.getConcatenatedContents();this.fixOpContentsObject(t),this.chunkProcessor.writeSanitizedContents(t),this.chunkProcessor.reset()}}},{key:"sanitize",value:function(){var e=this,t=0;try{this.messages.map((function(r){switch(t=r.sequenceNumber,r.type){case"join":e.fixJoin(r);break;case"propose":e.fixPropose(r);break;case"attach":e.fixAttach(r);break;case"op":e.fixOp(r);break;case"chunkedOp":e.fixChunkedOp(r);break;case"noop":case"leave":case"noClient":case"summarize":case"summaryAck":case"summaryNack":break;default:e.debugMsg("Unexpected op type ".concat(r.type))}})),Object(l.a)(!this.chunkProcessor.isPendingProcessing(),141)}catch(r){throw this.debugMsg("Error while processing sequenceNumber ".concat(t)),r}return this.messages}}]),e}(),U=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"===typeof __values?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,i,(t=e[r](t)).done,t.value)}))}}},K=function(e){return this instanceof K?(this.v=e,this):new K(e)},G=function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),a=[];return n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n;function s(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){a.push([e,t,r,n])>1||o(e,t)}))})}function o(e,t){try{(r=i[e](t)).value instanceof K?Promise.resolve(r.value.v).then(c,u):p(a[0][2],r)}catch(n){p(a[0][3],n)}var r}function c(e){o("next",e)}function u(e){o("throw",e)}function p(e,t){e(t),a.shift(),a.length&&o(a[0][0],a[0][1])}},W=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(){var e;return Object(i.a)(this,r),(e=t.apply(this,arguments)).ui=null,e.startSeqDeferred=new p.a,e.retryFetchOpsOnEndOfFile=!1,e.versions=[],e.stepsToPlay=0,e.lastOpReached=!1,e.versionCount=0,e}return Object(a.a)(r,[{key:"connectToUi",value:function(e){this.ui=e}},{key:"onClose",value:function(){this.startSeqDeferred.resolve(r.WindowClosedSeq)}},{key:"onVersionSelection",value:function(){var e=Object(n.a)(u.a.mark((function e(t){var n,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.documentStorageService){e.next=2;break}throw new Error("onVersionSelection: no storage");case 2:return e.next=4,this.documentStorageService.getSnapshotTree(t);case 4:return n=e.sent,e.next=7,r.seqFromTree(this.documentStorageService,n);case 7:i=e.sent,this.resolveStorage(i,new T(this.documentStorageService,n),t);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onOpButtonClick",value:function(e){this.stepsDeferred&&!Number.isNaN(e)&&e>0&&this.stepsDeferred.resolve(e)}},{key:"onSnapshotFileSelection",value:function(e){var t=this;if(/^snapshot.*\.json/.exec(e.name))if(/.*_expanded.*/.exec(e.name))alert("Incorrect file name - please use non-extended files: ".concat(e.name));else{var r=new FileReader;r.onload=Object(n.a)(u.a.mark((function n(){var i,a;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.documentStorageService){n.next=13;break}i=r.result,n.prev=2,a=JSON.parse(i),t.retryFetchOpsOnEndOfFile=!1,t.lastOpReached=!0,t.resolveStorage(Number.MAX_SAFE_INTEGER,new A(a),e.name),n.next=13;break;case 9:return n.prev=9,n.t0=n.catch(2),alert("Error parsing file: ".concat(n.t0)),n.abrupt("return");case 13:case"end":return n.stop()}}),n,null,[[2,9]])}))),r.readAsText(e,"utf-8")}else alert("Incorrect file name: ".concat(e.name))}},{key:"onDownloadOpsButtonClick",value:function(){var e=Object(n.a)(u.a.mark((function e(t){var r,n,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.documentService){e.next=2;break}throw new Error("DocumentService required");case 2:return e.next=4,this.documentService.connectToDeltaStorage();case 4:return r=e.sent,e.next=7,this.fetchOpsFromDeltaStorage(r);case 7:return n=e.sent,t&&(i=new L(n,!1,!1),n=i.sanitize()),e.abrupt("return",JSON.stringify(n,void 0,2));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchOpsFromDeltaStorage",value:function(){var e=Object(n.a)(u.a.mark((function e(t){var r,n,i,a,s,o,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=X(t),a=[],e.prev=2,s=U(i);case 4:return e.next=6,s.next();case 6:if((o=e.sent).done){e.next=12;break}c=o.value,a=a.concat(c);case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),r={error:e.t0};case 17:if(e.prev=17,e.prev=18,!o||o.done||!(n=s.return)){e.next=22;break}return e.next=22,n.call(s);case 22:if(e.prev=22,!r){e.next=25;break}throw r.error;case 25:return e.finish(22);case 26:return e.finish(17);case 27:return e.abrupt("return",a);case 28:case"end":return e.stop()}}),e,null,[[2,14,17,27],[18,,22,26]])})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchTo",value:function(e){}},{key:"isSelectionMade",value:function(){return void 0!==this.storage}},{key:"downloadVersionInfo",value:function(){var e=Object(n.a)(u.a.mark((function e(t,n,i,a){var s,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isSelectionMade()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,n;case 4:return e.next=6,t.getSnapshotTree(a);case 6:return s=e.sent,e.next=9,r.seqFromTree(t,s);case 9:o=e.sent,this.isSelectionMade()||(this.versionCount--,this.ui.updateVersionText(this.versionCount),this.ui.updateVersion(i,a,o));case 11:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"initStorage",value:function(){var e=Object(n.a)(u.a.mark((function e(t){var n,i,a,s,o,c=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.shouldUseController){e.next=2;break}return e.abrupt("return",this.shouldUseController);case 2:return Object(l.a)(!!t,128),Object(l.a)(!this.documentService,129),Object(l.a)(!this.documentStorageService,130),this.documentService=t,e.next=8,t.connectToStorage();case 8:if(this.documentStorageService=e.sent,this.isSelectionMade()){e.next=14;break}return e.next=12,this.documentStorageService.getVersions("",50);case 12:this.versions=e.sent,this.isSelectionMade()||(this.ui.addVersions(this.versions),this.ui.updateVersionText(this.versionCount));case 14:for(this.versionCount=this.versions.length,10,n=[],i=0;i<10;i++){for(a=Promise.resolve(),s=i;s<this.versions.length;s+=10)o=this.versions[s],a=this.downloadVersionInfo(this.documentStorageService,a,s,o);n.push(a)}return Promise.all(n).then((function(){c.ui.updateVersionText(0)})),e.next=21,this.startSeqDeferred.promise;case 21:return e.t0=e.sent,e.t1=r.WindowClosedSeq,this.shouldUseController=e.t0!==e.t1,Object(l.a)(this.isSelectionMade()===this.shouldUseController,131),e.abrupt("return",this.shouldUseController);case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readBlob",value:function(){var e=Object(n.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.storage){e.next=2;break}return e.abrupt("return",this.storage.readBlob(t));case 2:throw new Error("Reading blob before storage is setup properly");case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getVersions",value:function(){var e=Object(n.a)(u.a.mark((function e(t,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.storage){e.next=2;break}return e.abrupt("return",this.storage.getVersions(t,r));case 2:throw new Error("initStorage() was not called!");case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSnapshotTree",value:function(){var e=Object(n.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.storage){e.next=2;break}return e.abrupt("return",this.storage.getSnapshotTree(t));case 2:throw new Error("Reading snapshot tree before storage is setup properly");case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getStartingOpSequence",value:function(){var e=Object(n.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.startSeqDeferred.promise);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isDoneFetch",value:function(e,t){return void 0===t?(this.lastOpReached=!0,e===Number.MAX_SAFE_INTEGER?this.ui.updateLastOpText(-1,!1):this.ui.updateLastOpText(e,!1)):this.ui.updateLastOpText(e,!0),this.lastOpReached&&!this.retryFetchOpsOnEndOfFile}},{key:"replay",value:function(){var e=Object(n.a)(u.a.mark((function e(t,r){var n,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r;case 1:if(0!==n.length){e.next=5;break}return this.ui.updateNextOpText([]),e.abrupt("return");case 5:if(0!==this.stepsToPlay){e.next=14;break}return this.ui.disableNextOpButton(!1),this.stepsDeferred=new p.a,this.ui.updateNextOpText(n),e.next=11,this.stepsDeferred.promise;case 11:this.stepsToPlay=e.sent,this.stepsDeferred=void 0,this.ui.disableNextOpButton(!0);case 14:i=void 0,this.stepsToPlay>=n.length?(i=n,this.stepsToPlay-=n.length,n=[]):(i=n.splice(0,this.stepsToPlay),this.stepsToPlay=0),t(i),e.next=1;break;case 19:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"resolveStorage",value:function(e,t,r){Object(l.a)(!this.isSelectionMade(),132),Object(l.a)(!!t,133),this.storage=t,Object(l.a)(this.isSelectionMade(),134),this.ui.versionSelected(e,r),this.startSeqDeferred.resolve(e)}}],[{key:"create",value:function(e){if("object"===typeof localStorage&&null!==localStorage&&localStorage.FluidDebugger){var t=new r;if(e(t))return t}return null}},{key:"seqFromTree",value:function(){var e=Object(n.a)(u.a.mark((function e(t,r){var n,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",0);case 2:return n=r.trees[".protocol"].blobs.attributes,e.next=5,Object(d.a)(t,n);case 5:return i=e.sent,e.abrupt("return",i.sequenceNumber);case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(j);function X(e){return G(this,arguments,u.a.mark((function t(){var r,n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.fetchMessages(1,void 0);case 1:return t.next=4,K(r.read());case 4:if(!(n=t.sent).done){t.next=9;break}return t.next=8,K(void 0);case 8:return t.abrupt("return",t.sent);case 9:return t.next=11,K(n.value);case 11:return t.next=13,t.sent;case 13:t.next=1;break;case 15:case"end":return t.stop()}}),t)})))}W.WindowClosedSeq=-1;var Y=function(){function e(t,r){var n=this;Object(i.a)(this,e),this.controller=t,this.debuggerWindow=r,this.wasVersionSelected=!1,this.versions=[],this.documentClosed=!1;var a=this.debuggerWindow.document;a.write("<Title>Fluid Debugger</Title>\n<body>\n<h3>Fluid Debugger</h3>\nPlease select snapshot or file to start with<br/>\nClose debugger window to proceed to live document<br/><br/>\n<select style='width:250px' id='selector'>\n</select>\n&nbsp; &nbsp; &nbsp;\n<button id='buttonVers' style='width:60px'>Go</button><br/>\n<input id='file' type='file' value='Load from file'/>\n<br/><br/>\n<h4>Download the current document's ops</h4>\n<input type='checkbox' id='anonymize' value='Anonymize'>\n<label for='anonymize'>Anonymize</label>\n<button type='button' id='downloadOps'>Download ops</button>\n<br/><br/><div id='versionText'></div>\n</body>"),window.addEventListener("beforeunload",(function(e){n.documentClosed=!0,n.debuggerWindow.close()}),!1),this.debuggerWindow.addEventListener("beforeunload",(function(e){n.documentClosed||n.controller.onClose()}),!1),this.selector=a.getElementById("selector"),a.getElementById("buttonVers").onclick=function(){var e=n.selector.selectedIndex;t.onVersionSelection(n.versions[e])};var s=a.getElementById("file");s.addEventListener("change",(function(){var e=s.files;e&&t.onSnapshotFileSelection(e[0])}),!1);var o=a.getElementById("downloadOps"),c=a.getElementById("anonymize");this.attachDownloadOpsListener(o,c),this.versionText=a.getElementById("versionText"),this.versionText.textContent="Fetching snapshots, please wait...",t.connectToUi(this)}return Object(a.a)(e,[{key:"attachDownloadOpsListener",value:function(e,t){var r=this;e.addEventListener("click",(function(){r.controller.onDownloadOpsButtonClick(t.checked).then((function(e){r.download("opStream.json",e)})).catch((function(e){console.log("Error downloading ops: ".concat(e))}))}))}},{key:"addVersions",value:function(e){if(this.selector){this.versions=e;var t,r=Object(f.a)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value,i=document.createElement("option");void 0!==n.date?i.text="id = ".concat(n.id,",  time = ").concat(n.date):i.text="id = ".concat(n.id),this.selector.add(i)}}catch(a){r.e(a)}finally{r.f()}}}},{key:"updateVersion",value:function(e,t,r){if(this.selector){var n=this.selector[e];n.text="".concat(n.text,",  seq = ").concat(r),this.selector[e]=n}}},{key:"versionSelected",value:function(e,t){var r,n=this;r="string"===typeof t?"Playing ".concat(t," file"):"Playing from ".concat(t.id,", seq# ").concat(e),this.wasVersionSelected=!0,this.selector=void 0;var i=this.debuggerWindow.document;i.open(),i.write("<Title>Fluid Debugger</Title>\n<body>\n<h3>Fluid Debugger</h3>\n<div id='versionText'></div>\n<div id='lastOp'></div>\n<br/>\nStep to move: <input type='number' id='steps' value='1' min='1' style='width:50px'/>\n&nbsp; &nbsp; &nbsp;<button id='buttonOps' style='width:60px'>Go</button>\n<br/><br/>\n<div id='text1'></div><div id='text2'></div><div id='text3'></div>\n<br/>\n<h4>Download the current document's ops</h4>\n<input type='checkbox' id='anonymize' value='Anonymize'>\n<label for='anonymize'>Anonymize</label>\n<button type='button' id='downloadOps'>Download ops</button>\n</body>"),i.close(),this.lastOpText=i.getElementById("lastOp"),this.text1=i.getElementById("text1"),this.text2=i.getElementById("text2"),this.text3=i.getElementById("text3");var a=i.getElementById("steps");this.buttonOps=i.getElementById("buttonOps"),this.buttonOps.disabled=!0,this.buttonOps.onclick=function(){n.controller.onOpButtonClick(Number(a.value))},this.versionText=i.getElementById("versionText"),this.versionText.textContent=r;var s=i.getElementById("downloadOps"),o=i.getElementById("anonymize");this.attachDownloadOpsListener(s,o)}},{key:"disableNextOpButton",value:function(e){Object(l.a)(!!this.buttonOps,136),this.buttonOps.disabled=e}},{key:"updateNextOpText",value:function(t){if(0===t.length)this.text1.textContent="",this.text2.textContent="",this.text3.textContent="";else{var r=t[0],n=r.sequenceNumber,i=e.formatDate(r.timestamp);this.text1.textContent="Next op seq#: ".concat(n),this.text2.textContent="Type: ".concat(r.type),this.text3.textContent="".concat(i)}}},{key:"updateVersionText",value:function(e){if(!this.wasVersionSelected){var t=0===e?"":"Fetching information about ".concat(e," snapshots...");this.versionText.textContent=t}}},{key:"updateLastOpText",value:function(e,t){var r;e<0&&(r="FluidDebugger can't play ops in this mode"),r=t?"Last op (still loading): ".concat(e):"Document's last op seq#: ".concat(e),this.lastOpText.textContent=r}},{key:"download",value:function(e,t){var r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,".concat(encodeURIComponent(t))),r.setAttribute("download",e),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}}],[{key:"create",value:function(t){if("object"!==typeof window||null===window||"object"!==typeof window.document||null==window.document)return console.log("Can't create debugger window - not running in browser!"),null;var r=window.open("","","width=400,height=400,resizable=yes,location=no,menubar=no,titlebar=no,status=no,toolbar=no");return r?new e(t,r):(console.error("Can't create debugger window - please enable pop-up windows in your browser!"),null)}},{key:"formatDate",value:function(e){return new Date(e).toUTCString()}}]),e}(),H=r(706),Q=r(703),ee=r(323),te="documentId",re=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e,n,a){var s;return Object(i.a)(this,r),(s=t.call(this)).replayFrom=e,s.replayTo=n,s.unitIsTime=a,s.replayCurrent=0,!0!==a&&(s.replayTo=0),s}return Object(a.a)(r,[{key:"initStorage",value:function(){var e=Object(n.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getVersions",value:function(){var e=Object(n.a)(u.a.mark((function e(t,r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSnapshotTree",value:function(){var e=Object(n.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t?Promise.reject(new Error("Invalid operation")):null);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"readBlob",value:function(){var e=Object(n.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject(new Error("Invalid operation")));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getStartingOpSequence",value:function(){var e=Object(n.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchTo",value:function(e){if(!0!==this.unitIsTime&&this.replayTo>=0)return this.replayTo}},{key:"isDoneFetch",value:function(e,t){return this.replayTo>=0?!0===this.unitIsTime?void 0!==t&&void 0!==this.firstTimeStamp&&t-this.firstTimeStamp>=this.replayTo:e>=this.replayTo:void 0===t}},{key:"skipToIndex",value:function(e){if(this.replayFrom<=0)return 0;if(!0===this.unitIsTime)for(var t=0;t<e.length;t+=1){var r=e[t].timestamp;if(void 0!==r&&(void 0===this.firstTimeStamp&&(this.firstTimeStamp=r),r-this.firstTimeStamp>=this.replayFrom))return t}else if(this.replayFrom>this.replayCurrent)return this.replayFrom-this.replayCurrent;return 0}},{key:"replay",value:function(){var e=Object(n.a)(u.a.mark((function e(t,n){var i,a=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.skipToIndex(n),e.abrupt("return",new Promise((function(e){var s=function(){var e=n[i],s=[e],c=r.DelayInterval;if(i+=1,!0===a.unitIsTime){var u=e.timestamp;if(void 0!==u){for(;i<n.length;){var p=n[i];if(void 0===p.timestamp)break;var l=p.timestamp-u;if(l>=r.ReplayResolution){c=l;break}if(l<0)break;s.push(p),i+=1}void 0!==a.firstTimeStamp&&a.replayTo>=0&&u+c-a.firstTimeStamp>a.replayTo&&(c=-1)}}o(c),t(s)},o=function(t){t>=0&&i<n.length?setTimeout(s,t):(a.replayCurrent+=i,e())};o(r.DelayInterval)})));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(j);re.DelayInterval=50,re.ReplayResolution=15;var ne=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this)).details=e,n.maxMessageSize=r.ReplayMaxMessageSize,n._disposed=!1,n}return Object(a.a)(r,[{key:"clientId",get:function(){return this.details.clientId}},{key:"mode",get:function(){return this.details.mode}},{key:"claims",get:function(){return this.details.claims}},{key:"existing",get:function(){return this.details.existing}},{key:"version",get:function(){return this.details.version}},{key:"initialMessages",get:function(){return this.details.initialMessages}},{key:"initialSignals",get:function(){return this.details.initialSignals}},{key:"initialClients",get:function(){return this.details.initialClients}},{key:"serviceConfiguration",get:function(){return this.details.serviceConfiguration}},{key:"submit",value:function(e){throw new Error("ReplayDocumentDeltaConnection.submit() can't be called")}},{key:"submitSignal",value:function(){var e=Object(n.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"disposed",get:function(){return this._disposed}},{key:"dispose",value:function(){this._disposed=!0}},{key:"fetchAndEmitOps",value:function(){var e=Object(n.a)(u.a.mark((function e(t,r){var i,a,s,o,c,p,l,d=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Promise.resolve(),e.next=3,r.getStartingOpSequence();case 3:s=e.sent;case 4:o=r.fetchTo(s),c=new AbortController,p=t.fetchMessages(s+1,o,c.signal),l=u.a.mark((function e(){var t,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.read();case 2:if(!(t=e.sent).done){e.next=9;break}if(i=r.isDoneFetch(s,void 0)){e.next=8;break}return e.next=8,Object(Q.a)(2e3);case 8:return e.abrupt("return","break");case 9:a=a.then(Object(n.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.replay((function(e){return d.emit("op",te,e)}),o));case 1:case"end":return e.stop()}}),e)})))),o=t.value,s+=o.length,i=r.isDoneFetch(s,o[o.length-1].timestamp);case 13:case"end":return e.stop()}}),e)}));case 8:return e.delegateYield(l(),"t0",9);case 9:if("break"!==e.t0){e.next=12;break}return e.abrupt("break",13);case 12:if(!i){e.next=8;break}case 13:c.abort();case 14:if(!i){e.next=4;break}case 15:return e.abrupt("return",a);case 16:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}],[{key:"create",value:function(e,t){var n=new r({claims:r.claims,clientId:"PseudoClientId",existing:!0,initialMessages:[],initialSignals:[],initialClients:[],maxMessageSize:r.ReplayMaxMessageSize,mode:"read",serviceConfiguration:{blockSize:64436,maxMessageSize:r.ReplayMaxMessageSize,summary:{idleTime:5e3,maxOps:1e3,maxTime:6e4,maxAckWaitTime:6e5}},supportedVersions:[r.replayProtocolVersion],version:r.replayProtocolVersion});return n.fetchAndEmitOps(e,t),n}}]),r}(ee.a);ne.replayProtocolVersion="^0.1.0",ne.ReplayMaxMessageSize=16384,ne.claims={documentId:te,scopes:[H.a.DocRead],tenantId:"",user:{id:""},iat:Math.round((new Date).getTime()/1e3),exp:Math.round((new Date).getTime()/1e3)+3600,ver:"1.0"};var ie,ae=function(){function e(t,r){Object(i.a)(this,e),this.controller=t,this.deltaStorage=r}return Object(a.a)(e,[{key:"dispose",value:function(){}},{key:"resolvedUrl",get:function(){throw new Error("Not implemented")}},{key:"connectToStorage",value:function(){var e=Object(n.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.controller);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"connectToDeltaStorage",value:function(){var e=Object(n.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new k);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"connectToDeltaStream",value:function(){var e=Object(n.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.deltaStorage);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"create",value:function(){var t=Object(n.a)(u.a.mark((function t(r,n){var i;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.initStorage(r);case 2:if(t.sent){t.next=5;break}return t.abrupt("return",r);case 5:return t.t0=ne,t.next=8,r.connectToDeltaStorage();case 8:return t.t1=t.sent,t.t2=n,i=t.t0.create.call(t.t0,t.t1,t.t2),t.abrupt("return",new e(n,i));case 12:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()}]),e}(),se=r(81),oe=function(){function e(t,r){Object(i.a)(this,e),this.documentServiceFactory=t,this.controller=r,this.protocolName=t.protocolName}return Object(a.a)(e,[{key:"createDocumentService",value:function(){var e=Object(n.a)(u.a.mark((function e(t,r){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=se.a.create(r,void 0,{all:{isReplay:!0}}),e.t0=ae,e.next=4,this.documentServiceFactory.createDocumentService(t,n);case 4:return e.t1=e.sent,e.t2=this.controller,e.abrupt("return",e.t0.create.call(e.t0,e.t1,e.t2));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"createContainer",value:function(){var e=Object(n.a)(u.a.mark((function e(t,r,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not implemented");case 1:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()}],[{key:"create",value:function(t,r,n){return new e(n,new re(t,r))}}]),e}();!function(e){function t(){return(t=Object(n.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i()){e.next=3;break}return e.abrupt("return",t);case 3:return e.abrupt("return",ae.create(t,r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function r(){return(r=Object(n.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i()){e.next=3;break}return e.abrupt("return",t);case 3:return e.abrupt("return",new oe(t,r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.createFromService=function(e){return t.apply(this,arguments)},e.createFromServiceFactory=function(e){return r.apply(this,arguments)};var i=function(){return W.create((function(e){return Y.create(e)}))}}(ie||(ie={}))},742:function(e,t,r){"use strict";var n=r(54),i=t.ValidationError=function(e,t,r,n,i,a){if(Array.isArray(n)?(this.path=n,this.property=n.reduce((function(e,t){return e+l(t)}),"instance")):void 0!==n&&(this.property=n),e&&(this.message=e),r){var s=r.$id||r.id;this.schema=s||r}void 0!==t&&(this.instance=t),this.name=i,this.argument=a,this.stack=this.toString()};i.prototype.toString=function(){return this.property+" "+this.message};var a=t.ValidatorResult=function(e,t,r,n){this.instance=e,this.schema=t,this.options=r,this.path=n.path,this.propertyPath=n.propertyPath,this.errors=[],this.throwError=r&&r.throwError,this.throwFirst=r&&r.throwFirst,this.throwAll=r&&r.throwAll,this.disableFormat=r&&!0===r.disableFormat};function s(e,t){return t+": "+e.toString()+"\n"}function o(e){Error.captureStackTrace&&Error.captureStackTrace(this,o),this.instance=e.instance,this.schema=e.schema,this.options=e.options,this.errors=e.errors}a.prototype.addError=function(e){var t;if("string"==typeof e)t=new i(e,this.instance,this.schema,this.path);else{if(!e)throw new Error("Missing error detail");if(!e.message)throw new Error("Missing error message");if(!e.name)throw new Error("Missing validator type");t=new i(e.message,this.instance,this.schema,this.path,e.name,e.argument)}if(this.errors.push(t),this.throwFirst)throw new o(this);if(this.throwError)throw t;return t},a.prototype.importErrors=function(e){"string"==typeof e||e&&e.validatorType?this.addError(e):e&&e.errors&&Array.prototype.push.apply(this.errors,e.errors)},a.prototype.toString=function(e){return this.errors.map(s).join("")},Object.defineProperty(a.prototype,"valid",{get:function(){return!this.errors.length}}),e.exports.ValidatorResultError=o,o.prototype=new Error,o.prototype.constructor=o,o.prototype.name="Validation Error";var c=t.SchemaError=function e(t,r){this.message=t,this.schema=r,Error.call(this,t),Error.captureStackTrace(this,e)};c.prototype=Object.create(Error.prototype,{constructor:{value:c,enumerable:!1},name:{value:"SchemaError",enumerable:!1}});var u=t.SchemaContext=function(e,t,r,n,i){this.schema=e,this.options=t,Array.isArray(r)?(this.path=r,this.propertyPath=r.reduce((function(e,t){return e+l(t)}),"instance")):this.propertyPath=r,this.base=n,this.schemas=i};u.prototype.resolve=function(e){return n.resolve(this.base,e)},u.prototype.makeChild=function(e,t){var r=void 0===t?this.path:this.path.concat([t]),i=e.$id||e.id,a=n.resolve(this.base,i||""),s=new u(e,this.options,r,a,Object.create(this.schemas));return i&&!s.schemas[a]&&(s.schemas[a]=e),s};var p=t.FORMAT_REGEXPS={"date-time":/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\.\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,date:/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,time:/^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,email:/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/,"ip-address":/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipv6:/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,uri:/^[a-zA-Z][a-zA-Z0-9+-.]*:[^\s]*$/,"uri-reference":/^(((([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|([A-Za-z][+\-.0-9A-Za-z]*:?)?)|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?)?))#(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(([A-Za-z][+\-.0-9A-Za-z]*)?%[0-9A-Fa-f]{2}|[!$&-.0-9;=@_~]|[A-Za-z][+\-.0-9A-Za-z]*[!$&-*,;=@_~])(%[0-9A-Fa-f]{2}|[!$&-.0-9;=@-Z_a-z~])*((([/?](%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?#|[/?])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?|([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+(:\d*)?|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?:\d*|\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)?|[A-Za-z][+\-.0-9A-Za-z]*:?)?$/,color:/^(#?([0-9A-Fa-f]{3}){1,2}\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\(\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(rgb\(\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*\)))$/,hostname:/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"host-name":/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,alpha:/^[a-zA-Z]+$/,alphanumeric:/^[a-zA-Z0-9]+$/,"utc-millisec":function(e){return"string"===typeof e&&parseFloat(e)===parseInt(e,10)&&!isNaN(e)},regex:function(e){var t=!0;try{new RegExp(e)}catch(r){t=!1}return t},style:/\s*(.+?):\s*([^;]+);?/,phone:/^\+(?:[0-9] ?){6,14}[0-9]$/};p.regexp=p.regex,p.pattern=p.regex,p.ipv4=p["ip-address"],t.isFormat=function(e,t,r){if("string"===typeof e&&void 0!==p[t]){if(p[t]instanceof RegExp)return p[t].test(e);if("function"===typeof p[t])return p[t](e)}else if(r&&r.customFormats&&"function"===typeof r.customFormats[t])return r.customFormats[t](e);return!0};var l=t.makeSuffix=function(e){return(e=e.toString()).match(/[.\s\[\]]/)||e.match(/^[\d]/)?e.match(/^\d+$/)?"["+e+"]":"["+JSON.stringify(e)+"]":"."+e};function d(e,t,r,n){"object"===typeof r?t[n]=m(e[n],r):-1===e.indexOf(r)&&t.push(r)}function h(e,t,r){t[r]=e[r]}function f(e,t,r,n){"object"===typeof t[n]&&t[n]&&e[n]?r[n]=m(e[n],t[n]):r[n]=t[n]}function m(e,t){var r=Array.isArray(t),n=r&&[]||{};return r?(e=e||[],n=n.concat(e),t.forEach(d.bind(null,e,n))):(e&&"object"===typeof e&&Object.keys(e).forEach(h.bind(null,e,n)),Object.keys(t).forEach(f.bind(null,e,t,n))),n}function y(e){return"/"+encodeURIComponent(e).replace(/~/g,"%7E")}t.deepCompareStrict=function e(t,r){if(typeof t!==typeof r)return!1;if(Array.isArray(t))return!!Array.isArray(r)&&(t.length===r.length&&t.every((function(n,i){return e(t[i],r[i])})));if("object"===typeof t){if(!t||!r)return t===r;var n=Object.keys(t),i=Object.keys(r);return n.length===i.length&&n.every((function(n){return e(t[n],r[n])}))}return t===r},e.exports.deepMerge=m,t.objectGetPath=function(e,t){for(var r,n=t.split("/").slice(1);"string"==typeof(r=n.shift());){var i=decodeURIComponent(r.replace(/~0/,"~").replace(/~1/g,"/"));if(!(i in e))return;e=e[i]}return e},t.encodePath=function(e){return e.map(y).join("")},t.getDecimalPlaces=function(e){var t=0;if(isNaN(e))return t;"number"!==typeof e&&(e=Number(e));var r=e.toString().split("e");if(2===r.length){if("-"!==r[1][0])return t;t=Number(r[1].slice(1))}var n=r[0].split(".");return 2===n.length&&(t+=n[1].length),t},t.isSchema=function(e){return"object"===typeof e&&e||"boolean"===typeof e}},764:function(e,t,r){"use strict";var n=r(54),i=r(742);function a(e,t){this.id=e,this.ref=t}e.exports.SchemaScanResult=a,e.exports.scan=function(e,t){function r(e,t){if(t&&"object"==typeof t)if(t.$ref){var a=n.resolve(e,t.$ref);u[a]=u[a]?u[a]+1:0}else{var p=t.$id||t.id,l=p?n.resolve(e,p):e;if(l){if(l.indexOf("#")<0&&(l+="#"),c[l]){if(!i.deepCompareStrict(c[l],t))throw new Error("Schema <"+l+"> already exists with different definition");return c[l]}c[l]=t,"#"==l[l.length-1]&&(c[l.substring(0,l.length-1)]=t)}s(l+"/items",Array.isArray(t.items)?t.items:[t.items]),s(l+"/extends",Array.isArray(t.extends)?t.extends:[t.extends]),r(l+"/additionalItems",t.additionalItems),o(l+"/properties",t.properties),r(l+"/additionalProperties",t.additionalProperties),o(l+"/definitions",t.definitions),o(l+"/patternProperties",t.patternProperties),o(l+"/dependencies",t.dependencies),s(l+"/disallow",t.disallow),s(l+"/allOf",t.allOf),s(l+"/anyOf",t.anyOf),s(l+"/oneOf",t.oneOf),r(l+"/not",t.not)}}function s(e,t){if(Array.isArray(t))for(var n=0;n<t.length;n++)r(e+"/"+n,t[n])}function o(e,t){if(t&&"object"==typeof t)for(var n in t)r(e+"/"+n,t[n])}var c={},u={};return r(e,t),new a(c,u)}},870:function(e,t,r){"use strict";var n=e.exports.Validator=r(871);e.exports.ValidatorResult=r(742).ValidatorResult,e.exports.ValidatorResultError=r(742).ValidatorResultError,e.exports.ValidationError=r(742).ValidationError,e.exports.SchemaError=r(742).SchemaError,e.exports.SchemaScanResult=r(764).SchemaScanResult,e.exports.scan=r(764).scan,e.exports.validate=function(e,t,r){return(new n).validate(e,t,r)}},871:function(e,t,r){"use strict";var n=r(54),i=r(872),a=r(742),s=r(764).scan,o=a.ValidatorResult,c=a.ValidatorResultError,u=a.SchemaError,p=a.SchemaContext,l=function e(){this.customFormats=Object.create(e.prototype.customFormats),this.schemas={},this.unresolvedRefs=[],this.types=Object.create(h),this.attributes=Object.create(i.validators)};function d(e){var t="string"===typeof e?e:e.$ref;return"string"==typeof t&&t}l.prototype.customFormats={},l.prototype.schemas=null,l.prototype.types=null,l.prototype.attributes=null,l.prototype.unresolvedRefs=null,l.prototype.addSchema=function(e,t){var r=this;if(!e)return null;var n=s(t||"/",e),i=t||e.$id||e.id;for(var a in n.id)this.schemas[a]=n.id[a];for(var a in n.ref)this.unresolvedRefs.push(a);return this.unresolvedRefs=this.unresolvedRefs.filter((function(e){return"undefined"===typeof r.schemas[e]})),this.schemas[i]},l.prototype.addSubSchemaArray=function(e,t){if(Array.isArray(t))for(var r=0;r<t.length;r++)this.addSubSchema(e,t[r])},l.prototype.addSubSchemaObject=function(e,t){if(t&&"object"==typeof t)for(var r in t)this.addSubSchema(e,t[r])},l.prototype.setSchemas=function(e){this.schemas=e},l.prototype.getSchema=function(e){return this.schemas[e]},l.prototype.validate=function(e,t,r,i){if("boolean"!==typeof t&&"object"!==typeof t||null===t)throw new u("Expected `schema` to be an object or boolean");r||(r={});var a,l=t.$id||t.id,d=n.resolve(r.base||"/",l||"");if(!i){(i=new p(t,r,[],d,Object.create(this.schemas))).schemas[d]||(i.schemas[d]=t);var h=s(d,t);for(var f in h.id){var m=h.id[f];i.schemas[f]=m}}if(r.required&&void 0===e)return(a=new o(e,t,r,i)).addError("is required, but is undefined"),a;if(!(a=this.validateSchema(e,t,r,i)))throw new Error("Result undefined");if(r.throwAll&&a.errors.length)throw new c(a);return a},l.prototype.validateSchema=function(e,t,r,n){var s=new o(e,t,r,n);if("boolean"===typeof t)!0===t?t={}:!1===t&&(t={type:[]});else if(!t)throw new Error("schema is undefined");if(t.extends)if(Array.isArray(t.extends)){var c={schema:t,ctx:n};t.extends.forEach(this.schemaTraverser.bind(this,c)),t=c.schema,c.schema=null,c.ctx=null,c=null}else t=a.deepMerge(t,this.superResolve(t.extends,n));var l=d(t);if(l){var h=this.resolve(t,l,n),f=new p(h.subschema,r,n.path,h.switchSchema,n.schemas);return this.validateSchema(e,h.subschema,r,f)}var m=r&&r.skipAttributes||[];for(var y in t)if(!i.ignoreProperties[y]&&m.indexOf(y)<0){var v=null,b=this.attributes[y];if(b)v=b.call(this,e,t,r,n);else if(!1===r.allowUnknownAttributes)throw new u("Unsupported attribute: "+y,t);v&&s.importErrors(v)}if("function"==typeof r.rewrite){var g=r.rewrite.call(this,e,t,r,n);s.instance=g}return s},l.prototype.schemaTraverser=function(e,t){e.schema=a.deepMerge(e.schema,this.superResolve(t,e.ctx))},l.prototype.superResolve=function(e,t){var r=d(e);return r?this.resolve(e,r,t).subschema:e},l.prototype.resolve=function(e,t,r){if(t=r.resolve(t),r.schemas[t])return{subschema:r.schemas[t],switchSchema:t};var i=n.parse(t),s=i&&i.hash,o=s&&s.length&&t.substr(0,t.length-s.length);if(!o||!r.schemas[o])throw new u("no such schema <"+t+">",e);var c=a.objectGetPath(r.schemas[o],s.substr(1));if(void 0===c)throw new u("no such schema "+s+" located in <"+o+">",e);return{subschema:c,switchSchema:t}},l.prototype.testType=function(e,t,r,n,i){if(void 0!==i){if(null===i)throw new u('Unexpected null in "type" keyword');if("function"==typeof this.types[i])return this.types[i].call(this,e);if(i&&"object"==typeof i){var a=this.validateSchema(e,i,r,n);return void 0===a||!(a&&a.errors.length)}return!0}};var h=l.prototype.types={};h.string=function(e){return"string"==typeof e},h.number=function(e){return"number"==typeof e&&isFinite(e)},h.integer=function(e){return"number"==typeof e&&e%1===0},h.boolean=function(e){return"boolean"==typeof e},h.array=function(e){return Array.isArray(e)},h.null=function(e){return null===e},h.date=function(e){return e instanceof Date},h.any=function(e){return!0},h.object=function(e){return e&&"object"===typeof e&&!Array.isArray(e)&&!(e instanceof Date)},e.exports=l},872:function(e,t,r){"use strict";var n=r(742),i=n.ValidatorResult,a=n.SchemaError,s={ignoreProperties:{id:!0,default:!0,description:!0,title:!0,additionalItems:!0,then:!0,else:!0,$schema:!0,$ref:!0,extends:!0}},o=s.validators={};function c(e,t,r,n,i){var a=t.throwError,s=t.throwAll;t.throwError=!1,t.throwAll=!1;var o=this.validateSchema(e,i,t,r);return t.throwError=a,t.throwAll=s,!o.valid&&n instanceof Function&&n(o),o.valid}function u(e,t){if(Object.hasOwnProperty.call(e,t))return e[t];if(t in e)for(;e=Object.getPrototypeOf(e);)if(Object.propertyIsEnumerable.call(e,t))return e[t]}function p(e,t,r,n,i,a){if(this.types.object(e)&&(!t.properties||void 0===t.properties[i]))if(!1===t.additionalProperties)a.addError({name:"additionalProperties",argument:i,message:"is not allowed to have the additional property "+JSON.stringify(i)});else{var s=t.additionalProperties||{};"function"==typeof r.preValidateProperty&&r.preValidateProperty(e,i,s,r,n);var o=this.validateSchema(e[i],s,r,n.makeChild(s,i));o.instance!==a.instance[i]&&(a.instance[i]=o.instance),a.importErrors(o)}}o.type=function(e,t,r,n){if(void 0===e)return null;var a=new i(e,t,r,n),s=Array.isArray(t.type)?t.type:[t.type];if(!s.some(this.testType.bind(this,e,t,r,n))){var o=s.map((function(e){if(e){var t=e.$id||e.id;return t?"<"+t+">":e+""}}));a.addError({name:"type",argument:o,message:"is not of a type(s) "+o})}return a},o.anyOf=function(e,t,r,n){if(void 0===e)return null;var s=new i(e,t,r,n),o=new i(e,t,r,n);if(!Array.isArray(t.anyOf))throw new a("anyOf must be an array");if(!t.anyOf.some(c.bind(this,e,r,n,(function(e){o.importErrors(e)})))){var u=t.anyOf.map((function(e,t){var r=e.$id||e.id;return r?"<"+r+">":e.title&&JSON.stringify(e.title)||e.$ref&&"<"+e.$ref+">"||"[subschema "+t+"]"}));r.nestedErrors&&s.importErrors(o),s.addError({name:"anyOf",argument:u,message:"is not any of "+u.join(",")})}return s},o.allOf=function(e,t,r,n){if(void 0===e)return null;if(!Array.isArray(t.allOf))throw new a("allOf must be an array");var s=new i(e,t,r,n),o=this;return t.allOf.forEach((function(t,i){var a=o.validateSchema(e,t,r,n);if(!a.valid){var c=t.$id||t.id||t.title&&JSON.stringify(t.title)||t.$ref&&"<"+t.$ref+">"||"[subschema "+i+"]";s.addError({name:"allOf",argument:{id:c,length:a.errors.length,valid:a},message:"does not match allOf schema "+c+" with "+a.errors.length+" error[s]:"}),s.importErrors(a)}})),s},o.oneOf=function(e,t,r,n){if(void 0===e)return null;if(!Array.isArray(t.oneOf))throw new a("oneOf must be an array");var s=new i(e,t,r,n),o=new i(e,t,r,n),u=t.oneOf.filter(c.bind(this,e,r,n,(function(e){o.importErrors(e)}))).length,p=t.oneOf.map((function(e,t){return e.$id||e.id||e.title&&JSON.stringify(e.title)||e.$ref&&"<"+e.$ref+">"||"[subschema "+t+"]"}));return 1!==u&&(r.nestedErrors&&s.importErrors(o),s.addError({name:"oneOf",argument:p,message:"is not exactly one from "+p.join(",")})),s},o.if=function(e,t,r,a){if(void 0===e)return null;if(!n.isSchema(t.if))throw new Error('Expected "if" keyword to be a schema');var s,o=c.call(this,e,r,a,null,t.if),u=new i(e,t,r,a);if(o){if(void 0===t.then)return;if(!n.isSchema(t.then))throw new Error('Expected "then" keyword to be a schema');s=this.validateSchema(e,t.then,r,a.makeChild(t.then)),u.importErrors(s)}else{if(void 0===t.else)return;if(!n.isSchema(t.else))throw new Error('Expected "else" keyword to be a schema');s=this.validateSchema(e,t.else,r,a.makeChild(t.else)),u.importErrors(s)}return u},o.propertyNames=function(e,t,r,s){if(this.types.object(e)){var o=new i(e,t,r,s),c=void 0!==t.propertyNames?t.propertyNames:{};if(!n.isSchema(c))throw new a('Expected "propertyNames" to be a schema (object or boolean)');for(var p in e)if(void 0!==u(e,p)){var l=this.validateSchema(p,c,r,s.makeChild(c));o.importErrors(l)}return o}},o.properties=function(e,t,r,n){if(this.types.object(e)){var s=new i(e,t,r,n),o=t.properties||{};for(var c in o){var p=o[c];if(void 0!==p){if(null===p)throw new a('Unexpected null, expected schema in "properties"');"function"==typeof r.preValidateProperty&&r.preValidateProperty(e,c,p,r,n);var l=u(e,c),d=this.validateSchema(l,p,r,n.makeChild(p,c));d.instance!==s.instance[c]&&(s.instance[c]=d.instance),s.importErrors(d)}}return s}},o.patternProperties=function(e,t,r,n){if(this.types.object(e)){var s=new i(e,t,r,n),o=t.patternProperties||{};for(var c in e){var u=!0;for(var l in o){var d=o[l];if(void 0!==d){if(null===d)throw new a('Unexpected null, expected schema in "patternProperties"');try{var h=new RegExp(l,"u")}catch(m){h=new RegExp(l)}if(h.test(c)){u=!1,"function"==typeof r.preValidateProperty&&r.preValidateProperty(e,c,d,r,n);var f=this.validateSchema(e[c],d,r,n.makeChild(d,c));f.instance!==s.instance[c]&&(s.instance[c]=f.instance),s.importErrors(f)}}}u&&p.call(this,e,t,r,n,c,s)}return s}},o.additionalProperties=function(e,t,r,n){if(this.types.object(e)){if(t.patternProperties)return null;var a=new i(e,t,r,n);for(var s in e)p.call(this,e,t,r,n,s,a);return a}},o.minProperties=function(e,t,r,n){if(this.types.object(e)){var a=new i(e,t,r,n);return Object.keys(e).length>=t.minProperties||a.addError({name:"minProperties",argument:t.minProperties,message:"does not meet minimum property length of "+t.minProperties}),a}},o.maxProperties=function(e,t,r,n){if(this.types.object(e)){var a=new i(e,t,r,n);return Object.keys(e).length<=t.maxProperties||a.addError({name:"maxProperties",argument:t.maxProperties,message:"does not meet maximum property length of "+t.maxProperties}),a}},o.items=function(e,t,r,n){var a=this;if(this.types.array(e)&&t.items){var s=new i(e,t,r,n);return e.every((function(e,i){var o=Array.isArray(t.items)?t.items[i]||t.additionalItems:t.items;if(void 0===o)return!0;if(!1===o)return s.addError({name:"items",message:"additionalItems not permitted"}),!1;var c=a.validateSchema(e,o,r,n.makeChild(o,i));return c.instance!==s.instance[i]&&(s.instance[i]=c.instance),s.importErrors(c),!0})),s}},o.minimum=function(e,t,r,n){if(this.types.number(e)){var a=new i(e,t,r,n);return t.exclusiveMinimum&&!0===t.exclusiveMinimum?e>t.minimum||a.addError({name:"minimum",argument:t.minimum,message:"must be greater than "+t.minimum}):e>=t.minimum||a.addError({name:"minimum",argument:t.minimum,message:"must be greater than or equal to "+t.minimum}),a}},o.maximum=function(e,t,r,n){if(this.types.number(e)){var a=new i(e,t,r,n);return t.exclusiveMaximum&&!0===t.exclusiveMaximum?e<t.maximum||a.addError({name:"maximum",argument:t.maximum,message:"must be less than "+t.maximum}):e<=t.maximum||a.addError({name:"maximum",argument:t.maximum,message:"must be less than or equal to "+t.maximum}),a}},o.exclusiveMinimum=function(e,t,r,n){if("boolean"!==typeof t.exclusiveMaximum&&this.types.number(e)){var a=new i(e,t,r,n);return e>t.exclusiveMinimum||a.addError({name:"exclusiveMinimum",argument:t.exclusiveMinimum,message:"must be strictly greater than "+t.exclusiveMinimum}),a}},o.exclusiveMaximum=function(e,t,r,n){if("boolean"!==typeof t.exclusiveMaximum&&this.types.number(e)){var a=new i(e,t,r,n);return e<t.exclusiveMaximum||a.addError({name:"exclusiveMaximum",argument:t.exclusiveMaximum,message:"must be strictly less than "+t.exclusiveMaximum}),a}};var l=function(e,t,r,s,o,c){if(this.types.number(e)){var u=t[o];if(0==u)throw new a(o+" cannot be zero");var p=new i(e,t,r,s),l=n.getDecimalPlaces(e),d=n.getDecimalPlaces(u),h=Math.max(l,d),f=Math.pow(10,h);return Math.round(e*f)%Math.round(u*f)!==0&&p.addError({name:o,argument:u,message:c+JSON.stringify(u)}),p}};function d(e,t,r){var i,a=r.length;for(i=t+1;i<a;i++)if(n.deepCompareStrict(e,r[i]))return!1;return!0}o.multipleOf=function(e,t,r,n){return l.call(this,e,t,r,n,"multipleOf","is not a multiple of (divisible by) ")},o.divisibleBy=function(e,t,r,n){return l.call(this,e,t,r,n,"divisibleBy","is not divisible by (multiple of) ")},o.required=function(e,t,r,n){var a=new i(e,t,r,n);return void 0===e&&!0===t.required?a.addError({name:"required",message:"is required"}):this.types.object(e)&&Array.isArray(t.required)&&t.required.forEach((function(t){void 0===u(e,t)&&a.addError({name:"required",argument:t,message:"requires property "+JSON.stringify(t)})})),a},o.pattern=function(e,t,r,n){if(this.types.string(e)){var a=new i(e,t,r,n),s=t.pattern;try{var o=new RegExp(s,"u")}catch(c){o=new RegExp(s)}return e.match(o)||a.addError({name:"pattern",argument:t.pattern,message:"does not match pattern "+JSON.stringify(t.pattern.toString())}),a}},o.format=function(e,t,r,a){if(void 0!==e){var s=new i(e,t,r,a);return s.disableFormat||n.isFormat(e,t.format,this)||s.addError({name:"format",argument:t.format,message:"does not conform to the "+JSON.stringify(t.format)+" format"}),s}},o.minLength=function(e,t,r,n){if(this.types.string(e)){var a=new i(e,t,r,n),s=e.match(/[\uDC00-\uDFFF]/g);return e.length-(s?s.length:0)>=t.minLength||a.addError({name:"minLength",argument:t.minLength,message:"does not meet minimum length of "+t.minLength}),a}},o.maxLength=function(e,t,r,n){if(this.types.string(e)){var a=new i(e,t,r,n),s=e.match(/[\uDC00-\uDFFF]/g);return e.length-(s?s.length:0)<=t.maxLength||a.addError({name:"maxLength",argument:t.maxLength,message:"does not meet maximum length of "+t.maxLength}),a}},o.minItems=function(e,t,r,n){if(this.types.array(e)){var a=new i(e,t,r,n);return e.length>=t.minItems||a.addError({name:"minItems",argument:t.minItems,message:"does not meet minimum length of "+t.minItems}),a}},o.maxItems=function(e,t,r,n){if(this.types.array(e)){var a=new i(e,t,r,n);return e.length<=t.maxItems||a.addError({name:"maxItems",argument:t.maxItems,message:"does not meet maximum length of "+t.maxItems}),a}},o.uniqueItems=function(e,t,r,n){if(!0===t.uniqueItems&&this.types.array(e)){var a=new i(e,t,r,n);return e.every(d)||a.addError({name:"uniqueItems",message:"contains duplicate item"}),a}},o.dependencies=function(e,t,r,n){if(this.types.object(e)){var a=new i(e,t,r,n);for(var s in t.dependencies)if(void 0!==e[s]){var o=t.dependencies[s],c=n.makeChild(o,s);if("string"==typeof o&&(o=[o]),Array.isArray(o))o.forEach((function(t){void 0===e[t]&&a.addError({name:"dependencies",argument:c.propertyPath,message:"property "+t+" not found, required by "+c.propertyPath})}));else{var u=this.validateSchema(e,o,r,c);a.instance!==u.instance&&(a.instance=u.instance),u&&u.errors.length&&(a.addError({name:"dependencies",argument:c.propertyPath,message:"does not meet dependency required by "+c.propertyPath}),a.importErrors(u))}}return a}},o.enum=function(e,t,r,s){if(void 0===e)return null;if(!Array.isArray(t.enum))throw new a("enum expects an array",t);var o=new i(e,t,r,s);return t.enum.some(n.deepCompareStrict.bind(null,e))||o.addError({name:"enum",argument:t.enum,message:"is not one of enum values: "+t.enum.map(String).join(",")}),o},o.const=function(e,t,r,a){if(void 0===e)return null;var s=new i(e,t,r,a);return n.deepCompareStrict(t.const,e)||s.addError({name:"const",argument:t.const,message:"does not exactly match expected constant: "+t.const}),s},o.not=o.disallow=function(e,t,r,n){var a=this;if(void 0===e)return null;var s=new i(e,t,r,n),o=t.not||t.disallow;return o?(Array.isArray(o)||(o=[o]),o.forEach((function(i){if(a.testType(e,t,r,n,i)){var o=i&&(i.$id||i.id)||i;s.addError({name:"not",argument:o,message:"is of prohibited type "+o})}})),s):null},e.exports=s}}]);
//# sourceMappingURL=271.c8313a73.chunk.js.map