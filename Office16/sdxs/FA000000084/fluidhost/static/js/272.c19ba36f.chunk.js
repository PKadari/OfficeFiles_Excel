(this.webpackJsonpfluidhost=this.webpackJsonpfluidhost||[]).push([[272],{1267:function(e,t,r){"use strict";var n;r.d(t,"a",(function(){return n})),function(e){e[e.default=1]="default",e[e.copyLink=2]="copyLink",e[e.atMention=3]="atMention"}(n||(n={}))},675:function(e,t,r){"use strict";r.r(t),r.d(t,"SharepointShareService",(function(){return j}));var n=r(1),a=r(3),o=r(2),i=r(0),s=r.n(i),c=r(1267),u=r(79),l=r(892),d=r(779),p=r(334),f=r(212),h=r(893),m=r(1287),v=r(907),b=r(743),g=function(){var e=Object(n.a)(s.a.mark((function e(t,r,n,a,o){var i,c,u,l,d,g;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=p.a.start(b.a.CheckDocumentAccess,a),e.prev=1,c=Object(f.a)(r.siteUrl),u="Consumer"===n.identityType,l={getToken:function(e){var t=Object.assign(Object.assign({},e),{siteUrl:r.siteUrl,driveId:r.driveId,itemId:r.itemId});return n.getToken(Object(v.a)(c,u),t)},url:"".concat(c,"/_api/v2.1/drives/").concat(r.driveId,"/items/").concat(r.itemId,"/oneDrive.checkAccess"),tenantId:o,requestInit:{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:[{email:t}]})},retryPolicy:h.b,tokenPolicy:Object(h.a)(n,!1)},!a){e.next=11;break}return e.next=8,Object(m.b)(Object.assign(Object.assign({},l),{logger:a,nameForLogging:b.a.CheckDocumentAccess}));case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,Object(m.a)(l);case 13:e.t0=e.sent;case 14:return d=e.t0,e.next=17,d.result.json();case 17:return g=e.sent,i.setResult(!0),e.abrupt("return",g&&g.value&&g.value[0]&&g.value[0].canWrite);case 22:return e.prev=22,e.t1=e.catch(1),i.setResult(!1,{errorType:b.b.CheckDocumentAccessError}),e.abrupt("return",Promise.reject(e.t1));case 26:case"end":return e.stop()}}),e,null,[[1,22]])})));return function(t,r,n,a,o){return e.apply(this,arguments)}}(),O=function(){var e=Object(n.a)(s.a.mark((function e(t,r,n,a){var o,i,c,u,l,d,g,O,j,y,I,P;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=p.a.start(b.a.GetPermissions,n),e.prev=1,i=Object(f.a)(t.siteUrl),!(c="Consumer"===r.identityType)){e.next=6;break}throw new Error("Getting permissions for consumer account is not supported.");case 6:if(u={getToken:function(e){var n=Object.assign(Object.assign({},e),{siteUrl:t.siteUrl,driveId:t.driveId,itemId:t.itemId});return r.getToken(Object(v.a)(i,c),n)},url:"".concat(i,"/_api/v2.1/drives/").concat(t.driveId,"/items/").concat(t.itemId,"/permissions"),tenantId:a,requestInit:{method:"GET"},retryPolicy:h.b,tokenPolicy:Object(h.a)(r)},!n){e.next=13;break}return e.next=10,Object(m.b)(Object.assign(Object.assign({},u),{logger:n,nameForLogging:"GetPermissions"}));case 10:e.t0=e.sent,e.next=16;break;case 13:return e.next=15,Object(m.a)(u);case 15:e.t0=e.sent;case 16:return l=e.t0,e.next=19,l.result.json();case 19:return d=e.sent,g=[],O={},j=[],y=function(e){if(e.email){var t={name:e.displayName,userPrincipalName:e.email};O[t.userPrincipalName]||(O[t.userPrincipalName]=t)}else j.push(e.displayName)},d&&d.value&&d.value.map((function(e){if(e.grantedTo&&y(e.grantedTo.user),e.grantedToIdentities&&e.grantedToIdentities.map((function(e){y(e.user)})),e.link){var t={text:e.link.localizedDescription,scope:e.link.scope,type:e.link.type};g.push(t)}})),I=Object.values(O),P={personas:I,links:g,groups:j},o.setResult(!0),e.abrupt("return",P);case 31:return e.prev=31,e.t1=e.catch(1),o.setResult(!1,{errorType:b.b.GetPermissionsError}),e.abrupt("return",Promise.reject(e.t1));case 35:case"end":return e.stop()}}),e,null,[[1,31]])})));return function(t,r,n,a){return e.apply(this,arguments)}}(),j=function(){function e(t,r,n,o,i,s,c){Object(a.a)(this,e),this.bootDocumentInfo=t,this.localization=r,this.tokenProvider=n,this.logger=o,this.appName=i,this.tenantId=s,this.getShareUXTargetElement=c}return Object(o.a)(e,[{key:"ShareServicePromise",get:function(){return Promise.resolve(this)}},{key:"checkUserAccess",value:function(){var e=Object(n.a)(s.a.mark((function e(t){var r,n,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.resolvedUrl,n=t.userPrincipalName,a=this.getDocumentInfo(r),e.abrupt("return",g(n,a,this.tokenProvider,this.logger,this.tenantId));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"grantPermissions",value:function(){var e=Object(n.a)(s.a.mark((function e(t){var r,n,a,o,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.resolvedUrl,n=t.userPrincipalNames,a=t.uxConfiguration,o=this.getDocumentInfo(r),i=this.resolveShareUXConfig(a,{shareMode:c.a.atMention}),e.abrupt("return",Object(d.f)(Object.assign(Object.assign({tokenProvider:this.tokenProvider,logger:this.logger,localization:this.localization,defaultRecipients:n},o),{fileId:o.itemId,shareUXConfig:i,tenantId:this.tenantId})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"shareLink",value:function(){var e=Object(n.a)(s.a.mark((function e(t){var r,n,a,o,i,c,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.resolvedUrl,n=t.componentPath,a=t.uxConfiguration,o=this.resolveShareUXConfig(a),i={tokenProvider:this.tokenProvider,logger:this.logger,localization:this.localization,shareUXConfig:o,tenantId:this.tenantId},void 0!==n){e.next=6;break}return c=this.getDocumentInfo(r),e.abrupt("return",Object(d.f)(Object.assign(Object.assign(Object.assign({},i),c),{fileId:c.itemId})));case 6:return u=this.getComponentLocator(n,r),e.abrupt("return",Object(d.f)(Object.assign(Object.assign(Object.assign({},i),u),{fileId:u.itemId})));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPermissions",value:function(){var e=Object(n.a)(s.a.mark((function e(t){var r,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.resolvedUrl,n=this.getDocumentInfo(r),e.abrupt("return",O(n,this.tokenProvider,this.logger,this.tenantId));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDocumentInfo",value:function(e){var t;if(!e)return this.logger&&Object(u.c)(this.logger,{eventName:b.b.GetDocumentInfoError}),Object.assign(Object.assign({},this.bootDocumentInfo),{itemId:this.bootDocumentInfo.fileId});if(!Object(l.c)(e)){var r=new Error("Invalid file information: ResolvedUrl is not of the expected ODSP type");return this.logger&&Object(u.b)(this.logger,{eventName:b.b.GetDocumentInfoError},r),Object.assign(Object.assign({},this.bootDocumentInfo),{itemId:this.bootDocumentInfo.fileId})}return{driveId:e.driveId,siteUrl:e.siteUrl,itemId:e.itemId,containerPackageName:null===(t=e.codeHint)||void 0===t?void 0:t.containerPackageName}}},{key:"getComponentLocator",value:function(e,t){var r=this.getDocumentInfo(t);return Object.assign(Object.assign({},r),{dataStorePath:e,appName:this.appName})}},{key:"resolveShareUXConfig",value:function(e,t){var r,n,a,o,i=Object(d.e)(e)?e:t;return(null===(r=null===i||void 0===i?void 0:i.shareControl)||void 0===r?void 0:r.props)&&(i.shareControl.props=Object.assign(Object.assign({},i.shareControl.props),{target:null!==(a=null===(n=i.shareControl.props)||void 0===n?void 0:n.target)&&void 0!==a?a:null===(o=this.getShareUXTargetElement)||void 0===o?void 0:o.call(this)})),i}}]),e}()},743:function(e,t,r){"use strict";var n,a,o,i;r.d(t,"d",(function(){return n})),r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return i})),function(e){e.ShareDocument="ShareDocument"}(n||(n={})),function(e){e.RenderShare="RenderShare",e.CompleteShare="CompleteShare",e.CheckDocumentAccess="CheckDocumentAccess",e.GetPermissions="GetPermissions"}(a||(a={})),function(e){e.GetPermissionsError="GetPermissionsError",e.CheckDocumentAccessError="CheckDocumentAccessError",e.GetDocumentInfoError="GetDocumentInfoError",e.GeneratePayloadError="GeneratePayloadError",e.SpoShareError="SpoShareError",e.SpoTimeoutError="SpoTimeoutError",e.IframeLoadTimeoutError="IframeLoadTimeoutError",e.UnknownShareError="UnknownShareError"}(o||(o={})),function(e){e.ShareDialogOpened="ShareDialogOpened"}(i||(i={}))},775:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var n,a=r(2),o=r(3),i=r(4),s=r(5),c=r(49);!function(e){e[e.specificPeople=0]="specificPeople",e[e.organization=1]="organization",e[e.anyone=2]="anyone",e[e.existing=3]="existing",e[e.specificPeopleFlex=4]="specificPeopleFlex",e[e.customLabeledSpecificPeople=5]="customLabeledSpecificPeople"}(n||(n={}));var u=function(e){Object(i.a)(r,e);var t=Object(s.a)(r);function r(e,n,a,i,s){var c;return Object(o.a)(this,r),(c=t.call(this,n||e)).errorType=e,c.debugErrorMessage=a,c.spoError=i,c.spoErrorCategory=s,c}return Object(a.a)(r)}(Object(c.a)(Error))},779:function(e,t,r){"use strict";r.d(t,"f",(function(){return F})),r.d(t,"e",(function(){return J})),r.d(t,"c",(function(){return q})),r.d(t,"a",(function(){return H})),r.d(t,"b",(function(){return _})),r.d(t,"d",(function(){return B}));var n=r(6),a=r(1),o=r(0),i=r.n(o),s=r(731),c=r(748),u=r(223),l=r(317),d=r(213),p=r(212),f=r(892),h=r(1260),m=r(582),v=r(1259),b=r(333),g=r(1267),O=r(8),j=r(332),y="--ms-themeColorPalette",I="--ms-themeColor";function P(e){var t={},r={},n=Object(j.a)(),a=function(e,a){if(e.startsWith(y)){var o=function(e){var t="--ms-themeColorPaletteShared",r="--ms-themeColorPaletteAccent";if(e.startsWith(t))return k(e,t);if(e.startsWith(r))return k(e,r);if(e.startsWith(y))return k(e,y);return}(e);void 0!==o&&n.palette.hasOwnProperty(o)&&!t[o]&&(t[o]=a)}else if(e.startsWith(I)){var i=k(e,I);i&&n.semanticColors.hasOwnProperty(i)&&!r[i]&&(r[i]=a)}};if(e){var o,i=Object(O.a)(e);try{for(i.s();!(o=i.n()).done;){var s=o.value;a(s.name,s.value)}}catch(c){i.e(c)}finally{i.f()}}return Object(j.a)({palette:t,semanticColors:r})}function k(e,t){var r=e.substring(t.length);return"".concat(r.substring(0,1).toLowerCase()).concat(r.substring(1))}var E=function(){return null},S=r(743),C=r(775),w=r(1275);function T(){return(T=Object(a.a)(i.a.mark((function e(t,r){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(r);case 2:return n=e.sent,e.abrupt("return",Object(w.a)(n,r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var D=function(e){return r(908)("./".concat(e,"/HostDefaultsStrings.json"))};function x(e){return function(e,t){return T.apply(this,arguments)}(D,e)}function U(){return(U=Object(a.a)(i.a.mark((function e(t){var a,o,c,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([x(t),Promise.all([r.e(0),r.e(2),r.e(267)]).then(r.bind(null,1268))]);case 2:return a=e.sent,o=Object(n.a)(a,2),c=o[0],u=o[1],e.abrupt("return",{default:function(e){return s.createElement(u.ShareDialogRenderer,Object.assign({stringTable:c},e))}});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(){return(N=Object(a.a)(i.a.mark((function e(t){var a,o,c,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([x(t),Promise.all([r.e(0),r.e(266)]).then(r.bind(null,1289))]);case 2:return a=e.sent,o=Object(n.a)(a,2),c=o[0],u=o[1],e.abrupt("return",{default:function(e){return s.createElement(u.ShareCalloutRenderer,Object.assign({stringTable:c},e))}});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var L=r(79),G=r(334),M=r(707);function R(e,t,r,n,a,o){var i=function(e){switch(e){case g.a.default:return"DefaultShare";case g.a.copyLink:return"CopyLink";case g.a.atMention:return"AtMention"}}(t);Object(L.c)(e,{eventName:S.c.ShareDialogOpened,entrypoint:i,sharePointCorrelationId:o}),n.then((function(t){Object(L.a)(e,{eventName:S.a.CompleteShare,succeeded:!0,shared:t,entrypoint:i,sharePointCorrelationId:o}),t&&Object(L.d)(e,{eventName:S.d.ShareDocument,entrypoint:i})})).catch((function(t){Object(L.a)(e,{eventName:S.a.CompleteShare,succeeded:!1,entrypoint:i,sharePointCorrelationId:o,errorType:t.errorType||S.b.UnknownShareError,debugErrorMessage:t.debugErrorMessage,spoError:t.spoError,spoErrorCategory:t.spoErrorCategory},t)}));var s=G.a.start(S.a.RenderShare,e);r.then((function(e){s.setResult(!0,Object.assign({rendered:e,entrypoint:i,sharePointCorrelationId:o},z(a,s.startTime)))})).catch((function(e){s.setResult(!1,Object.assign({entrypoint:i,sharePointCorrelationId:o,errorType:e.errorType||S.b.UnknownShareError,debugErrorMessage:e.debugErrorMessage,spoError:e.spoError,spoErrorCategory:e.spoErrorCategory},z(a,s.startTime)),e)}))}function z(e,t){return{payloadLoadStartTime:Object(M.a)(e.payloadLoadStartTime,t),payloadLoadEndTime:Object(M.a)(e.payloadLoadEndTime,t),payloadSendStartTime:Object(M.a)(e.payloadSendStartTime,t),sharePointLoadStartTime:Object(M.a)(e.sharePointLoadStartTime,t)}}var A=r(907);function F(e){var t,r,n=e.shareUXConfig,a=e.tokenProvider,o=e.fileId,i=e.driveId,p=e.siteUrl,f=e.localization,h=e.logger,m=e.defaultRecipients,v=e.dataStorePath,b=e.appName,O=e.correlationId,j={},y=new l.a,I=new l.a,k=(null===n||void 0===n?void 0:n.shareMode)||g.a.default,w=O||Object(u.a)();h&&R(h,k,I,y,j,w),Object(d.b)(25e3,[I,y]).then((function(e){if(e){var t=new C.a(S.b.IframeLoadTimeoutError);W(I,y,t)}})).catch((function(){}));try{j.payloadLoadStartTime=performance.now();var T=null!==(r=null===(t=null===n||void 0===n?void 0:n.shareControl)||void 0===t?void 0:t.props)&&void 0!==r?r:{theme:void 0,themeProperties:void 0},D=T.theme,x=T.themeProperties,L=T.target;!D&&x&&(D=P(x),n.shareControl.props.theme=D);var G=function(e,t,r,n,a,o,i,s,c,u,l,d,p){return X.apply(this,arguments)}(k,a,o,i,p,f.locale,h,w,m,v,b,void 0,D),M=null!==n&&void 0!==n?n:{shareControl:void 0,setFocusOnDismiss:void 0},z=M.shareControl,A=M.setFocusOnDismiss;G.then((function(){j.payloadLoadEndTime=performance.now(),Object(d.b)(15e3,[I,y]).then((function(e){if(e){var t=new C.a(S.b.SpoTimeoutError);W(I,y,t)}})).catch((function(){}))})).catch((function(){}));var F=function(){!function(e,t,r){e.resolve(r),t.resolve(r)}(I,y,!1),A&&A()},J=L||document.createElement("div");if("Callout"===(null===z||void 0===z?void 0:z.type)){var q=s.lazy((function(){return function(e){return N.apply(this,arguments)}(f.locale)}));c.render(s.createElement(s.Suspense,{fallback:s.createElement(E,null)},s.createElement(q,{payloadPromise:G,onRenderPromise:I,onCompletePromise:y,onDismissCallout:F,perfMarks:j,localization:f,calloutProps:z.props})),J)}else{var H=s.lazy((function(){return function(e){return U.apply(this,arguments)}(f.locale)}));c.render(s.createElement(s.Suspense,{fallback:s.createElement(E,null)},s.createElement(H,{payloadPromise:G,onRenderPromise:I,onCompletePromise:y,onDismissDialog:F,perfMarks:j,shareMode:k,localization:f,dialogProps:null===z||void 0===z?void 0:z.props})),J)}}catch(_){W(I,y,_)}return y}function X(){return(X=Object(a.a)(i.a.mark((function e(t,r,a,o,s,c,u,l,d,g,O,j,y){var I,P,k,E,w,T,D,x,U;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s&&o&&a){e.next=2;break}throw new C.a(S.b.GeneratePayloadError,"File information is missing");case 2:if("UnauthenticatedGuest"!==r.identityType){e.next=4;break}throw new C.a(S.b.GeneratePayloadError,"UnauthenticatedGuest user is not allowed to use share functionality");case 4:return I="Consumer"===r.identityType,P=Object(p.a)(s),e.next=8,Promise.all([Object(f.a)(r,s,o,a,u,c),r.getToken(Object(A.a)(P,I),{tenantId:c}),I?Promise.resolve(""):Object(h.a)(r,u)]);case 8:if(k=e.sent,E=Object(n.a)(k,3),w=E[0],T=E[1],D=E[2],w&&w.webDavUrl&&w.name){e.next=15;break}throw new C.a(S.b.GeneratePayloadError,"Failed to fetch file info");case 15:return x=T.token,U={mode:t,authToken:x,clientId:"fluid",itemName:w.name,itemExtension:"fluid",isFolder:!1,isODB:P.indexOf("".concat(m.a,"."))>0,organizationName:Object(v.a)(D)?"":D,webAbsoluteUrl:s,correlationId:l,navId:void 0!==g?b.a.createNavParam({siteUrl:s,driveId:o,itemId:a,dataStorePath:g,appName:O,containerPackageName:j}):void 0,listId:w.sharepointIds.listId,listItemId:w.sharepointIds.listItemId,theme:y},d&&(U.defaultRecipients=d,U.accessChecked=!0),e.abrupt("return",JSON.stringify(U));case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e,t,r){e.reject(r),t.reject(r)}function J(e){return!!e&&"shareMode"in e}var q=320,H=500,_=350;function B(e){return Math.min(window.innerWidth,e)}},907:function(e,t,r){"use strict";function n(e,t){return[t?"onedrive.readwrite":"".concat(e,"/files.readwrite.all")]}r.d(t,"a",(function(){return n}))}}]);
//# sourceMappingURL=272.c19ba36f.chunk.js.map